var Gm=Object.defineProperty;var e_=(n,e,t)=>e in n?Gm(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var _=(n,e,t)=>e_(n,typeof e!="symbol"?e+"":e,t);function t_(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}function rd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function n_(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var lo={exports:{}},yr={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vl;function r_(){if(vl)return yr;vl=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,s,i){var o=null;if(i!==void 0&&(o=""+i),s.key!==void 0&&(o=""+s.key),"key"in s){i={};for(var a in s)a!=="key"&&(i[a]=s[a])}else i=s;return s=i.ref,{$$typeof:n,type:r,key:o,ref:s!==void 0?s:null,props:i}}return yr.Fragment=e,yr.jsx=t,yr.jsxs=t,yr}var wl;function s_(){return wl||(wl=1,lo.exports=r_()),lo.exports}var B=s_(),uo={exports:{}},ee={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tl;function i_(){if(Tl)return ee;Tl=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function f(P){return P===null||typeof P!="object"?null:(P=h&&P[h]||P["@@iterator"],typeof P=="function"?P:null)}var d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,m={};function g(P,U,W){this.props=P,this.context=U,this.refs=m,this.updater=W||d}g.prototype.isReactComponent={},g.prototype.setState=function(P,U){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,U,"setState")},g.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function y(){}y.prototype=g.prototype;function S(P,U,W){this.props=P,this.context=U,this.refs=m,this.updater=W||d}var v=S.prototype=new y;v.constructor=S,p(v,g.prototype),v.isPureReactComponent=!0;var x=Array.isArray,T={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function M(P,U,W,H,G,le){return W=le.ref,{$$typeof:n,type:P,key:U,ref:W!==void 0?W:null,props:le}}function N(P,U){return M(P.type,U,void 0,void 0,void 0,P.props)}function L(P){return typeof P=="object"&&P!==null&&P.$$typeof===n}function j(P){var U={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(W){return U[W]})}var $=/\/+/g;function K(P,U){return typeof P=="object"&&P!==null&&P.key!=null?j(""+P.key):U.toString(36)}function se(){}function Z(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(se,se):(P.status="pending",P.then(function(U){P.status==="pending"&&(P.status="fulfilled",P.value=U)},function(U){P.status==="pending"&&(P.status="rejected",P.reason=U)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function ie(P,U,W,H,G){var le=typeof P;(le==="undefined"||le==="boolean")&&(P=null);var J=!1;if(P===null)J=!0;else switch(le){case"bigint":case"string":case"number":J=!0;break;case"object":switch(P.$$typeof){case n:case e:J=!0;break;case u:return J=P._init,ie(J(P._payload),U,W,H,G)}}if(J)return G=G(P),J=H===""?"."+K(P,0):H,x(G)?(W="",J!=null&&(W=J.replace($,"$&/")+"/"),ie(G,U,W,"",function(An){return An})):G!=null&&(L(G)&&(G=N(G,W+(G.key==null||P&&P.key===G.key?"":(""+G.key).replace($,"$&/")+"/")+J)),U.push(G)),1;J=0;var De=H===""?".":H+":";if(x(P))for(var de=0;de<P.length;de++)H=P[de],le=De+K(H,de),J+=ie(H,U,W,le,G);else if(de=f(P),typeof de=="function")for(P=de.call(P),de=0;!(H=P.next()).done;)H=H.value,le=De+K(H,de++),J+=ie(H,U,W,le,G);else if(le==="object"){if(typeof P.then=="function")return ie(Z(P),U,W,H,G);throw U=String(P),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.")}return J}function be(P,U,W){if(P==null)return P;var H=[],G=0;return ie(P,H,"","",function(le){return U.call(W,le,G++)}),H}function tt(P){if(P._status===-1){var U=P._result;U=U(),U.then(function(W){(P._status===0||P._status===-1)&&(P._status=1,P._result=W)},function(W){(P._status===0||P._status===-1)&&(P._status=2,P._result=W)}),P._status===-1&&(P._status=0,P._result=U)}if(P._status===1)return P._result.default;throw P._result}var ze=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var U=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(U))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)};function dt(){}return ee.Children={map:be,forEach:function(P,U,W){be(P,function(){U.apply(this,arguments)},W)},count:function(P){var U=0;return be(P,function(){U++}),U},toArray:function(P){return be(P,function(U){return U})||[]},only:function(P){if(!L(P))throw Error("React.Children.only expected to receive a single React element child.");return P}},ee.Component=g,ee.Fragment=t,ee.Profiler=s,ee.PureComponent=S,ee.StrictMode=r,ee.Suspense=c,ee.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,ee.act=function(){throw Error("act(...) is not supported in production builds of React.")},ee.cache=function(P){return function(){return P.apply(null,arguments)}},ee.cloneElement=function(P,U,W){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var H=p({},P.props),G=P.key,le=void 0;if(U!=null)for(J in U.ref!==void 0&&(le=void 0),U.key!==void 0&&(G=""+U.key),U)!I.call(U,J)||J==="key"||J==="__self"||J==="__source"||J==="ref"&&U.ref===void 0||(H[J]=U[J]);var J=arguments.length-2;if(J===1)H.children=W;else if(1<J){for(var De=Array(J),de=0;de<J;de++)De[de]=arguments[de+2];H.children=De}return M(P.type,G,void 0,void 0,le,H)},ee.createContext=function(P){return P={$$typeof:o,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:i,_context:P},P},ee.createElement=function(P,U,W){var H,G={},le=null;if(U!=null)for(H in U.key!==void 0&&(le=""+U.key),U)I.call(U,H)&&H!=="key"&&H!=="__self"&&H!=="__source"&&(G[H]=U[H]);var J=arguments.length-2;if(J===1)G.children=W;else if(1<J){for(var De=Array(J),de=0;de<J;de++)De[de]=arguments[de+2];G.children=De}if(P&&P.defaultProps)for(H in J=P.defaultProps,J)G[H]===void 0&&(G[H]=J[H]);return M(P,le,void 0,void 0,null,G)},ee.createRef=function(){return{current:null}},ee.forwardRef=function(P){return{$$typeof:a,render:P}},ee.isValidElement=L,ee.lazy=function(P){return{$$typeof:u,_payload:{_status:-1,_result:P},_init:tt}},ee.memo=function(P,U){return{$$typeof:l,type:P,compare:U===void 0?null:U}},ee.startTransition=function(P){var U=T.T,W={};T.T=W;try{var H=P(),G=T.S;G!==null&&G(W,H),typeof H=="object"&&H!==null&&typeof H.then=="function"&&H.then(dt,ze)}catch(le){ze(le)}finally{T.T=U}},ee.unstable_useCacheRefresh=function(){return T.H.useCacheRefresh()},ee.use=function(P){return T.H.use(P)},ee.useActionState=function(P,U,W){return T.H.useActionState(P,U,W)},ee.useCallback=function(P,U){return T.H.useCallback(P,U)},ee.useContext=function(P){return T.H.useContext(P)},ee.useDebugValue=function(){},ee.useDeferredValue=function(P,U){return T.H.useDeferredValue(P,U)},ee.useEffect=function(P,U){return T.H.useEffect(P,U)},ee.useId=function(){return T.H.useId()},ee.useImperativeHandle=function(P,U,W){return T.H.useImperativeHandle(P,U,W)},ee.useInsertionEffect=function(P,U){return T.H.useInsertionEffect(P,U)},ee.useLayoutEffect=function(P,U){return T.H.useLayoutEffect(P,U)},ee.useMemo=function(P,U){return T.H.useMemo(P,U)},ee.useOptimistic=function(P,U){return T.H.useOptimistic(P,U)},ee.useReducer=function(P,U,W){return T.H.useReducer(P,U,W)},ee.useRef=function(P){return T.H.useRef(P)},ee.useState=function(P){return T.H.useState(P)},ee.useSyncExternalStore=function(P,U,W){return T.H.useSyncExternalStore(P,U,W)},ee.useTransition=function(){return T.H.useTransition()},ee.version="19.0.0",ee}var xl;function sd(){return xl||(xl=1,uo.exports=i_()),uo.exports}var C=sd();const o_=rd(C),Sl=t_({__proto__:null,default:o_},[C]);var ho={exports:{}},Be={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Al;function a_(){if(Al)return Be;Al=1;var n=sd();function e(c){var l="https://react.dev/errors/"+c;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)l+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+c+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function i(c,l,u){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:h==null?null:""+h,children:c,containerInfo:l,implementation:u}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(c,l){if(c==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return Be.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Be.createPortal=function(c,l){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(e(299));return i(c,l,null,u)},Be.flushSync=function(c){var l=o.T,u=r.p;try{if(o.T=null,r.p=2,c)return c()}finally{o.T=l,r.p=u,r.d.f()}},Be.preconnect=function(c,l){typeof c=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,r.d.C(c,l))},Be.prefetchDNS=function(c){typeof c=="string"&&r.d.D(c)},Be.preinit=function(c,l){if(typeof c=="string"&&l&&typeof l.as=="string"){var u=l.as,h=a(u,l.crossOrigin),f=typeof l.integrity=="string"?l.integrity:void 0,d=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;u==="style"?r.d.S(c,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:h,integrity:f,fetchPriority:d}):u==="script"&&r.d.X(c,{crossOrigin:h,integrity:f,fetchPriority:d,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},Be.preinitModule=function(c,l){if(typeof c=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var u=a(l.as,l.crossOrigin);r.d.M(c,{crossOrigin:u,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&r.d.M(c)},Be.preload=function(c,l){if(typeof c=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var u=l.as,h=a(u,l.crossOrigin);r.d.L(c,u,{crossOrigin:h,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},Be.preloadModule=function(c,l){if(typeof c=="string")if(l){var u=a(l.as,l.crossOrigin);r.d.m(c,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:u,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else r.d.m(c)},Be.requestFormReset=function(c){r.d.r(c)},Be.unstable_batchedUpdates=function(c,l){return c(l)},Be.useFormState=function(c,l,u){return o.H.useFormState(c,l,u)},Be.useFormStatus=function(){return o.H.useHostTransitionStatus()},Be.version="19.0.0",Be}var El;function c_(){if(El)return ho.exports;El=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),ho.exports=a_(),ho.exports}function Hs(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const _c=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Rl=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Rl&&parseFloat(Rl[1]);const ls=globalThis,En=globalThis.process||{},l_=globalThis.navigator||{};function id(n){var r,s;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function vn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||id()}function u_(n){return vn()?id()?"Electron":(l_.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const od="4.1.0";function h_(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class f_{constructor(e,t,r="sessionStorage"){this.storage=h_(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function d_(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function p_(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var zs;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(zs||(zs={}));const g_=10;function Cl(n){return typeof n!="string"?n:(n=n.toUpperCase(),zs[n]||zs.WHITE)}function m_(n,e,t){return!vn&&typeof n=="string"&&(e&&(n=`\x1B[${Cl(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${Cl(t)+g_}m${n}\x1B[49m`)),n}function __(n,e=["constructor"]){const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t),s=n;for(const i of r){const o=s[i];typeof o=="function"&&(e.find(a=>i===a)||(s[i]=o.bind(n)))}}function bc(n,e){if(!n)throw new Error("Assertion failed")}function Rn(){var e,t,r;let n;if(vn()&&ls.performance)n=(t=(e=ls==null?void 0:ls.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in En){const s=(r=En==null?void 0:En.hrtime)==null?void 0:r.call(En);n=s[0]*1e3+s[1]/1e6}else n=Date.now();return n}const Cn={debug:vn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},b_={enabled:!0,level:0};function In(){}const Il={},Pl={once:!0};class ns{constructor({id:e}={id:""}){this.VERSION=od,this._startTs=Rn(),this._deltaTs=Rn(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new f_(`__probe-${this.id}__`,b_),this.timeStamp(`${this.id} started`),__(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Rn()-this._startTs).toPrecision(10))}getDelta(){return Number((Rn()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Cn.warn,arguments,Pl)}error(e){return this._getLogFunction(0,e,Cn.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Cn.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Cn.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Cn.debug||Cn.info,arguments,Pl)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||In,r&&[r],{tag:v_(t)}):In}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||In)}group(e,t,r={collapsed:!1}){const s=Ol({logLevel:e,message:t,opts:r}),{collapsed:i}=r;return s.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||In)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=ad(e)}_getLogFunction(e,t,r,s,i){if(this._shouldLog(e)){i=Ol({logLevel:e,message:t,args:s,opts:i}),r=r||i.method,bc(r),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=Rn();const o=i.tag||i.message;if(i.once&&o)if(!Il[o])Il[o]=Rn();else return In;return t=y_(this.id,i.message,i),r.bind(console,t,...i.args)}return In}}ns.VERSION=od;function ad(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return bc(Number.isFinite(e)&&e>=0),e}function Ol(n){const{logLevel:e,message:t}=n;n.logLevel=ad(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return bc(s==="string"||s==="object"),Object.assign(n,{args:r},n.opts)}function y_(n,e,t){if(typeof e=="string"){const r=t.time?p_(d_(t.total)):"";e=t.time?`${n}: ${r}  ${e}`:`${n}: ${e}`,e=m_(e,t.color,t.background)}return e}function v_(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const fo="4.3.2",w_=fo[0]>="0"&&fo[0]<="9"?`v${fo}`:"";function T_(){const n=new ns({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=w_,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const x_=T_();function S_(n,e){return cd(n||{},e)}function cd(n,e,t=0){if(t>3)return e;const r={...n};for(const[s,i]of Object.entries(e))i&&typeof i=="object"&&!Array.isArray(i)?r[s]=cd(r[s]||{},e[s],t+1):r[s]=e[s];return r}const A_="latest";function E_(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const R_=E_();function en(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const hn=typeof process!="object"||String(process)!=="[object process]"||process.browser,C_=typeof window<"u"&&typeof window.orientation<"u",kl=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);kl&&parseFloat(kl[1]);class I_{constructor(e,t){_(this,"name");_(this,"workerThread");_(this,"isRunning",!0);_(this,"result");_(this,"_resolve",()=>{});_(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){en(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){en(this.isRunning),this.isRunning=!1,this._reject(e)}}class po{terminate(){}}const go=new Map;function P_(n){en(n.source&&!n.url||!n.source&&n.url);let e=go.get(n.source||n.url);return e||(n.url&&(e=O_(n.url),go.set(n.url,e)),n.source&&(e=ld(n.source),go.set(n.source,e))),en(e),e}function O_(n){if(!n.startsWith("http"))return n;const e=k_(n);return ld(e)}function ld(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function k_(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function ud(n,e=!0,t){const r=t||new Set;if(n){if(Ml(n))r.add(n);else if(Ml(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)ud(n[s],e,r)}}return t===void 0?Array.from(r):[]}function Ml(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const mo=()=>{};class fa{constructor(e){_(this,"name");_(this,"source");_(this,"url");_(this,"terminated",!1);_(this,"worker");_(this,"onMessage");_(this,"onError");_(this,"_loadableURL","");const{name:t,source:r,url:s}=e;en(r||s),this.name=t,this.source=r,this.url=s,this.onMessage=mo,this.onError=i=>console.log(i),this.worker=hn?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&hn||typeof po<"u"&&!hn}destroy(){this.onMessage=mo,this.onError=mo,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||ud(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=P_({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new po(r,{eval:!1})}else if(this.source)e=new po(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class M_{constructor(e){_(this,"name","unnamed");_(this,"source");_(this,"url");_(this,"maxConcurrency",1);_(this,"maxMobileConcurrency",1);_(this,"onDebug",()=>{});_(this,"reuseWorkers",!0);_(this,"props",{});_(this,"jobQueue",[]);_(this,"idleQueue",[]);_(this,"count",0);_(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return fa.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,i,o)=>s.done(o),r=(s,i)=>s.error(i)){const s=new Promise(i=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:i}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new I_(t.name,e);e.onMessage=s=>t.onMessage(r,s.type,s.payload),e.onError=s=>t.onError(r,s),t.onStart(r);try{await r.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!hn||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new fa({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return C_?this.maxMobileConcurrency:this.maxConcurrency}}const N_={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},zt=class zt{constructor(e){_(this,"props");_(this,"workerPools",new Map);this.props={...N_},this.setProps(e),this.workerPools=new Map}static isSupported(){return fa.isSupported()}static getWorkerFarm(e={}){return zt._workerFarm=zt._workerFarm||new zt({}),zt._workerFarm.setProps(e),zt._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:s}=e;let i=this.workerPools.get(t);return i||(i=new M_({name:t,source:r,url:s}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};_(zt,"_workerFarm");let Xs=zt;function D_(n,e={}){const t=e[n.id]||{},r=hn?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(hn?s=`modules/${n.module}/dist/${r}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let i=n.version;i==="latest"&&(i=A_);const o=i?`@${i}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${o}/dist/${r}`}return en(s),s}function F_(n,e=R_){en(n,"no worker provided");const t=n.version;return!(!e||!t)}function U_(n,e){return!Xs.isSupported()||!hn&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function B_(n,e,t,r,s){const i=n.id,o=D_(n,t),c=Xs.getWorkerFarm(t).getWorkerPool({name:i,url:o});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const l=await c.startJob("process-on-worker",L_.bind(null,s));return l.postMessage("process",{input:e,options:t,context:r}),await(await l.result).result}async function L_(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:i,options:o}=r;try{const a=await n(i,o);e.postMessage("done",{id:s,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:s,error:c})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function V_(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),s=new Uint8Array(e);for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}function $_(...n){return j_(n)}function j_(n){const e=n.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),t=e.reduce((i,o)=>i+o.byteLength,0),r=new Uint8Array(t);let s=0;for(const i of e)r.set(i,s),s+=i.byteLength;return r.buffer}async function W_(n){const e=[];for await(const t of n)e.push(t);return $_(...e)}function Nl(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class Dl{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Nl(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Nl()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Hi{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let s=this.stats[t];return s||(e instanceof Dl?s=e:s=new Dl(t,r),this.stats[t]=s),s}}let H_="";const Fl={};function z_(n){for(const e in Fl)if(n.startsWith(e)){const t=Fl[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${H_}${n}`),n}function X_(n){return n&&typeof n=="object"&&n.isBuffer}function hd(n){if(X_(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function fd(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function q_(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const Y_=n=>typeof n=="boolean",Dr=n=>typeof n=="function",rs=n=>n!==null&&typeof n=="object",Ul=n=>rs(n)&&n.constructor==={}.constructor,K_=n=>!!n&&typeof n[Symbol.iterator]=="function",Z_=n=>n&&typeof n[Symbol.asyncIterator]=="function",wn=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Tn=n=>typeof Blob<"u"&&n instanceof Blob,J_=n=>n&&typeof n=="object"&&n.isBuffer,Q_=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||rs(n)&&Dr(n.tee)&&Dr(n.cancel)&&Dr(n.getReader),G_=n=>rs(n)&&Dr(n.read)&&Dr(n.pipe)&&Y_(n.readable),dd=n=>Q_(n)||G_(n);class eb extends Error{constructor(t,r){super(t);_(this,"reason");_(this,"url");_(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const tb=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,nb=/^([-\w.]+\/[-\w.+]+)/;function Bl(n,e){return n.toLowerCase()===e.toLowerCase()}function rb(n){const e=nb.exec(n);return e?e[1]:n}function Ll(n){const e=tb.exec(n);return e?e[1]:""}const pd=/\?.*/;function sb(n){const e=n.match(pd);return e&&e[0]}function yc(n){return n.replace(pd,"")}function ib(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function zi(n){return wn(n)?n.url:Tn(n)?n.name||"":typeof n=="string"?n:""}function vc(n){if(wn(n)){const e=n,t=e.headers.get("content-type")||"",r=yc(e.url);return rb(t)||Ll(r)}return Tn(n)?n.type||"":typeof n=="string"?Ll(n):""}function ob(n){return wn(n)?n.headers["content-length"]||-1:Tn(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function gd(n){if(wn(n))return n;const e={},t=ob(n);t>=0&&(e["content-length"]=String(t));const r=zi(n),s=vc(n);s&&(e["content-type"]=s);const i=await lb(n);i&&(e["x-first-bytes"]=i),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function ab(n){if(!n.ok)throw await cb(n)}async function cb(n){const e=ib(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const r={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");r.reason=!n.bodyUsed&&(s!=null&&s.includes("application/json"))?await n.json():await n.text()}catch{}return new eb(t,r)}async function lb(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const s=new FileReader;s.onload=i=>{var o;return r((o=i==null?void 0:i.target)==null?void 0:o.result)},s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${ub(t)}`}return null}function ub(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function hb(n){return!fb(n)&&!db(n)}function fb(n){return n.startsWith("http:")||n.startsWith("https:")}function db(n){return n.startsWith("data:")}async function Vl(n,e){var t,r;if(typeof n=="string"){const s=z_(n);return hb(s)&&(t=globalThis.loaders)!=null&&t.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(s,e):await fetch(s,e)}return await gd(n)}const $l=new ns({id:"loaders.gl"});class pb{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class gb{constructor(){_(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const md={fetch:null,mimeType:void 0,nothrow:!1,log:new gb,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:_c,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},mb={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function _d(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function bd(){const n=_d();return n.globalOptions=n.globalOptions||{...md},n.globalOptions}function _b(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],bb(n,t),vb(e,n,r)}function bb(n,e){jl(n,null,md,mb,e);for(const t of e){const r=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},i=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};jl(r,t.id,s,i,e)}}function jl(n,e,t,r,s){const i=e||"Top level",o=e?`${e}.`:"";for(const a in n){const c=!e&&rs(n[a]),l=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in t)&&!l&&!u){if(a in r)$l.warn(`${i} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!c){const h=yb(a,s);$l.warn(`${i} loader option '${o}${a}' not recognized. ${h}`)()}}}}function yb(n,e){const t=n.toLowerCase();let r="";for(const s of e)for(const i in s.options){if(n===i)return`Did you mean '${s.id}.${i}'?`;const o=i.toLowerCase();(t.startsWith(o)||o.startsWith(t))&&(r=r||`Did you mean '${s.id}.${i}'?`)}return r}function vb(n,e,t){const s={...n.options||{}};return wb(s,t),s.log===null&&(s.log=new pb),Wl(s,bd()),Wl(s,e),s}function Wl(n,e){for(const t in e)if(t in e){const r=e[t];Ul(r)&&Ul(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function wb(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function wc(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function Tc(n){Hs(n,"null loader"),Hs(wc(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const yd=()=>{const n=_d();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function Tb(n){const e=yd();n=Array.isArray(n)?n:[n];for(const t of n){const r=Tc(t);e.find(s=>r===s)||e.unshift(r)}}function xb(){return yd()}const Sb=/\.([^.]+)$/;async function Ab(n,e=[],t,r){if(!vd(n))return null;let s=Hl(n,e,{...t,nothrow:!0},r);if(s)return s;if(Tn(n)&&(n=await n.slice(0,10).arrayBuffer(),s=Hl(n,e,t,r)),!s&&!(t!=null&&t.nothrow))throw new Error(wd(n));return s}function Hl(n,e=[],t,r){if(!vd(n))return null;if(e&&!Array.isArray(e))return Tc(e);let s=[];e&&(s=s.concat(e)),t!=null&&t.ignoreRegisteredLoaders||s.push(...xb()),Rb(s);const i=Eb(n,s,t,r);if(!i&&!(t!=null&&t.nothrow))throw new Error(wd(n));return i}function Eb(n,e,t,r){const s=zi(n),i=vc(n),o=yc(s)||(r==null?void 0:r.url);let a=null,c="";return t!=null&&t.mimeType&&(a=_o(e,t==null?void 0:t.mimeType),c=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),a=a||Cb(e,o),c=c||(a?`matched url ${o}`:""),a=a||_o(e,i),c=c||(a?`matched MIME type ${i}`:""),a=a||Pb(e,n),c=c||(a?`matched initial data ${Td(n)}`:""),t!=null&&t.fallbackMimeType&&(a=a||_o(e,t==null?void 0:t.fallbackMimeType),c=c||(a?`matched fallback MIME type ${i}`:"")),c&&x_.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${c}.`),a}function vd(n){return!(n instanceof Response&&n.status===204)}function wd(n){const e=zi(n),t=vc(n);let r="No valid loader found (";r+=e?`${fd(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?Td(n):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function Rb(n){for(const e of n)Tc(e)}function Cb(n,e){const t=e&&Sb.exec(e),r=t&&t[1];return r?Ib(n,r):null}function Ib(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function _o(n,e){var t;for(const r of n)if((t=r.mimeTypes)!=null&&t.some(s=>Bl(e,s))||Bl(e,`application/x.${r.id}`))return r;return null}function Pb(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(Ob(e,t))return t}else if(ArrayBuffer.isView(e)){if(zl(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&zl(e,0,t))return t;return null}function Ob(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function zl(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>kb(n,e,t,s))}function kb(n,e,t,r){if(r instanceof ArrayBuffer)return V_(r,n,r.byteLength);switch(typeof r){case"function":return r(n);case"string":const s=da(n,e,r.length);return r===s;default:return!1}}function Td(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?da(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?da(n,0,e):""}function da(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let s="";for(let i=0;i<t;i++)s+=String.fromCharCode(r.getUint8(e+i));return s}const Mb=256*1024;function*Nb(n,e){const t=(e==null?void 0:e.chunkSize)||Mb;let r=0;const s=new TextEncoder;for(;r<n.length;){const i=Math.min(n.length-r,t),o=n.slice(r,r+i);r+=i,yield s.encode(o)}}const Db=256*1024;function*Fb(n,e={}){const{chunkSize:t=Db}=e;let r=0;for(;r<n.byteLength;){const s=Math.min(n.byteLength-r,t),i=new ArrayBuffer(s),o=new Uint8Array(n,r,s);new Uint8Array(i).set(o),r+=s,yield i}}const Ub=1024*1024;async function*Bb(n,e){const t=(e==null?void 0:e.chunkSize)||Ub;let r=0;for(;r<n.size;){const s=r+t,i=await n.slice(r,s).arrayBuffer();r=s,yield i}}function Xl(n,e){return _c?Lb(n,e):Vb(n)}async function*Lb(n,e){const t=n.getReader();let r;try{for(;;){const s=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:i,value:o}=await s;if(i)return;yield hd(o)}}catch{t.releaseLock()}}async function*Vb(n,e){for await(const t of n)yield hd(t)}function $b(n,e){if(typeof n=="string")return Nb(n,e);if(n instanceof ArrayBuffer)return Fb(n,e);if(Tn(n))return Bb(n,e);if(dd(n))return Xl(n,e);if(wn(n))return Xl(n.body,e);throw new Error("makeIterator")}const xd="Cannot convert supplied data type";function jb(n,e,t){if(e.text&&typeof n=="string")return n;if(J_(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+s)),r}throw new Error(xd)}async function Wb(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return jb(n,e);if(Tn(n)&&(n=await gd(n)),wn(n)){const s=n;return await ab(s),e.binary?await s.arrayBuffer():await s.text()}if(dd(n)&&(n=$b(n,t)),K_(n)||Z_(n))return W_(n);throw new Error(xd)}function Sd(n,e){const t=bd(),r=n||t;return typeof r.fetch=="function"?r.fetch:rs(r.fetch)?s=>Vl(s,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Vl}function Hb(n,e,t){if(t)return t;const r={fetch:Sd(e,n),...n};if(r.url){const s=yc(r.url);r.baseUrl=s,r.queryString=sb(r.url),r.filename=fd(s),r.baseUrl=q_(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function zb(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function qs(n,e,t,r){e&&!Array.isArray(e)&&!wc(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const s=zi(n),o=zb(e,r),a=await Ab(n,o,t);return a?(t=_b(t,a,o,s),r=Hb({url:s,_parse:qs,loaders:o},t,r||null),await Xb(a,n,t,r)):null}async function Xb(n,e,t,r){if(F_(n),t=S_(n.options,t),wn(e)){const i=e,{ok:o,redirected:a,status:c,statusText:l,type:u,url:h}=i,f=Object.fromEntries(i.headers.entries());r.response={headers:f,ok:o,redirected:a,status:c,statusText:l,type:u,url:h}}e=await Wb(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,r);if(U_(n,t))return await B_(n,e,t,r,qs);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,r);if(s.parse)return await s.parse(e,t,r);throw en(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function pa(n,e,t,r){let s,i;!Array.isArray(e)&&!wc(e)?(s=[],i=e):(s=e,i=t);const o=Sd(i);let a=n;return typeof n=="string"&&(a=await o(n)),Tn(n)&&(a=await o(n)),Array.isArray(s)?await qs(a,s,i):await qs(a,s,i)}const qb="4.3.2";var nd;const Yb=(nd=globalThis.loaders)==null?void 0:nd.parseImageNode,ga=typeof Image<"u",ma=typeof ImageBitmap<"u",Kb=!!Yb,_a=_c?!0:Kb;function Zb(n){switch(n){case"auto":return ma||ga||_a;case"imagebitmap":return ma;case"image":return ga;case"data":return _a;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function Jb(){if(ma)return"imagebitmap";if(ga)return"image";if(_a)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Qb(n){const e=ey(n);if(!e)throw new Error("Not an image");return e}function Gb(n){switch(Qb(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function ey(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const ty=/^data:image\/svg\+xml/,ny=/\.svg((\?|#).*)?$/;function xc(n){return n&&(ty.test(n)||ny.test(n))}function ry(n,e){if(xc(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return Ad(n,e)}function Ad(n,e){if(xc(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Ed(n,e,t){const r=ry(n,t),s=self.URL||self.webkitURL,i=typeof r!="string"&&s.createObjectURL(r);try{return await sy(i||r,e)}finally{i&&s.revokeObjectURL(i)}}async function sy(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,s)=>{try{t.onload=()=>r(t),t.onerror=i=>{const o=i instanceof Error?i.message:"error";s(new Error(o))}}catch(i){s(i)}})}const iy={};let ql=!0;async function oy(n,e,t){let r;xc(t)?r=await Ed(n,e,t):r=Ad(n,t);const s=e&&e.imagebitmap;return await ay(r,s)}async function ay(n,e=null){if((cy(e)||!ql)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),ql=!1}return await createImageBitmap(n)}function cy(n){for(const e in n||iy)return!1;return!0}function ly(n){return!dy(n,"ftyp",4)||(n[8]&96)===0?null:uy(n)}function uy(n){switch(hy(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function hy(n,e,t){return String.fromCharCode(...n.slice(e,t))}function fy(n){return[...n].map(e=>e.charCodeAt(0))}function dy(n,e,t=0){const r=fy(e);for(let s=0;s<r.length;++s)if(r[s]!==n[s+t])return!1;return!0}const wt=!1,Fr=!0;function Rd(n){const e=ss(n);return gy(e)||by(e)||my(e)||_y(e)||py(e)}function py(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=ly(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function gy(n){const e=ss(n);return e.byteLength>=24&&e.getUint32(0,wt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,wt),height:e.getUint32(20,wt)}:null}function my(n){const e=ss(n);return e.byteLength>=10&&e.getUint32(0,wt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Fr),height:e.getUint16(8,Fr)}:null}function _y(n){const e=ss(n);return e.byteLength>=14&&e.getUint16(0,wt)===16973&&e.getUint32(2,Fr)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Fr),height:e.getUint32(22,Fr)}:null}function by(n){const e=ss(n);if(!(e.byteLength>=3&&e.getUint16(0,wt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:s}=yy();let i=2;for(;i+9<e.byteLength;){const o=e.getUint16(i,wt);if(s.has(o))return{mimeType:"image/jpeg",height:e.getUint16(i+5,wt),width:e.getUint16(i+7,wt)};if(!r.has(o))return null;i+=2,i+=e.getUint16(i,wt)}return null}function yy(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function ss(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function vy(n,e){var s;const{mimeType:t}=Rd(n)||{},r=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return Hs(r),await r(n,t)}async function wy(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:i}=t||{},o=Ty(s);let a;switch(o){case"imagebitmap":a=await oy(n,e,i);break;case"image":a=await Ed(n,e,i);break;case"data":a=await vy(n);break;default:Hs(!1)}return s==="data"&&(a=Gb(a)),a}function Ty(n){switch(n){case"auto":case"data":return Jb();default:return Zb(n),n}}const xy=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Sy=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Ay={image:{type:"auto",decode:!0}},Ey={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:qb,mimeTypes:Sy,extensions:xy,parse:wy,tests:[n=>!!Rd(new DataView(n))],options:Ay},fe=new ns({id:"deck"});let ba={};function Ry(n){ba=n}function We(n,e,t,r){fe.level>0&&ba[n]&&ba[n].call(null,e,t,r)}function Cy(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const Iy={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Cy,parseTextSync:JSON.parse};function Py(){const n="9.1.8",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(fe.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:fe,_registerLoggers:Ry},Tb([Iy,[Ey,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const Oy=Py();function Sc(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const bo={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function ky(n){const e={};for(const[t,r]of Object.entries(n))e[t]=My(r);return e}function My(n){let e=Yl(n);if(e!=="object")return{value:n,...bo[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...bo[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=Yl(n.value),{...n,...bo[e],type:e}):{type:"object",value:null};throw new Error("props")}function Yl(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const Ny=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,Dy=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,Fy={vertex:Ny,fragment:Dy},Kl=/void\s+main\s*\([^)]*\)\s*\{\n?/,Zl=/}\n?[^{}]*$/,yo=[],Ms="__LUMA_INJECT_DECLARATIONS__";function Uy(n){const e={vertex:{},fragment:{}};for(const t in n){let r=n[t];const s=By(t);typeof r=="string"&&(r={order:0,injection:r}),e[s][t]=r}return e}function By(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Ys(n,e,t,r=!1){const s=e==="vertex";for(const i in t){const o=t[i];o.sort((c,l)=>c.order-l.order),yo.length=o.length;for(let c=0,l=o.length;c<l;++c)yo[c]=o[c].injection;const a=`${yo.join(`
`)}
`;switch(i){case"vs:#decl":s&&(n=n.replace(Ms,a));break;case"vs:#main-start":s&&(n=n.replace(Kl,c=>c+a));break;case"vs:#main-end":s&&(n=n.replace(Zl,c=>a+c));break;case"fs:#decl":s||(n=n.replace(Ms,a));break;case"fs:#main-start":s||(n=n.replace(Kl,c=>c+a));break;case"fs:#main-end":s||(n=n.replace(Zl,c=>a+c));break;default:n=n.replace(i,c=>c+a)}}return n=n.replace(Ms,""),r&&(n=n.replace(/\}\s*$/,i=>i+Fy[e])),n}function Ks(n){n.map(e=>Ly(e))}function Ly(n){if(n.instance)return;Ks(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:r={}}=n,s={normalizedInjections:Uy(r),parsedDeprecations:Vy(t)};e&&(s.propValidators=ky(e)),n.instance=s;let i={};e&&(i=Object.entries(e).reduce((o,[a,c])=>{const l=c==null?void 0:c.value;return l&&(o[a]=l),o},{})),n.defaultUniforms={...n.defaultUniforms,...i}}function Cd(n,e,t){var r;(r=n.deprecations)==null||r.forEach(s=>{var i;(i=s.regex)!=null&&i.test(e)&&(s.deprecated?t.deprecated(s.old,s.new)():t.removed(s.old,s.new)())})}function Vy(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function Ac(n){Ks(n);const e={},t={};Id({modules:n,level:0,moduleMap:e,moduleDepth:t});const r=Object.keys(t).sort((s,i)=>t[i]-t[s]).map(s=>e[s]);return Ks(r),r}function Id(n){const{modules:e,level:t,moduleMap:r,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const i of e)r[i.name]=i,(s[i.name]===void 0||s[i.name]<t)&&(s[i.name]=t);for(const i of e)i.dependencies&&Id({modules:i.dependencies,level:t+1,moduleMap:r,moduleDepth:s})}function $y(n){switch(n==null?void 0:n.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function jy(n,e){var r;if(Number(((r=n.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=Jl(n,Wy),n;case"fragment":return n=Jl(n,Hy),n;default:throw new Error(e)}}const Pd=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Wy=[...Pd,[ya("attribute"),"in $1"],[ya("varying"),"out $1"]],Hy=[...Pd,[ya("varying"),"in $1"]];function Jl(n,e){for(const[t,r]of e)n=n.replace(t,r);return n}function ya(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Od(n,e){let t="";for(const r in n){const s=n[r];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[r]){const i=e[r];i.sort((o,a)=>o.order-a.order);for(const o of i)t+=`  ${o.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function kd(n){const e={vertex:{},fragment:{}};for(const t of n){let r,s;typeof t!="string"?(r=t,s=r.hook):(r={},s=t),s=s.trim();const[i,o]=s.split(":"),a=s.replace(/\(.+/,""),c=Object.assign(r,{signature:o});switch(i){case"vs":e.vertex[a]=c;break;case"fs":e.fragment[a]=c;break;default:throw new Error(i)}}return e}function zy(n,e){return{name:Xy(n,e),language:"glsl",version:qy(n)}}function Xy(n,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return r?r[1]:e}function qy(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const Md=`

${Ms}
`,Yy=`precision highp float;
`;function Ky(n){const e=Ac(n.modules||[]);return{source:Jy(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:Nd(e)}}function Zy(n){const{vs:e,fs:t}=n,r=Ac(n.modules||[]);return{vs:Ql(n.platformInfo,{...n,source:e,stage:"vertex",modules:r}),fs:Ql(n.platformInfo,{...n,source:t,stage:"fragment",modules:r}),getUniforms:Nd(r)}}function Jy(n,e){var m;const{source:t,stage:r,modules:s,hookFunctions:i=[],inject:o={},log:a}=e;Sc(typeof t=="string","shader source must be a string");const c=t;let l="";const u=kd(i),h={},f={},d={};for(const g in o){const y=typeof o[g]=="string"?{injection:o[g],order:0}:o[g],S=/^(v|f)s:(#)?([\w-]+)$/.exec(g);if(S){const v=S[2],x=S[3];v?x==="decl"?f[g]=[y]:d[g]=[y]:h[g]=[y]}else d[g]=[y]}const p=s;for(const g of p){a&&Cd(g,c,a);const y=Dd(g,"wgsl");l+=y;const S=((m=g.injections)==null?void 0:m[r])||{};for(const v in S){const x=/^(v|f)s:#([\w-]+)$/.exec(v);if(x){const I=x[2]==="decl"?f:d;I[v]=I[v]||[],I[v].push(S[v])}else h[v]=h[v]||[],h[v].push(S[v])}}return l+=Md,l=Ys(l,r,f),l+=Od(u[r],h),l+=c,l=Ys(l,r,d),l}function Ql(n,e){var M;const{id:t,source:r,stage:s,language:i="glsl",modules:o,defines:a={},hookFunctions:c=[],inject:l={},prologue:u=!0,log:h}=e;Sc(typeof r=="string","shader source must be a string");const f=i==="glsl"?zy(r).version:-1,d=n.shaderLanguageVersion,p=f===100?"#version 100":"#version 300 es",g=r.split(`
`).slice(1).join(`
`),y={};o.forEach(N=>{Object.assign(y,N.defines)}),Object.assign(y,a);let S="";switch(i){case"wgsl":break;case"glsl":S=u?`${p}

// ----- PROLOGUE -------------------------
${Qy({id:t,source:r,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${$y(n)}
${s==="fragment"?Yy:""}

// ----- APPLICATION DEFINES -------------------------

${Gy(y)}

`:`${p}
`;break}const v=kd(c),x={},T={},I={};for(const N in l){const L=typeof l[N]=="string"?{injection:l[N],order:0}:l[N],j=/^(v|f)s:(#)?([\w-]+)$/.exec(N);if(j){const $=j[2],K=j[3];$?K==="decl"?T[N]=[L]:I[N]=[L]:x[N]=[L]}else I[N]=[L]}for(const N of o){h&&Cd(N,g,h);const L=Dd(N,s);S+=L;const j=((M=N.instance)==null?void 0:M.normalizedInjections[s])||{};for(const $ in j){const K=/^(v|f)s:#([\w-]+)$/.exec($);if(K){const Z=K[2]==="decl"?T:I;Z[$]=Z[$]||[],Z[$].push(j[$])}else x[$]=x[$]||[],x[$].push(j[$])}}return S+="// ----- MAIN SHADER SOURCE -------------------------",S+=Md,S=Ys(S,s,T),S+=Od(v[s],x),S+=g,S=Ys(S,s,I),i==="glsl"&&f!==d&&(S=jy(S,s)),S.trim()}function Nd(n){return function(t){var s;const r={};for(const i of n){const o=(s=i.getUniforms)==null?void 0:s.call(i,t,r);Object.assign(r,o)}return r}}function Qy(n){const{id:e,source:t,stage:r}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function Gy(n={}){let e="";for(const t in n){const r=n[t];(r||Number.isFinite(r))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function Dd(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:Sc(!1)}if(!n.name)throw new Error("Shader module must have a name");const r=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${r}
`),s+=`${t}
`,s}const ev=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,tv=/^\s*\#\s*endif\s*$/;function nv(n,e){var o;const t=n.split(`
`),r=[];let s=!0,i=null;for(const a of t){const c=a.match(ev),l=a.match(tv);c?(i=c[1],s=!!((o=e==null?void 0:e.defines)!=null&&o[i])):l?s=!0:s&&r.push(a)}return r.join(`
`)}const ln=class ln{constructor(){_(this,"_hookFunctions",[]);_(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return ln.defaultShaderAssembler=ln.defaultShaderAssembler||new ln,ln.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),r=this._hookFunctions,{source:s,getUniforms:i}=Ky({...e,source:e.source,modules:t,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?nv(s):s,getUniforms:i,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),r=this._hookFunctions;return{...Zy({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let s=0;for(let i=0,o=this._defaultModules.length;i<o;++i){const a=this._defaultModules[i],c=a.name;t[s++]=a,r[c]=!0}for(let i=0,o=e.length;i<o;++i){const a=e[i],c=a.name;r[c]||(t[s++]=a,r[c]=!0)}return t.length=s,Ks(t),t}};_(ln,"defaultShaderAssembler");let Zs=ln;const rv=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,sv=`#version 300 es
${rv}`;function Fd(n){const{input:e,inputChannels:t,output:r}=n||{};if(!e)return sv;if(!t)throw new Error("inputChannels");const s=iv(t),i=ov(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${r};
void main() {
  ${r} = ${i};
}`}function iv(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function ov(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class av{constructor(){_(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Hi({id:e})),this.stats.get(e)}}const Ud=new av,F=new ns({id:"luma.gl"}),vo={};function Xi(n="id"){vo[n]=vo[n]||1;const e=vo[n]++;return`${n}-${e}`}var ha;let ge=(ha=class{constructor(e,t,r){_(this,"id");_(this,"props");_(this,"userData",{});_(this,"_device");_(this,"destroyed",!1);_(this,"allocatedBytes",0);_(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=cv(t,r);const s=this.props.id!=="undefined"?this.props.id:Xi(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},_(ha,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),ha);function cv(n,e){const t={...e};for(const r in n)n[r]!==void 0&&(t[r]=n[r]);return t}var Ee;let xe=(Ee=class extends ge{constructor(t,r){const s={...r};(r.usage||0)&Ee.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?s.indexType="uint32":r.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data;super(t,s,Ee.defaultProps);_(this,"usage");_(this,"indexType");_(this,"updateTimestamp");_(this,"debugData",new ArrayBuffer(0));this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,r){throw new Error("not implemented")}_setDebugData(t,r,s){const i=ArrayBuffer.isView(t)?t.buffer:t,o=Math.min(t?t.byteLength:s,Ee.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(o):r===0&&s===i.byteLength?this.debugData=i.slice(0,o):this.debugData=i.slice(r,r+o)}},_(Ee,"defaultProps",{...ge.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),_(Ee,"MAP_READ",1),_(Ee,"MAP_WRITE",2),_(Ee,"COPY_SRC",4),_(Ee,"COPY_DST",8),_(Ee,"INDEX",16),_(Ee,"VERTEX",32),_(Ee,"UNIFORM",64),_(Ee,"STORAGE",128),_(Ee,"INDIRECT",256),_(Ee,"QUERY_RESOLVE",512),_(Ee,"DEBUG_DATA_MAX_LENGTH",32),Ee);function Bd(n){const e=Gl[n],t=lv(e),r=n.includes("norm"),s=!r&&!n.startsWith("float"),i=n.startsWith("s");return{dataType:Gl[n],byteLength:t,integer:s,signed:i,normalized:r}}function lv(n){return uv[n]}const Gl={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},uv={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Le="texture-compression-bc",pe="texture-compression-astc",pt="texture-compression-etc2",hv="texture-compression-etc1-webgl",us="texture-compression-pvrtc-webgl",wo="texture-compression-atc-webgl",hs="float32-renderable-webgl",To="float16-renderable-webgl",fv="rgb9e5ufloat-renderable-webgl",xo="snorm8-renderable-webgl",vr="norm16-renderable-webgl",So="snorm16-renderable-webgl",fs="float32-filterable",eu="float16-filterable-webgl";function Ld(n){const e=dv[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const dv={r8unorm:{},r8snorm:{render:xo},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:xo},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:To,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:vr},"r16snorm-webgl":{f:So},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:xo},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:To,filter:eu},"rg16unorm-webgl":{render:vr},"rg16snorm-webgl":{render:So},r32uint:{},r32sint:{},r32float:{render:hs,filter:fs},rgb9e5ufloat:{channels:"rgb",packed:!0,render:fv},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:hs},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:vr},"rgb16snorm-webgl":{f:vr},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:fs},rgba16uint:{},rgba16sint:{},rgba16float:{render:To,filter:eu},"rgba16unorm-webgl":{render:vr},"rgba16snorm-webgl":{render:So},"rgb32float-webgl":{render:hs,filter:fs},rgba32uint:{},rgba32sint:{},rgba32float:{render:hs,filter:fs},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Le},"bc1-rgb-unorm-srgb-webgl":{f:Le},"bc1-rgba-unorm":{f:Le},"bc1-rgba-unorm-srgb":{f:Le},"bc2-rgba-unorm":{f:Le},"bc2-rgba-unorm-srgb":{f:Le},"bc3-rgba-unorm":{f:Le},"bc3-rgba-unorm-srgb":{f:Le},"bc4-r-unorm":{f:Le},"bc4-r-snorm":{f:Le},"bc5-rg-unorm":{f:Le},"bc5-rg-snorm":{f:Le},"bc6h-rgb-ufloat":{f:Le},"bc6h-rgb-float":{f:Le},"bc7-rgba-unorm":{f:Le},"bc7-rgba-unorm-srgb":{f:Le},"etc2-rgb8unorm":{f:pt},"etc2-rgb8unorm-srgb":{f:pt},"etc2-rgb8a1unorm":{f:pt},"etc2-rgb8a1unorm-srgb":{f:pt},"etc2-rgba8unorm":{f:pt},"etc2-rgba8unorm-srgb":{f:pt},"eac-r11unorm":{f:pt},"eac-r11snorm":{f:pt},"eac-rg11unorm":{f:pt},"eac-rg11snorm":{f:pt},"astc-4x4-unorm":{f:pe},"astc-4x4-unorm-srgb":{f:pe},"astc-5x4-unorm":{f:pe},"astc-5x4-unorm-srgb":{f:pe},"astc-5x5-unorm":{f:pe},"astc-5x5-unorm-srgb":{f:pe},"astc-6x5-unorm":{f:pe},"astc-6x5-unorm-srgb":{f:pe},"astc-6x6-unorm":{f:pe},"astc-6x6-unorm-srgb":{f:pe},"astc-8x5-unorm":{f:pe},"astc-8x5-unorm-srgb":{f:pe},"astc-8x6-unorm":{f:pe},"astc-8x6-unorm-srgb":{f:pe},"astc-8x8-unorm":{f:pe},"astc-8x8-unorm-srgb":{f:pe},"astc-10x5-unorm":{f:pe},"astc-10x5-unorm-srgb":{f:pe},"astc-10x6-unorm":{f:pe},"astc-10x6-unorm-srgb":{f:pe},"astc-10x8-unorm":{f:pe},"astc-10x8-unorm-srgb":{f:pe},"astc-10x10-unorm":{f:pe},"astc-10x10-unorm-srgb":{f:pe},"astc-12x10-unorm":{f:pe},"astc-12x10-unorm-srgb":{f:pe},"astc-12x12-unorm":{f:pe},"astc-12x12-unorm-srgb":{f:pe},"pvrtc-rgb4unorm-webgl":{f:us},"pvrtc-rgba4unorm-webgl":{f:us},"pvrtc-rbg2unorm-webgl":{f:us},"pvrtc-rgba2unorm-webgl":{f:us},"etc1-rbg-unorm-webgl":{f:hv},"atc-rgb-unorm-webgl":{f:wo},"atc-rgba-unorm-webgl":{f:wo},"atc-rgbai-unorm-webgl":{f:wo}},pv=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],gv=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function Vd(n){return pv.some(e=>n.startsWith(e))}function Ec(n){let e=mv(n);if(Vd(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=_v(n);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const t=gv.exec(n);if(t){const[,r,s,i,o,a]=t,c=`${i}${s}`,l=Bd(c),u=l.byteLength*8,h=r.length,f=[u,h>=2?u:0,h>=3?u:0,h>=4?u:0];e={format:n,attachment:e.attachment,dataType:l.dataType,components:h,channels:r,integer:l.integer,signed:l.signed,normalized:l.normalized,bitsPerChannel:f,bytesPerPixel:l.byteLength*r.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function mv(n){var i;const e=Ld(n),t=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((i=e.channels)==null?void 0:i.length)||1,bytesPerPixel:t,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function _v(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,r,s]=t;return{blockWidth:Number(r),blockHeight:Number(s)}}return null}function bv(n){const e=Ld(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=Ec(n),s=n.startsWith("depth")||n.startsWith("stencil"),i=r==null?void 0:r.signed,o=r==null?void 0:r.integer,a=r==null?void 0:r.webgl;return t.render&&(t.render=!i),t.filter&&(t.filter=!s&&!i&&!o&&!a),t}class yv{}class vv{constructor(e=[],t){_(this,"features");_(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const Ii=class Ii{constructor(e){_(this,"id");_(this,"props");_(this,"userData",{});_(this,"statsManager",Ud);_(this,"timestamp",0);_(this,"_reused",!1);_(this,"_lumaData",{});this.props={...Ii.defaultProps,...e},this.id=this.props.id||Xi(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=bv(e),r=o=>(typeof o=="string"?this.features.has(o):o)??!0,s=r(t.create),i={format:e,create:s,render:s&&r(t.render),filter:s&&r(t.filter),blend:s&&r(t.blend),store:s&&r(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(i)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Vd(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&xe.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":F.warn("indices buffer content must be of integer type")()),t}};_(Ii,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>F.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:F.get("debug")||void 0,debugShaders:F.get("debug-shaders")||void 0,debugFramebuffers:!!F.get("debug-framebuffers"),debugWebGL:!!F.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Jt=Ii;const wv=vn()&&typeof document<"u",Tv=()=>wv&&document.readyState==="complete",xv="set luma.log.level=1 (or higher) to trace rendering",tu="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Xt=class Xt{constructor(){_(this,"stats",Ud);_(this,"log",F);_(this,"VERSION","9.1.5");_(this,"spector");_(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw F.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),F.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");F.error("This version of luma.gl has already been initialized")()}F.log(1,`${this.VERSION} - ${xv}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,r])=>r).filter(r=>{var s;return(s=r.isSupported)==null?void 0:s.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,s,i,o;const t=this.getAdapterMap(e);return(s=(r=t.get("webgpu"))==null?void 0:r.isSupported)!=null&&s.call(r)?"webgpu":(o=(i=t.get("webgl"))==null?void 0:i.isSupported)!=null&&o.call(i)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Xt.defaultProps,e)}async createDevice(e={}){var a;e={...Xt.defaultProps,...e},e.waitForPageLoad&&await Xt.pageLoaded;const t=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const i=(this.getAdapterMap(e.adapters)||t).get(r),o=await((a=i==null?void 0:i.create)==null?void 0:a.call(i,e));if(o)return o;throw new Error(tu)}async attachDevice(e){var o;const t=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await Xt.pageLoaded,e.handle===null&&(r="unknown");const s=t.get(r),i=await((o=s==null?void 0:s.attach)==null?void 0:o.call(s,null));if(i)return i;throw new Error(tu)}enforceWebGL2(e=!0,t=[]){var i;const s=this.getAdapterMap(t).get("webgl");s||F.warn("enforceWebGL2: webgl adapter not found")(),(i=s==null?void 0:s.enforceWebGL2)==null||i.call(s,e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const r of e)t.set(r.type,r);return t}registerDevices(e){F.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const r=t.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};_(Xt,"defaultProps",{...Jt.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),_(Xt,"pageLoaded",Sv().then(()=>{F.probe(2,"DOM is loaded")()}));let va=Xt;const wa=new va;function Sv(){return Tv()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class Av{}const Pi=class Pi{constructor(e){_(this,"id");_(this,"props");_(this,"canvas");_(this,"htmlCanvas");_(this,"offscreenCanvas");_(this,"type");_(this,"width",1);_(this,"height",1);_(this,"resizeObserver");_(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...Pi.defaultProps,...e},e=this.props,!vn()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=Rv(e.canvas):this.canvas=e.canvas;else{const t=Cv(e),r=Ev((e==null?void 0:e.container)||null);r.insertBefore(t,r.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const r of t)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?t/r:1}catch{return 1}}cssToDevicePixels(e,t=!0){const r=this.cssToDeviceRatio(),[s,i]=this.getDrawingBufferSize();return Iv(e,r,s,i,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let r="width"in t?t.width:this.htmlCanvas.clientWidth,s="height"in t?t.height:this.htmlCanvas.clientHeight;(!r||!s)&&(F.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const i=this._canvasSizeInfo;if(i.clientWidth!==r||i.clientHeight!==s||i.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),c=Math.floor(s*o);if(this.htmlCanvas.width=a,this.htmlCanvas.height=c,this.device.gl){const[u,h]=this.getDrawingBufferSize();(u!==a||h!==c)&&(o=Math.min(u/r,h/s),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(s*o),F.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};_(Pi,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let Ta=Pi;function Ev(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function Rv(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function Cv(n){const{width:e,height:t}=n,r=document.createElement("canvas");return r.id=Xi("lumagl-auto-created-canvas"),r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",r}function Iv(n,e,t,r,s){const i=n,o=nu(i[0],e,t);let a=ru(i[1],e,r,s),c=nu(i[0]+1,e,t);const l=c===t-1?c:c-1;c=ru(i[1]+1,e,r,s);let u;return s?(c=c===0?c:c+1,u=a,a=c):u=c===r-1?c:c-1,{x:o,y:a,width:Math.max(l-o+1,1),height:Math.max(u-a+1,1)}}function nu(n,e,t){return Math.min(Math.round(n*e),t-1)}function ru(n,e,t,r){return r?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const Fe=class Fe extends ge{constructor(t,r){r=Fe.normalizeProps(t,r);super(t,r,Fe.defaultProps);_(this,"dimension");_(this,"format");_(this,"width");_(this,"height");_(this,"depth");_(this,"mipLevels");_(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const s=Fe.getTextureDataSize(this.props.data);this.width=(s==null?void 0:s.width)||1,this.height=(s==null?void 0:s.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Fe.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const r=t==null?void 0:t.data;return ArrayBuffer.isView(r)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Fe.getTextureDataSize(t[0]);if(Fe.isExternalImage(t))return Fe.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const s=Object.values(t)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,r){let s;return ArrayBuffer.isView(t)?s=[{data:t,width:r.width,height:r.height}]:Array.isArray(t)?s=t:s=[t],s}static getMipLevelCount(t,r){return Math.floor(Math.log2(Math.max(t,r)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,r){var c,l;const s={...r},i=((l=(c=t==null?void 0:t.props)==null?void 0:c._resourceDefaults)==null?void 0:l.texture)||{};Object.assign(s,i);const{width:o,height:a}=s;return typeof o=="number"&&(s.width=Math.max(1,Math.ceil(o))),typeof a=="number"&&(s.height=Math.max(1,Math.ceil(a))),s}};_(Fe,"COPY_SRC",1),_(Fe,"COPY_DST",2),_(Fe,"TEXTURE",4),_(Fe,"STORAGE",8),_(Fe,"RENDER_ATTACHMENT",16),_(Fe,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),_(Fe,"defaultProps",{...ge.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),_(Fe,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let we=Fe;const Oi=class Oi extends ge{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Oi.defaultProps)}};_(Oi,"defaultProps",{...ge.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Js=Oi;function Pv(n,e,t){let r="";const s=e.split(/\r?\n/),i=n.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=s.length;a++)for(r+=$d(s[a-1],a,t);i.length>o&&i[o].lineNum===a;){const c=i[o++];r+=su(c,s,c.lineNum,{...t,inlineSource:!1})}return r;case"issues":case"no":for(const a of n)r+=su(a,s,a.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return r}}function su(n,e,t,r){if(r!=null&&r.inlineSource){const i=Ov(e,t),o=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${i}${o}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function Ov(n,e,t){let r="";for(let s=e-2;s<=e;s++){const i=n[s-1];i!==void 0&&(r+=$d(i,e,t))}return r}function $d(n,e,t){const r=t!=null&&t.html?Mv(n):n;return`${kv(String(e),4)}: ${r}${t!=null&&t.html?"<br/>":`
`}`}function kv(n,e){let t="";for(let r=n.length;r<e;++r)t+=" ";return t+n}function Mv(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const ki=class ki extends ge{constructor(t,r){r={...r,debugShaders:r.debugShaders||t.props.debugShaders||"errors"};super(t,{id:Nv(r),...r},ki.defaultProps);_(this,"stage");_(this,"source");_(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();t==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(t){var l;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=jd(this.source),s=`${this.stage} ${r}`;let i=Pv(t,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),(l=document.getElementsByClassName("luma-compiler-log-error")[0])==null||l.scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};_(ki,"defaultProps",{...ge.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Qs=ki;function Nv(n){return jd(n.source)||n.id||Xi(`unnamed ${n.stage}-shader`)}function jd(n,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return r?r[1]:e}const Xr=class Xr extends ge{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=Xr.normalizeProps(e,t),super(e,t,Xr.defaultProps)}static normalizeProps(e,t){var i,o;const r=((o=(i=e==null?void 0:e.props)==null?void 0:i._resourceDefaults)==null?void 0:o.sampler)||{};return{...t,...r}}};_(Xr,"defaultProps",{...ge.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Gs=Xr;const Mi=class Mi extends ge{constructor(t,r={}){super(t,r,Mi.defaultProps);_(this,"width");_(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const r=this.colorAttachments.map(i=>i.texture.clone(t)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:s})}resize(t){let r=!t;if(t){const[s,i]=Array.isArray(t)?t:[t.width,t.height];r=r||i!==this.height||s!==this.width,this.width=s,this.height=i}r&&(F.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,s)=>{if(typeof r=="string"){const i=this.createColorTexture(r,s);return this.attachResource(i),i.view}return r instanceof we?r.view:r});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof we?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:we.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:we.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const i=this.colorAttachments[s].texture.clone({width:t,height:r});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}};_(Mi,"defaultProps",{...ge.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let ei=Mi;const Ni=class Ni extends ge{constructor(t,r){super(t,r,Ni.defaultProps);_(this,"shaderLayout");_(this,"bufferLayout");_(this,"linkStatus","pending");_(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};_(Ni,"defaultProps",{...ge.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let er=Ni;const ut=class ut extends ge{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=ut.normalizeProps(e,t),super(e,t,ut.defaultProps)}static normalizeProps(e,t){var i;return{...(i=e.props._resourceDefaults)==null?void 0:i.renderPass,...t}}};_(ut,"defaultClearColor",[0,0,0,1]),_(ut,"defaultClearDepth",1),_(ut,"defaultClearStencil",0),_(ut,"defaultProps",{...ge.defaultProps,framebuffer:null,parameters:void 0,clearColor:ut.defaultClearColor,clearColors:void 0,clearDepth:ut.defaultClearDepth,clearStencil:ut.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let xa=ut;const Di=class Di extends ge{constructor(t,r){super(t,r,Di.defaultProps);_(this,"hash","");_(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};_(Di,"defaultProps",{...ge.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let ti=Di;const Fi=class Fi extends ge{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Fi.defaultProps)}};_(Fi,"defaultProps",{...ge.defaultProps,measureExecutionTime:void 0});let Sa=Fi;const Ui=class Ui extends ge{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Ui.defaultProps)}};_(Ui,"defaultProps",{...ge.defaultProps});let Aa=Ui;function Dv(n){const[e,t]=Uv[n],r=e==="i32"||e==="u32",s=e!=="u32",i=Bv[e]*t,o=Fv(e,t);return{dataType:e,components:t,defaultVertexFormat:o,byteLength:i,integer:r,signed:s}}function Fv(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const Uv={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Bv={f32:4,f16:2,i32:4,u32:4};function Wd(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,r]=n.split("x"),s=t,i=r?parseInt(r):1,o=Bd(s),a={type:s,components:i,byteLength:o.byteLength*i,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function Hd(n,e){const t={};for(const r of n.attributes){const s=Vv(n,e,r.name);s&&(t[r.name]=s)}return t}function Lv(n,e,t=16){const r=Hd(n,e),s=new Array(t).fill(null);for(const i of Object.values(r))s[i.location]=i;return s}function Vv(n,e,t){const r=$v(n,t),s=jv(e,t);if(!r)return null;const i=Dv(r.type),o=(s==null?void 0:s.vertexFormat)||i.defaultVertexFormat,a=Wd(o);return{attributeName:(s==null?void 0:s.attributeName)||r.name,bufferName:(s==null?void 0:s.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:i.dataType,shaderComponents:i.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:i.integer,stepMode:(s==null?void 0:s.stepMode)||r.stepMode||"vertex",byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function $v(n,e){const t=n.attributes.find(r=>r.name===e);return t||F.warn(`shader layout attribute "${e}" not present in shader`),t||null}function jv(n,e){Wv(n);let t=Hv(n,e);return t||(t=zv(n,e),t)?t:(F.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function Wv(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&F.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Hv(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function zv(n,e){var t;for(const r of n){let s=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=Wd(o.format);s+=a.byteLength}const i=(t=r.attributes)==null?void 0:t.find(o=>o.attribute===e);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:s}}return null}const Bi=class Bi extends ge{constructor(t,r){super(t,r,Bi.defaultProps);_(this,"maxVertexAttributes");_(this,"attributeInfos");_(this,"indexBuffer",null);_(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:s,bufferLayout:i}=r.renderPipeline||{};if(!s||!i)throw new Error("VertexArray");this.attributeInfos=Lv(s,i,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,r){this.device.reportError(new Error("constant attributes not supported"))}};_(Bi,"defaultProps",{...ge.defaultProps,renderPipeline:null});let Ea=Bi;const Li=class Li extends ge{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Li.defaultProps)}};_(Li,"defaultProps",{...ge.defaultProps,layout:void 0,buffers:{}});let Ra=Li;const Vi=class Vi extends ge{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Vi.defaultProps)}};_(Vi,"defaultProps",{...ge.defaultProps,type:void 0,count:void 0});let Ca=Vi;const Xv={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function qv(n){return Xv[n]}function Yv(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let ds;function zd(n){return(!ds||ds.byteLength<n)&&(ds=new ArrayBuffer(n)),ds}function Kv(n,e){const t=zd(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function Zv(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function ni(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":Zv(n)}const iu=1024;class Jv{constructor(e){_(this,"layout",{});_(this,"byteLength");let t=0;for(const[s,i]of Object.entries(e)){const o=qv(i),{type:a,components:c}=o;t=Yv(t,c);const l=t;t+=c,this.layout[s]={type:a,size:c,offset:l}}t+=(4-t%4)%4;const r=t*4;this.byteLength=Math.max(r,iu)}getData(e){const t=Math.max(this.byteLength,iu),r=zd(t),s={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[i,o]of Object.entries(e)){const a=this.layout[i];if(!a){F.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:c,size:l,offset:u}=a,h=s[c];if(l===1){if(typeof o!="number"&&typeof o!="boolean"){F.warn(`Supplied value for single component uniform ${i} is not a number: ${o}`)();continue}h[u]=Number(o)}else{if(!ni(o)){F.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${o}`)();continue}h.set(o,u)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function Qv(n,e,t=16){if(n!==e)return!1;const r=n,s=e;if(!ni(r))return!1;if(ni(s)&&r.length===s.length){for(let i=0;i<r.length;++i)if(s[i]!==r[i])return!1}return!0}function Gv(n){return ni(n)?n.slice():n}class e0{constructor(e){_(this,"name");_(this,"uniforms",{});_(this,"modifiedUniforms",{});_(this,"modified",!0);_(this,"bindingLayout",{});_(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(i=>i.type==="uniform"&&i.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const s=r;for(const i of s.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){Qv(this.uniforms[e],t)||(this.uniforms[e]=Gv(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class t0{constructor(e){_(this,"uniformBlocks",new Map);_(this,"uniformBufferLayouts",new Map);_(this,"uniformBuffers",new Map);for(const[t,r]of Object.entries(e)){const s=t,i=new Jv(r.uniformTypes||{});this.uniformBufferLayouts.set(s,i);const o=new e0({name:t});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(s,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[r,s]of Object.entries(e))(t=this.uniformBlocks.get(r))==null||t.setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var r,s;const t=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(s=this.uniformBufferLayouts.get(e))==null?void 0:s.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);const s=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:xe.UNIFORM|xe.COPY_DST,byteLength:s}),o=this.getUniformBufferData(t);return i.write(o),i}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const r=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:xe.UNIFORM|xe.COPY_DST,byteLength:r});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(t);e||(e=r)}return e&&F.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var i;const t=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),s=!1;if(r&&(t!=null&&t.needsRedraw)){s||(s=t.needsRedraw);const o=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(o);const a=(i=this.uniformBlocks.get(e))==null?void 0:i.getAllUniforms();F.log(4,`Writing to uniform buffer ${String(e)}`,o,a)()}return s}}function Xd(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function qd(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function n0(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let s=Xd(n);if(s==="uint8"&&t&&r===1)return"unorm8-webgl";if(s==="uint8"&&t&&r===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${r}`}if(s==="uint16"||s==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${r}`}return r===1?s:`${s}x${r}`}class Ao{constructor(e){_(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,t){const r=[...e];for(const s of t){const i=r.findIndex(o=>o.name===s.name);i<0?r.push(s):r[i]=s}return r}}class rt{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class ou{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Yt extends rt{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Qt extends rt{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class gn extends rt{constructor(e,t,r,s){super(e,r),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Wt;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Wt||(Wt={}));let ps=class{constructor(e,t,r,s,i,o,a){this.name=e,this.type=t,this.group=r,this.binding=s,this.attributes=i,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}};class r0{constructor(e,t){this.name=e,this.type=t}}class s0{constructor(e,t,r,s){this.name=e,this.type=t,this.locationType=r,this.location=s,this.interpolation=null}}class au{constructor(e,t,r,s){this.name=e,this.type=t,this.locationType=r,this.location=s}}class i0{constructor(e,t,r,s){this.name=e,this.type=t,this.attributes=r,this.id=s}}class o0{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class a0{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class c0{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const Yd=new Float32Array(1),l0=new Int32Array(Yd.buffer),Ve=new Uint16Array(1);function u0(n){Yd[0]=n;const e=l0[0],t=e>>31&1;let r=e>>23&255,s=8388607&e;if(r===255)return Ve[0]=t<<15|31744|(s!==0?512:0),Ve[0];if(r===0){if(s===0)return Ve[0]=t<<15,Ve[0];s|=8388608;let i=113;for(;!(8388608&s);)s<<=1,i--;return r=127-i,s&=8388607,r>0?(s=(s>>126-r)+(s>>127-r&1),Ve[0]=t<<15|r<<10|s>>13,Ve[0]):(Ve[0]=t<<15,Ve[0])}return r=r-127+15,r>=31?(Ve[0]=t<<15|31744,Ve[0]):r<=0?r<-10?(Ve[0]=t<<15,Ve[0]):(s=(8388608|s)>>1-r,Ve[0]=t<<15|s>>13,Ve[0]):(s>>=13,Ve[0]=t<<15|r<<10|s,Ve[0])}const Rc=new Uint32Array(1),Kd=new Float32Array(Rc.buffer,0,1);function cu(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return Rc[0]=e,Kd[0]}function h0(n,e,t,r,s,i,o,a,c){const l=r*(o>>=s)*(i>>=s)+t*o+e*a;switch(c){case"r8unorm":return[oe(n,l,"8unorm",1)[0]];case"r8snorm":return[oe(n,l,"8snorm",1)[0]];case"r8uint":return[oe(n,l,"8uint",1)[0]];case"r8sint":return[oe(n,l,"8sint",1)[0]];case"rg8unorm":{const u=oe(n,l,"8unorm",2);return[u[0],u[1]]}case"rg8snorm":{const u=oe(n,l,"8snorm",2);return[u[0],u[1]]}case"rg8uint":{const u=oe(n,l,"8uint",2);return[u[0],u[1]]}case"rg8sint":{const u=oe(n,l,"8sint",2);return[u[0],u[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const u=oe(n,l,"8unorm",4);return[u[0],u[1],u[2],u[3]]}case"rgba8snorm":{const u=oe(n,l,"8snorm",4);return[u[0],u[1],u[2],u[3]]}case"rgba8uint":{const u=oe(n,l,"8uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba8sint":{const u=oe(n,l,"8sint",4);return[u[0],u[1],u[2],u[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const u=oe(n,l,"8unorm",4);return[u[2],u[1],u[0],u[3]]}case"r16uint":return[oe(n,l,"16uint",1)[0]];case"r16sint":return[oe(n,l,"16sint",1)[0]];case"r16float":return[oe(n,l,"16float",1)[0]];case"rg16uint":{const u=oe(n,l,"16uint",2);return[u[0],u[1]]}case"rg16sint":{const u=oe(n,l,"16sint",2);return[u[0],u[1]]}case"rg16float":{const u=oe(n,l,"16float",2);return[u[0],u[1]]}case"rgba16uint":{const u=oe(n,l,"16uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba16sint":{const u=oe(n,l,"16sint",4);return[u[0],u[1],u[2],u[3]]}case"rgba16float":{const u=oe(n,l,"16float",4);return[u[0],u[1],u[2],u[3]]}case"r32uint":return[oe(n,l,"32uint",1)[0]];case"r32sint":return[oe(n,l,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[oe(n,l,"32float",1)[0]];case"rg32uint":{const u=oe(n,l,"32uint",2);return[u[0],u[1]]}case"rg32sint":{const u=oe(n,l,"32sint",2);return[u[0],u[1]]}case"rg32float":{const u=oe(n,l,"32float",2);return[u[0],u[1]]}case"rgba32uint":{const u=oe(n,l,"32uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba32sint":{const u=oe(n,l,"32sint",4);return[u[0],u[1],u[2],u[3]]}case"rgba32float":{const u=oe(n,l,"32float",4);return[u[0],u[1],u[2],u[3]]}case"rg11b10ufloat":{const u=new Uint32Array(n.buffer,l,1)[0],h=(4192256&u)>>11,f=(4290772992&u)>>22;return[cu(2047&u),cu(h),function(d){const p=112+(d>>5&31)<<23|(31&d)<<18;return Rc[0]=p,Kd[0]}(f),1]}}return null}function oe(n,e,t,r){const s=[0,0,0,0];for(let l=0;l<r;++l)switch(t){case"8unorm":s[l]=n[e]/255,e++;break;case"8snorm":s[l]=n[e]/255*2-1,e++;break;case"8uint":s[l]=n[e],e++;break;case"8sint":s[l]=n[e]-127,e++;break;case"16uint":s[l]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":s[l]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":s[l]=(i=n[e]|n[e+1]<<8,o=void 0,a=void 0,c=void 0,o=(32768&i)>>15,c=1023&i,(a=(31744&i)>>10)==0?(o?-1:1)*Math.pow(2,-14)*(c/Math.pow(2,10)):a==31?c?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,a-15)*(1+c/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":s[l]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":s[l]=new Float32Array(n.buffer,e,1)[0],e+=4}var i,o,a,c;return s}function ue(n,e,t,r,s){for(let i=0;i<r;++i)switch(t){case"8unorm":n[e]=255*s[i],e++;break;case"8snorm":n[e]=.5*(s[i]+1)*255,e++;break;case"8uint":n[e]=s[i],e++;break;case"8sint":n[e]=s[i]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=s[i],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=s[i],e+=2;break;case"16float":{const o=u0(s[i]);new Uint16Array(n.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=s[i],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=s[i],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=s[i],e+=4}return s}const Eo={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class at{constructor(){this.id=at._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(ri.instance);for(const r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(si.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}at._id=0;class ri extends at{}ri.instance=new ri;class si extends at{}si.instance=new si;const Zd=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class ye extends at{constructor(){super()}}class Yr extends ye{constructor(e,t,r,s,i,o){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=s,this.startLine=i,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class f0 extends ye{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Jd extends ye{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Ia extends ye{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Qd extends ye{constructor(e,t,r,s){super(),this.init=e,this.condition=t,this.increment=r,this.body=s}get astNodeType(){return"for"}search(e){var t,r,s;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class Pt extends ye{constructor(e,t,r,s,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Cc extends ye{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Ur extends ye{constructor(e,t,r,s,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Ns extends ye{constructor(e,t,r,s,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Hn,Cr,k,E;(n=>{n.increment="++",n.decrement="--"})(Hn||(Hn={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(Hn||(Hn={}));class Gd extends ye{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Cr||(Cr={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Cr||(Cr={}));class ep extends ye{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Ic extends ye{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return Zd.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class tp extends ye{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class np extends ye{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}}let rp=class extends ye{constructor(e,t,r,s){super(),this.condition=e,this.body=t,this.elseif=r,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}};class sp extends ye{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class d0 extends ye{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class p0 extends ye{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class ip extends ye{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Pc extends ye{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class g0 extends ye{constructor(){super()}get astNodeType(){return"discard"}}class op extends ye{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class ap extends ye{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class D extends ye{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const s=D._priority.get(t.name);D._priority.get(e[r].name)<s&&(t=e[r])}return t.name==="x32"?D.i32:t}getTypeName(){return this.name}}D.x32=new D("x32"),D.f32=new D("f32"),D.i32=new D("i32"),D.u32=new D("u32"),D.f16=new D("f16"),D.bool=new D("bool"),D.void=new D("void"),D._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class lu extends D{constructor(e){super(e)}}class Ct extends D{constructor(e,t,r,s){super(e),this.members=t,this.startLine=r,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class O extends D{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}O.vec2f=new O("vec2",D.f32,null),O.vec3f=new O("vec3",D.f32,null),O.vec4f=new O("vec4",D.f32,null),O.vec2i=new O("vec2",D.i32,null),O.vec3i=new O("vec3",D.i32,null),O.vec4i=new O("vec4",D.i32,null),O.vec2u=new O("vec2",D.u32,null),O.vec3u=new O("vec3",D.u32,null),O.vec4u=new O("vec4",D.u32,null),O.vec2h=new O("vec2",D.f16,null),O.vec3h=new O("vec3",D.f16,null),O.vec4h=new O("vec4",D.f16,null),O.vec2b=new O("vec2",D.bool,null),O.vec3b=new O("vec3",D.bool,null),O.vec4b=new O("vec4",D.bool,null),O.mat2x2f=new O("mat2x2",D.f32,null),O.mat2x3f=new O("mat2x3",D.f32,null),O.mat2x4f=new O("mat2x4",D.f32,null),O.mat3x2f=new O("mat3x2",D.f32,null),O.mat3x3f=new O("mat3x3",D.f32,null),O.mat3x4f=new O("mat3x4",D.f32,null),O.mat4x2f=new O("mat4x2",D.f32,null),O.mat4x3f=new O("mat4x3",D.f32,null),O.mat4x4f=new O("mat4x4",D.f32,null),O.mat2x2h=new O("mat2x2",D.f16,null),O.mat2x3h=new O("mat2x3",D.f16,null),O.mat2x4h=new O("mat2x4",D.f16,null),O.mat3x2h=new O("mat3x2",D.f16,null),O.mat3x3h=new O("mat3x3",D.f16,null),O.mat3x4h=new O("mat3x4",D.f16,null),O.mat4x2h=new O("mat4x2",D.f16,null),O.mat4x3h=new O("mat4x3",D.f16,null),O.mat4x4h=new O("mat4x4",D.f16,null),O.mat2x2i=new O("mat2x2",D.i32,null),O.mat2x3i=new O("mat2x3",D.i32,null),O.mat2x4i=new O("mat2x4",D.i32,null),O.mat3x2i=new O("mat3x2",D.i32,null),O.mat3x3i=new O("mat3x3",D.i32,null),O.mat3x4i=new O("mat3x4",D.i32,null),O.mat4x2i=new O("mat4x2",D.i32,null),O.mat4x3i=new O("mat4x3",D.i32,null),O.mat4x4i=new O("mat4x4",D.i32,null),O.mat2x2u=new O("mat2x2",D.u32,null),O.mat2x3u=new O("mat2x3",D.u32,null),O.mat2x4u=new O("mat2x4",D.u32,null),O.mat3x2u=new O("mat3x2",D.u32,null),O.mat3x3u=new O("mat3x3",D.u32,null),O.mat3x4u=new O("mat3x4",D.u32,null),O.mat4x2u=new O("mat4x2",D.u32,null),O.mat4x3u=new O("mat4x3",D.u32,null),O.mat4x4u=new O("mat4x4",D.u32,null);class Ro extends D{constructor(e,t,r,s){super(e),this.storage=t,this.type=r,this.access=s}get astNodeType(){return"pointer"}}class Br extends D{constructor(e,t,r,s){super(e),this.attributes=t,this.format=r,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class Ir extends D{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class Et extends at{constructor(){super(),this.postfix=null}}class mn extends Et{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class _t extends Et{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Oc extends Et{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return Zd.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Ge extends Et{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class cp extends Et{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class Pe extends Et{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof A}get isVector(){return this.value instanceof w||this.value instanceof q}get scalarValue(){return this.value instanceof A?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof w||this.value instanceof q?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class lp extends Et{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class tr extends Et{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class up extends Et{constructor(){super()}}class Re extends up{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class lt extends up{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?D.f32:e.name==="u32"||t.name==="u32"?D.u32:D.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class hp extends at{constructor(e){super(),this.body=e}}class Ds extends Et{constructor(){super()}get astNodeType(){return"default"}}class fp extends hp{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class dp extends hp{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class uu extends at{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class m0 extends at{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class hu extends at{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class pp extends at{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class ot{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=ot._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}ot._id=0;class Pa extends ot{constructor(){super(new rt("void",null),null)}toString(){return"void"}}Pa.void=new Pa;class Pn extends ot{constructor(e){super(new rt("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,s){this.reference.setDataValue(e,t,r,s)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}}class A extends ot{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new A(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new A(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new A(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,s){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof A))return void console.error("SetDataValue: Invalid value",t);let i=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?i=Math.floor(i):this.typeInfo.name==="bool"&&(i=i?1:0),this.data[0]=i}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function _0(n,e,t){const r=e.length;return r===2?t==="f32"?new w(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new w(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new w(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new w(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):r===3?t==="f32"?new w(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new w(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new w(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new w(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):r===4?t==="f32"?new w(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new w(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new w(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new w(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class w extends ot{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new w(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new w(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new w(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,s){r instanceof mn?console.error("TODO: Set vector postfix"):t instanceof w?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof gn)s=this.typeInfo.format||s;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?s=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?s=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?s=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?s=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let i=this;for(;t!==null&&i!==null;){if(t instanceof tr){const o=t.index;let a=-1;if(o instanceof Pe){if(!(o.value instanceof A))return console.error(`GetSubData: Invalid array index ${o.value}`),null;a=o.value.value}else{const c=e.evalExpression(o,r);if(!(c instanceof A))return console.error("GetSubData: Unknown index type",o),null;a=c.value}if(a<0||a>=i.data.length)return console.error("GetSubData: Index out of range",a),null;if(i.data instanceof Float32Array){const c=new Float32Array(i.data.buffer,i.data.byteOffset+4*a,1);return new A(c,s)}if(i.data instanceof Int32Array){const c=new Int32Array(i.data.buffer,i.data.byteOffset+4*a,1);return new A(c,s)}if(i.data instanceof Uint32Array){const c=new Uint32Array(i.data.buffer,i.data.byteOffset+4*a,1);return new A(c,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof mn))return console.error("GetSubData: Unknown postfix",t),null;{const o=t.value.toLowerCase();if(o.length===1){let c=0;if(o==="x"||o==="r")c=0;else if(o==="y"||o==="g")c=1;else if(o==="z"||o==="b")c=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;c=3}if(this.data instanceof Float32Array){let l=new Float32Array(this.data.buffer,this.data.byteOffset+4*c,1);return new A(l,s,this)}if(this.data instanceof Int32Array){let l=new Int32Array(this.data.buffer,this.data.byteOffset+4*c,1);return new A(l,s,this)}if(this.data instanceof Uint32Array){let l=new Uint32Array(this.data.buffer,this.data.byteOffset+4*c,1);return new A(l,s,this)}}const a=[];for(const c of o)c==="x"||c==="r"?a.push(this.data[0]):c==="y"||c==="g"?a.push(this.data[1]):c==="z"||c==="b"?a.push(this.data[2]):c==="w"||c==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${c}`);i=_0(e,a,s.name)}t=t.postfix}return i}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class q extends ot{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new q(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,s){r instanceof mn?console.error("TODO: Set matrix postfix"):t instanceof q?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof gn)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof tr){const i=t.index;let o=-1;if(i instanceof Pe){if(!(i.value instanceof A))return console.error(`GetDataValue: Invalid array index ${i.value}`),null;o=i.value.value}else{const l=e.evalExpression(i,r);if(!(l instanceof A))return console.error("GetDataValue: Unknown index type",i),null;o=l.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const a=s.endsWith("h")?"h":"f";let c;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")c=new w(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${a}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")c=new w(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${a}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;c=new w(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${a}`))}return t.postfix?c.getSubData(e,t.postfix,r):c}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Te extends ot{constructor(e,t,r=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Te(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,r,s){if(t===null)return void console.log("setDataValue: NULL data.");let i=this.offset,o=this.typeInfo;for(;r;){if(r instanceof tr)if(o instanceof Qt){const a=r.index;if(a instanceof Pe){if(!(a.value instanceof A))return void console.error(`SetDataValue: Invalid index type ${a.value}`);i+=a.value.value*o.stride}else{const c=e.evalExpression(a,s);if(!(c instanceof A))return void console.error("SetDataValue: Unknown index type",a);i+=c.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof mn))return void console.error("SetDataValue: Unknown postfix type",r);{const a=r.value;if(o instanceof Yt){let c=!1;for(const l of o.members)if(l.name===a){i+=l.offset,o=l.type,c=!0;break}if(!c)return void console.error(`SetDataValue: Member ${a} not found`)}else if(o instanceof rt){const c=o.getTypeName();let l=0;if(a==="x"||a==="r")l=0;else if(a==="y"||a==="g")l=1;else if(a==="z"||a==="b")l=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);l=3}if(!(t instanceof A))return void console.error("SetDataValue: Invalid value",t);const u=t.value;return c==="vec2f"?void(new Float32Array(this.buffer,i,2)[l]=u):c==="vec3f"?void(new Float32Array(this.buffer,i,3)[l]=u):c==="vec4f"?void(new Float32Array(this.buffer,i,4)[l]=u):c==="vec2i"?void(new Int32Array(this.buffer,i,2)[l]=u):c==="vec3i"?void(new Int32Array(this.buffer,i,3)[l]=u):c==="vec4i"?void(new Int32Array(this.buffer,i,4)[l]=u):c==="vec2u"?void(new Uint32Array(this.buffer,i,2)[l]=u):c==="vec3u"?void(new Uint32Array(this.buffer,i,3)[l]=u):c==="vec4u"?void(new Uint32Array(this.buffer,i,4)[l]=u):void console.error(`SetDataValue: Type ${c} is not a struct`)}}}r=r.postfix}this.setData(e,t,o,i,s)}setData(e,t,r,s,i){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(t instanceof Te){if(r===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",o,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`);else{const a=new Float32Array(this.buffer,s,16);t instanceof q?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11],a[12]=t.data[12],a[13]=t.data[13],a[14]=t.data[14],a[15]=t.data[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15])}else{const a=new Float32Array(this.buffer,s,12);t instanceof q?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11])}else{const a=new Float32Array(this.buffer,s,8);t instanceof q?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7])}else{const a=new Float32Array(this.buffer,s,12);t instanceof q?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11])}else{const a=new Float32Array(this.buffer,s,9);t instanceof q?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8])}else{const a=new Float32Array(this.buffer,s,6);t instanceof q?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5])}else{const a=new Float32Array(this.buffer,s,8);t instanceof q?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7])}else{const a=new Float32Array(this.buffer,s,6);t instanceof q?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5])}else{const a=new Float32Array(this.buffer,s,4);t instanceof q?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,s,4);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,s,3);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Uint32Array(this.buffer,s,2);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Uint32Array(this.buffer,s,4);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Uint32Array(this.buffer,s,3);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Uint32Array(this.buffer,s,2);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Int32Array(this.buffer,s,4);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Int32Array(this.buffer,s,3);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Int32Array(this.buffer,s,2);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else{const a=new Float32Array(this.buffer,s,4);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3])}else{const a=new Float32Array(this.buffer,s,3);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2])}else{const a=new Float32Array(this.buffer,s,2);t instanceof w?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1])}else t instanceof A&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof A&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof A&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof A&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,r){var s,i,o;if(t===null)return this;let a=this.offset,c=this.typeInfo;for(;t;){if(t instanceof tr){const u=t.index,h=e.evalExpression(u,r);let f=0;if(h instanceof A?f=h.value:console.error("GetDataValue: Invalid index type",u),c instanceof Qt)a+=f*c.stride,c=c.format;else{const d=c.getTypeName();d==="mat4x4"||d==="mat4x4f"||d==="mat4x4h"?(a+=16*f,c=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${c.getTypeName()} is not an array`)}}else{if(!(t instanceof mn))return console.error("GetDataValue: Unknown postfix type",t),null;{const u=t.value;if(c instanceof Yt){let h=!1;for(const f of c.members)if(f.name===u){a+=f.offset,c=f.type,h=!0;break}if(!h)return console.error(`GetDataValue: Member ${u} not found`),null}else if(c instanceof rt){const h=c.getTypeName();if(h==="vec2f"||h==="vec3f"||h==="vec4f"||h==="vec2i"||h==="vec3i"||h==="vec4i"||h==="vec2u"||h==="vec3u"||h==="vec4u"||h==="vec2b"||h==="vec3b"||h==="vec4b"||h==="vec2h"||h==="vec3h"||h==="vec4h"||h==="vec2"||h==="vec3"||h==="vec4"){if(u.length>0&&u.length<5){let f="f";const d=[];for(let p=0;p<u.length;++p){const m=u[p].toLowerCase();let g=0;if(m==="x"||m==="r")g=0;else if(m==="y"||m==="g")g=1;else if(m==="z"||m==="b")g=2;else{if(m!=="w"&&m!=="a")return console.error(`Unknown member ${u}`),null;g=3}if(u.length===1){if(h.endsWith("f"))return this.buffer.byteLength<a+4*g+4?(console.log("Insufficient buffer data"),null):new A(new Float32Array(this.buffer,a+4*g,1),e.getTypeInfo("f32"),this);if(h.endsWith("h"))return new A(new Float32Array(this.buffer,a+4*g,1),e.getTypeInfo("f16"),this);if(h.endsWith("i"))return new A(new Int32Array(this.buffer,a+4*g,1),e.getTypeInfo("i32"),this);if(h.endsWith("b"))return new A(new Int32Array(this.buffer,a+4*g,1),e.getTypeInfo("bool"),this);if(h.endsWith("u"))return new A(new Uint32Array(this.buffer,a+4*g,1),e.getTypeInfo("i32"),this)}if(h==="vec2f")d.push(new Float32Array(this.buffer,a,2)[g]);else if(h==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const y=new Float32Array(this.buffer,a,3);d.push(y[g])}else if(h==="vec4f")d.push(new Float32Array(this.buffer,a,4)[g]);else if(h==="vec2i")f="i",d.push(new Int32Array(this.buffer,a,2)[g]);else if(h==="vec3i")f="i",d.push(new Int32Array(this.buffer,a,3)[g]);else if(h==="vec4i")f="i",d.push(new Int32Array(this.buffer,a,4)[g]);else if(h==="vec2u"){f="u";const y=new Uint32Array(this.buffer,a,2);d.push(y[g])}else h==="vec3u"?(f="u",d.push(new Uint32Array(this.buffer,a,3)[g])):h==="vec4u"&&(f="u",d.push(new Uint32Array(this.buffer,a,4)[g]))}return d.length===2?c=e.getTypeInfo(`vec2${f}`):d.length===3?c=e.getTypeInfo(`vec3${f}`):d.length===4?c=e.getTypeInfo(`vec4${f}`):console.error(`GetDataValue: Invalid vector length ${d.length}`),new w(d,c,null)}return console.error(`GetDataValue: Unknown member ${u}`),null}return console.error(`GetDataValue: Type ${h} is not a struct`),null}}}t=t.postfix}const l=c.getTypeName();return l==="f32"?new A(new Float32Array(this.buffer,a,1),c,this):l==="i32"?new A(new Int32Array(this.buffer,a,1),c,this):l==="u32"?new A(new Uint32Array(this.buffer,a,1),c,this):l==="vec2f"?new w(new Float32Array(this.buffer,a,2),c,this):l==="vec3f"?new w(new Float32Array(this.buffer,a,3),c,this):l==="vec4f"?new w(new Float32Array(this.buffer,a,4),c,this):l==="vec2i"?new w(new Int32Array(this.buffer,a,2),c,this):l==="vec3i"?new w(new Int32Array(this.buffer,a,3),c,this):l==="vec4i"?new w(new Int32Array(this.buffer,a,4),c,this):l==="vec2u"?new w(new Uint32Array(this.buffer,a,2),c,this):l==="vec3u"?new w(new Uint32Array(this.buffer,a,3),c,this):l==="vec4u"?new w(new Uint32Array(this.buffer,a,4),c,this):c instanceof gn&&c.name==="atomic"?((s=c.format)===null||s===void 0?void 0:s.name)==="u32"?new A(new Uint32Array(this.buffer,a,1)[0],c.format,this):((i=c.format)===null||i===void 0?void 0:i.name)==="i32"?new A(new Int32Array(this.buffer,a,1)[0],c.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=c.format)===null||o===void 0?void 0:o.name}`),null):new Te(this.buffer,c,a,this)}toString(){let e="";if(this.typeInfo instanceof Qt)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof Yt?e+="{...}":e="[...]";return e}}class It extends ot{constructor(e,t,r,s){super(t,null),this.data=e,this.descriptor=r,this.view=s}clone(){return new It(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.width)!==null&&t!==void 0?t:0}get height(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){const e=this.format,t=Eo[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Eo[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Eo[e],r=this.width;if(!e||r<=0||!t)return-1;const s=this.height,i=this.depthOrArrayLayers,o=this.dimension;return r/t.blockWidth*(o==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*i}getPixel(e,t,r=0,s=0){const i=this.texelByteSize,o=this.bytesPerRow,a=this.height,c=this.data[s];return h0(new Uint8Array(c),e,t,r,s,a,o,i,this.format)}setPixel(e,t,r,s,i){const o=this.texelByteSize,a=this.bytesPerRow,c=this.height,l=this.data[s];(function(u,h,f,d,p,m,g,y,S,v){const x=d*(g>>=p)*(m>>=p)+f*g+h*y;switch(S){case"r8unorm":return void ue(u,x,"8unorm",1,v);case"r8snorm":return void ue(u,x,"8snorm",1,v);case"r8uint":return void ue(u,x,"8uint",1,v);case"r8sint":return void ue(u,x,"8sint",1,v);case"rg8unorm":return void ue(u,x,"8unorm",2,v);case"rg8snorm":return void ue(u,x,"8snorm",2,v);case"rg8uint":return void ue(u,x,"8uint",2,v);case"rg8sint":return void ue(u,x,"8sint",2,v);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void ue(u,x,"8unorm",4,v);case"rgba8snorm":return void ue(u,x,"8snorm",4,v);case"rgba8uint":return void ue(u,x,"8uint",4,v);case"rgba8sint":return void ue(u,x,"8sint",4,v);case"r16uint":return void ue(u,x,"16uint",1,v);case"r16sint":return void ue(u,x,"16sint",1,v);case"r16float":return void ue(u,x,"16float",1,v);case"rg16uint":return void ue(u,x,"16uint",2,v);case"rg16sint":return void ue(u,x,"16sint",2,v);case"rg16float":return void ue(u,x,"16float",2,v);case"rgba16uint":return void ue(u,x,"16uint",4,v);case"rgba16sint":return void ue(u,x,"16sint",4,v);case"rgba16float":return void ue(u,x,"16float",4,v);case"r32uint":return void ue(u,x,"32uint",1,v);case"r32sint":return void ue(u,x,"32sint",1,v);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void ue(u,x,"32float",1,v);case"rg32uint":return void ue(u,x,"32uint",2,v);case"rg32sint":return void ue(u,x,"32sint",2,v);case"rg32float":return void ue(u,x,"32float",2,v);case"rgba32uint":return void ue(u,x,"32uint",4,v);case"rgba32sint":return void ue(u,x,"32sint",4,v);case"rgba32float":return void ue(u,x,"32float",4,v);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(l),e,t,r,s,c,a,o,this.format,i)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(E||(E={}));class R{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class b{}k=b,b.none=new R("",E.reserved,""),b.eof=new R("EOF",E.token,""),b.reserved={asm:new R("asm",E.reserved,"asm"),bf16:new R("bf16",E.reserved,"bf16"),do:new R("do",E.reserved,"do"),enum:new R("enum",E.reserved,"enum"),f16:new R("f16",E.reserved,"f16"),f64:new R("f64",E.reserved,"f64"),handle:new R("handle",E.reserved,"handle"),i8:new R("i8",E.reserved,"i8"),i16:new R("i16",E.reserved,"i16"),i64:new R("i64",E.reserved,"i64"),mat:new R("mat",E.reserved,"mat"),premerge:new R("premerge",E.reserved,"premerge"),regardless:new R("regardless",E.reserved,"regardless"),typedef:new R("typedef",E.reserved,"typedef"),u8:new R("u8",E.reserved,"u8"),u16:new R("u16",E.reserved,"u16"),u64:new R("u64",E.reserved,"u64"),unless:new R("unless",E.reserved,"unless"),using:new R("using",E.reserved,"using"),vec:new R("vec",E.reserved,"vec"),void:new R("void",E.reserved,"void")},b.keywords={array:new R("array",E.keyword,"array"),atomic:new R("atomic",E.keyword,"atomic"),bool:new R("bool",E.keyword,"bool"),f32:new R("f32",E.keyword,"f32"),i32:new R("i32",E.keyword,"i32"),mat2x2:new R("mat2x2",E.keyword,"mat2x2"),mat2x3:new R("mat2x3",E.keyword,"mat2x3"),mat2x4:new R("mat2x4",E.keyword,"mat2x4"),mat3x2:new R("mat3x2",E.keyword,"mat3x2"),mat3x3:new R("mat3x3",E.keyword,"mat3x3"),mat3x4:new R("mat3x4",E.keyword,"mat3x4"),mat4x2:new R("mat4x2",E.keyword,"mat4x2"),mat4x3:new R("mat4x3",E.keyword,"mat4x3"),mat4x4:new R("mat4x4",E.keyword,"mat4x4"),ptr:new R("ptr",E.keyword,"ptr"),sampler:new R("sampler",E.keyword,"sampler"),sampler_comparison:new R("sampler_comparison",E.keyword,"sampler_comparison"),struct:new R("struct",E.keyword,"struct"),texture_1d:new R("texture_1d",E.keyword,"texture_1d"),texture_2d:new R("texture_2d",E.keyword,"texture_2d"),texture_2d_array:new R("texture_2d_array",E.keyword,"texture_2d_array"),texture_3d:new R("texture_3d",E.keyword,"texture_3d"),texture_cube:new R("texture_cube",E.keyword,"texture_cube"),texture_cube_array:new R("texture_cube_array",E.keyword,"texture_cube_array"),texture_multisampled_2d:new R("texture_multisampled_2d",E.keyword,"texture_multisampled_2d"),texture_storage_1d:new R("texture_storage_1d",E.keyword,"texture_storage_1d"),texture_storage_2d:new R("texture_storage_2d",E.keyword,"texture_storage_2d"),texture_storage_2d_array:new R("texture_storage_2d_array",E.keyword,"texture_storage_2d_array"),texture_storage_3d:new R("texture_storage_3d",E.keyword,"texture_storage_3d"),texture_depth_2d:new R("texture_depth_2d",E.keyword,"texture_depth_2d"),texture_depth_2d_array:new R("texture_depth_2d_array",E.keyword,"texture_depth_2d_array"),texture_depth_cube:new R("texture_depth_cube",E.keyword,"texture_depth_cube"),texture_depth_cube_array:new R("texture_depth_cube_array",E.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new R("texture_depth_multisampled_2d",E.keyword,"texture_depth_multisampled_2d"),texture_external:new R("texture_external",E.keyword,"texture_external"),u32:new R("u32",E.keyword,"u32"),vec2:new R("vec2",E.keyword,"vec2"),vec3:new R("vec3",E.keyword,"vec3"),vec4:new R("vec4",E.keyword,"vec4"),bitcast:new R("bitcast",E.keyword,"bitcast"),block:new R("block",E.keyword,"block"),break:new R("break",E.keyword,"break"),case:new R("case",E.keyword,"case"),continue:new R("continue",E.keyword,"continue"),continuing:new R("continuing",E.keyword,"continuing"),default:new R("default",E.keyword,"default"),diagnostic:new R("diagnostic",E.keyword,"diagnostic"),discard:new R("discard",E.keyword,"discard"),else:new R("else",E.keyword,"else"),enable:new R("enable",E.keyword,"enable"),fallthrough:new R("fallthrough",E.keyword,"fallthrough"),false:new R("false",E.keyword,"false"),fn:new R("fn",E.keyword,"fn"),for:new R("for",E.keyword,"for"),function:new R("function",E.keyword,"function"),if:new R("if",E.keyword,"if"),let:new R("let",E.keyword,"let"),const:new R("const",E.keyword,"const"),loop:new R("loop",E.keyword,"loop"),while:new R("while",E.keyword,"while"),private:new R("private",E.keyword,"private"),read:new R("read",E.keyword,"read"),read_write:new R("read_write",E.keyword,"read_write"),return:new R("return",E.keyword,"return"),requires:new R("requires",E.keyword,"requires"),storage:new R("storage",E.keyword,"storage"),switch:new R("switch",E.keyword,"switch"),true:new R("true",E.keyword,"true"),alias:new R("alias",E.keyword,"alias"),type:new R("type",E.keyword,"type"),uniform:new R("uniform",E.keyword,"uniform"),var:new R("var",E.keyword,"var"),override:new R("override",E.keyword,"override"),workgroup:new R("workgroup",E.keyword,"workgroup"),write:new R("write",E.keyword,"write"),r8unorm:new R("r8unorm",E.keyword,"r8unorm"),r8snorm:new R("r8snorm",E.keyword,"r8snorm"),r8uint:new R("r8uint",E.keyword,"r8uint"),r8sint:new R("r8sint",E.keyword,"r8sint"),r16uint:new R("r16uint",E.keyword,"r16uint"),r16sint:new R("r16sint",E.keyword,"r16sint"),r16float:new R("r16float",E.keyword,"r16float"),rg8unorm:new R("rg8unorm",E.keyword,"rg8unorm"),rg8snorm:new R("rg8snorm",E.keyword,"rg8snorm"),rg8uint:new R("rg8uint",E.keyword,"rg8uint"),rg8sint:new R("rg8sint",E.keyword,"rg8sint"),r32uint:new R("r32uint",E.keyword,"r32uint"),r32sint:new R("r32sint",E.keyword,"r32sint"),r32float:new R("r32float",E.keyword,"r32float"),rg16uint:new R("rg16uint",E.keyword,"rg16uint"),rg16sint:new R("rg16sint",E.keyword,"rg16sint"),rg16float:new R("rg16float",E.keyword,"rg16float"),rgba8unorm:new R("rgba8unorm",E.keyword,"rgba8unorm"),rgba8unorm_srgb:new R("rgba8unorm_srgb",E.keyword,"rgba8unorm_srgb"),rgba8snorm:new R("rgba8snorm",E.keyword,"rgba8snorm"),rgba8uint:new R("rgba8uint",E.keyword,"rgba8uint"),rgba8sint:new R("rgba8sint",E.keyword,"rgba8sint"),bgra8unorm:new R("bgra8unorm",E.keyword,"bgra8unorm"),bgra8unorm_srgb:new R("bgra8unorm_srgb",E.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new R("rgb10a2unorm",E.keyword,"rgb10a2unorm"),rg11b10float:new R("rg11b10float",E.keyword,"rg11b10float"),rg32uint:new R("rg32uint",E.keyword,"rg32uint"),rg32sint:new R("rg32sint",E.keyword,"rg32sint"),rg32float:new R("rg32float",E.keyword,"rg32float"),rgba16uint:new R("rgba16uint",E.keyword,"rgba16uint"),rgba16sint:new R("rgba16sint",E.keyword,"rgba16sint"),rgba16float:new R("rgba16float",E.keyword,"rgba16float"),rgba32uint:new R("rgba32uint",E.keyword,"rgba32uint"),rgba32sint:new R("rgba32sint",E.keyword,"rgba32sint"),rgba32float:new R("rgba32float",E.keyword,"rgba32float"),static_assert:new R("static_assert",E.keyword,"static_assert")},b.tokens={decimal_float_literal:new R("decimal_float_literal",E.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new R("hex_float_literal",E.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new R("int_literal",E.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new R("uint_literal",E.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new R("name",E.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new R("ident",E.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new R("and",E.token,"&"),and_and:new R("and_and",E.token,"&&"),arrow:new R("arrow ",E.token,"->"),attr:new R("attr",E.token,"@"),forward_slash:new R("forward_slash",E.token,"/"),bang:new R("bang",E.token,"!"),bracket_left:new R("bracket_left",E.token,"["),bracket_right:new R("bracket_right",E.token,"]"),brace_left:new R("brace_left",E.token,"{"),brace_right:new R("brace_right",E.token,"}"),colon:new R("colon",E.token,":"),comma:new R("comma",E.token,","),equal:new R("equal",E.token,"="),equal_equal:new R("equal_equal",E.token,"=="),not_equal:new R("not_equal",E.token,"!="),greater_than:new R("greater_than",E.token,">"),greater_than_equal:new R("greater_than_equal",E.token,">="),shift_right:new R("shift_right",E.token,">>"),less_than:new R("less_than",E.token,"<"),less_than_equal:new R("less_than_equal",E.token,"<="),shift_left:new R("shift_left",E.token,"<<"),modulo:new R("modulo",E.token,"%"),minus:new R("minus",E.token,"-"),minus_minus:new R("minus_minus",E.token,"--"),period:new R("period",E.token,"."),plus:new R("plus",E.token,"+"),plus_plus:new R("plus_plus",E.token,"++"),or:new R("or",E.token,"|"),or_or:new R("or_or",E.token,"||"),paren_left:new R("paren_left",E.token,"("),paren_right:new R("paren_right",E.token,")"),semicolon:new R("semicolon",E.token,";"),star:new R("star",E.token,"*"),tilde:new R("tilde",E.token,"~"),underscore:new R("underscore",E.token,"_"),xor:new R("xor",E.token,"^"),plus_equal:new R("plus_equal",E.token,"+="),minus_equal:new R("minus_equal",E.token,"-="),times_equal:new R("times_equal",E.token,"*="),division_equal:new R("division_equal",E.token,"/="),modulo_equal:new R("modulo_equal",E.token,"%="),and_equal:new R("and_equal",E.token,"&="),or_equal:new R("or_equal",E.token,"|="),xor_equal:new R("xor_equal",E.token,"^="),shift_right_equal:new R("shift_right_equal",E.token,">>="),shift_left_equal:new R("shift_left_equal",E.token,"<<=")},b.simpleTokens={"@":k.tokens.attr,"{":k.tokens.brace_left,"}":k.tokens.brace_right,":":k.tokens.colon,",":k.tokens.comma,"(":k.tokens.paren_left,")":k.tokens.paren_right,";":k.tokens.semicolon},b.literalTokens={"&":k.tokens.and,"&&":k.tokens.and_and,"->":k.tokens.arrow,"/":k.tokens.forward_slash,"!":k.tokens.bang,"[":k.tokens.bracket_left,"]":k.tokens.bracket_right,"=":k.tokens.equal,"==":k.tokens.equal_equal,"!=":k.tokens.not_equal,">":k.tokens.greater_than,">=":k.tokens.greater_than_equal,">>":k.tokens.shift_right,"<":k.tokens.less_than,"<=":k.tokens.less_than_equal,"<<":k.tokens.shift_left,"%":k.tokens.modulo,"-":k.tokens.minus,"--":k.tokens.minus_minus,".":k.tokens.period,"+":k.tokens.plus,"++":k.tokens.plus_plus,"|":k.tokens.or,"||":k.tokens.or_or,"*":k.tokens.star,"~":k.tokens.tilde,_:k.tokens.underscore,"^":k.tokens.xor,"+=":k.tokens.plus_equal,"-=":k.tokens.minus_equal,"*=":k.tokens.times_equal,"/=":k.tokens.division_equal,"%=":k.tokens.modulo_equal,"&=":k.tokens.and_equal,"|=":k.tokens.or_equal,"^=":k.tokens.xor_equal,">>=":k.tokens.shift_right_equal,"<<=":k.tokens.shift_left_equal},b.regexTokens={decimal_float_literal:k.tokens.decimal_float_literal,hex_float_literal:k.tokens.hex_float_literal,int_literal:k.tokens.int_literal,uint_literal:k.tokens.uint_literal,ident:k.tokens.ident},b.storage_class=[k.keywords.function,k.keywords.private,k.keywords.workgroup,k.keywords.uniform,k.keywords.storage],b.access_mode=[k.keywords.read,k.keywords.write,k.keywords.read_write],b.sampler_type=[k.keywords.sampler,k.keywords.sampler_comparison],b.sampled_texture_type=[k.keywords.texture_1d,k.keywords.texture_2d,k.keywords.texture_2d_array,k.keywords.texture_3d,k.keywords.texture_cube,k.keywords.texture_cube_array],b.multisampled_texture_type=[k.keywords.texture_multisampled_2d],b.storage_texture_type=[k.keywords.texture_storage_1d,k.keywords.texture_storage_2d,k.keywords.texture_storage_2d_array,k.keywords.texture_storage_3d],b.depth_texture_type=[k.keywords.texture_depth_2d,k.keywords.texture_depth_2d_array,k.keywords.texture_depth_cube,k.keywords.texture_depth_cube_array,k.keywords.texture_depth_multisampled_2d],b.texture_external_type=[k.keywords.texture_external],b.any_texture_type=[...k.sampled_texture_type,...k.multisampled_texture_type,...k.storage_texture_type,...k.depth_texture_type,...k.texture_external_type],b.texel_format=[k.keywords.r8unorm,k.keywords.r8snorm,k.keywords.r8uint,k.keywords.r8sint,k.keywords.r16uint,k.keywords.r16sint,k.keywords.r16float,k.keywords.rg8unorm,k.keywords.rg8snorm,k.keywords.rg8uint,k.keywords.rg8sint,k.keywords.r32uint,k.keywords.r32sint,k.keywords.r32float,k.keywords.rg16uint,k.keywords.rg16sint,k.keywords.rg16float,k.keywords.rgba8unorm,k.keywords.rgba8unorm_srgb,k.keywords.rgba8snorm,k.keywords.rgba8uint,k.keywords.rgba8sint,k.keywords.bgra8unorm,k.keywords.bgra8unorm_srgb,k.keywords.rgb10a2unorm,k.keywords.rg11b10float,k.keywords.rg32uint,k.keywords.rg32sint,k.keywords.rg32float,k.keywords.rgba16uint,k.keywords.rgba16sint,k.keywords.rgba16float,k.keywords.rgba32uint,k.keywords.rgba32sint,k.keywords.rgba32float],b.const_literal=[k.tokens.int_literal,k.tokens.uint_literal,k.tokens.decimal_float_literal,k.tokens.hex_float_literal,k.keywords.true,k.keywords.false],b.literal_or_ident=[k.tokens.ident,k.tokens.int_literal,k.tokens.uint_literal,k.tokens.decimal_float_literal,k.tokens.hex_float_literal,k.tokens.name],b.element_count_expression=[k.tokens.int_literal,k.tokens.uint_literal,k.tokens.ident],b.template_types=[k.keywords.vec2,k.keywords.vec3,k.keywords.vec4,k.keywords.mat2x2,k.keywords.mat2x3,k.keywords.mat2x4,k.keywords.mat3x2,k.keywords.mat3x3,k.keywords.mat3x4,k.keywords.mat4x2,k.keywords.mat4x3,k.keywords.mat4x4,k.keywords.atomic,k.keywords.bitcast,...k.any_texture_type],b.attribute_name=[k.tokens.ident,k.keywords.block,k.keywords.diagnostic],b.assignment_operators=[k.tokens.equal,k.tokens.plus_equal,k.tokens.minus_equal,k.tokens.times_equal,k.tokens.division_equal,k.tokens.modulo_equal,k.tokens.and_equal,k.tokens.or_equal,k.tokens.xor_equal,k.tokens.shift_right_equal,k.tokens.shift_left_equal],b.increment_operators=[k.tokens.plus_plus,k.tokens.minus_minus];class fu{constructor(e,t,r,s,i){this.type=e,this.lexeme=t,this.line=r,this.start=s,this.end=i}toString(){return this.lexeme}isTemplateType(){return b.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==b.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class b0{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new fu(b.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const t=b.simpleTokens[e];if(t)return this._addToken(t),!0;let r=b.none;const s=this._isAlpha(e),i=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(s){const o=b.keywords[e];if(o)return this._addToken(o),!0}if(s||i)return this._addToken(b.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(b.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(b.tokens.minus_minus),!0;const c=this._tokens.length-1;if((b.literal_or_ident.indexOf(this._tokens[c].type)!=-1||this._tokens[c].type==b.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let c=!1,l=this._tokens.length-1;for(let u=0;u<5&&l>=0&&b.assignment_operators.indexOf(this._tokens[l].type)===-1;++u,--l)if(this._tokens[l].type===b.tokens.less_than){l>0&&this._tokens[l-1].isArrayOrTemplateType()&&(c=!0);break}if(c)return this._addToken(o),!0}if(o===b.none){let c=e,l=0;const u=2;for(let h=0;h<u;++h)if(c+=this._peekAhead(h),o=this._findType(c),o!==b.none){l=h;break}if(o===b.none)return r!==b.none&&(this._current--,this._addToken(r),!0);e=c,this._current+=l+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==b.none&&(this._addToken(r),!0)}_findType(e){for(const r in b.regexTokens){const s=b.regexTokens[r];if(this._match(e,s.rule))return s}return b.literalTokens[e]||b.none}_match(e,t){const r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new fu(e,t,this._line,this._start,this._current))}}function V(n){return Array.isArray(n)||(n==null?void 0:n.buffer)instanceof ArrayBuffer}const ii=new Float32Array(1),y0=new Uint32Array(ii.buffer),v0=new Uint32Array(ii.buffer),oi=new Int32Array(1),w0=new Float32Array(oi.buffer),T0=new Uint32Array(oi.buffer),ai=new Uint32Array(1),x0=new Float32Array(ai.buffer),S0=new Int32Array(ai.buffer);function du(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return ii[0]=n,y0[0];if(t==="u32")return ii[0]=n,v0[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return oi[0]=n,w0[0];if(t==="u32")return oi[0]=n,T0[0]}else if(e==="u32"){if(t==="f32")return ai[0]=n,x0[0];if(t==="i32"||t==="x32")return ai[0]=n,S0[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class A0{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class gs{constructor(e,t){this.align=e,this.size=t}}class Tt{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new c0,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Yr&&this._functions.set(t.name,new A0(t));for(const t of e)if(t instanceof Ct){const r=this.getTypeInfo(t,null);r instanceof Yt&&this.structs.push(r)}for(const t of e)if(t instanceof Pc)this.aliases.push(this._getAliasInfo(t));else if(t instanceof Cc){const r=t,s=this._getAttributeNum(r.attributes,"id",0),i=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new i0(r.name,i,r.attributes,s))}else if(this._isUniformVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),i=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new ps(r.name,o,s,i,r.attributes,Wt.Uniform,r.access);a.access||(a.access="read"),this.uniforms.push(a)}else if(this._isStorageVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),i=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),c=new ps(r.name,o,s,i,r.attributes,a?Wt.StorageTexture:Wt.Storage,r.access);c.access||(c.access="read"),this.storage.push(c)}else if(this._isTextureVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),i=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),c=new ps(r.name,o,s,i,r.attributes,a?Wt.StorageTexture:Wt.Texture,r.access);c.access||(c.access="read"),a?this.storage.push(c):this.textures.push(c)}else if(this._isSamplerVar(t)){const r=t,s=this._getAttributeNum(r.attributes,"group",0),i=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new ps(r.name,o,s,i,r.attributes,Wt.Sampler,r.access);this.samplers.push(a)}else if(t instanceof Yr){const r=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),o=r||s||i,a=new a0(t.name,o==null?void 0:o.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,o&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!o),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[o.name].push(a)),a.arguments=t.args.map(c=>new o0(c.name,this.getTypeInfo(c.type,c.attributes),c.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(r=>{var s,i,o;if(r instanceof pp){if(r.value)if(V(r.value))for(const a of r.value)for(const c of this.overrides)a===c.name&&((s=t.info)===null||s===void 0||s.overrides.push(c));else for(const a of this.overrides)r.value===a.name&&((i=t.info)===null||i===void 0||i.overrides.push(a))}else if(r instanceof Ge)for(const a of this.overrides)r.name===a.name&&((o=t.info)===null||o===void 0||o.overrides.push(a))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(const s of e.calls){const i=(r=this._functions.get(s.name))===null||r===void 0?void 0:r.info;i&&t.add(i)}}findResource(e,t,r){if(r){for(const s of this.entry.compute)if(s.name===r){for(const i of s.resources)if(i.group==e&&i.binding==t)return i}for(const s of this.entry.vertex)if(s.name===r){for(const i of s.resources)if(i.group==e&&i.binding==t)return i}for(const s of this.entry.fragment)if(s.name===r){for(const i of s.resources)if(i.group==e&&i.binding==t)return i}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const r=[],s=this,i=[];return e.search(o=>{if(o instanceof ri)i.push({});else if(o instanceof si)i.pop();else if(o instanceof Pt){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type),i.length>0&&(i[i.length-1][a.name]=a)}else if(o instanceof _t){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof Ur){const a=o;t&&a.type!==null&&this._markStructsFromAST(a.type),i.length>0&&(i[i.length-1][a.name]=a)}else if(o instanceof Ge){const a=o;if(i.length>0&&i[i.length-1][a.name])return;const c=s._findResource(a.name);c&&r.push(c)}else if(o instanceof Oc){const a=o,c=s._functions.get(a.name);c&&(t&&(c.inUse=!0),e.calls.add(c.node),c.resources===null&&(c.resources=s._findResources(c.node,t)),r.push(...c.resources))}else if(o instanceof Ic){const a=o,c=s._functions.get(a.name);c&&(t&&(c.inUse=!0),e.calls.add(c.node),c.resources===null&&(c.resources=s._findResources(c.node,t)),r.push(...c.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function t(r,s){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),s>=e[r].length&&(e[r].length=s+1)}for(const r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Ct)this._getStructOutputs(e,t);else{const r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(const r of e.members)if(r.type instanceof Ct)this._getStructOutputs(r.type,t);else{const s=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(s!==null){const i=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(s.value),a=new au(r.name,i,s.name,o);t.push(a)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new au("",r,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const r of e)if(r.type instanceof Ct)this._getStructInputs(r.type,t);else{const s=this._getInputInfo(r);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const r of e.members)if(r.type instanceof Ct)this._getStructInputs(r.type,t);else{const s=this._getInputInfo(r);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),i=this._parseInt(t.value),o=new s0(e.name,s,t.name,i);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new r0(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Br){const s=e,i=s.format?this.getTypeInfo(s.format,s.attributes):null,o=new Qt(s.name,t);return o.format=i,o.count=s.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Ct){const s=e,i=new Yt(s.name,t);i.startLine=s.startLine,i.endLine=s.endLine;for(const o of s.members){const a=this.getTypeInfo(o.type,o.attributes);i.members.push(new ou(o.name,a,o.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Ir){const s=e,i=s.format instanceof D,o=s.format?i?this.getTypeInfo(s.format,null):new rt(s.format,null):null,a=new gn(s.name,o,t,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof O){const s=e,i=s.format?this.getTypeInfo(s.format,null):null,o=new gn(s.name,i,t,s.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new rt(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,s;const i=this._getTypeSize(e);if(e.size=(t=i==null?void 0:i.size)!==null&&t!==void 0?t:0,e instanceof Qt&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,(s=o==null?void 0:o.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof Yt&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,s=0,i=0,o=0;for(let a=0,c=e.members.length;a<c;++a){const l=e.members[a],u=this._getTypeSize(l);if(!u)continue;(t=this._getAlias(l.type.name))!==null&&t!==void 0||l.type;const h=u.align,f=u.size;r=this._roundUp(h,r+s),s=f,i=r,o=Math.max(o,h),l.offset=r,l.size=f,this._updateTypeInfo(l.type)}e.size=this._roundUp(o,i+s),e.align=o}_getTypeSize(e){var t,r;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof ou&&(e=e.type),e instanceof rt){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Tt._typeInfo[e.name];if(o!==void 0){const a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new gs(Math.max(i,o.align/a),Math.max(s,o.size/a))}}{const o=Tt._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new gs(Math.max(i,o.align/a),Math.max(s,o.size/a))}}if(e instanceof Qt){let o=e,a=8,c=8;const l=this._getTypeSize(o.format);return l!==null&&(c=l.size,a=l.align),c=o.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,c)),s&&(c=s),new gs(Math.max(i,a),Math.max(s,c))}if(e instanceof Yt){let o=0,a=0,c=0,l=0,u=0;for(const h of e.members){const f=this._getTypeSize(h.type);f!==null&&(o=Math.max(f.align,o),c=this._roundUp(f.align,c+l),l=f.size,u=c)}return a=this._roundUp(o,u+l),new gs(Math.max(i,o),Math.max(s,a))}return null}_isUniformVar(e){return e instanceof Pt&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Pt&&e.storage=="storage"}_isTextureVar(e){return e instanceof Pt&&e.type!==null&&Tt._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Pt&&e.type!==null&&Tt._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const r=e;if(!r||!r.attributes)return null;const s=r.attributes;for(let i of s)if(i.name==t)return i;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let s of e)if(s.name==t){let i=s!==null&&s.value!==null?s.value:r;return i instanceof Array&&(i=i[0]),typeof i=="number"?i:typeof i=="string"?parseInt(i):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}Tt._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Tt._textureTypes=b.any_texture_type.map(n=>n.name),Tt._samplerTypes=b.sampler_type.map(n=>n.name);class kc{constructor(e,t,r){this.name=e,this.value=t,this.node=r}clone(){return new kc(this.name,this.value,this.node)}}class Mc{constructor(e){this.name=e.name,this.node=e}clone(){return new Mc(this.node)}}class Nc{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new kc(e,t,r??null))}setVariable(e,t,r){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;const r=this.getVariable(e);return(t=r==null?void 0:r.value)!==null&&t!==void 0?t:null}clone(){return new Nc(this)}}class E0{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class R0{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const r=this.exec.evalExpression(e.args[0],t);let s=!0;if(r instanceof w)return r.data.forEach(i=>{i||(s=!1)}),new A(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w){const s=r.data.some(i=>i);return new A(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof A))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.evalExpression(r,t);if(s instanceof Te&&s.typeInfo.size===0){const i=s.typeInfo,o=s.buffer.byteLength/i.stride;return new A(o,this.getTypeInfo("u32"))}return new A(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.abs(i)),r.typeInfo);const s=r;return new A(Math.abs(s.value),s.typeInfo)}Acos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.acos(i)),r.typeInfo);const s=r;return new A(Math.acos(s.value),r.typeInfo)}Acosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.acosh(i)),r.typeInfo);const s=r;return new A(Math.acosh(s.value),r.typeInfo)}Asin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.asin(i)),r.typeInfo);const s=r;return new A(Math.asin(s.value),r.typeInfo)}Asinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.asinh(i)),r.typeInfo);const s=r;return new A(Math.asinh(s.value),r.typeInfo)}Atan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.atan(i)),r.typeInfo);const s=r;return new A(Math.atan(s.value),r.typeInfo)}Atanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.atanh(i)),r.typeInfo);const s=r;return new A(Math.atanh(s.value),r.typeInfo)}Atan2(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof w&&s instanceof w)return new w(r.data.map((a,c)=>Math.atan2(a,s.data[c])),r.typeInfo);const i=r,o=s;return new A(Math.atan2(i.value,o.value),r.typeInfo)}Ceil(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.ceil(i)),r.typeInfo);const s=r;return new A(Math.ceil(s.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r instanceof w&&s instanceof w&&i instanceof w)return new w(r.data.map((l,u)=>this._clamp(l,s.data[u],i.data[u])),r.typeInfo);const o=r,a=s,c=i;return new A(this._clamp(o.value,a.value,c.value),r.typeInfo)}Cos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.cos(i)),r.typeInfo);const s=r;return new A(Math.cos(s.value),r.typeInfo)}Cosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.cosh(i)),r.typeInfo);const s=r;return new A(Math.cos(s.value),r.typeInfo)}CountLeadingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.clz32(i)),r.typeInfo);const s=r;return new A(Math.clz32(s.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>this._countOneBits(i)),r.typeInfo);const s=r;return new A(this._countOneBits(s.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>this._countTrailingZeros(i)),r.typeInfo);const s=r;return new A(this._countTrailingZeros(s.value),r.typeInfo)}Cross(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof w&&s instanceof w){if(r.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const i=r.data,o=s.data;return new w([i[1]*o[2]-o[1]*i[2],i[2]*o[0]-o[2]*i[0],i[0]*o[1]-o[0]*i[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const r=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return r instanceof w?new w(r.data.map(i=>i*s),r.typeInfo):new A(r.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof q){const s=r.data,i=r.typeInfo.getTypeName(),o=i.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h")return new A(s[0]*s[3]-s[1]*s[2],o);if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h")return new A(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),o);if(i==="mat2x4"||i==="mat2x4f"||i==="mat2x4h")console.error(`TODO: Determinant for ${i}`);else if(i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h")console.error(`TODO: Determinant for ${i}`);else{if(i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h")return new A(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),o);i==="mat3x4"||i==="mat3x4f"||i==="mat3x4h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h"?console.error(`TODO: Determinant for ${i}`):i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h"||console.error(`TODO: Determinant for ${i}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof w&&s instanceof w){let a=0;for(let c=0;c<r.data.length;++c)a+=(r.data[c]-s.data[c])*(r.data[c]-s.data[c]);return new A(Math.sqrt(a),this.getTypeInfo("f32"))}const i=r,o=s;return new A(Math.abs(i.value-o.value),r.typeInfo)}_dot(e,t){let r=0;for(let s=0;s<e.length;++s)r+=t[s]*e[s];return r}Dot(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return r instanceof w&&s instanceof w?new A(this._dot(r.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.exp(i)),r.typeInfo);const s=r;return new A(Math.exp(s.value),r.typeInfo)}Exp2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.pow(2,i)),r.typeInfo);const s=r;return new A(Math.pow(2,s.value),r.typeInfo)}ExtractBits(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=s.value,a=i.value;if(r instanceof w)return new w(r.data.map(l=>l>>o&(1<<a)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const c=r.value;return new A(c>>o&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r instanceof w&&s instanceof w&&i instanceof w){const o=this._dot(s.data,i.data);return new w(o<0?Array.from(r.data):r.data.map(a=>-a),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>this._firstLeadingBit(i)),r.typeInfo);const s=r;return new A(this._firstLeadingBit(s.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>this._firstTrailingBit(i)),r.typeInfo);const s=r;return new A(this._firstTrailingBit(s.value),r.typeInfo)}Floor(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.floor(i)),r.typeInfo);const s=r;return new A(Math.floor(s.value),r.typeInfo)}Fma(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r instanceof w&&s instanceof w&&i instanceof w)return r.data.length!==s.data.length||r.data.length!==i.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new w(r.data.map((l,u)=>l*s.data[u]+i.data[u]),r.typeInfo);const o=r,a=s,c=i;return new A(o.value*a.value+c.value,o.typeInfo)}Fract(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>i-Math.floor(i)),r.typeInfo);const s=r;return new A(s.value-Math.floor(s.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t),o=this.exec.evalExpression(e.args[3],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=i.value,c=(1<<o.value)-1<<a,l=~c;if(r instanceof w&&s instanceof w)return new w(r.data.map((f,d)=>f&l|s.data[d]<<a&c),r.typeInfo);const u=r.value,h=s.value;return new A(u&l|h<<a&c,r.typeInfo)}InverseSqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>1/Math.sqrt(i)),r.typeInfo);const s=r;return new A(1/Math.sqrt(s.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w){let i=0;return r.data.forEach(o=>{i+=o*o}),new A(Math.sqrt(i),this.getTypeInfo("f32"))}const s=r;return new A(Math.abs(s.value),r.typeInfo)}Log(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.log(i)),r.typeInfo);const s=r;return new A(Math.log(s.value),r.typeInfo)}Log2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.log2(i)),r.typeInfo);const s=r;return new A(Math.log2(s.value),r.typeInfo)}Max(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof w&&s instanceof w)return new w(r.data.map((a,c)=>Math.max(a,s.data[c])),r.typeInfo);const i=r,o=s;return new A(Math.max(i.value,o.value),r.typeInfo)}Min(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof w&&s instanceof w)return new w(r.data.map((a,c)=>Math.min(a,s.data[c])),r.typeInfo);const i=r,o=s;return new A(Math.min(i.value,o.value),r.typeInfo)}Mix(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r instanceof w&&s instanceof w&&i instanceof w)return new w(r.data.map((c,l)=>r.data[l]*(1-i.data[l])+s.data[l]*i.data[l]),r.typeInfo);const o=s,a=i;return new A(r.value*(1-a.value)+o.value*a.value,r.typeInfo)}Modf(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof w&&s instanceof w)return new w(r.data.map((o,a)=>o%s.data[a]),r.typeInfo);const i=s;return new A(r.value%i.value,r.typeInfo)}Normalize(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w){const s=this.Length(e,t).value;return new w(r.data.map(i=>i/s),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof w&&s instanceof w)return new w(r.data.map((a,c)=>Math.pow(a,s.data[c])),r.typeInfo);const i=r,o=s;return new A(Math.pow(i.value,o.value),r.typeInfo)}QuantizeToF16(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof w?new w(r.data.map(s=>s),r.typeInfo):new A(r.value,r.typeInfo)}Radians(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof w?new w(r.data.map(s=>s*Math.PI/180),r.typeInfo):new A(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(r instanceof w&&s instanceof w){const i=this._dot(r.data,s.data);return new w(r.data.map((o,a)=>o-2*i*s.data[a]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(r instanceof w&&s instanceof w&&i instanceof A){const o=this._dot(s.data,r.data);return new w(r.data.map((a,c)=>{const l=1-i.value*i.value*(1-o*o);if(l<0)return 0;const u=Math.sqrt(l);return i.value*a-(i.value*o+u)*s.data[c]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.round(i)),r.typeInfo);const s=r;return new A(Math.round(s.value),r.typeInfo)}Saturate(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.min(Math.max(i,0),1)),r.typeInfo);const s=r;return new A(Math.min(Math.max(s.value,0),1),r.typeInfo)}Sign(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.sign(i)),r.typeInfo);const s=r;return new A(Math.sign(s.value),r.typeInfo)}Sin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.sin(i)),r.typeInfo);const s=r;return new A(Math.sin(s.value),r.typeInfo)}Sinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.sinh(i)),r.typeInfo);const s=r;return new A(Math.sinh(s.value),r.typeInfo)}_smoothstep(e,t,r){const s=Math.min(Math.max((r-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(i instanceof w&&r instanceof w&&s instanceof w)return new w(i.data.map((l,u)=>this._smoothstep(r.data[u],s.data[u],l)),i.typeInfo);const o=r,a=s,c=i;return new A(this._smoothstep(o.value,a.value,c.value),i.typeInfo)}Sqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.sqrt(i)),r.typeInfo);const s=r;return new A(Math.sqrt(s.value),r.typeInfo)}Step(e,t){const r=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof w&&r instanceof w)return new w(s.data.map((o,a)=>o<r.data[a]?0:1),s.typeInfo);const i=r;return new A(s.value<i.value?0:1,i.typeInfo)}Tan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.tan(i)),r.typeInfo);const s=r;return new A(Math.tan(s.value),r.typeInfo)}Tanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.tanh(i)),r.typeInfo);const s=r;return new A(Math.tanh(s.value),r.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof q))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const i=r.data;return new q([i[0],i[2],i[1],i[3]],s)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const i=r.data;return new q([i[0],i[3],i[6],i[1],i[4],i[7]],s)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const i=r.data;return new q([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13]],s)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const i=r.data;return new q([i[0],i[3],i[1],i[4],i[2],i[5]],s)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const i=r.data;return new q([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]],s)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const i=r.data;return new q([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14]],s)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const i=r.data;return new q([i[0],i[4],i[1],i[5],i[2],i[6]],s)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const i=r.data;return new q([i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]],s)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const i=r.data;return new q([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]],s)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof w)return new w(r.data.map(i=>Math.trunc(i)),r.typeInfo);const s=r;return new A(Math.trunc(s.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const r=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof Ge){const i=r.name,o=t.getVariableValue(i);if(o instanceof It){if(s<0||s>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=o.getMipLevelSize(s),c=o.dimension;return c==="1d"?new A(a[0],this.getTypeInfo("u32")):c==="3d"?new w(a,this.getTypeInfo("vec3u")):c==="2d"?new w(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${c} not found. Line ${e.line}`),null)}return console.error(`Texture ${i} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const r=e.args[0],s=this.exec.evalExpression(e.args[1],t),i=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof w)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Ge){const o=r.name,a=t.getVariableValue(o);if(a instanceof It){const c=Math.floor(s.data[0]),l=Math.floor(s.data[1]);if(c<0||c>=a.width||l<0||l>=a.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const u=a.getPixel(c,l,0,i);return u===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new w(u,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const r=e.args[0];if(r instanceof Ge){const s=r.name,i=t.getVariableValue(s);return i instanceof It?new A(i.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const r=e.args[0];if(r instanceof Ge){const s=r.name,i=t.getVariableValue(s);return i instanceof It?new A(i.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const r=e.args[0];if(r instanceof Ge){const s=r.name,i=t.getVariableValue(s);return i instanceof It?new A(i.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const r=e.args[0],s=this.exec.evalExpression(e.args[1],t),i=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof w)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Ge){const a=r.name,c=t.getVariableValue(a);if(c instanceof It){const l=c.getMipLevelSize(0),u=Math.floor(s.data[0]),h=Math.floor(s.data[1]);return u<0||u>=l[0]||h<0||h>=l[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(c.setPixel(u,h,0,i,Array.from(o)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.getVariableName(r,t);return t.getVariable(s).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),c=i.value.getSubData(this.exec,r.postfix,t);return c instanceof A&&a instanceof A&&(c.value=a.value),i.value instanceof Te&&i.value.setDataValue(this.exec,c,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),c=i.value.getSubData(this.exec,r.postfix,t),l=new A(c.value,c.typeInfo);return c instanceof A&&a instanceof A&&(c.value+=a.value),i.value instanceof Te&&i.value.setDataValue(this.exec,c,r.postfix,t),l}AtomicSub(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),c=i.value.getSubData(this.exec,r.postfix,t),l=new A(c.value,c.typeInfo);return c instanceof A&&a instanceof A&&(c.value-=a.value),i.value instanceof Te&&i.value.setDataValue(this.exec,c,r.postfix,t),l}AtomicMax(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),c=i.value.getSubData(this.exec,r.postfix,t),l=new A(c.value,c.typeInfo);return c instanceof A&&a instanceof A&&(c.value=Math.max(c.value,a.value)),i.value instanceof Te&&i.value.setDataValue(this.exec,c,r.postfix,t),l}AtomicMin(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),c=i.value.getSubData(this.exec,r.postfix,t),l=new A(c.value,c.typeInfo);return c instanceof A&&a instanceof A&&(c.value=Math.min(c.value,a.value)),i.value instanceof Te&&i.value.setDataValue(this.exec,c,r.postfix,t),l}AtomicAnd(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),c=i.value.getSubData(this.exec,r.postfix,t),l=new A(c.value,c.typeInfo);return c instanceof A&&a instanceof A&&(c.value=c.value&a.value),i.value instanceof Te&&i.value.setDataValue(this.exec,c,r.postfix,t),l}AtomicOr(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),c=i.value.getSubData(this.exec,r.postfix,t),l=new A(c.value,c.typeInfo);return c instanceof A&&a instanceof A&&(c.value=c.value|a.value),i.value instanceof Te&&i.value.setDataValue(this.exec,c,r.postfix,t),l}AtomicXor(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),c=i.value.getSubData(this.exec,r.postfix,t),l=new A(c.value,c.typeInfo);return c instanceof A&&a instanceof A&&(c.value=c.value^a.value),i.value instanceof Te&&i.value.setDataValue(this.exec,c,r.postfix,t),l}AtomicExchange(e,t){let r=e.args[0];r instanceof Re&&(r=r.right);const s=this.exec.getVariableName(r,t),i=t.getVariable(s);let o=e.args[1];const a=this.exec.evalExpression(o,t),c=i.value.getSubData(this.exec,r.postfix,t),l=new A(c.value,c.typeInfo);return c instanceof A&&a instanceof A&&(c.value=a.value),i.value instanceof Te&&i.value.setDataValue(this.exec,c,r.postfix,t),l}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Co={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Xe={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class je extends E0{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new Tt,this.reflection.updateAST(this.ast),this.context=(r=t==null?void 0:t.clone())!==null&&r!==void 0?r:new Nc,this.builtins=new R0(this),this.typeInfo={bool:this.getTypeInfo(D.bool),i32:this.getTypeInfo(D.i32),u32:this.getTypeInfo(D.u32),f32:this.getTypeInfo(D.f32),f16:this.getTypeInfo(D.f16),vec2f:this.getTypeInfo(O.vec2f),vec2u:this.getTypeInfo(O.vec2u),vec2i:this.getTypeInfo(O.vec2i),vec2h:this.getTypeInfo(O.vec2h),vec3f:this.getTypeInfo(O.vec3f),vec3u:this.getTypeInfo(O.vec3u),vec3i:this.getTypeInfo(O.vec3i),vec3h:this.getTypeInfo(O.vec3h),vec4f:this.getTypeInfo(O.vec4f),vec4u:this.getTypeInfo(O.vec4u),vec4i:this.getTypeInfo(O.vec4i),vec4h:this.getTypeInfo(O.vec4h),mat2x2f:this.getTypeInfo(O.mat2x2f),mat2x3f:this.getTypeInfo(O.mat2x3f),mat2x4f:this.getTypeInfo(O.mat2x4f),mat3x2f:this.getTypeInfo(O.mat3x2f),mat3x3f:this.getTypeInfo(O.mat3x3f),mat3x4f:this.getTypeInfo(O.mat3x4f),mat4x2f:this.getTypeInfo(O.mat4x2f),mat4x3f:this.getTypeInfo(O.mat4x3f),mat4x4f:this.getTypeInfo(O.mat4x4f)}}getVariableValue(e){var t,r;const s=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;if(s===null)return null;if(s instanceof A)return s.value;if(s instanceof w||s instanceof q)return Array.from(s.data);if(s instanceof Te&&s.typeInfo instanceof Qt){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,s){const i=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,i),this._execStatements(this.ast,i);const o=i.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const a=t[0],c=t[1],l=t[2],u=this.getTypeInfo("vec3u");i.setVariable("@num_workgroups",new w(t,u));for(const h in r)for(const f in r[h]){const d=r[h][f];i.variables.forEach(p=>{var m;const g=p.node;if(g!=null&&g.attributes){let y=null,S=null;for(const v of g.attributes)v.name==="binding"?y=v.value:v.name==="group"&&(S=v.value);if(f==y&&h==S)if(d.texture!==void 0&&d.descriptor!==void 0){const v=new It(d.texture,this.getTypeInfo(g.type),d.descriptor,(m=d.texture.view)!==null&&m!==void 0?m:null);p.value=v}else d.uniform!==void 0?p.value=new Te(d.uniform,this.getTypeInfo(g.type)):p.value=new Te(d,this.getTypeInfo(g.type))}})}for(let h=0;h<l;++h)for(let f=0;f<c;++f)for(let d=0;d<a;++d)i.setVariable("@workgroup_id",new w([d,f,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[d,f,h],i)}execStatement(e,t){if(e instanceof sp)return this.evalExpression(e.value,t);if(e instanceof op){if(e.condition){const r=this.evalExpression(e.condition,t);if(!(r instanceof A))throw new Error("Invalid break-if condition");if(!r.value)return null}return je._breakObj}if(e instanceof ap)return je._continueObj;if(e instanceof Ur)this._let(e,t);else if(e instanceof Pt)this._var(e,t);else if(e instanceof Ns)this._const(e,t);else if(e instanceof Yr)this._function(e,t);else{if(e instanceof rp)return this._if(e,t);if(e instanceof np)return this._switch(e,t);if(e instanceof Qd)return this._for(e,t);if(e instanceof Jd)return this._while(e,t);if(e instanceof tp)return this._loop(e,t);if(e instanceof Ia){const r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof ep)this._assign(e,t);else if(e instanceof Gd)this._increment(e,t);else{if(e instanceof Ct)return null;if(e instanceof Cc){const r=e.name;t.getVariable(r)===null&&t.setVariable(r,new A(0,this.getTypeInfo("u32")))}else if(e instanceof Ic)this._call(e,t);else{if(e instanceof ip||e instanceof Pc)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof lt?this._evalBinaryOp(e,t):e instanceof Pe?this._evalLiteral(e,t):e instanceof Ge?this._evalVariable(e,t):e instanceof Oc?this._evalCall(e,t):e instanceof _t?this._evalCreate(e,t):e instanceof cp?this._evalConst(e,t):e instanceof lp?this._evalBitcast(e,t):e instanceof Re?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof D){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(const r in e){const s=e[r],i=this.reflection.getOverrideInfo(r);i!==null?(i.type===null&&(i.type=this.getTypeInfo("u32")),i.type.name==="u32"||i.type.name==="i32"||i.type.name==="f32"||i.type.name==="f16"?t.setVariable(r,new A(s,i.type)):i.type.name==="bool"?t.setVariable(r,new A(s?1:0,i.type)):i.type.name==="vec2"||i.type.name==="vec3"||i.type.name==="vec4"||i.type.name==="vec2f"||i.type.name==="vec3f"||i.type.name==="vec4f"||i.type.name==="vec2i"||i.type.name==="vec3i"||i.type.name==="vec4i"||i.type.name==="vec2u"||i.type.name==="vec3u"||i.type.name==="vec4u"||i.type.name==="vec2h"||i.type.name==="vec3h"||i.type.name==="vec4h"?t.setVariable(r,new w(s,i.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){const s=[1,1,1];for(const u of e.node.attributes)if(u.name==="workgroup_size"){if(u.value.length>0){const h=r.getVariableValue(u.value[0]);s[0]=h instanceof A?h.value:parseInt(u.value[0])}if(u.value.length>1){const h=r.getVariableValue(u.value[1]);s[1]=h instanceof A?h.value:parseInt(u.value[1])}if(u.value.length>2){const h=r.getVariableValue(u.value[2]);s[2]=h instanceof A?h.value:parseInt(u.value[2])}}const i=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new w(s,i));const a=s[0],c=s[1],l=s[2];for(let u=0,h=0;u<l;++u)for(let f=0;f<c;++f)for(let d=0;d<a;++d,++h){const p=[d,f,u],m=[d+t[0]*s[0],f+t[1]*s[1],u+t[2]*s[2]];r.setVariable("@local_invocation_id",new w(p,i)),r.setVariable("@global_invocation_id",new w(m,i)),r.setVariable("@local_invocation_index",new A(h,o)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(const r of e.node.args)for(const s of r.attributes)if(s.name==="builtin"){const i=`@${s.value}`,o=t.getVariable(i);o!==void 0&&t.variables.set(r.name,o)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Re;)e=e.right;return e instanceof Ge?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const r of e){if(r instanceof Array){const i=t.clone(),o=this._execStatements(r,i);if(o)return o;continue}const s=this.execStatement(r,t);if(s)return s}return null}_call(e,t){const r=t.clone();r.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let i=0;i<s.node.args.length;++i){const o=s.node.args[i],a=this.evalExpression(e.args[i],r);r.setVariable(o.name,a,o)}this._execStatements(s.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const r=this.getVariableName(e.variable,t),s=t.getVariable(r);s?e.operator==="++"?s.value instanceof A?s.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof A?s.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Ge){const r=this.getVariableName(e,t),s=t.getVariable(r);return s===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof Re){if(e.operator==="*"){const r=this._getVariableData(e.right,t);return r instanceof Pn?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,t);return new Pn(r)}}return null}_assign(e,t){let r=null,s="<var>",i=null;if(e.variable instanceof Re){const c=this._getVariableData(e.variable,t),l=this.evalExpression(e.value,t),u=e.operator;if(u==="="){if(c instanceof A||c instanceof w||c instanceof q){if(l instanceof A||l instanceof w||l instanceof q&&c.data.length===l.data.length)return void c.data.set(l.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(c instanceof Te&&l instanceof Te&&c.buffer.byteLength-c.offset>=l.buffer.byteLength-l.offset)return void(c.buffer.byteLength%4==0?new Uint32Array(c.buffer,c.offset,c.typeInfo.size/4).set(new Uint32Array(l.buffer,l.offset,l.typeInfo.size/4)):new Uint8Array(c.buffer,c.offset,c.typeInfo.size).set(new Uint8Array(l.buffer,l.offset,l.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(u==="+=")return c instanceof A||c instanceof w||c instanceof q?l instanceof A||l instanceof w||l instanceof q?void c.data.set(l.data.map((h,f)=>c.data[f]+h)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(u==="-=")return(c instanceof A||c instanceof w||c instanceof q)&&(l instanceof A||l instanceof w||l instanceof q)?void c.data.set(l.data.map((h,f)=>c.data[f]-h)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Re){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const c=t.getVariable(s);if(!(c&&c.value instanceof Pn))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);r=c.value.reference;let l=e.variable.postfix;if(!l){let u=e.variable.right;for(;u instanceof Re;){if(u.postfix){l=u.postfix;break}u=u.right}}l&&(r=r.getSubData(this,l,t))}}else{i=e.variable.postfix,s=this.getVariableName(e.variable,t);const c=t.getVariable(s);if(c===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);r=c.value}if(r instanceof Pn&&(r=r.reference),r===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const o=this.evalExpression(e.value,t),a=e.operator;if(a==="=")if(r instanceof Te)r.setDataValue(this,o,i,t);else if(i){if(!(r instanceof w||r instanceof q))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(i instanceof tr){const c=this.evalExpression(i.index,t).value;if(r instanceof w){if(!(o instanceof A))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[c]=o.value}else{if(!(r instanceof q))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const l=this.evalExpression(i.index,t).value;if(l<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(o instanceof w))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const u=r.typeInfo.getTypeName();if(u==="mat2x2"||u==="mat2x2f"||u==="mat2x2h"){if(!(l<2&&o.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[2*l]=o.data[0],r.data[2*l+1]=o.data[1]}else if(u==="mat2x3"||u==="mat2x3f"||u==="mat2x3h"){if(!(l<2&&o.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[3*l]=o.data[0],r.data[3*l+1]=o.data[1],r.data[3*l+2]=o.data[2]}else if(u==="mat2x4"||u==="mat2x4f"||u==="mat2x4h"){if(!(l<2&&o.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[4*l]=o.data[0],r.data[4*l+1]=o.data[1],r.data[4*l+2]=o.data[2],r.data[4*l+3]=o.data[3]}else if(u==="mat3x2"||u==="mat3x2f"||u==="mat3x2h"){if(!(l<3&&o.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[2*l]=o.data[0],r.data[2*l+1]=o.data[1]}else if(u==="mat3x3"||u==="mat3x3f"||u==="mat3x3h"){if(!(l<3&&o.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[3*l]=o.data[0],r.data[3*l+1]=o.data[1],r.data[3*l+2]=o.data[2]}else if(u==="mat3x4"||u==="mat3x4f"||u==="mat3x4h"){if(!(l<3&&o.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[4*l]=o.data[0],r.data[4*l+1]=o.data[1],r.data[4*l+2]=o.data[2],r.data[4*l+3]=o.data[3]}else if(u==="mat4x2"||u==="mat4x2f"||u==="mat4x2h"){if(!(l<4&&o.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[2*l]=o.data[0],r.data[2*l+1]=o.data[1]}else if(u==="mat4x3"||u==="mat4x3f"||u==="mat4x3h"){if(!(l<4&&o.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[3*l]=o.data[0],r.data[3*l+1]=o.data[1],r.data[3*l+2]=o.data[2]}else{if(u!=="mat4x4"&&u!=="mat4x4f"&&u!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(l<4&&o.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);r.data[4*l]=o.data[0],r.data[4*l+1]=o.data[1],r.data[4*l+2]=o.data[2],r.data[4*l+3]=o.data[3]}}}}}else if(i instanceof mn){const c=i.value;if(!(r instanceof w))return void console.error(`Invalid assignment to ${c}. Variable ${s} is not a vector. Line ${e.line}`);if(o instanceof A){if(c.length>1)return void console.error(`Invalid assignment to ${c} for variable ${s}. Line ${e.line}`);if(c==="x")r.data[0]=o.value;else if(c==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${c} for variable ${s}. Line ${e.line}`);r.data[1]=o.value}else if(c==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${c} for variable ${s}. Line ${e.line}`);r.data[2]=o.value}else if(c==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${c} for variable ${s}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof w))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(c.length!==o.data.length)return void console.error(`Invalid assignment to ${c} for variable ${s}. Line ${e.line}`);for(let l=0;l<c.length;++l){const u=c[l];if(u==="x"||u==="r")r.data[0]=o.data[l];else if(u==="y"||u==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${s}. Line ${e.line}`);r.data[1]=o.data[l]}else if(u==="z"||u==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${s}. Line ${e.line}`);r.data[2]=o.data[l]}else{if(u!=="w"&&u!=="a")return void console.error(`Invalid assignment to ${u} for variable ${s}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${s}. Line ${e.line}`);r.data[3]=o.data[l]}}}}}else r instanceof A&&o instanceof A?r.value=o.value:r instanceof w&&o instanceof w||r instanceof q&&o instanceof q?r.data.set(o.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`);else{const c=r.getSubData(this,i,t);if(c instanceof w&&o instanceof A){const l=c.data,u=o.value;if(a==="+=")for(let h=0;h<l.length;++h)l[h]+=u;else if(a==="-=")for(let h=0;h<l.length;++h)l[h]-=u;else if(a==="*=")for(let h=0;h<l.length;++h)l[h]*=u;else if(a==="/=")for(let h=0;h<l.length;++h)l[h]/=u;else if(a==="%=")for(let h=0;h<l.length;++h)l[h]%=u;else if(a==="&=")for(let h=0;h<l.length;++h)l[h]&=u;else if(a==="|=")for(let h=0;h<l.length;++h)l[h]|=u;else if(a==="^=")for(let h=0;h<l.length;++h)l[h]^=u;else if(a==="<<=")for(let h=0;h<l.length;++h)l[h]<<=u;else if(a===">>=")for(let h=0;h<l.length;++h)l[h]>>=u;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(c instanceof w&&o instanceof w){const l=c.data,u=o.data;if(l.length!==u.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let h=0;h<l.length;++h)l[h]+=u[h];else if(a==="-=")for(let h=0;h<l.length;++h)l[h]-=u[h];else if(a==="*=")for(let h=0;h<l.length;++h)l[h]*=u[h];else if(a==="/=")for(let h=0;h<l.length;++h)l[h]/=u[h];else if(a==="%=")for(let h=0;h<l.length;++h)l[h]%=u[h];else if(a==="&=")for(let h=0;h<l.length;++h)l[h]&=u[h];else if(a==="|=")for(let h=0;h<l.length;++h)l[h]|=u[h];else if(a==="^=")for(let h=0;h<l.length;++h)l[h]^=u[h];else if(a==="<<=")for(let h=0;h<l.length;++h)l[h]<<=u[h];else if(a===">>=")for(let h=0;h<l.length;++h)l[h]>>=u[h];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(c instanceof A&&o instanceof A))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?c.value+=o.value:a==="-="?c.value-=o.value:a==="*="?c.value*=o.value:a==="/="?c.value/=o.value:a==="%="?c.value%=o.value:a==="&="?c.value&=o.value:a==="|="?c.value|=o.value:a==="^="?c.value^=o.value:a==="<<="?c.value<<=o.value:a===">>="?c.value>>=o.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}r instanceof Te&&r.setDataValue(this,c,i,t)}}_function(e,t){const r=new Mc(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!==null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Re||(r=r.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const i=new _t(e.type,[]);r=this._evalCreate(i,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Re||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof Br||e.type instanceof Ct||e.type instanceof O){const i=new _t(e.type,[]);r=this._evalCreate(i,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof A))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const i of e.cases)if(i instanceof fp)for(const o of i.selectors){if(o instanceof Ds){s=i;continue}const a=this.evalExpression(o,t);if(!(a instanceof A))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(i.body,t)}else i instanceof dp&&(s=i);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof A))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(const s of e.elseif){const i=this.evalExpression(s.condition,t);if(!(i instanceof A))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof A?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===je._breakObj)break;if(r!==null&&r!==je._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const r=this._execStatements(e.body,t);if(r===je._breakObj)break;if(r===je._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===je._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===je._breakObj)break;if(r!==je._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){const r=this.evalExpression(e.value,t),s=e.type;if(r instanceof A){const i=du(r.value,r.typeInfo.name,s.name);return new A(i,this.getTypeInfo(s))}if(r instanceof w){const i=r.typeInfo.getTypeName();let o="";if(i.endsWith("f"))o="f32";else if(i.endsWith("i"))o="i32";else if(i.endsWith("u"))o="u32";else if(i.endsWith("b"))o="bool";else{if(!i.endsWith("h"))return console.error(`Unknown vector type ${i}. Line ${e.line}`),null;o="f16"}const a=s.getTypeName();let c="";if(a.endsWith("f"))c="f32";else if(a.endsWith("i"))c="i32";else if(a.endsWith("u"))c="u32";else if(a.endsWith("b"))c="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${c}. Line ${e.line}`),null;c="f16"}const l=function(u,h,f){if(h===f)return u;const d=new Array(u.length);for(let p=0;p<u.length;p++)d[p]=du(u[p],h,f);return d}(Array.from(r.data),o,c);return new w(l,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof _t){if(e.type===null)return Pa.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof _t?e.type.name:e.name,i=e instanceof _t?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(i===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(i.size===0)return null;const o=new Te(new ArrayBuffer(i.size),i,0);if(i instanceof Yt){if(e.args)for(let a=0;a<e.args.length;++a){const c=i.members[a],l=e.args[a],u=this.evalExpression(l,t);o.setData(this,u,c.type,c.offset,t)}}else if(i instanceof Qt){let a=0;if(e.args)for(let c=0;c<e.args.length;++c){const l=e.args[c],u=this.evalExpression(l,t);i.format===null&&(((r=u.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?i.format=this.getTypeInfo("i32"):i.format=u.typeInfo),o.setData(this,u,i.format,a,t),a+=i.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof _t?o.getSubData(this,e.postfix,t):o}_evalLiteral(e,t){const r=this.getTypeInfo(e.type),s=r.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new A(e.scalarValue,r):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const r=t.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const s=je._priority.get(t.name);je._priority.get(e[r].name)<s&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const r=this.evalExpression(e.right,t);if(e.operator==="&")return new Pn(r);if(e.operator==="*")return r instanceof Pn?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=r instanceof A?r.value:r instanceof w?Array.from(r.data):null;switch(e.operator){case"+":{if(V(s)){const a=s.map((c,l)=>+c);return new w(a,r.typeInfo)}const i=s,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new A(+i,o)}case"-":{if(V(s)){const a=s.map((c,l)=>-c);return new w(a,r.typeInfo)}const i=s,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new A(-i,o)}case"!":{if(V(s)){const a=s.map((c,l)=>c?0:1);return new w(a,r.typeInfo)}const i=s,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new A(i?0:1,o)}case"~":{if(V(s)){const a=s.map((c,l)=>~c);return new w(a,r.typeInfo)}const i=s,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new A(~i,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const r=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),i=r instanceof A?r.value:r instanceof w||r instanceof q?Array.from(r.data):null,o=s instanceof A?s.value:s instanceof w||s instanceof q?Array.from(s.data):null;switch(e.operator){case"+":{if(V(i)&&V(o)){const u=i,h=o;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=u.map((d,p)=>d+h[p]);return new w(f,r.typeInfo)}if(V(i)){const u=o,h=i.map((f,d)=>f+u);return new w(h,r.typeInfo)}if(V(o)){const u=i,h=o.map((f,d)=>u+f);return new w(h,s.typeInfo)}const a=i,c=o,l=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new A(a+c,l)}case"-":{if(V(i)&&V(o)){const u=i,h=o;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=u.map((d,p)=>d-h[p]);return new w(f,r.typeInfo)}if(V(i)){const u=o,h=i.map((f,d)=>f-u);return new w(h,r.typeInfo)}if(V(o)){const u=i,h=o.map((f,d)=>u-f);return new w(h,s.typeInfo)}const a=i,c=o,l=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new A(a-c,l)}case"*":{if(V(i)&&V(o)){const u=i,h=o;if(r instanceof q&&s instanceof q){const f=function(g,y,S,v){if(Xe[y.name]===void 0||Xe[v.name]===void 0)return null;const x=Xe[y.name][0],T=Xe[y.name][1],I=Xe[v.name][0];if(x!==Xe[v.name][1])return null;const M=new Array(I*T);for(let N=0;N<T;N++)for(let L=0;L<I;L++){let j=0;for(let $=0;$<x;$++)j+=g[$*T+N]*S[L*x+$];M[N*I+L]=j}return M}(u,r.typeInfo,h,s.typeInfo);if(f===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const d=Xe[s.typeInfo.name][0],p=Xe[r.typeInfo.name][1],m=this.getTypeInfo(`mat${d}x${p}f`);return new q(f,m)}if(r instanceof q&&s instanceof w){const f=function(d,p,m,g){if(Xe[p.name]===void 0||Co[g.name]===void 0)return null;const y=Xe[p.name][0],S=Xe[p.name][1];if(y!==m.length)return null;const v=new Array(S);for(let x=0;x<S;x++){let T=0;for(let I=0;I<y;I++)T+=d[I*S+x]*m[I];v[x]=T}return v}(u,r.typeInfo,h,s.typeInfo);return f===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new w(f,s.typeInfo)}if(r instanceof w&&s instanceof q){const f=function(d,p,m,g){if(Co[p.name]===void 0||Xe[g.name]===void 0)return null;const y=Xe[g.name][0],S=Xe[g.name][1];if(S!==d.length)return null;const v=[];for(let x=0;x<y;x++){let T=0;for(let I=0;I<S;I++)T+=d[I]*m[I*y+x];v[x]=T}return v}(u,r.typeInfo,h,s.typeInfo);return f===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new w(f,r.typeInfo)}{if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=u.map((d,p)=>d*h[p]);return new w(f,r.typeInfo)}}if(V(i)){const u=o,h=i.map((f,d)=>f*u);return r instanceof q?new q(h,r.typeInfo):new w(h,r.typeInfo)}if(V(o)){const u=i,h=o.map((f,d)=>u*f);return s instanceof q?new q(h,s.typeInfo):new w(h,s.typeInfo)}const a=i,c=o,l=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new A(a*c,l)}case"%":{if(V(i)&&V(o)){const u=i,h=o;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=u.map((d,p)=>d%h[p]);return new w(f,r.typeInfo)}if(V(i)){const u=o,h=i.map((f,d)=>f%u);return new w(h,r.typeInfo)}if(V(o)){const u=i,h=o.map((f,d)=>u%f);return new w(h,s.typeInfo)}const a=i,c=o,l=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new A(a%c,l)}case"/":{if(V(i)&&V(o)){const u=i,h=o;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=u.map((d,p)=>d/h[p]);return new w(f,r.typeInfo)}if(V(i)){const u=o,h=i.map((f,d)=>f/u);return new w(h,r.typeInfo)}if(V(o)){const u=i,h=o.map((f,d)=>u/f);return new w(h,s.typeInfo)}const a=i,c=o,l=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new A(a/c,l)}case"&":{if(V(i)&&V(o)){const u=i,h=o;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=u.map((d,p)=>d&h[p]);return new w(f,r.typeInfo)}if(V(i)){const u=o,h=i.map((f,d)=>f&u);return new w(h,r.typeInfo)}if(V(o)){const u=i,h=o.map((f,d)=>u&f);return new w(h,s.typeInfo)}const a=i,c=o,l=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new A(a&c,l)}case"|":{if(V(i)&&V(o)){const u=i,h=o;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=u.map((d,p)=>d|h[p]);return new w(f,r.typeInfo)}if(V(i)){const u=o,h=i.map((f,d)=>f|u);return new w(h,r.typeInfo)}if(V(o)){const u=i,h=o.map((f,d)=>u|f);return new w(h,s.typeInfo)}const a=i,c=o,l=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new A(a|c,l)}case"^":{if(V(i)&&V(o)){const u=i,h=o;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=u.map((d,p)=>d^h[p]);return new w(f,r.typeInfo)}if(V(i)){const u=o,h=i.map((f,d)=>f^u);return new w(h,r.typeInfo)}if(V(o)){const u=i,h=o.map((f,d)=>u^f);return new w(h,s.typeInfo)}const a=i,c=o,l=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new A(a^c,l)}case"<<":{if(V(i)&&V(o)){const u=i,h=o;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=u.map((d,p)=>d<<h[p]);return new w(f,r.typeInfo)}if(V(i)){const u=o,h=i.map((f,d)=>f<<u);return new w(h,r.typeInfo)}if(V(o)){const u=i,h=o.map((f,d)=>u<<f);return new w(h,s.typeInfo)}const a=i,c=o,l=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new A(a<<c,l)}case">>":{if(V(i)&&V(o)){const u=i,h=o;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const f=u.map((d,p)=>d>>h[p]);return new w(f,r.typeInfo)}if(V(i)){const u=o,h=i.map((f,d)=>f>>u);return new w(h,r.typeInfo)}if(V(o)){const u=i,h=o.map((f,d)=>u>>f);return new w(h,s.typeInfo)}const a=i,c=o,l=this._maxFormatTypeInfo([r.typeInfo,s.typeInfo]);return new A(a>>c,l)}case">":if(V(i)&&V(o)){const a=i,c=o;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const l=a.map((u,h)=>u>c[h]?1:0);return new w(l,r.typeInfo)}if(V(i)){const a=o,c=i.map((l,u)=>l>a?1:0);return new w(c,r.typeInfo)}if(V(o)){const a=i,c=o.map((l,u)=>a>l?1:0);return new w(c,s.typeInfo)}return new A(i>o?1:0,this.getTypeInfo("bool"));case"<":if(V(i)&&V(o)){const a=i,c=o;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const l=a.map((u,h)=>u<c[h]?1:0);return new w(l,r.typeInfo)}if(V(i)){const a=o,c=i.map((l,u)=>l<a?1:0);return new w(c,r.typeInfo)}if(V(o)){const a=i,c=o.map((l,u)=>a<l?1:0);return new w(c,s.typeInfo)}return new A(i<o?1:0,this.getTypeInfo("bool"));case"==":if(V(i)&&V(o)){const a=i,c=o;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const l=a.map((u,h)=>u===c[h]?1:0);return new w(l,r.typeInfo)}if(V(i)){const a=o,c=i.map((l,u)=>l==a?1:0);return new w(c,r.typeInfo)}if(V(o)){const a=i,c=o.map((l,u)=>a==l?1:0);return new w(c,s.typeInfo)}return new A(i===o?1:0,this.getTypeInfo("bool"));case"!=":if(V(i)&&V(o)){const a=i,c=o;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const l=a.map((u,h)=>u!==c[h]?1:0);return new w(l,r.typeInfo)}if(V(i)){const a=o,c=i.map((l,u)=>l!==a?1:0);return new w(c,r.typeInfo)}if(V(o)){const a=i,c=o.map((l,u)=>a!==l?1:0);return new w(c,s.typeInfo)}return new A(i!==o?1:0,this.getTypeInfo("bool"));case">=":if(V(i)&&V(o)){const a=i,c=o;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const l=a.map((u,h)=>u>=c[h]?1:0);return new w(l,r.typeInfo)}if(V(i)){const a=o,c=i.map((l,u)=>l>=a?1:0);return new w(c,r.typeInfo)}if(V(o)){const a=i,c=o.map((l,u)=>a>=l?1:0);return new w(c,s.typeInfo)}return new A(i>=o?1:0,this.getTypeInfo("bool"));case"<=":if(V(i)&&V(o)){const a=i,c=o;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const l=a.map((u,h)=>u<=c[h]?1:0);return new w(l,r.typeInfo)}if(V(i)){const a=o,c=i.map((l,u)=>l<=a?1:0);return new w(c,r.typeInfo)}if(V(o)){const a=i,c=o.map((l,u)=>a<=l?1:0);return new w(c,s.typeInfo)}return new A(i<=o?1:0,this.getTypeInfo("bool"));case"&&":if(V(i)&&V(o)){const a=i,c=o;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const l=a.map((u,h)=>u&&c[h]?1:0);return new w(l,r.typeInfo)}if(V(i)){const a=o,c=i.map((l,u)=>l&&a?1:0);return new w(c,r.typeInfo)}if(V(o)){const a=i,c=o.map((l,u)=>a&&l?1:0);return new w(c,s.typeInfo)}return new A(i&&o?1:0,this.getTypeInfo("bool"));case"||":if(V(i)&&V(o)){const a=i,c=o;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const l=a.map((u,h)=>u||c[h]?1:0);return new w(l,r.typeInfo)}if(V(i)){const a=o,c=i.map((l,u)=>l||a?1:0);return new w(c,r.typeInfo)}if(V(o)){const a=i,c=o.map((l,u)=>a||l?1:0);return new w(c,s.typeInfo)}return new A(i||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=t.clone();r.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let i=0;i<s.node.args.length;++i){const o=s.node.args[i],a=this.evalExpression(e.args[i],r);r.createVariable(o.name,a,o)}return this._execStatements(s.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const r=t.getFunction(e.name);if(r){const s=t.clone();for(let i=0;i<r.node.args.length;++i){const o=r.node.args[i],a=this.evalExpression(e.args[i],s);s.setVariable(o.name,a,o)}return this._execStatements(r.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new A(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const r=this.getTypeInfo(e.type),s=e.type.getTypeName(),i=Co[s];if(i===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const o=[];if(e instanceof Pe)if(e.isVector){const a=e.vectorValue;for(const c of a)o.push(c)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const c=this.evalExpression(a,t);if(c instanceof w){const l=c.data;for(let u=0;u<l.length;++u){let h=l[u];o.push(h)}}else if(c instanceof A){let l=c.value;o.push(l)}}if(e.type instanceof O&&e.type.format===null&&(e.type.format=O.f32),o.length===0){const a=new Array(i).fill(0);return new w(a,r).getSubData(this,e.postfix,t)}if(o.length===1)for(;o.length<i;)o.push(o[0]);return o.length<i?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new w(o.length>i?o.slice(0,i):o,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const r=this.getTypeInfo(e.type),s=e.type.getTypeName(),i=Xe[s];if(i===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const o=[];if(e instanceof Pe)if(e.isVector){const a=e.vectorValue;for(const c of a)o.push(c)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const c=this.evalExpression(a,t);c instanceof w?o.push(...c.data):c instanceof A?o.push(c.value):c instanceof q&&o.push(...c.data)}if(r instanceof gn&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const a=new Array(i[2]).fill(0);return new q(a,r).getSubData(this,e.postfix,t)}return o.length!==i[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new q(o,r).getSubData(this,e.postfix,t)}}je._breakObj=new ot(new rt("BREAK",null),null),je._continueObj=new ot(new rt("CONTINUE",null),null),je._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class C0{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class I0{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new C0,this._exec=new je,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const s=r.arrayType,i=r.countNode;if(i instanceof Ge){const o=i.name,a=this._context.constants.get(o);if(a)try{const c=a.constEvaluate(this._exec);s.count=c}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of t)r.search(s=>{s instanceof hu||s instanceof Ro?s.type=this._forwardType(s.type):s instanceof Br?s.format=this._forwardType(s.format):s instanceof Pt||s instanceof Ur||s instanceof Ns?s.type=this._forwardType(s.type):s instanceof Yr?s.returnType=this._forwardType(s.returnType):s instanceof uu&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof lu){const t=this._getType(e.name);if(t)return t}else e instanceof Ro?e.type=this._forwardType(e.type):e instanceof Br&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new b0(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==b.eof}_match(e){if(e instanceof R)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const r=t.type;let s=!1;for(const i of e){if(r===i)return!0;i===b.tokens.name&&(s=!0)}if(s){const i=b.tokens.name.rule.exec(t.lexeme);if(i&&i.index==0&&i[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===b.tokens.name){const r=b.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(b.tokens.semicolon)&&!this._isAtEnd(););if(this._match(b.keywords.alias)){const t=this._type_alias();return this._consume(b.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(b.keywords.diagnostic)){const t=this._diagnostic();return this._consume(b.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(b.keywords.requires)){const t=this._requires_directive();return this._consume(b.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(b.keywords.enable)){const t=this._enable_directive();return this._consume(b.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(b.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(b.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(b.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(b.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(b.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(b.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(b.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(b.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(b.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(b.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(b.keywords.fn))return null;const e=this._currentLine,t=this._consume(b.tokens.ident,"Expected function name.").toString();this._consume(b.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(b.tokens.paren_right))do{if(this._check(b.tokens.paren_right))break;const a=this._attribute(),c=this._consume(b.tokens.name,"Expected argument name.").toString();this._consume(b.tokens.colon,"Expected ':' for argument type.");const l=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=l,r.push(this._updateNode(new uu(c,u,a))))}while(this._match(b.tokens.comma));this._consume(b.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(b.tokens.arrow)){const a=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=a)}const i=this._compound_statement(),o=this._currentLine;return this._updateNode(new Yr(t,r,s,i,e,o),e)}_compound_statement(){const e=[];for(this._consume(b.tokens.brace_left,"Expected '{' for block.");!this._check(b.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(b.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(b.tokens.semicolon)&&!this._isAtEnd(););if(this._check(b.tokens.attr)&&this._attribute(),this._check(b.keywords.if))return this._if_statement();if(this._check(b.keywords.switch))return this._switch_statement();if(this._check(b.keywords.loop))return this._loop_statement();if(this._check(b.keywords.for))return this._for_statement();if(this._check(b.keywords.while))return this._while_statement();if(this._check(b.keywords.continuing))return this._continuing_statement();if(this._check(b.keywords.static_assert))return this._static_assert_statement();if(this._check(b.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(b.keywords.return))e=this._return_statement();else if(this._check([b.keywords.var,b.keywords.let,b.keywords.const]))e=this._variable_statement();else if(this._match(b.keywords.discard))e=this._updateNode(new g0);else if(this._match(b.keywords.break)){const t=this._updateNode(new op);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(b.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(b.keywords.continue)){const t=this._updateNode(new ap);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(b.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(b.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new f0(t),e)}_while_statement(){if(!this._match(b.keywords.while))return null;const e=this._updateNode(new Jd(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(b.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(b.keywords.continuing))return null;const t=this._currentLine,r=this._compound_statement();return this._updateNode(new Ia(r,e),t)}_for_statement(){if(!this._match(b.keywords.for))return null;this._consume(b.tokens.paren_left,"Expected '('.");const e=this._updateNode(new Qd(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(b.tokens.semicolon)?null:this._for_init(),this._consume(b.tokens.semicolon,"Expected ';'."),e.condition=this._check(b.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(b.tokens.semicolon,"Expected ';'."),e.increment=this._check(b.tokens.paren_right)?null:this._for_increment(),this._consume(b.tokens.paren_right,"Expected ')'."),this._check(b.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(b.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(b.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Pt(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(b.keywords.let)){const e=this._currentLine,t=this._consume(b.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(b.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}this._consume(b.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new Ur(t,r,null,null,s),e)}if(this._match(b.keywords.const)){const e=this._currentLine,t=this._consume(b.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(b.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}this._consume(b.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return r===null&&s instanceof Pe&&(r=s.type),this._updateNode(new Ns(t,r,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(b.increment_operators))return this._current=e,null;const r=this._consume(b.increment_operators,"Expected increment operator");return this._updateNode(new Gd(r.type===b.tokens.plus_plus?Hn.increment:Hn.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(b.tokens.brace_right))return null;let r=this._match(b.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const s=this._consume(b.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return this._updateNode(new ep(Cr.parse(s.lexeme),e,i),t)}_func_call_statement(){if(!this._check(b.tokens.ident))return null;const e=this._currentLine,t=this._current,r=this._consume(b.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new Ic(r.lexeme,s),e)}_loop_statement(){if(!this._match(b.keywords.loop))return null;this._check(b.tokens.attr)&&this._attribute(),this._consume(b.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new tp([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof Ia){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(b.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(b.keywords.switch))return null;const e=this._updateNode(new np(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(b.tokens.attr)&&this._attribute(),this._consume(b.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(b.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([b.keywords.default,b.keywords.case]);){if(this._match(b.keywords.case)){const r=this._case_selectors();for(const i of r)if(i instanceof Ds){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(b.tokens.colon),this._check(b.tokens.attr)&&this._attribute(),this._consume(b.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(b.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new fp(r,s)))}if(this._match(b.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(b.tokens.colon),this._check(b.tokens.attr)&&this._attribute(),this._consume(b.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(b.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new dp(r)))}}return e}_case_selectors(){const e=[];for(this._match(b.keywords.default)?e.push(this._updateNode(new Ds)):e.push(this._shift_expression());this._match(b.tokens.comma);)this._match(b.keywords.default)?e.push(this._updateNode(new Ds)):e.push(this._shift_expression());return e}_case_body(){if(this._match(b.keywords.fallthrough))return this._consume(b.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(b.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(b.tokens.attr)&&this._attribute();const r=this._compound_statement();let s=[];this._match_elseif()&&(this._check(b.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let i=null;return this._match(b.keywords.else)&&(this._check(b.tokens.attr)&&this._attribute(),i=this._compound_statement()),this._updateNode(new rp(t,r,s,i),e)}_match_elseif(){return this._tokens[this._current].type===b.keywords.else&&this._tokens[this._current+1].type===b.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new m0(t,r))),this._match_elseif()&&(this._check(b.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(b.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new sp(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(b.tokens.or_or);)e=this._updateNode(new lt(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(b.tokens.and_and);)e=this._updateNode(new lt(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(b.tokens.or);)e=this._updateNode(new lt(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(b.tokens.xor);)e=this._updateNode(new lt(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(b.tokens.and);)e=this._updateNode(new lt(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([b.tokens.equal_equal,b.tokens.not_equal])?this._updateNode(new lt(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([b.tokens.less_than,b.tokens.greater_than,b.tokens.less_than_equal,b.tokens.greater_than_equal]);)e=this._updateNode(new lt(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([b.tokens.shift_left,b.tokens.shift_right]);)e=this._updateNode(new lt(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([b.tokens.plus,b.tokens.minus]);)e=this._updateNode(new lt(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([b.tokens.star,b.tokens.forward_slash,b.tokens.modulo]);)e=this._updateNode(new lt(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([b.tokens.minus,b.tokens.bang,b.tokens.tilde,b.tokens.star,b.tokens.and])?this._updateNode(new Re(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(b.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(b.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new tr(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(b.tokens.period)){const e=this._consume(b.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new mn(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return D.void;case"bool":return D.bool;case"i32":return D.i32;case"u32":return D.u32;case"f32":return D.f32;case"f16":return D.f16;case"vec2f":return O.vec2f;case"vec3f":return O.vec3f;case"vec4f":return O.vec4f;case"vec2i":return O.vec2i;case"vec3i":return O.vec3i;case"vec4i":return O.vec4i;case"vec2u":return O.vec2u;case"vec3u":return O.vec3u;case"vec4u":return O.vec4u;case"vec2h":return O.vec2h;case"vec3h":return O.vec3h;case"vec4h":return O.vec4h;case"mat2x2f":return O.mat2x2f;case"mat2x3f":return O.mat2x3f;case"mat2x4f":return O.mat2x4f;case"mat3x2f":return O.mat3x2f;case"mat3x3f":return O.mat3x3f;case"mat3x4f":return O.mat3x4f;case"mat4x2f":return O.mat4x2f;case"mat4x3f":return O.mat4x3f;case"mat4x4f":return O.mat4x4f;case"mat2x2h":return O.mat2x2h;case"mat2x3h":return O.mat2x3h;case"mat2x4h":return O.mat2x4h;case"mat3x2h":return O.mat3x2h;case"mat3x3h":return O.mat3x3h;case"mat3x4h":return O.mat3x4h;case"mat4x2h":return O.mat4x2h;case"mat4x3h":return O.mat4x3h;case"mat4x4h":return O.mat4x4h;case"mat2x2i":return O.mat2x2i;case"mat2x3i":return O.mat2x3i;case"mat2x4i":return O.mat2x4i;case"mat3x2i":return O.mat3x2i;case"mat3x3i":return O.mat3x3i;case"mat3x4i":return O.mat3x4i;case"mat4x2i":return O.mat4x2i;case"mat4x3i":return O.mat4x3i;case"mat4x4i":return O.mat4x4i;case"mat2x2u":return O.mat2x2u;case"mat2x3u":return O.mat2x3u;case"mat2x4u":return O.mat2x4u;case"mat3x2u":return O.mat3x2u;case"mat3x3u":return O.mat3x3u;case"mat3x4u":return O.mat3x4u;case"mat4x2u":return O.mat4x2u;case"mat4x3u":return O.mat4x3u;case"mat4x4u":return O.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(b.tokens.ident)){const r=this._previous().toString();if(this._check(b.tokens.paren_left)){const s=this._argument_expression_list(),i=this._getType(r);return i!==null?this._updateNode(new _t(i,s)):this._updateNode(new Oc(r,s))}if(this._context.constants.has(r)){const s=this._context.constants.get(r);return this._updateNode(new cp(r,s.value))}return this._updateNode(new Ge(r))}if(this._match(b.tokens.int_literal)){const r=this._previous().toString();let s=r.endsWith("i")||r.endsWith("i")?D.i32:r.endsWith("u")||r.endsWith("U")?D.u32:D.x32;const i=parseInt(r);return this._validateTypeRange(i,s),this._updateNode(new Pe(new A(i,this._exec.getTypeInfo(s)),s))}if(this._match(b.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,D.u32),this._updateNode(new Pe(new A(r,this._exec.getTypeInfo(D.u32)),D.u32))}if(this._match([b.tokens.decimal_float_literal,b.tokens.hex_float_literal])){let r=this._previous().toString(),s=r.endsWith("h");s&&(r=r.substring(0,r.length-1));const i=parseFloat(r);this._validateTypeRange(i,s?D.f16:D.f32);const o=s?D.f16:D.f32;return this._updateNode(new Pe(new A(i,this._exec.getTypeInfo(o)),o))}if(this._match([b.keywords.true,b.keywords.false])){let r=this._previous().toString()===b.keywords.true.rule;return this._updateNode(new Pe(new A(r?1:0,this._exec.getTypeInfo(D.bool)),D.bool))}if(this._check(b.tokens.paren_left))return this._paren_expression();if(this._match(b.keywords.bitcast)){this._consume(b.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(b.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new lp(r,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new _t(e,t))}_argument_expression_list(){if(!this._match(b.tokens.paren_left))return null;const e=[];do{if(this._check(b.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(b.tokens.comma));return this._consume(b.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(b.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(b.tokens.paren_right),e}_paren_expression(){this._consume(b.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(b.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(b.keywords.struct))return null;const e=this._currentLine,t=this._consume(b.tokens.ident,"Expected name for struct.").toString();this._consume(b.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(b.tokens.brace_right);){const o=this._attribute(),a=this._consume(b.tokens.name,"Expected variable name.").toString();this._consume(b.tokens.colon,"Expected ':' for struct member type.");const c=this._attribute(),l=this._type_decl();l!=null&&(l.attributes=c),this._check(b.tokens.brace_right)?this._match(b.tokens.comma):this._consume(b.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new hu(a,l,o)))}this._consume(b.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,i=this._updateNode(new Ct(t,r,e,s),e);return this._context.structs.set(t,i),i}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(b.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Pe){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Pe&&(e.type=e.value.type.name==="x32"?D.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(b.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(b.keywords.const))return null;const t=this._consume(b.tokens.name,"Expected variable name"),r=this._currentLine;let s=null;if(this._match(b.tokens.colon)){const c=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=c)}let i=null;this._consume(b.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let c=[D.f32],l=o.constEvaluate(this._exec,c);l instanceof A&&this._validateTypeRange(l.value,c[0]),c[0]instanceof O&&c[0].format===null&&l.typeInfo instanceof gn&&l.typeInfo.format!==null&&(l.typeInfo.format.name==="f16"?c[0].format=D.f16:l.typeInfo.format.name==="f32"?c[0].format=D.f32:l.typeInfo.format.name==="i32"?c[0].format=D.i32:l.typeInfo.format.name==="u32"?c[0].format=D.u32:l.typeInfo.format.name==="bool"?c[0].format=D.bool:console.error(`TODO: impelement template format type ${l.typeInfo.format.name}`)),i=this._updateNode(new Pe(l,c[0])),this._exec.context.setVariable(t.toString(),l)}catch{i=o}if(s!==null&&i instanceof Pe){if(i.type.name!=="x32"&&s.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${s.name}. Line:${this._currentLine}`);i.type=s,i.isScalar&&this._validateTypeRange(i.scalarValue,i.type)}else s===null&&i instanceof Pe&&(s=(e=i==null?void 0:i.type)!==null&&e!==void 0?e:D.f32,s===D.x32&&(s=D.i32));const a=this._updateNode(new Ns(t.toString(),s,"","",i),r);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(b.keywords.let))return null;const e=this._currentLine,t=this._consume(b.tokens.name,"Expected variable name");let r=null;if(this._match(b.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}let s=null;if(this._match(b.tokens.equal)&&(s=this._const_expression()),r!==null&&s instanceof Pe){if(s.type.name!=="x32"&&r.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${r.name}. Line:${this._currentLine}`);s.type=r}else r===null&&s instanceof Pe&&(r=s.type.name==="x32"?D.i32:s.type);return s instanceof Pe&&s.isScalar&&this._validateTypeRange(s.scalarValue,r),this._updateNode(new Ur(t.toString(),r,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(b.keywords.var))return null;const e=this._currentLine;let t="",r="";this._match(b.tokens.less_than)&&(t=this._consume(b.storage_class,"Expected storage_class.").toString(),this._match(b.tokens.comma)&&(r=this._consume(b.access_mode,"Expected access_mode.").toString()),this._consume(b.tokens.greater_than,"Expected '>'."));const s=this._consume(b.tokens.name,"Expected variable name");let i=null;if(this._match(b.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}return this._updateNode(new Pt(s.toString(),i,t,r,null),e)}_override_decl(){if(!this._match(b.keywords.override))return null;const e=this._consume(b.tokens.name,"Expected variable name");let t=null;if(this._match(b.tokens.colon)){const r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new Cc(e.toString(),t,null))}_diagnostic(){this._consume(b.tokens.paren_left,"Expected '('");const e=this._consume(b.tokens.ident,"Expected severity control name.");this._consume(b.tokens.comma,"Expected ','");let t=this._consume(b.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(b.tokens.period)&&(t+=`.${this._consume(b.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(b.tokens.paren_right,"Expected ')'"),this._updateNode(new ip(e.toString(),t))}_enable_directive(){const e=this._consume(b.tokens.ident,"identity expected.");return this._updateNode(new d0(e.toString()))}_requires_directive(){const e=[this._consume(b.tokens.ident,"identity expected.").toString()];for(;this._match(b.tokens.comma);){const t=this._consume(b.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new p0(e))}_type_alias(){const e=this._consume(b.tokens.ident,"identity expected.");this._consume(b.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const r=this._updateNode(new Pc(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([b.tokens.ident,...b.texel_format,b.keywords.bool,b.keywords.f32,b.keywords.i32,b.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const s=this._updateNode(new lu(r));return this._forwardTypeCount++,s}return this._updateNode(new D(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(b.template_types)){let r=this._advance().toString(),s=null,i=null;return this._match(b.tokens.less_than)&&(s=this._type_decl(),i=null,this._match(b.tokens.comma)&&(i=this._consume(b.access_mode,"Expected access_mode for pointer").toString()),this._consume(b.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new O(r,s,i))}if(this._match(b.keywords.ptr)){let r=this._previous().toString();this._consume(b.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(b.storage_class,"Expected storage_class for pointer");this._consume(b.tokens.comma,"Expected ',' for pointer.");const i=this._type_decl();let o=null;return this._match(b.tokens.comma)&&(o=this._consume(b.access_mode,"Expected access_mode for pointer").toString()),this._consume(b.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Ro(r,s.toString(),i,o))}const t=this._attribute();if(this._match(b.keywords.array)){let r=null,s=-1;const i=this._previous();let o=null;if(this._match(b.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let c="";if(this._match(b.tokens.comma)){o=this._shift_expression();try{c=o.constEvaluate(this._exec).toString(),o=null}catch{c="1"}}this._consume(b.tokens.greater_than,"Expected '>' for array."),s=c?parseInt(c):0}const a=this._updateNode(new Br(i.toString(),t,r,s));return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(b.sampler_type))return this._updateNode(new Ir(this._previous().toString(),null,null));if(this._match(b.depth_texture_type))return this._updateNode(new Ir(this._previous().toString(),null,null));if(this._match(b.sampled_texture_type)||this._match(b.multisampled_texture_type)){const e=this._previous();this._consume(b.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(b.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ir(e.toString(),t,null))}if(this._match(b.storage_texture_type)){const e=this._previous();this._consume(b.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(b.texel_format,"Invalid texel format.").toString();this._consume(b.tokens.comma,"Expected ',' after texel format.");const r=this._consume(b.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(b.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ir(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(b.tokens.attr);){const t=this._consume(b.attribute_name,"Expected attribute name"),r=this._updateNode(new pp(t.toString(),null));if(this._match(b.tokens.paren_left)){if(r.value=this._consume(b.literal_or_ident,"Expected attribute value").toString(),this._check(b.tokens.comma)){this._advance();do{const s=this._consume(b.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(s)}while(this._match(b.tokens.comma))}this._consume(b.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class P0 extends Tt{constructor(e){super(),e&&this.update(e)}update(e){const t=new I0().parse(e);this.updateAST(t)}}function O0(n){var i;const e={attributes:[],bindings:[]};let t;try{t=k0(n)}catch(o){return F.error(o.message)(),e}for(const o of t.uniforms){const a=[];for(const c of((i=o.type)==null?void 0:i.members)||[])a.push({name:c.name,type:pu(c.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:a})}for(const o of t.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of t.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const r=t.entry.vertex[0],s=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<s;o++){const a=r.inputs[o];if(a.locationType==="location"){const c=pu(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:c})}}return e}function pu(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function k0(n){try{return new P0(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const M0={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...M0}};const st=globalThis.mathgl.config;function N0(n,{precision:e=st.precision}={}){return n=D0(n),`${parseFloat(n.toPrecision(e))}`}function nr(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Kt(n,e,t){return U0(n,r=>Math.max(e,Math.min(t,r)))}function ci(n,e,t){return nr(n)?n.map((r,s)=>ci(r,e[s],t)):t*e+(1-t)*n}function Kr(n,e,t){const r=st.EPSILON;try{if(n===e)return!0;if(nr(n)&&nr(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!Kr(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=st.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{st.EPSILON=r}}function D0(n){return Math.round(n/st.EPSILON)*st.EPSILON}function F0(n){return n.clone?n.clone():new Array(n.length)}function U0(n,e,t){if(nr(n)){const r=n;t=t||F0(r);for(let s=0;s<t.length&&s<r.length;++s){const i=typeof n=="number"?n:n[s];t[s]=e(i,s,t)}return t}return e(n)}class gp extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:nr(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(st)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+N0(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Kr(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const i=e[s],o=typeof t=="number"?t:t[s];this[s]=i+r*(o-i)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(st.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function B0(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Qe(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function Io(n,e,t=""){if(st.debug&&!B0(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function gu(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class L0 extends gp{get x(){return this[0]}set x(e){this[0]=Qe(e)}get y(){return this[1]}set y(e){this[1]=Qe(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-e[r];t+=s*s}return Qe(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return Qe(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return gu(e>=0&&e<this.ELEMENTS,"index is out of range"),Qe(this[e])}setComponent(e,t){return gu(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Fs=1e-6;let rr=typeof Float32Array<"u"?Float32Array:Array;function V0(){const n=new rr(2);return rr!=Float32Array&&(n[0]=0,n[1]=0),n}function mu(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function $0(n,e){return n[0]=-e[0],n[1]=-e[1],n}function mp(n,e,t,r){const s=e[0],i=e[1];return n[0]=s+r*(t[0]-s),n[1]=i+r*(t[1]-i),n}function j0(n,e,t){const r=e[0],s=e[1];return n[0]=t[0]*r+t[4]*s+t[12],n[1]=t[1]*r+t[5]*s+t[13],n}(function(){const n=V0();return function(e,t,r,s,i,o){let a,c;for(t||(t=2),r||(r=0),s?c=Math.min(s*t+r,e.length):c=e.length,a=r;a<c;a+=t)n[0]=e[a],n[1]=e[a+1],i(n,n,o),e[a]=n[0],e[a+1]=n[1];return e}})();function W0(n,e,t){const r=e[0],s=e[1],i=t[3]*r+t[7]*s||1;return n[0]=(t[0]*r+t[4]*s)/i,n[1]=(t[1]*r+t[5]*s)/i,n}function _p(n,e,t){const r=e[0],s=e[1],i=e[2],o=t[3]*r+t[7]*s+t[11]*i||1;return n[0]=(t[0]*r+t[4]*s+t[8]*i)/o,n[1]=(t[1]*r+t[5]*s+t[9]*i)/o,n[2]=(t[2]*r+t[6]*s+t[10]*i)/o,n}function H0(n,e,t){const r=e[0],s=e[1];return n[0]=t[0]*r+t[2]*s,n[1]=t[1]*r+t[3]*s,n[2]=e[2],n}function z0(){const n=new rr(3);return rr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function X0(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function q0(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Y0(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function K0(n,e,t){const r=e[0],s=e[1],i=e[2],o=t[0],a=t[1],c=t[2];return n[0]=s*c-i*a,n[1]=i*o-r*c,n[2]=r*a-s*o,n}function bp(n,e,t){const r=e[0],s=e[1],i=e[2];let o=t[3]*r+t[7]*s+t[11]*i+t[15];return o=o||1,n[0]=(t[0]*r+t[4]*s+t[8]*i+t[12])/o,n[1]=(t[1]*r+t[5]*s+t[9]*i+t[13])/o,n[2]=(t[2]*r+t[6]*s+t[10]*i+t[14])/o,n}function Z0(n,e,t){const r=e[0],s=e[1],i=e[2];return n[0]=r*t[0]+s*t[3]+i*t[6],n[1]=r*t[1]+s*t[4]+i*t[7],n[2]=r*t[2]+s*t[5]+i*t[8],n}function J0(n,e,t){const r=t[0],s=t[1],i=t[2],o=t[3],a=e[0],c=e[1],l=e[2];let u=s*l-i*c,h=i*a-r*l,f=r*c-s*a,d=s*f-i*h,p=i*u-r*f,m=r*h-s*u;const g=o*2;return u*=g,h*=g,f*=g,d*=2,p*=2,m*=2,n[0]=a+u+d,n[1]=c+h+p,n[2]=l+f+m,n}function Q0(n,e,t,r){const s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[0],i[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),i[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function G0(n,e,t,r){const s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),i[1]=s[1],i[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function ew(n,e,t,r){const s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),i[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),i[2]=s[2],n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function tw(n,e){const t=n[0],r=n[1],s=n[2],i=e[0],o=e[1],a=e[2],c=Math.sqrt((t*t+r*r+s*s)*(i*i+o*o+a*a)),l=c&&Y0(n,e)/c;return Math.acos(Math.min(Math.max(l,-1),1))}const nw=X0;(function(){const n=z0();return function(e,t,r,s,i,o){let a,c;for(t||(t=3),r||(r=0),s?c=Math.min(s*t+r,e.length):c=e.length,a=r;a<c;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],i(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}})();const Po=[0,0,0];let ms;class St extends L0{static get ZERO(){return ms||(ms=new St(0,0,0),Object.freeze(ms)),ms}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&nr(e)?this.copy(e):(st.debug&&(Qe(e),Qe(t),Qe(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return st.debug&&(Qe(e.x),Qe(e.y),Qe(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Qe(e)}angle(e){return tw(this,e)}cross(e){return K0(this,this,e),this.check()}rotateX({radians:e,origin:t=Po}){return Q0(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Po}){return G0(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Po}){return ew(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return bp(this,this,e),this.check()}transformAsVector(e){return _p(this,this,e),this.check()}transformByMatrix3(e){return Z0(this,this,e),this.check()}transformByMatrix2(e){return H0(this,this,e),this.check()}transformByQuaternion(e){return J0(this,this,e),this.check()}}class rw extends gp{toString(){let e="[";if(st.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=Qe(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[r+s];return t}setColumn(e,t){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=t[s];return this}}function sw(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function iw(n,e){if(n===e){const t=e[1],r=e[2],s=e[3],i=e[6],o=e[7],a=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=i,n[11]=e[14],n[12]=s,n[13]=o,n[14]=a}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function Oa(n,e){const t=e[0],r=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],y=e[15],S=t*a-r*o,v=t*c-s*o,x=t*l-i*o,T=r*c-s*a,I=r*l-i*a,M=s*l-i*c,N=u*m-h*p,L=u*g-f*p,j=u*y-d*p,$=h*g-f*m,K=h*y-d*m,se=f*y-d*g;let Z=S*se-v*K+x*$+T*j-I*L+M*N;return Z?(Z=1/Z,n[0]=(a*se-c*K+l*$)*Z,n[1]=(s*K-r*se-i*$)*Z,n[2]=(m*M-g*I+y*T)*Z,n[3]=(f*I-h*M-d*T)*Z,n[4]=(c*j-o*se-l*L)*Z,n[5]=(t*se-s*j+i*L)*Z,n[6]=(g*x-p*M-y*v)*Z,n[7]=(u*M-f*x+d*v)*Z,n[8]=(o*K-a*j+l*N)*Z,n[9]=(r*j-t*K-i*N)*Z,n[10]=(p*I-m*x+y*S)*Z,n[11]=(h*x-u*I-d*S)*Z,n[12]=(a*L-o*$-c*N)*Z,n[13]=(t*$-r*L+s*N)*Z,n[14]=(m*v-p*T-g*S)*Z,n[15]=(u*T-h*v+f*S)*Z,n):null}function ow(n){const e=n[0],t=n[1],r=n[2],s=n[3],i=n[4],o=n[5],a=n[6],c=n[7],l=n[8],u=n[9],h=n[10],f=n[11],d=n[12],p=n[13],m=n[14],g=n[15],y=e*o-t*i,S=e*a-r*i,v=t*a-r*o,x=l*p-u*d,T=l*m-h*d,I=u*m-h*p,M=e*I-t*T+r*x,N=i*I-o*T+a*x,L=l*v-u*S+h*y,j=d*v-p*S+m*y;return c*M-s*N+g*L-f*j}function fn(n,e,t){const r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=e[9],d=e[10],p=e[11],m=e[12],g=e[13],y=e[14],S=e[15];let v=t[0],x=t[1],T=t[2],I=t[3];return n[0]=v*r+x*a+T*h+I*m,n[1]=v*s+x*c+T*f+I*g,n[2]=v*i+x*l+T*d+I*y,n[3]=v*o+x*u+T*p+I*S,v=t[4],x=t[5],T=t[6],I=t[7],n[4]=v*r+x*a+T*h+I*m,n[5]=v*s+x*c+T*f+I*g,n[6]=v*i+x*l+T*d+I*y,n[7]=v*o+x*u+T*p+I*S,v=t[8],x=t[9],T=t[10],I=t[11],n[8]=v*r+x*a+T*h+I*m,n[9]=v*s+x*c+T*f+I*g,n[10]=v*i+x*l+T*d+I*y,n[11]=v*o+x*u+T*p+I*S,v=t[12],x=t[13],T=t[14],I=t[15],n[12]=v*r+x*a+T*h+I*m,n[13]=v*s+x*c+T*f+I*g,n[14]=v*i+x*l+T*d+I*y,n[15]=v*o+x*u+T*p+I*S,n}function li(n,e,t){const r=t[0],s=t[1],i=t[2];let o,a,c,l,u,h,f,d,p,m,g,y;return e===n?(n[12]=e[0]*r+e[4]*s+e[8]*i+e[12],n[13]=e[1]*r+e[5]*s+e[9]*i+e[13],n[14]=e[2]*r+e[6]*s+e[10]*i+e[14],n[15]=e[3]*r+e[7]*s+e[11]*i+e[15]):(o=e[0],a=e[1],c=e[2],l=e[3],u=e[4],h=e[5],f=e[6],d=e[7],p=e[8],m=e[9],g=e[10],y=e[11],n[0]=o,n[1]=a,n[2]=c,n[3]=l,n[4]=u,n[5]=h,n[6]=f,n[7]=d,n[8]=p,n[9]=m,n[10]=g,n[11]=y,n[12]=o*r+u*s+p*i+e[12],n[13]=a*r+h*s+m*i+e[13],n[14]=c*r+f*s+g*i+e[14],n[15]=l*r+d*s+y*i+e[15]),n}function Dc(n,e,t){const r=t[0],s=t[1],i=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*i,n[9]=e[9]*i,n[10]=e[10]*i,n[11]=e[11]*i,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function aw(n,e,t,r){let s=r[0],i=r[1],o=r[2],a=Math.sqrt(s*s+i*i+o*o),c,l,u,h,f,d,p,m,g,y,S,v,x,T,I,M,N,L,j,$,K,se,Z,ie;return a<Fs?null:(a=1/a,s*=a,i*=a,o*=a,l=Math.sin(t),c=Math.cos(t),u=1-c,h=e[0],f=e[1],d=e[2],p=e[3],m=e[4],g=e[5],y=e[6],S=e[7],v=e[8],x=e[9],T=e[10],I=e[11],M=s*s*u+c,N=i*s*u+o*l,L=o*s*u-i*l,j=s*i*u-o*l,$=i*i*u+c,K=o*i*u+s*l,se=s*o*u+i*l,Z=i*o*u-s*l,ie=o*o*u+c,n[0]=h*M+m*N+v*L,n[1]=f*M+g*N+x*L,n[2]=d*M+y*N+T*L,n[3]=p*M+S*N+I*L,n[4]=h*j+m*$+v*K,n[5]=f*j+g*$+x*K,n[6]=d*j+y*$+T*K,n[7]=p*j+S*$+I*K,n[8]=h*se+m*Z+v*ie,n[9]=f*se+g*Z+x*ie,n[10]=d*se+y*Z+T*ie,n[11]=p*se+S*Z+I*ie,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function yp(n,e,t){const r=Math.sin(t),s=Math.cos(t),i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],f=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=i*s+l*r,n[5]=o*s+u*r,n[6]=a*s+h*r,n[7]=c*s+f*r,n[8]=l*s-i*r,n[9]=u*s-o*r,n[10]=h*s-a*r,n[11]=f*s-c*r,n}function cw(n,e,t){const r=Math.sin(t),s=Math.cos(t),i=e[0],o=e[1],a=e[2],c=e[3],l=e[8],u=e[9],h=e[10],f=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=i*s-l*r,n[1]=o*s-u*r,n[2]=a*s-h*r,n[3]=c*s-f*r,n[8]=i*r+l*s,n[9]=o*r+u*s,n[10]=a*r+h*s,n[11]=c*r+f*s,n}function vp(n,e,t){const r=Math.sin(t),s=Math.cos(t),i=e[0],o=e[1],a=e[2],c=e[3],l=e[4],u=e[5],h=e[6],f=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=i*s+l*r,n[1]=o*s+u*r,n[2]=a*s+h*r,n[3]=c*s+f*r,n[4]=l*s-i*r,n[5]=u*s-o*r,n[6]=h*s-a*r,n[7]=f*s-c*r,n}function lw(n,e){const t=e[0],r=e[1],s=e[2],i=e[3],o=t+t,a=r+r,c=s+s,l=t*o,u=r*o,h=r*a,f=s*o,d=s*a,p=s*c,m=i*o,g=i*a,y=i*c;return n[0]=1-h-p,n[1]=u+y,n[2]=f-g,n[3]=0,n[4]=u-y,n[5]=1-l-p,n[6]=d+m,n[7]=0,n[8]=f+g,n[9]=d-m,n[10]=1-l-h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function uw(n,e,t,r,s,i,o){const a=1/(t-e),c=1/(s-r),l=1/(i-o);return n[0]=i*2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i*2*c,n[6]=0,n[7]=0,n[8]=(t+e)*a,n[9]=(s+r)*c,n[10]=(o+i)*l,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*i*2*l,n[15]=0,n}function hw(n,e,t,r,s){const i=1/Math.tan(e/2);if(n[0]=i/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const o=1/(r-s);n[10]=(s+r)*o,n[14]=2*s*r*o}else n[10]=-1,n[14]=-2*r;return n}const fw=hw;function dw(n,e,t,r,s,i,o){const a=1/(e-t),c=1/(r-s),l=1/(i-o);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*c,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*l,n[11]=0,n[12]=(e+t)*a,n[13]=(s+r)*c,n[14]=(o+i)*l,n[15]=1,n}const pw=dw;function gw(n,e,t,r){let s,i,o,a,c,l,u,h,f,d;const p=e[0],m=e[1],g=e[2],y=r[0],S=r[1],v=r[2],x=t[0],T=t[1],I=t[2];return Math.abs(p-x)<Fs&&Math.abs(m-T)<Fs&&Math.abs(g-I)<Fs?sw(n):(h=p-x,f=m-T,d=g-I,s=1/Math.sqrt(h*h+f*f+d*d),h*=s,f*=s,d*=s,i=S*d-v*f,o=v*h-y*d,a=y*f-S*h,s=Math.sqrt(i*i+o*o+a*a),s?(s=1/s,i*=s,o*=s,a*=s):(i=0,o=0,a=0),c=f*a-d*o,l=d*i-h*a,u=h*o-f*i,s=Math.sqrt(c*c+l*l+u*u),s?(s=1/s,c*=s,l*=s,u*=s):(c=0,l=0,u=0),n[0]=i,n[1]=c,n[2]=h,n[3]=0,n[4]=o,n[5]=l,n[6]=f,n[7]=0,n[8]=a,n[9]=u,n[10]=d,n[11]=0,n[12]=-(i*p+o*m+a*g),n[13]=-(c*p+l*m+u*g),n[14]=-(h*p+f*m+d*g),n[15]=1,n)}function mw(){const n=new rr(4);return rr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function _w(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function is(n,e,t){const r=e[0],s=e[1],i=e[2],o=e[3];return n[0]=t[0]*r+t[4]*s+t[8]*i+t[12]*o,n[1]=t[1]*r+t[5]*s+t[9]*i+t[13]*o,n[2]=t[2]*r+t[6]*s+t[10]*i+t[14]*o,n[3]=t[3]*r+t[7]*s+t[11]*i+t[15]*o,n}(function(){const n=mw();return function(e,t,r,s,i,o){let a,c;for(t||(t=4),r||(r=0),s?c=Math.min(s*t+r,e.length):c=e.length,a=r;a<c;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],n[3]=e[a+3],i(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2],e[a+3]=n[3];return e}})();var ka;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(ka||(ka={}));const bw=45*Math.PI/180,yw=1,Oo=.1,ko=500,vw=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class At extends rw{static get IDENTITY(){return Tw()}static get ZERO(){return ww()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return ka}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,s,i,o,a,c,l,u,h,f,d,p,m,g){return this[0]=e,this[1]=t,this[2]=r,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=u,this[10]=h,this[11]=f,this[12]=d,this[13]=p,this[14]=m,this[15]=g,this.check()}setRowMajor(e,t,r,s,i,o,a,c,l,u,h,f,d,p,m,g){return this[0]=e,this[1]=i,this[2]=l,this[3]=d,this[4]=t,this[5]=o,this[6]=u,this[7]=p,this[8]=r,this[9]=a,this[10]=h,this[11]=m,this[12]=s,this[13]=c,this[14]=f,this[15]=g,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(vw)}fromObject(e){return this.check()}fromQuaternion(e){return lw(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:s,top:i,near:o=Oo,far:a=ko}=e;return a===1/0?xw(this,t,r,s,i,o):uw(this,t,r,s,i,o,a),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:s=[0,1,0]}=e;return gw(this,t,r,s),this.check()}ortho(e){const{left:t,right:r,bottom:s,top:i,near:o=Oo,far:a=ko}=e;return pw(this,t,r,s,i,o,a),this.check()}orthographic(e){const{fovy:t=bw,aspect:r=yw,focalDistance:s=1,near:i=Oo,far:o=ko}=e;_u(t);const a=t/2,c=s*Math.tan(a),l=c*r;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:i,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:s=.1,far:i=500}=e;return _u(t),fw(this,t,r,s,i),this.check()}determinant(){return ow(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),s=1/r[0],i=1/r[1],o=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*i,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*i,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),s=1/r[0],i=1/r[1],o=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*i,e[2]=this[2]*o,e[3]=this[4]*s,e[4]=this[5]*i,e[5]=this[6]*o,e[6]=this[8]*s,e[7]=this[9]*i,e[8]=this[10]*o,e}transpose(){return iw(this,this),this.check()}invert(){return Oa(this,this),this.check()}multiplyLeft(e){return fn(this,e,this),this.check()}multiplyRight(e){return fn(this,this,e),this.check()}rotateX(e){return yp(this,this,e),this.check()}rotateY(e){return cw(this,this,e),this.check()}rotateZ(e){return vp(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return aw(this,this,e,t),this.check()}scale(e){return Dc(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return li(this,this,e),this.check()}transform(e,t){return e.length===4?(t=is(t||[-0,-0,-0,-0],e,this),Io(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let s;switch(r){case 2:s=j0(t||[-0,-0],e,this);break;case 3:s=bp(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Io(s,e.length),s}transformAsVector(e,t){let r;switch(e.length){case 2:r=W0(t||[-0,-0],e,this);break;case 3:r=_p(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Io(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let _s,bs;function ww(){return _s||(_s=new At([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(_s)),_s}function Tw(){return bs||(bs=new At,Object.freeze(bs)),bs}function _u(n){if(n>Math.PI*2)throw Error("expected radians")}function xw(n,e,t,r,s,i){const o=2*i/(t-e),a=2*i/(s-r),c=(t+e)/(t-e),l=(s+r)/(s-r),u=-1,h=-1,f=-2*i;return n[0]=o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=c,n[9]=l,n[10]=u,n[11]=h,n[12]=0,n[13]=0,n[14]=f,n[15]=0,n}function wp(n,e=[],t=0){const r=Math.fround(n),s=n-r;return e[t]=r,e[t+1]=s,e}function Sw(n){return n-Math.fround(n)}function Aw(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let r=0;r<4;++r){const s=t*4+r;wp(n[r*4+t],e,s*2)}return e}const Ew=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Rw={name:"fp32",vs:Ew},Cw=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,Iw={ONE:1},Pw={name:"fp64arithmetic",vs:Cw,defaultUniforms:Iw,uniformTypes:{ONE:"f32"},fp64ify:wp,fp64LowPart:Sw,fp64ifyMatrix4:Aw},Ow=[0,1,1,1],kw=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Mw=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,bu={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:Ow},vs:kw,fs:Mw,getUniforms:Nw};function Nw(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const r=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=r}if(n.highlightColor){const r=Array.from(n.highlightColor,s=>s/255);Number.isFinite(r[3])||(r[3]=1),t.highlightColor=r}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const yu=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,Dw=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,Tp=3,Fw=255;var Zr;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(Zr||(Zr={}));const Lr={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:Tp},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Zr.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:Dw,vs:yu,fs:yu,getUniforms:Uw};function Uw(n,e={}){if(n=n&&{...n},!n)return{...Lr.defaultUniforms};n.lights&&(n={...n,...Lw(n.lights),lights:void 0});const{ambientLight:t,pointLights:r,directionalLights:s}=n||{};if(!(t||r&&r.length>0||s&&s.length>0))return{...Lr.defaultUniforms,enabled:0};const o={...Lr.defaultUniforms,...e,...Bw({ambientLight:t,pointLights:r,directionalLights:s})};return n.enabled!==void 0&&(o.enabled=n.enabled?1:0),o}function Bw({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const r={};r.ambientLightColor=Mo(n);let s=0;for(const i of e){r.lightType=Zr.POINT;const o=s;r[`lightColor${o}`]=Mo(i),r[`lightPosition${o}`]=i.position,r[`lightAttenuation${o}`]=i.attenuation||[1,0,0],s++}for(const i of t){r.lightType=Zr.DIRECTIONAL;const o=s;r[`lightColor${o}`]=Mo(i),r[`lightDirection${o}`]=i.direction,s++}return s>Tp&&F.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=t.length,r.pointLightCount=e.length,r}function Lw(n){var t,r;const e={pointLights:[],directionalLights:[]};for(const s of n||[])switch(s.type){case"ambient":e.ambientLight=s;break;case"directional":(t=e.directionalLights)==null||t.push(s);break;case"point":(r=e.pointLights)==null||r.push(s);break}return e}function Mo(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(r=>r*t/Fw)}const xp=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,Sp=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,Ap={props:{},name:"gouraudMaterial",vs:Sp.replace("phongMaterial","gouraudMaterial"),fs:xp.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Lr],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...Ap.defaultUniforms,...e}}},Vw=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Ep={name:"phongMaterial",dependencies:[Lr],source:Vw,vs:xp,fs:Sp,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...Ep.defaultUniforms,...e}}},vu=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,$w={name:"layer",vs:vu,fs:vu,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},jw=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Rp="#define SMOOTH_EDGE_RADIUS 0.5",Ww=`${Rp}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Hw=`${Rp}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Cp={name:"geometry",source:jw,vs:Ww,fs:Hw},zw=25;var Ie;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(Ie||(Ie={}));var Oe;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Oe||(Oe={}));var Q;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Q||(Q={}));const Xw="compute",qw="auto",Ma="manipulation",Us="none",Na="pan-x",Da="pan-y";function Yw(n){if(n.includes(Us))return Us;const e=n.includes(Na),t=n.includes(Da);return e&&t?Us:e||t?e?Na:Da:n.includes(Ma)?Ma:qw}class Kw{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===Xw&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return Yw(e.join(" "))}}function ui(n){return n.trim().split(/\s+/g)}function No(n,e,t){if(n)for(const r of ui(e))n.addEventListener(r,t,!1)}function Do(n,e,t){if(n)for(const r of ui(e))n.removeEventListener(r,t,!1)}function wu(n){return(n.ownerDocument||n).defaultView}function Zw(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function Ip(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,r=0,s=0;for(;s<e;)t+=n[s].clientX,r+=n[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(r/e)}}function Tu(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:Ip(e),deltaX:n.deltaX,deltaY:n.deltaY}}function Pp(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)}function xu(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.sqrt(t*t+r*r)}function Jw(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.atan2(r,t)*180/Math.PI}function Su(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.atan2(r,t)*180/Math.PI}function Op(n,e){return n===e?Oe.None:Math.abs(n)>=Math.abs(e)?n<0?Oe.Left:Oe.Right:e<0?Oe.Up:Oe.Down}function Qw(n,e){const t=e.center;let r=n.offsetDelta,s=n.prevDelta;const i=n.prevInput;return(e.eventType===Ie.Start||(i==null?void 0:i.eventType)===Ie.End)&&(s=n.prevDelta={x:(i==null?void 0:i.deltaX)||0,y:(i==null?void 0:i.deltaY)||0},r=n.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-r.x),deltaY:s.y+(t.y-r.y)}}function kp(n,e,t){return{x:e/n||0,y:t/n||0}}function Gw(n,e){return xu(e[0],e[1])/xu(n[0],n[1])}function eT(n,e){return Su(e[1],e[0])-Su(n[1],n[0])}function tT(n,e){const t=n.lastInterval||e,r=e.timeStamp-t.timeStamp;let s,i,o,a;if(e.eventType!==Ie.Cancel&&(r>zw||t.velocity===void 0)){const c=e.deltaX-t.deltaX,l=e.deltaY-t.deltaY,u=kp(r,c,l);i=u.x,o=u.y,s=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=Op(c,l),n.lastInterval=e}else s=t.velocity,i=t.velocityX,o=t.velocityY,a=t.direction;e.velocity=s,e.velocityX=i,e.velocityY=o,e.direction=a}function nT(n,e){const{session:t}=n,{pointers:r}=e,{length:s}=r;t.firstInput||(t.firstInput=Tu(e)),s>1&&!t.firstMultiple?t.firstMultiple=Tu(e):s===1&&(t.firstMultiple=!1);const{firstInput:i,firstMultiple:o}=t,a=o?o.center:i.center,c=e.center=Ip(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-i.timeStamp,e.angle=Jw(a,c),e.distance=Pp(a,c);const{deltaX:l,deltaY:u}=Qw(t,e);e.deltaX=l,e.deltaY=u,e.offsetDirection=Op(e.deltaX,e.deltaY);const h=kp(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=h.x,e.overallVelocityY=h.y,e.overallVelocity=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,e.scale=o?Gw(o.pointers,r):1,e.rotation=o?eT(o.pointers,r):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let f=n.element;return Zw(e.srcEvent.target,f)&&(f=e.srcEvent.target),e.target=f,tT(t,e),e}function rT(n,e,t){const r=t.pointers.length,s=t.changedPointers.length,i=e&Ie.Start&&r-s===0,o=e&(Ie.End|Ie.Cancel)&&r-s===0;t.isFirst=!!i,t.isFinal=!!o,i&&(n.session={}),t.eventType=e;const a=nT(n,t);n.emit("hammer.input",a),n.recognize(a),n.session.prevInput=a}let sT=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){rT(this.manager,e,t)}init(){No(this.element,this.evEl,this.domHandler),No(this.target,this.evTarget,this.domHandler),No(wu(this.element),this.evWin,this.domHandler)}destroy(){Do(this.element,this.evEl,this.domHandler),Do(this.target,this.evTarget,this.domHandler),Do(wu(this.element),this.evWin,this.domHandler)}};const iT={pointerdown:Ie.Start,pointermove:Ie.Move,pointerup:Ie.End,pointercancel:Ie.Cancel,pointerout:Ie.Cancel},oT="pointerdown",aT="pointermove pointerup pointercancel";class cT extends sT{constructor(e){super(e),this.evEl=oT,this.evWin=aT,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let r=!1;const s=iT[e.type],i=e.pointerType,o=i==="touch";let a=t.findIndex(c=>c.pointerId===e.pointerId);s&Ie.Start&&(e.buttons||o)?a<0&&(t.push(e),a=t.length-1):s&(Ie.End|Ie.Cancel)&&(r=!0),!(a<0)&&(t[a]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:i,srcEvent:e}),r&&t.splice(a,1))}}const lT=["","webkit","Moz","MS","ms","o"];function uT(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const r of lT){const s=r?r+t:e;if(s in n)return s}}const hT=1,Au=2,Eu={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class fT{constructor(e,t){this.options={...Eu,...t,cssProps:{...Eu.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new cT(this),this.touchAction=new Kw(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Au:hT}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:s}=this;let{curRecognizer:i}=t;(!i||i&&i.state&Q.Recognized)&&(i=t.curRecognizer=null);let o=0;for(;o<s.length;)r=s[o],t.stopped!==Au&&(!i||r===i||r.canRecognizeWith(i))?r.recognize(e):r.reset(),!i&&r.state&(Q.Began|Q.Changed|Q.Ended)&&(i=t.curRecognizer=r),o++}get(e){const{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:r}=this,s=r.indexOf(t);s!==-1&&(r.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:r}=this;for(const s of ui(e))r[s]=r[s]||[],r[s].push(t)}off(e,t){if(!e)return;const{handlers:r}=this;for(const s of ui(e))t?r[s]&&r[s].splice(r[s].indexOf(t),1):delete r[s]}emit(e,t){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let i=0;for(;i<r.length;)r[i](s),i++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[r,s]of Object.entries(this.options.cssProps)){const i=uT(t.style,r);e?(this.oldCssProps[i]=t.style[i],t.style[i]=s):t.style[i]=this.oldCssProps[i]||""}e||(this.oldCssProps={})}}}let dT=1;function pT(){return dT++}function Ru(n){return n&Q.Cancelled?"cancel":n&Q.Ended?"end":n&Q.Changed?"move":n&Q.Began?"start":""}class Mp{constructor(e){this.options=e,this.id=pT(),this.state=Q.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:r}=this;return r.indexOf(t)===-1&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const r=this.requireFail.indexOf(t);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Q.Ended&&this.manager.emit(this.options.event+Ru(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Q.Ended&&this.manager.emit(this.options.event+Ru(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Q.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Q.Failed|Q.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Q.Failed;return}this.state&(Q.Recognized|Q.Cancelled|Q.Failed)&&(this.state=Q.Possible),this.state=this.process(t),this.state&(Q.Began|Q.Changed|Q.Ended|Q.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class Np extends Mp{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:r}=e,s=t&(Q.Began|Q.Changed),i=this.attrTest(e);return s&&(r&Ie.Cancel||!i)?t|Q.Cancelled:s||i?r&Ie.End?t|Q.Ended:t&Q.Began?t|Q.Changed:Q.Began:Q.Failed}}class Cu extends Mp{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Ma]}process(e){const{options:t}=this,r=e.pointers.length===t.pointers,s=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),e.eventType&Ie.Start&&this.count===0)return this.failTimeout();if(s&&i&&r){if(e.eventType!==Ie.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<t.interval:!0,a=!this.pCenter||Pp(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!o?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Q.Recognized,this.tryEmit(this._input)},t.interval),Q.Began):Q.Recognized}return Q.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Q.Failed},this.options.interval),Q.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Q.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const gT=["","start","move","end","cancel","up","down","left","right"];class Iu extends Np{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Oe.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Oe.Horizontal&&t.push(Da),e&Oe.Vertical&&t.push(Na),t}getEventNames(){return gT.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let r=!0,{distance:s}=e,{direction:i}=e;const o=e.deltaX,a=e.deltaY;return i&t.direction||(t.direction&Oe.Horizontal?(i=o===0?Oe.None:o<0?Oe.Left:Oe.Right,r=o!==this.pX,s=Math.abs(e.deltaX)):(i=a===0?Oe.None:a<0?Oe.Up:Oe.Down,r=a!==this.pY,s=Math.abs(e.deltaY))),e.direction=i,r&&s>t.threshold&&!!(i&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Q.Began)||!(this.state&Q.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Oe[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const mT=["","start","move","end","cancel","in","out"];class _T extends Np{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Us]}getEventNames(){return mT.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Q.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}let qi=class{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}};const bT=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",yT=bT.indexOf("firefox")!==-1,Pu=4.000244140625,vT=40,wT=.25;class TT extends qi{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=s=>{if(!this.options.enable)return;let i=s.deltaY;globalThis.WheelEvent&&(yT&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(i/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(i*=vT)),i!==0&&i%Pu===0&&(i=Math.floor(i/Pu)),s.shiftKey&&i&&(i=i*wT),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-i,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const Ou=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class xT extends qi{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=i=>{this.handleOverEvent(i),this.handleOutEvent(i),this.handleEnterEvent(i),this.handleLeaveEvent(i),this.handleMoveEvent(i)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,Ou.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){Ou.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const ku=["keydown","keyup"];class ST extends qi{constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=s=>{const i=s.target||s.srcElement;i.tagName==="INPUT"&&i.type==="text"||i.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",ku.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){ku.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class AT extends qi{constructor(e,t,r){super(e,t,r),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const Mu=1,Fa=2,Nu=4,ET={pointerdown:Mu,pointermove:Fa,pointerup:Nu,mousedown:Mu,mousemove:Fa,mouseup:Nu},RT=0,CT=1,IT=2,PT=1,OT=2,kT=4;function MT(n){const e=ET[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=n.srcEvent;let s=!1,i=!1,o=!1;return e===Fa?(s=!!(t&PT),i=!!(t&kT),o=!!(t&OT)):(s=r===RT,i=r===CT,o=r===IT),{leftButton:s,middleButton:i,rightButton:o}}function NT(n,e){const t=n.center;if(!t)return null;const r=e.getBoundingClientRect(),s=r.width/e.offsetWidth||1,i=r.height/e.offsetHeight||1,o={x:(t.x-r.left-e.clientLeft)/s,y:(t.y-r.top-e.clientTop)/i};return{center:t,offsetCenter:o}}const DT={srcElement:"root",priority:0};class FT{constructor(e,t){this.handleEvent=r=>{if(this.isEmpty())return;const s=this._normalizeEvent(r);let i=r.srcEvent.target;for(;i&&i!==s.rootElement;){if(this._emit(s,i),s.handled)return;i=i.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,s=!1,i=!1){const{handlers:o,handlersByElement:a}=this,c={...DT,...r};let l=a.get(c.srcElement);l||(l=[],a.set(c.srcElement,l));const u={type:e,handler:t,srcElement:c.srcElement,priority:c.priority};s&&(u.once=!0),i&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=l.length-1;for(;h>=0&&!(l[h].priority>=u.priority);)h--;l.splice(h+1,0,u)}remove(e,t){const{handlers:r,handlersByElement:s}=this;for(let i=r.length-1;i>=0;i--){const o=r[i];if(o.type===e&&o.handler===t){r.splice(i,1);const a=s.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&s.delete(o.srcElement)}}this._active=r.some(i=>!i.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let s=!1;const i=()=>{e.handled=!0},o=()=>{e.handled=!0,s=!0},a=[];for(let c=0;c<r.length;c++){const{type:l,handler:u,once:h}=r[c];if(u({...e,type:l,stopPropagation:i,stopImmediatePropagation:o}),h&&a.push(r[c]),s)break}for(let c=0;c<a.length;c++){const{type:l,handler:u}=a[c];this.remove(l,u)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...MT(e),...NT(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function UT(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const r=t.shift(),s=t.shift()||{};e=new r(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class BT{constructor(e=null,t={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new fT(e,this.options);for(const r of this.options.recognizers){const{recognizer:s,recognizeWith:i,requireFailure:o}=UT(r);this.manager.add(s),i&&s.recognizeWith(i),o&&s.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new TT(e,this._onOtherEvent,{enable:!1}),this.moveInput=new xT(e,this._onOtherEvent,{enable:!1}),this.keyInput=new ST(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new AT(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var i,o,a,c;const{manager:r}=this;if(!r)return;const s=r.get(e);s&&(s.set({enable:t}),r.touchAction.update()),(i=this.wheelInput)==null||i.enableEventType(e,t),(o=this.moveInput)==null||o.enableEventType(e,t),(a=this.keyInput)==null||a.enableEventType(e,t),(c=this.contextmenuInput)==null||c.enableEventType(e,t)}_addEventHandler(e,t,r,s,i){if(typeof e!="string"){r=t;for(const[l,u]of Object.entries(e))this._addEventHandler(l,u,r,s,i);return}const{manager:o,events:a}=this;if(!o)return;let c=a.get(e);if(!c){const l=this._getRecognizerName(e)||e;c=new FT(this,l),a.set(e,c),o&&o.on(e,c.handleEvent)}c.add(e,t,r,s,i),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[i,o]of Object.entries(e))this._removeEventHandler(i,o);return}const{events:r}=this,s=r.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:i}=s;let o=!1;for(const a of r.values())if(a.recognizerName===i&&!a.isEmpty()){o=!0;break}o||this._toggleRecognizer(i,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:t.options.event}}const ne={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ne,"IDENTITY",{get:()=>(fe.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const nt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},sr={common:0,meters:1,pixels:2},Ua={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Du={multipan:[Iu,{threshold:10,direction:Oe.Vertical,pointers:2}],pinch:[_T,{},null,["multipan"]],pan:[Iu,{threshold:1},["pinch"],["multipan"]],dblclick:[Cu,{event:"dblclick",taps:2}],click:[Cu,{event:"click"},null,["dblclick"]]};function LT(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}function os(n){let e={},t;return r=>{for(const s in r)if(!LT(r[s],e[s])){t=n(r),e=r;break}return t}}const Fu=[0,0,0,0],VT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Dp=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$T=[0,0,0],Fp=[0,0,0],jT=os(zT);function Up(n,e,t=Fp){t.length<3&&(t=[t[0],t[1],0]);let r=t,s,i=!0;switch(e===ne.LNGLAT_OFFSETS||e===ne.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case nt.WEB_MERCATOR:(e===ne.LNGLAT||e===ne.CARTESIAN)&&(s=[0,0,0],i=!1);break;case nt.WEB_MERCATOR_AUTO_OFFSET:e===ne.LNGLAT?r=s:e===ne.CARTESIAN&&(r=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case nt.IDENTITY:r=n.position.map(Math.fround),r[2]=r[2]||0;break;case nt.GLOBE:i=!1,s=null;break;default:i=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:r,offsetMode:i}}function WT(n,e,t){const{viewMatrixUncentered:r,projectionMatrix:s}=n;let{viewMatrix:i,viewProjectionMatrix:o}=n,a=Fu,c=Fu,l=n.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:f}=Up(n,e,t);return f&&(c=n.projectPosition(u||h),l=[l[0]-c[0],l[1]-c[1],l[2]-c[2]],c[3]=1,a=is([],c,o),i=r||i,o=fn([],s,i),o=fn([],o,VT)),{viewMatrix:i,viewProjectionMatrix:o,projectionCenter:a,originCommon:c,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:u}}function HT({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=ne.DEFAULT,coordinateOrigin:s=Fp,autoWrapLongitude:i=!1}){r===ne.DEFAULT&&(r=n.isGeospatial?ne.LNGLAT:ne.CARTESIAN);const o=jT({viewport:n,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:s});return o.wrapLongitude=i,o.modelMatrix=t||Dp,o}function zT({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:s,viewProjectionMatrix:i,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:c,geospatialOrigin:l}=WT(n,t,r),u=n.getDistanceScales(),h=[n.width*e,n.height*e],f=is([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,d={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:c,commonOrigin:o.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:h,devicePixelRatio:e,focalDistance:f,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:$T,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:i,modelMatrix:Dp,cameraPosition:a};if(l){const p=n.getDistanceScales(l);switch(t){case ne.METER_OFFSETS:d.commonUnitsPerWorldUnit=p.unitsPerMeter,d.commonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case ne.LNGLAT:case ne.LNGLAT_OFFSETS:n._pseudoMeters||(d.commonUnitsPerMeter=p.unitsPerMeter),d.commonUnitsPerWorldUnit=p.unitsPerDegree,d.commonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case ne.CARTESIAN:d.commonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.commonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return d}const XT=Object.keys(ne).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${ne[n]};`).join(""),qT=Object.keys(nt).map(n=>`const PROJECTION_MODE_${n}: i32 = ${nt[n]};`).join(""),YT=Object.keys(sr).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${sr[n]};`).join(""),KT=`${XT}
${qT}
${YT}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,ZT=`${KT}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,JT=Object.keys(ne).map(n=>`const int COORDINATE_SYSTEM_${n} = ${ne[n]};`).join(""),QT=Object.keys(nt).map(n=>`const int PROJECTION_MODE_${n} = ${nt[n]};`).join(""),GT=Object.keys(sr).map(n=>`const int UNIT_${n.toUpperCase()} = ${sr[n]};`).join(""),ex=`${JT}
${QT}
${GT}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,tx={};function nx(n=tx){return"viewport"in n?HT(n):{}}const Fc={name:"project",dependencies:[Rw,Cp],source:ZT,vs:ex,getUniforms:nx,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},rx=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,sx=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Yi={name:"project32",dependencies:[Fc],source:rx,vs:sx};function ix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Zn(n,e){const t=is([],e,n);return _w(t,t,1/t[3]),t}function Uu(n,e){const t=n%e;return t<0?e+t:t}function Ba(n,e,t){return n<e?e:n>t?t:n}function ox(n){return Math.log(n)*Math.LOG2E}const Uc=Math.log2||ox;function kt(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const ft=Math.PI,Bp=ft/4,it=ft/180,La=180/ft,ir=512,hi=4003e4,Bu=85.051129,ax=1.5;function cx(n){return Uc(n)}function fi(n){const[e,t]=n;kt(Number.isFinite(e)),kt(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*it,s=t*it,i=ir*(r+ft)/(2*ft),o=ir*(ft+Math.log(Math.tan(Bp+s*.5)))/(2*ft);return[i,o]}function or(n){const[e,t]=n,r=e/ir*(2*ft)-ft,s=2*(Math.atan(Math.exp(t/ir*(2*ft)-ft))-Bp);return[r*La,s*La]}function lx(n){const{latitude:e}=n;kt(Number.isFinite(e));const t=Math.cos(e*it);return cx(hi*t)-9}function Fo(n){const e=Math.cos(n*it);return ir/hi/e}function Va(n){const{latitude:e,longitude:t,highPrecision:r=!1}=n;kt(Number.isFinite(e)&&Number.isFinite(t));const s=ir,i=Math.cos(e*it),o=s/360,a=o/i,c=s/hi/i,l={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,a,c],degreesPerUnit:[1/o,1/a,1/c]};if(r){const u=it*Math.tan(e*it)/i,h=o*u/2,f=s/hi*u,d=f/a*c;l.unitsPerDegree2=[0,h,f],l.unitsPerMeter2=[d,0,d]}return l}function Lp(n,e){const[t,r,s]=n,[i,o,a]=e,{unitsPerMeter:c,unitsPerMeter2:l}=Va({longitude:t,latitude:r,highPrecision:!0}),u=fi(n);u[0]+=i*(c[0]+l[0]*o),u[1]+=o*(c[1]+l[1]*o);const h=or(u),f=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[h[0],h[1],f]:h}function ux(n){const{height:e,pitch:t,bearing:r,altitude:s,scale:i,center:o}=n,a=ix();li(a,a,[0,0,-s]),yp(a,a,-t*it),vp(a,a,r*it);const c=i/e;return Dc(a,a,[c,c,c]),o&&li(a,a,q0([],o)),a}function hx(n){const{width:e,height:t,altitude:r,pitch:s=0,offset:i,center:o,scale:a,nearZMultiplier:c=1,farZMultiplier:l=1}=n;let{fovy:u=di(ax)}=n;r!==void 0&&(u=di(r));const h=u*it,f=s*it,d=Vp(u);let p=d;o&&(p+=o[2]*a/Math.cos(f)/t);const m=h*(.5+(i?i[1]:0)/t),g=Math.sin(m)*p/Math.sin(Ba(Math.PI/2-f-m,.01,Math.PI-.01)),y=Math.sin(f)*g+p,S=p*10,v=Math.min(y*l,S);return{fov:h,aspect:e/t,focalDistance:d,near:c,far:v}}function di(n){return 2*Math.atan(.5/n)*La}function Vp(n){return .5/Math.tan(.5*n*it)}function $p(n,e){const[t,r,s=0]=n;return kt(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(s)),Zn(e,[t,r,s,1])}function Bc(n,e,t=0){const[r,s,i]=n;if(kt(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(i))return Zn(e,[r,s,i,1]);const o=Zn(e,[r,s,0,1]),a=Zn(e,[r,s,1,1]),c=o[2],l=a[2],u=c===l?0:((t||0)-c)/(l-c);return mp([],o,a,u)}function fx(n){const{width:e,height:t,bounds:r,minExtent:s=0,maxZoom:i=24,offset:o=[0,0]}=n,[[a,c],[l,u]]=r,h=dx(n.padding),f=fi([a,Ba(u,-85.051129,Bu)]),d=fi([l,Ba(c,-85.051129,Bu)]),p=[Math.max(Math.abs(d[0]-f[0]),s),Math.max(Math.abs(d[1]-f[1]),s)],m=[e-h.left-h.right-Math.abs(o[0])*2,t-h.top-h.bottom-Math.abs(o[1])*2];kt(m[0]>0&&m[1]>0);const g=m[0]/p[0],y=m[1]/p[1],S=(h.right-h.left)/2/g,v=(h.top-h.bottom)/2/y,x=[(d[0]+f[0])/2+S,(d[1]+f[1])/2+v],T=or(x),I=Math.min(i,Uc(Math.abs(Math.min(g,y))));return kt(Number.isFinite(I)),{longitude:T[0],latitude:T[1],zoom:I}}function dx(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(kt(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const Lu=Math.PI/180;function px(n,e=0){const{width:t,height:r,unproject:s}=n,i={targetZ:e},o=s([0,r],i),a=s([t,r],i);let c,l;const u=n.fovy?.5*n.fovy*Lu:Math.atan(.5/n.altitude),h=(90-n.pitch)*Lu;return u>h-.01?(c=Vu(n,0,e),l=Vu(n,t,e)):(c=s([0,0],i),l=s([t,0],i)),[o,a,l,c]}function Vu(n,e,t){const{pixelUnprojectionMatrix:r}=n,s=Zn(r,[e,0,1,1]),i=Zn(r,[e,n.height,1,1]),a=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(i[2]-s[2]),c=mp([],s,i,a),l=or(c);return l.push(t),l}const $u=512;function gx(n){const{width:e,height:t,pitch:r=0}=n;let{longitude:s,latitude:i,zoom:o,bearing:a=0}=n;(s<-180||s>180)&&(s=Uu(s+180,360)-180),(a<-180||a>180)&&(a=Uu(a+180,360)-180);const c=Uc(t/$u);if(o<=c)o=c,i=0;else{const l=t/2/Math.pow(2,o),u=or([0,l])[1];if(i<u)i=u;else{const h=or([0,$u-l])[1];i>h&&(i=h)}}return{width:e,height:t,longitude:s,latitude:i,zoom:o,pitch:r,bearing:a}}const jp=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,mx=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,_x=`
${jp}
${mx}
`,bx=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,yx=`
${jp}
${bx}
`,vx=os(Ax),wx=os(Ex),Tx=[0,0,0,1],xx=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Sx(n,e){const[t,r,s]=n,i=Bc([t,r,s],e);return Number.isFinite(s)?i:[i[0],i[1],0]}function Ax({viewport:n,center:e}){return new At(n.viewProjectionMatrix).invert().transform(e)}function Ex({viewport:n,shadowMatrices:e}){const t=[],r=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,i=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(o=>Sx(o,r));for(const o of e){const a=o.clone().translate(new St(n.center).negate()),c=i.map(u=>a.transform(u)),l=new At().ortho({left:Math.min(...c.map(u=>u[0])),right:Math.max(...c.map(u=>u[0])),bottom:Math.min(...c.map(u=>u[1])),top:Math.max(...c.map(u=>u[1])),near:Math.min(...c.map(u=>-u[2])),far:Math.max(...c.map(u=>-u[2]))});t.push(l.multiplyRight(o))}return t}function Rx(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const r=Fc.getUniforms(t),s=vx({viewport:t.viewport,center:r.center}),i=[],o=wx({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let c=0;c<n.shadowMatrices.length;c++){const l=o[c],u=l.clone().translate(new St(t.viewport.center).negate());r.coordinateSystem===ne.LNGLAT&&r.projectionMode===nt.WEB_MERCATOR?(o[c]=u,i[c]=s):(o[c]=l.clone().multiplyRight(xx),i[c]=u.transform(s))}const a={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||Tx,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let c=0;c<o.length;c++)a[`viewProjectionMatrix${c}`]=o[c],a[`projectCenter${c}`]=i[c];for(let c=0;c<2;c++)a[`shadow_uShadowMap${c}`]=n.shadowMaps&&n.shadowMaps[c]||n.dummyShadowMap;return a}const ju={name:"shadow",dependencies:[Fc],vs:_x,fs:yx,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:Rx,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Cx={...bu,defaultUniforms:{...bu.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},Ix=[Cp],Px=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],Ox=[];function kx(n){const e=Zs.getDefaultShaderAssembler();for(const r of Ix)e.addDefaultModule(r);const t=n==="glsl"?Px:Ox;for(const r of t)e.addShaderHook(r);return e}const Mx=[255,255,255],Nx=1;let Dx=0;class Wp{constructor(e={}){this.type="ambient";const{color:t=Mx}=e,{intensity:r=Nx}=e;this.id=e.id||`ambient-${Dx++}`,this.color=t,this.intensity=r}}const Fx=[255,255,255],Ux=1,Bx=[0,0,-1];let Lx=0;class Wu{constructor(e={}){this.type="directional";const{color:t=Fx}=e,{intensity:r=Ux}=e,{direction:s=Bx}=e,{_shadow:i=!1}=e;this.id=e.id||`directional-${Lx++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new St(s).normalize().toArray(),this.shadow=i}getProjectedLight(e){return this}}class Vx{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Lc extends Vx{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,r]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,i=e.clearColor??(s?[0,0,0,0]:!1),o=s?1:!1,a=s?0:!1,c=e.colorMask??15,l={viewport:[0,0,t,r]};e.colorMask&&(l.colorMask=c),e.scissorRect&&(l.scissorRect=e.scissorRect);const u=this.device.beginRenderPass({framebuffer:e.target,parameters:l,clearColor:i,clearDepth:o,clearStencil:a});try{return this._drawLayers(u,e)}finally{u.end(),this.device.submit()}}_drawLayers(e,t){const{target:r,shaderModuleProps:s,viewports:i,views:o,onViewportActive:a,clearStack:c=!0}=t;t.pass=t.pass||"unknown",c&&(this._lastRenderIndex=-1);const l=[];for(const u of i){const h=o&&o[u.id];a==null||a(u);const f=this._getDrawLayerParams(u,t),d=u.subViewports||[u];for(const p of d){const m=this._drawLayersInViewport(e,{target:r,shaderModuleProps:s,viewport:p,view:h,pass:t.pass,layers:t.layers},f);l.push(m)}}return l}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:s=!1,layerFilter:i,cullRect:o,effects:a,shaderModuleProps:c},l=!1){var p;const u=[],h=Hp(this._lastRenderIndex+1),f={layer:t[0],viewport:e,isPicking:s,renderPass:r,cullRect:o},d={};for(let m=0;m<t.length;m++){const g=t[m],y=this._shouldDrawLayer(g,f,i,d),S={shouldDrawLayer:y};y&&!l&&(S.shouldDrawLayer=!0,S.layerRenderIndex=h(g,y),S.shaderModuleProps=this._getShaderModuleProps(g,a,r,c),S.layerParameters={...(p=g.context.deck)==null?void 0:p.props.parameters,...this.getLayerParameters(g,m,e)}),u[m]=S}return u}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:s,target:i,viewport:o,view:a},c){const l=$x(this.device,{shaderModuleProps:r,target:i,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:i,parameters:{viewport:l,scissorRect:l},clearColor:h.color?[0,0,0,0]:!1,clearDepth:h.depth?1:!1}).end()}const u={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let h=0;h<t.length;h++){const f=t[h],d=c[h],{shouldDrawLayer:p}=d;if(p&&f.props.pickable&&u.pickableCount++,f.isComposite&&u.compositeCount++,f.isDrawable&&d.shouldDrawLayer){const{layerRenderIndex:m,shaderModuleProps:g,layerParameters:y}=d;u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,m),g.project&&(g.project.viewport=o),f.context.renderPass=e;try{f._drawLayer({renderPass:e,shaderModuleProps:g,uniforms:{layerIndex:m},parameters:y})}catch(S){f.raiseError(S,`drawing ${f} to ${s}`)}}}return u}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(t))return!1;t.layer=o,o=o.parent}if(r){const a=t.layer.id;if(a in s||(s[a]=r(t)),!s[a])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,s){var c,l;const i=this.device.canvasContext.cssToDeviceRatio(),o=((c=e.internalState)==null?void 0:c.propsInTransition)||e.props,a={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:i,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const u of t)Hu(a,(l=u.getShaderModuleProps)==null?void 0:l.call(u,e,a));return Hu(a,this.getShaderModuleProps(e,t,a),s)}}function Hp(n=0,e={}){const t={},r=(s,i)=>{const o=s.props._offset,a=s.id,c=s.parent&&s.parent.id;let l;if(c&&!(c in e)&&r(s.parent,!1),c in t){const u=t[c]=t[c]||Hp(e[c],e);l=u(s,i),t[a]=u}else Number.isFinite(o)?(l=o+(e[c]||0),t[a]=null):l=n;return i&&l>=n&&(n=l+1),e[a]=l,l};return r}function $x(n,{shaderModuleProps:e,target:t,viewport:r}){var c;const s=((c=e==null?void 0:e.project)==null?void 0:c.devicePixelRatio)??n.canvasContext.cssToDeviceRatio(),[,i]=n.canvasContext.getDrawingBufferSize(),o=t?t.height:i,a=r;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function Hu(n,...e){for(const t of e)if(t)for(const r in t)n[r]?Object.assign(n[r],t[r]):n[r]=t[r];return n}class jx extends Lc{constructor(e,t){super(e,t);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],i=s.width*r,o=s.height*r,a=[1,1,1,1];(i!==t.width||o!==t.height)&&t.resize({width:i,height:o}),super.render({...e,clearColor:a,target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const Wx={color:[255,255,255],intensity:1},zu=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Hx=[0,0,0,200/255];class Vc{constructor(e={}){this.id="lighting-effect",this.shadowColor=Hx,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(ju),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:s,views:i}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:t,viewports:r,onViewportActive:s,views:i,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},i=e.props.material;return{shadow:r,lighting:s,phongMaterial:i,gouraudMaterial:i}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(ju))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new At().lookAt({eye:new St(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new jx(e);this.shadowPasses[t]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new Wp(Wx),this.directionalLights.push(new Wu(zu[0]),new Wu(zu[1])))}}class zx{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:s,padding:i=0,copy:o=!1,initialize:a=!1,maxCount:c}){const l=s||e&&e.constructor||Float32Array,u=t*r+i;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,u)}let h=1/0;c&&(h=c*r+i);const f=this._allocate(l,u,a,h);return e&&o?f.set(e):a||f.fill(0,0,4),this._release(e),f}release(e){this._release(e)}_allocate(e,t,r,s){let i=Math.max(Math.ceil(t*this.opts.overAlloc),1);i>s&&(i=s);const o=this._pool,a=e.BYTES_PER_ELEMENT*i,c=o.findIndex(l=>l.byteLength>=a);if(c>=0){const l=new e(o.splice(c,1)[0],0,i);return r&&l.fill(0),l}return new e(i)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:s}=r,i=t.findIndex(o=>o.byteLength>=s);i<0?t.push(r):(i>0||t.length<this.opts.poolSize)&&t.splice(i,0,r),t.length>this.opts.poolSize&&t.shift()}}const Jr=new zx;function Pr(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Xx(n){return[n[12],n[13],n[14]]}function qx(n){return{left:On(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:On(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:On(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:On(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:On(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:On(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Xu=new St;function On(n,e,t,r){Xu.set(n,e,t);const s=Xu.len();return{distance:r/s,normal:new St(-n/s,-e/s,-t/s)}}function Yx(n){return n-Math.fround(n)}let wr;function Uo(n,e){const{size:t=1,startIndex:r=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,i=(s-r)/t;wr=Jr.allocate(wr,i,{type:Float32Array,size:t*2});let o=r,a=0;for(;o<s;){for(let c=0;c<t;c++){const l=n[o++];wr[a+c]=l,wr[a+c+t]=Yx(l)}a+=t*2}return wr.subarray(0,i*t*2)}function Kx(n){let e=null,t=!1;for(const r of n)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const Zx=Math.PI/180,Jx=Pr(),qu=[0,0,0],Qx={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Gx({width:n,height:e,orthographic:t,fovyRadians:r,focalDistance:s,padding:i,near:o,far:a}){const c=n/e,l=t?new At().orthographic({fovy:r,aspect:c,focalDistance:s,near:o,far:a}):new At().perspective({fovy:r,aspect:c,near:o,far:a});if(i){const{left:u=0,right:h=0,top:f=0,bottom:d=0}=i,p=Kt((u+n-h)/2,0,n)-n/2,m=Kt((f+e-d)/2,0,e)-e/2;l[8]-=p*2/n,l[9]+=m*2/e}return l}class pr{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Qx,this.focalDistance=e.focalDistance||1,this.position=e.position||qu,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?nt.WEB_MERCATOR:nt.WEB_MERCATOR_AUTO_OFFSET:nt.IDENTITY}equals(e){return e instanceof pr?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Kr(e.projectionMatrix,this.projectionMatrix)&&Kr(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),s=$p(r,this.pixelProjectionMatrix),[i,o]=s,a=t?o:this.height-o;return e.length===2?[i,a]:[i,a,s[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[s,i,o]=e,a=t?i:this.height-i,c=r&&r*this.distanceScales.unitsPerMeter[2],l=Bc([s,a,o],this.pixelUnprojectionMatrix,c),[u,h,f]=this.unprojectPosition(l);return Number.isFinite(o)?[u,h,f]:Number.isFinite(r)?[u,h,r]:[u,h]}projectPosition(e){const[t,r]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,s]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,s]}projectFlat(e){if(this.isGeospatial){const t=fi(e);return t[1]=Kt(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?or(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),s=this.unproject([this.width,0],t),i=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(r[0],s[0],i[0],o[0]),Math.min(r[1],s[1],i[1],o[1]),Math.max(r[0],s[0],i[0],o[0]),Math.max(r[1],s[1],i[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?Va({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:s=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,qx(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=lx({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Va({latitude:r,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:i,modelMatrix:o}=e;let a=qu;if(i&&(a=o?new At(o).transformAsVector(i,[]):i),this.isGeospatial){const c=this.projectPosition([t,r,0]);this.center=new St(a).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:t=Jx,projectionMatrix:r=null,orthographic:s=!1,fovyRadians:i,fovy:o=75,near:a=.1,far:c=1e3,padding:l=null,focalDistance:u=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new At().multiplyRight(t).translate(new St(this.center).negate()),this.projectionMatrix=r||Gx({width:this.width,height:this.height,orthographic:s,fovyRadians:i||o*Zx,focalDistance:u,padding:l,near:a,far:c});const h=Pr();fn(h,h,this.projectionMatrix),fn(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=Oa([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Xx(this.viewMatrixInverse);const f=Pr(),d=Pr();Dc(f,f,[this.width/2,-this.height/2,1]),li(f,f,[1,-1,0]),fn(d,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Oa(Pr(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||fe.warn("Pixel project matrix not invertible")()}}pr.displayName="Viewport";class ar extends pr{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:s=0,pitch:i=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:c=1.01,nearZ:l,farZ:u,orthographic:h=!1,projectionMatrix:f,repeat:d=!1,worldOffset:p=0,position:m,padding:g,legacyMeterSizes:y=!1}=e;let{width:S,height:v,altitude:x=1.5}=e;const T=Math.pow(2,s);S=S||1,v=v||1;let I,M=null;if(f)x=f[5]/2,I=di(x);else{e.fovy?(I=e.fovy,x=Vp(I)):I=di(x);let L;if(g){const{top:j=0,bottom:$=0}=g;L=[0,Kt((j+v-$)/2,0,v)-v/2]}M=hx({width:S,height:v,scale:T,center:m&&[0,0,m[2]*Fo(t)],offset:L,pitch:i,fovy:I,nearZMultiplier:a,farZMultiplier:c}),Number.isFinite(l)&&(M.near=l),Number.isFinite(u)&&(M.far=u)}let N=ux({height:v,pitch:i,bearing:o,scale:T,altitude:x});p&&(N=new At().translate([512*p,0,0]).multiplyLeft(N)),super({...e,width:S,height:v,viewMatrix:N,longitude:r,latitude:t,zoom:s,...M,fovy:I,focalDistance:x}),this.latitude=t,this.longitude=r,this.zoom=s,this.pitch=i,this.bearing=o,this.altitude=x,this.fovy=I,this.orthographic=h,this._subViewports=d?[]:null,this._pseudoMeters=y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let s=t;s<=r;s++){const i=s?new ar({...this,worldOffset:s}):this;this._subViewports.push(i)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),s=(e[2]||0)*Fo(e[1]);return[t,r,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),s=(e[2]||0)/Fo(r);return[t,r,s]}addMetersToLngLat(e,t){return Lp(e,t)}panByPosition(e,t){const r=Bc(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),i=mu([],s,$0([],r)),o=mu([],this.center,i),[a,c]=this.unprojectFlat(o);return{longitude:a,latitude:c}}getBounds(e={}){const t=px(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:s}=this,{longitude:i,latitude:o,zoom:a}=fx({width:r,height:s,bounds:e,...t});return new ar({width:r,height:s,longitude:i,latitude:o,zoom:a})}}ar.displayName="WebMercatorViewport";const Yu=[0,0,0];function Bo(n,e,t=!1){const r=e.projectPosition(n);if(t&&e instanceof ar){const[s,i,o=0]=n,a=e.getDistanceScales([s,i]);r[2]=o*a.unitsPerMeter[2]}return r}function eS(n){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=n;let{coordinateSystem:s,fromCoordinateSystem:i,fromCoordinateOrigin:o}=n;return s===ne.DEFAULT&&(s=e.isGeospatial?ne.LNGLAT:ne.CARTESIAN),i===void 0&&(i=s),o===void 0&&(o=r),{viewport:e,coordinateSystem:s,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:i,fromCoordinateOrigin:o}}function zp(n,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:s,offsetMode:i}){let[o,a,c=0]=n;switch(t&&([o,a,c]=is([],[o,a,c,1],t)),r){case ne.LNGLAT:return Bo([o,a,c],e,i);case ne.LNGLAT_OFFSETS:return Bo([o+s[0],a+s[1],c+(s[2]||0)],e,i);case ne.METER_OFFSETS:return Bo(Lp(s,[o,a,c]),e,i);case ne.CARTESIAN:default:return e.isGeospatial?[o+s[0],a+s[1],c+s[2]]:e.projectPosition([o,a,c])}}function Xp(n,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:s,modelMatrix:i,fromCoordinateSystem:o,fromCoordinateOrigin:a}=eS(e),{autoOffset:c=!0}=e,{geospatialOrigin:l=Yu,shaderCoordinateOrigin:u=Yu,offsetMode:h=!1}=c?Up(t,r,s):{},f=zp(n,{viewport:t,modelMatrix:i,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const d=t.projectPosition(l||u);nw(f,f,d)}return f}const tS=[255,255,255],nS=1,rS=[1,0,0],sS=[0,0,1];let iS=0;class qp{constructor(e={}){this.type="point";const{color:t=tS}=e,{intensity:r=nS}=e,{position:s=sS}=e;this.id=e.id||`point-${iS++}`,this.color=t,this.intensity=r,this.type="point",this.position=s,this.attenuation=oS(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:t}=this,r=e.context.viewport,{coordinateSystem:s,coordinateOrigin:i}=e.props,o=Xp(this.position,{viewport:r,coordinateSystem:s,coordinateOrigin:i,fromCoordinateSystem:r.isGeospatial?ne.LNGLAT:ne.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return t.color=this.color,t.intensity=this.intensity,t.position=o,t}}function oS(n){return n.attenuation?n.attenuation:rS}let aS=1,cS=1;class Yp{constructor(){_(this,"time",0);_(this,"channels",new Map);_(this,"animations",new Map);_(this,"playing",!1);_(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:s=1,repeat:i=1}=e,o=aS++,a={time:0,delay:t,duration:r,rate:s,repeat:i};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const r=this.animations.values();for(const s of r){const{animation:i,channel:o}=s;i.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=cS++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,s=e.duration*e.repeat;r>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function lS(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function uS(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let hS=0;const fS={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:wa.stats.get(`animation-loop-${hS++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class dS{constructor(e){_(this,"device",null);_(this,"canvas",null);_(this,"props");_(this,"animationProps",null);_(this,"timeline",null);_(this,"stats");_(this,"cpuTime");_(this,"gpuTime");_(this,"frameRate");_(this,"display");_(this,"needsRedraw","initialized");_(this,"_initialized",!1);_(this,"_running",!1);_(this,"_animationFrameId",null);_(this,"_nextFramePromise",null);_(this,"_resolveNextFrame",null);_(this,"_cpuStartTime",0);_(this,"_error",null);if(this.props={...fS,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Hi({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,s;if(this.props.onError(e),this._error=Error(),((s=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:s.canvas)instanceof HTMLCanvasElement){const i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=lS(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(uS(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,r;const e=(r=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){var i,o,a,c;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((o=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const s=(c=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:c.canvas;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Lo={};function Ki(n="id"){Lo[n]=Lo[n]||1;const e=Lo[n]++;return`${n}-${e}`}class Ku{constructor(e){_(this,"id");_(this,"userData",{});_(this,"topology");_(this,"bufferLayout",[]);_(this,"vertexCount");_(this,"indices");_(this,"attributes");if(this.id=e.id||Ki("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&xe.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function pS(n,e){if(e instanceof Ku)return e;const t=gS(n,e),{attributes:r,bufferLayout:s}=mS(n,e);return new Ku({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:r})}function gS(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:xe.INDEX,data:t})}function mS(n,e){const t=[],r={};for(const[i,o]of Object.entries(e.attributes)){let a=i;switch(i){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(o){r[a]=n.createBuffer({data:o.value,id:`${i}-buffer`});const{value:c,size:l,normalized:u}=o;t.push({name:a,format:n0(c,l,u)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:t,vertexCount:s}}const $i=class $i{constructor(e){_(this,"device");_(this,"destroyPolicy");_(this,"_hashCounter",0);_(this,"_hashes",{});_(this,"_renderPipelineCache",{});_(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new $i(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...er.defaultProps,...e},r=this._hashRenderPipeline(t);if(!this._renderPipelineCache[r]){const s=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=r,this._renderPipelineCache[r]={pipeline:s,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const t={...ti.defaultProps,...e},r=this._hashComputePipeline(t);if(!this._computePipelineCache[r]){const s=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=r,this._computePipelineCache[r]={pipeline:s,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const t=e.hash,r=e instanceof ti?this._computePipelineCache:this._renderPipelineCache;r[t].useCount--,r[t].useCount===0&&this.destroyPolicy==="unused"&&(r[t].pipeline.destroy(),delete r[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,s="-",i=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${r}V${s}BL${i}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${t}/${r}V${s}T${e.topology}P${o}BL${i}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};_($i,"defaultProps",{...er.defaultProps});let $a=$i;const ji=class ji{constructor(e){_(this,"device");_(this,"destroyPolicy");_(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new ji(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let r=this._cache[t];if(!r){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:s,useCount:0}}return r.useCount++,r.shader}release(e){const t=this._hashShader(e),r=this._cache[t];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};_(ji,"defaultProps",{...Qs.defaultProps});let ja=ji;function _S(n,e){var s;const t={},r="Values";if(n.attributes.length===0&&!((s=n.varyings)!=null&&s.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const i of n.attributes)if(i){const o=`${i.location} ${i.name}: ${i.type}`;t[`in ${o}`]={[r]:i.stepMode||"vertex"}}for(const i of n.varyings||[]){const o=`${i.location} ${i.name}`;t[`out ${o}`]={[r]:JSON.stringify(i)}}return t}let ke=null,nn=null;function bS(n,{id:e,minimap:t,opaque:r,top:s="0",left:i="0",rgbaScale:o=1}){ke||(ke=document.createElement("canvas"),ke.id=e,ke.title=e,ke.style.zIndex="100",ke.style.position="absolute",ke.style.top=s,ke.style.left=i,ke.style.border="blue 5px solid",ke.style.transform="scaleY(-1)",document.body.appendChild(ke),nn=ke.getContext("2d")),(ke.width!==n.width||ke.height!==n.height)&&(ke.width=n.width/2,ke.height=n.height/2,ke.style.width="400px",ke.style.height="400px");const a=n.device.readPixelsToArrayWebGL(n),c=nn==null?void 0:nn.createImageData(n.width,n.height);if(c){for(let u=0;u<a.length;u+=4)c.data[0+u+0]=a[u+0]*o,c.data[0+u+1]=a[u+1]*o,c.data[0+u+2]=a[u+2]*o,c.data[0+u+3]=r?255:a[u+3]*o;nn==null||nn.putImageData(c,0,0)}}function Wa(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Wa(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const i of r)if(!e.hasOwnProperty(i)||!Wa(n[i],e[i],t-1))return!1;return!0}return!1}function yS(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function vS(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function Kp(n){return yS(n)||vS(n)}function wS(n){return Kp(n)||typeof n=="number"||typeof n=="boolean"}function Zp(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];wS(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}class TS{constructor(e,t){_(this,"options",{disableWarnings:!1});_(this,"modules");_(this,"moduleUniforms");_(this,"moduleBindings");Object.assign(this.options,t);const r=Ac(Object.values(e).filter(s=>s.dependencies));for(const s of r)e[s.name]=s;F.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,i]of Object.entries(e))this._addModule(i),i.name&&s!==i.name&&!this.options.disableWarnings&&F.warn(`Module name: ${s} vs ${i.name}`)()}destroy(){}setProps(e){var t;for(const r of Object.keys(e)){const s=r,i=e[s]||{},o=this.modules[s];if(!o){this.options.disableWarnings||F.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[s],c=this.moduleBindings[s],l=((t=o.getUniforms)==null?void 0:t.call(o,i,a))||i,{uniforms:u,bindings:h}=Zp(l);this.moduleUniforms[s]={...a,...u},this.moduleBindings[s]={...c,...h}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[r,s]of Object.entries(this.moduleUniforms))for(const[i,o]of Object.entries(s))e[`${r}.${i}`]={type:(t=this.modules[r].uniformTypes)==null?void 0:t[i],value:String(o)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let xS="";async function SS(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:xS+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class Vo{constructor(e,t){_(this,"device");_(this,"id");_(this,"texture");_(this,"sampler");_(this,"view");_(this,"ready");_(this,"isReady",!1);_(this,"destroyed",!1);_(this,"resolveReady",()=>{});_(this,"rejectReady",()=>{});this.device=e,this.id=t.id||Ki("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:SS(t.data)}),this.ready=new Promise((r,s)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=s}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let t,r;const s=e.data,i=await Jp(s).then(t,r);if(this.destroyed)return;const o={...e,data:i};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function Jp(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(Jp));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),r=Object.keys(e),s={};for(let i=0;i<r.length;i++)s[r[i]]=t[i];return s}return n}const rn=2,AS=1e4,Wi=class Wi{constructor(e,t){_(this,"device");_(this,"id");_(this,"source");_(this,"vs");_(this,"fs");_(this,"pipelineFactory");_(this,"shaderFactory");_(this,"userData",{});_(this,"parameters");_(this,"topology");_(this,"bufferLayout");_(this,"isInstanced");_(this,"instanceCount",0);_(this,"vertexCount");_(this,"indexBuffer",null);_(this,"bufferAttributes",{});_(this,"constantAttributes",{});_(this,"bindings",{});_(this,"uniforms",{});_(this,"vertexArray");_(this,"transformFeedback",null);_(this,"pipeline");_(this,"shaderInputs");_(this,"_uniformStore");_(this,"_attributeInfos",{});_(this,"_gpuGeometry",null);_(this,"_getModuleUniforms");_(this,"props");_(this,"_pipelineNeedsUpdate","newly created");_(this,"_needsRedraw","initializing");_(this,"_destroyed",!1);_(this,"_lastDrawTimestamp",-1);_(this,"_lastLogTime",0);_(this,"_logOpen",!1);_(this,"_drawCount",0);var c,l,u,h;this.props={...Wi.defaultProps,...t},t=this.props,this.id=t.id||Ki("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(((c=this.props.modules)==null?void 0:c.map(f=>[f.name,f]))||[]),s=t.shaderInputs||new TS(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const i=RS(e),o=(((l=this.props.modules)==null?void 0:l.length)>0?this.props.modules:(u=this.shaderInputs)==null?void 0:u.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:f,getUniforms:d}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:i,...this.props,modules:o});this.source=f,this._getModuleUniforms=d,(h=this.props).shaderLayout||(h.shaderLayout=O0(this.source))}else{const{vs:f,fs:d,getUniforms:p}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:i,...this.props,modules:o});this.vs=f,this.fs=d,this._getModuleUniforms=p}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||$a.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||ja.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return F.info(rn,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),Ha(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:i}=this.vertexArray,o=i?i.byteLength/(i.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const t=e&&pS(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const s=new Ao(this.bufferLayout);this.bufferLayout=s.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Ao(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Wa(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new t0(this.shaderInputs.modules);for(const[t,r]of Object.entries(this.shaderInputs.modules))if(ES(r)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const r=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&F.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const s=new Ao(this.bufferLayout);for(const[i,o]of Object.entries(e)){const a=s.getBufferLayout(i);if(!a){r||F.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}const c=s.getAttributeNamesForBuffer(a);let l=!1;for(const u of c){const h=this._attributeInfos[u];h&&(this.vertexArray.setBuffer(h.location,o),l=!0)}!l&&!r&&F.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[r,s]of Object.entries(e)){const i=this._attributeInfos[r];i?this.vertexArray.setConstantWebGL(i.location,s):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||F.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Ha(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:r}=Zp(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Vo&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,r]of Object.entries(this.bindings))r instanceof Vo?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Js?e=Math.max(e,t.texture.updateTimestamp):t instanceof xe||t instanceof we?e=Math.max(e,t.updateTimestamp):t instanceof Vo?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Gs||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[r]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===r)&&r!=="positions"&&delete t[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(F.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=r:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:s}),this._attributeInfos=Hd(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=F.level>3?0:AS;F.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,F.group(rn,`>>> DRAWING MODEL ${this.id}`,{collapsed:F.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=_S(this.pipeline.shaderLayout,this.id);F.table(rn,e)();const t=this.shaderInputs.getDebugTable();for(const[s,i]of Object.entries(this.uniforms))t[s]={value:i};F.table(rn,t)();const r=this._getAttributeDebugTable();F.table(rn,this._attributeInfos)(),F.table(rn,r)(),F.groupEnd(rn)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const r=e.props.framebuffer;r&&bS(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,r]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:s?this._getBufferOrConstantValues(s,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,r=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){const r=qd(t);return(e instanceof xe?new r(e.debugData):e).toString()}};_(Wi,"defaultProps",{...er.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Zs.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Mt=Wi;function ES(n){return!!(n.uniformTypes&&!Ha(n.uniformTypes))}function RS(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function Ha(n){for(const e in n)return!1;return!0}const qr=class qr{constructor(e,t=qr.defaultProps){_(this,"device");_(this,"model");_(this,"transformFeedback");if(!qr.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Mt(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||Fd(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof xe)return t.readAsync();const{buffer:r,byteOffset:s=0,byteLength:i=r.byteLength}=t;return r.readAsync(s,i)}};_(qr,"defaultProps",{...Mt.defaultProps,outputs:void 0,feedbackBuffers:void 0});let cr=qr;const CS="transform_output";class Zu{constructor(e,t){_(this,"device");_(this,"model");_(this,"sampler");_(this,"currentIndex",0);_(this,"samplerTextureMap",null);_(this,"bindings",[]);_(this,"resources",{});this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Mt(this.device,{id:t.id||"texture-transform-model",fs:t.fs||Fd({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:CS}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){var e;this.model.destroy();for(const t of this.bindings)(e=t.framebuffer)==null||e.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],r=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(r),r.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:r,targetTexture:s}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,t),s){e.targetTexture=s;const{width:i,height:o}=s;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:i,height:o,colorAttachments:[s]}),e.framebuffer.resize({width:i,height:o})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const r in t)t[r].sampler=this.sampler}}class IS{constructor(e){_(this,"id");_(this,"topology");_(this,"vertexCount");_(this,"indices");_(this,"attributes");_(this,"userData",{});const{attributes:t={},indices:r=null,vertexCount:s=null}=e;this.id=e.id||Ki("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[i,o]of Object.entries(t)){const a=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(i)}: must be typed array or object with value as typed array`);if((i==="POSITION"||i==="positions")&&!a.size&&(a.size=3),i==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[i]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const s of Object.values(e)){const{value:i,size:o,constant:a}=s;!a&&i&&o!==void 0&&o>=1&&(r=Math.min(r,i.length/o))}return r}}const PS={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class Qp extends Lc{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:s,onViewportActive:i,pickingFBO:o,deviceRect:{x:a,y:c,width:l,height:u},cullRect:h,effects:f,pass:d="picking",pickZ:p,shaderModuleProps:m}){this.pickZ=p;const g=this._resetColorEncoder(p),y=[a,c,l,u],S=super.render({target:o,layers:e,layerFilter:t,views:r,viewports:s,onViewportActive:i,cullRect:h,effects:f==null?void 0:f.filter(x=>x.useInPicking),pass:d,isPicking:!0,shaderModuleProps:m,clearColor:[0,0,0,0],colorMask:15,scissorRect:y});return this._colorEncoderState=null,{decodePickingColor:g&&kS.bind(null,g),stats:S}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){const s={...e.props.parameters},{pickable:i,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?s.blend=!1:i&&o.includes("draw")&&(Object.assign(s,PS),s.blend=!0,s.blendColor=OS(this._colorEncoderState,e,r)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function OS(n,e,t){const{byLayer:r,byAlpha:s}=n;let i,o=r.get(e);return o?(o.viewports.push(t),i=o.a):(i=r.size+1,i<=255?(o={a:i,layer:e,viewports:[t]},r.set(e,o),s[i]=o):(fe.warn("Too many pickable layers, only picking the first 255")(),i=0)),[0,0,0,i/255]}function kS(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const jn={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},pi=Symbol.for("component"),Gt=Symbol.for("propTypes"),$o=Symbol.for("deprecatedProps"),Jn=Symbol.for("asyncPropDefaults"),_n=Symbol.for("asyncPropOriginal"),Zt=Symbol.for("asyncPropResolved");function $c(n,e=()=>!0){return Array.isArray(n)?Gp(n,e,[]):e(n)?[n]:[]}function Gp(n,e,t){let r=-1;for(;++r<n.length;){const s=n[r];Array.isArray(s)?Gp(s,e,t):e(s)&&t.push(s)}return t}function MS({target:n,source:e,start:t=0,count:r=1}){const s=e.length,i=r*s;let o=0;for(let a=t;o<s;o++)n[a++]=e[o];for(;o<i;)o<i-o?(n.copyWithin(t+o,t,t+o),o*=2):(n.copyWithin(t+o,t,t+i-o),o=i);return n}class NS{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let s=e;typeof e=="string"&&(s=pa(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(i=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=i)}).catch(i=>{this._loadCount===r&&(this.isLoaded=!0,this._error=i||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const i of this._subscribers)i.onChange(this.getData())}}class DS{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:s=!0}){let i=this._resources[e];i?i.setData(t,r):(i=new NS(e,t,this._context),this._resources[e]=i),i.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const s=t[r],i=this._resources[s.resourceId];i&&i.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:s="default"}){const{_resources:i,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),i[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=i[e];if(this._track(r,s,a,t),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,s){const i=this._consumers,o=i[e]=i[e]||{};let a=o[t];const c=a&&a.resourceId&&this._resources[a.resourceId];c&&(c.unsubscribe(a),this.prune()),r&&(a?(a.onChange=s,a.resourceId=r.id):a={onChange:s,resourceId:r.id},o[t]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const FS="layerManager.setLayers",US="layerManager.activateViewport";class BS{constructor(e,t){var a;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{We(US,this,c),c&&(this.context.viewport=c)};const{deck:r,stats:s,viewport:i,timeline:o}=t||{};this.layers=[],this.resourceManager=new DS({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:kx(((a=e==null?void 0:e.info)==null?void 0:a.shadingLanguage)||"glsl"),defaultShaderModules:[$w],renderPass:void 0,stats:s||new Hi({id:"deck.gl"}),viewport:i||new pr({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Yp,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const s=r.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){We(FS,this,t,e),this._lastRenderedLayers=e;const r=$c(e,Boolean);for(const s of r)s.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(r=>r.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,r=t.findIndex(s=>s.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){const r={};for(const o of e)r[o.id]?fe.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,r,s),this._finalizeOldLayers(r);let i=!1;for(const o of s)if(o.hasUniformTransition()){i=`Uniform transition in ${o}`;break}this._needsUpdate=i,this.layers=s}_updateSublayersRecursively(e,t,r){for(const s of e){s.context=this.context;const i=t[s.id];i===null&&fe.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let o=null;try{this._debug&&i!==s&&s.validateProps(),i?(this._transferLayerState(i,s),this._updateLayer(s)):this._initializeLayer(s),r.push(s),o=s.isComposite?s.getSubLayers():null}catch(a){this._handleError("matching",a,s)}o&&this._updateSublayersRecursively(o,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=jn.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=jn.MATCHED,t!==e&&(e.lifecycle=jn.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=jn.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=jn.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Ye(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Ye(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const i of r)if(!e.hasOwnProperty(i)||!Ye(n[i],e[i],t-1))return!1;return!0}return!1}class LS{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),s={x:e[0],y:e[1]};for(let i=r.length-1;i>=0;--i){const o=r[i];if(o.containsPixel(s)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=$c(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ye(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):fe.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:i=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:i,width:this.width,height:this.height})}})}_updateController(e,t,r,s){const i=e.controller;if(i&&r){const o={...t,...i,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!s||s.constructor!==i.type)&&(s=this._createController(e,o)),s&&s.setProps(o),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let s=e.length;s--;){const i=e[s],o=this.getViewState(i),a=i.makeViewport({viewState:o,width:this.width,height:this.height});let c=t[i.id];const l=!!i.controller;l&&!c&&(r=!0),(r||!l)&&c&&(c.finalize(),c=null),this.controllers[i.id]=this._updateController(i,o,a,c),a&&this._viewports.unshift(a)}for(const s in t){const i=t[s];i&&!this.controllers[s]&&i.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,s)=>!e[s].equals(t[s]))}}const VS=/([0-9]+\.?[0-9]*)(%|px)/;function Ut(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=VS.exec(n);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function Bt(n,e){return n.relative?Math.round(n.position*e):n.position}class lr{constructor(e){const{id:t,x:r=0,y:s=0,width:i="100%",height:o="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Ut(r),this._y=Ut(s),this._width=Ut(i),this._height=Ut(o),this._padding=a&&{left:Ut(a.left||0),right:Ut(a.right||0),top:Ut(a.top||0),bottom:Ut(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ye(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const i=this.getViewportType(r);return new i({...r,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:Bt(this._x,e),y:Bt(this._y,t),width:Bt(this._width,e),height:Bt(this._height,t)};return this._padding&&(r.padding={left:Bt(this._padding.left,e),top:Bt(this._padding.top,t),right:Bt(this._padding.right,e),bottom:Bt(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Zi{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(t=this.settings).onStart)==null||r.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:s}=this;this._handle=r.addChannel({delay:r.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Ju=()=>{},za={BREAK:1,SNAP_TO_END:2,IGNORE:3},$S=n=>n,jS=za.BREAK;class WS{constructor(e){this._onTransitionUpdate=t=>{const{time:r,settings:{interpolator:s,startProps:i,endProps:o,duration:a,easing:c}}=t,l=c(r/a),u=s.interpolateProps(i,o,l);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Zi(e.timeline),this.onViewStateChange=e.onViewStateChange||Ju,this.onStateChange=e.onStateChange||Ju}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let s=r;if(this.transition.inProgress){const{interruption:i,endProps:o}=this.transition.settings;s={...r,...i===za.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===za.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(r),i=t.transitionInterpolator,o=i.getDuration?i.getDuration(e,t):t.transitionDuration;if(o===0)return;const a=i.initializeProps(e,s);this.propsInTransition={};const c={duration:o,easing:t.transitionEasing||$S,interpolator:i,interruption:t.transitionInterruption||jS,startProps:a.start,endProps:a.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function He(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class HS{constructor(e){const{compare:t,extract:r,required:s}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=s}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!Kr(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},s={};for(const i of this._propsToExtract)(i in e||i in t)&&(r[i]=e[i],s[i]=t[i]);return this._checkRequiredProps(r),this._checkRequiredProps(s),{start:r,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];He(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}const zS=["longitude","latitude","zoom","bearing","pitch"],XS=["longitude","latitude","zoom"];class eg extends HS{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:zS,required:XS},super(r.transitionProps),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:s,around:i}=this.opts;if(s&&i){const o=s(e),a=s(t),c=o.unproject(i);r.start.around=i,Object.assign(r.end,{around:a.project(c),aroundPosition:c,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const s={};for(const i of this._propsToExtract)s[i]=ci(e[i]||0,t[i]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const i=this.opts.makeViewport({...t,...s});Object.assign(s,i.panByPosition(t.aroundPosition,ci(e.around,t.around,r)))}return s}}const Lt={transitionDuration:0},qS=300,ys=n=>1-(1-n)*(1-n),kn={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},sn={};class YS{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new WS({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-r]}isPointInBounds(e,t){const{width:r,height:s}=this.props;if(t&&t.handled)return!1;const i=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=s;return i&&t&&t.stopPropagation(),i}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?qS:0;const{scrollZoom:r=!0,dragPan:s=!0,dragRotate:i=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:c=!1,keyboard:l=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(kn.WHEEL,u&&r),this.toggleEvents(kn.PAN,u),this.toggleEvents(kn.PINCH,u&&(a||c)),this.toggleEvents(kn.MULTI_PAN,u&&c),this.toggleEvents(kn.DOUBLE_CLICK,u&&o),this.toggleEvents(kn.KEYBOARD,u&&l),this.scrollZoom=r,this.dragPan=s,this.dragRotate=i,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=c,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const s={...e.getViewportProps(),...t},i=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),i){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const s=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(s,Lt,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,Lt,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],i=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ys},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Lt,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],i=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ys},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:i}=e;let o=2/(1+Math.exp(-Math.abs(i*r)));i<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:t}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,Lt,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Lt,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),s=[r[0],r[1]+=e.velocityY*t/2],i=this.controllerState.rotate({pos:s});this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ys},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return sn._startPinchRotation=e.rotation,sn._lastPinchEvent=e,this.updateViewport(r,Lt,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:sn._startPinchRotation-r})}return this.updateViewport(t,Lt,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),sn._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=sn;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const s=this.getCenter(e);let i=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),c=Math.pow(2,o+a*t/2);i=i.zoom({pos:s,scale:c}).zoomEnd(),this.updateViewport(i,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:ys},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return sn._startPinchRotation=null,sn._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:s,rotateSpeedX:i,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let c;const l={};switch(e.srcEvent.code){case"Minus":c=t?a.zoomOut(r).zoomOut(r):a.zoomOut(r),l.isZooming=!0;break;case"Equal":c=t?a.zoomIn(r).zoomIn(r):a.zoomIn(r),l.isZooming=!0;break;case"ArrowLeft":t?(c=a.rotateLeft(i),l.isRotating=!0):(c=a.moveLeft(s),l.isPanning=!0);break;case"ArrowRight":t?(c=a.rotateRight(i),l.isRotating=!0):(c=a.moveRight(s),l.isPanning=!0);break;case"ArrowUp":t?(c=a.rotateUp(o),l.isRotating=!0):(c=a.moveUp(s),l.isPanning=!0);break;case"ArrowDown":t?(c=a.rotateDown(o),l.isRotating=!0):(c=a.moveDown(s),l.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Lt:e?{...t,transitionInterpolator:new eg({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class KS{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Qu=5,ZS=1.2;class JS extends KS{constructor(e){const{width:t,height:r,latitude:s,longitude:i,zoom:o,bearing:a=0,pitch:c=0,altitude:l=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:f=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:m,startZoomLngLat:g,startRotatePos:y,startBearing:S,startPitch:v,startZoom:x,normalize:T=!0}=e;He(Number.isFinite(i)),He(Number.isFinite(s)),He(Number.isFinite(o)),super({width:t,height:r,latitude:s,longitude:i,zoom:o,bearing:a,pitch:c,altitude:l,maxZoom:h,minZoom:f,maxPitch:d,minPitch:p,normalize:T,position:u},{startPanLngLat:m,startZoomLngLat:g,startRotatePos:y,startBearing:S,startPitch:v,startZoom:x}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:s,startBearing:i,startPitch:o}=this.getState();if(!s||i===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,s,o,i):a={bearing:i+t,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:s,startZoomLngLat:i}=this.getState();if(i||(s=this.getViewportProps().zoom,i=this._unproject(t)||this._unproject(e)),!i)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let c=s+Math.log2(r);c=Kt(c,a,o);const l=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...l.panByPosition(i,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:s,longitude:i}=r;return Math.abs(s-t.bearing)>180&&(r.bearing=s<0?s+360:s-360),Math.abs(i-t.longitude)>180&&(r.longitude=i<0?i+360:i-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:s}=e;e.zoom=Kt(s,r,t);const{maxPitch:i,minPitch:o,pitch:a}=e;e.pitch=Kt(a,o,i);const{normalize:c=!0}=e;return c&&Object.assign(e,gx(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,s){const i=e[0]-t[0],o=e[1]-t[1],a=e[1],c=t[1],{width:l,height:u}=this.getViewportProps(),h=i/l;let f=0;o>0?Math.abs(u-c)>Qu&&(f=o/(c-u)*ZS):o<0&&c>Qu&&(f=1-a/c),f=Kt(f,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps(),m=s+180*h;let g=r;return f>0?g=r+f*(p-r):f<0&&(g=r-f*(d-r)),{pitch:g,bearing:m}}}class QS extends YS{constructor(){super(...arguments),this.ControllerState=JS,this.transition={transitionDuration:300,transitionInterpolator:new eg({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class tg extends lr{constructor(e={}){super(e)}getViewportType(){return ar}get ControllerType(){return QS}}tg.displayName="MapView";const GS=new Vc;function e1(n,e){const t=n.order??1/0,r=e.order??1/0;return t-r}class t1{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(s=>e1(s,e)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ye(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const r=[];for(const s of e){const i=t[s.id];let o=s;i&&i!==s?i.setProps?(i.setProps(s.props),o=i):i.cleanup(this._context):i||s.setup(this._context),r.push(o),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(s=>s instanceof Vc)||this._resolvedEffects.push(GS),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class n1 extends Lc{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const r1="deckRenderer.renderLayers";class s1{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new n1(e),this.pickLayersPass=new Qp(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const s=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const i=t.render({...r,target:s});r.effects&&this._postRender(r.effects,r),this.renderCount++,We(r1,this,i,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[s]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:r}=this,s={...t,inputBuffer:r[0],swapBuffer:r[1]};for(const i of e)if(i.postRender){s.target=i.id===this.lastPostProcessEffect?t.target:void 0;const o=i.postRender(s);s.inputBuffer=o,s.swapBuffer=o===r[0]?r[1]:r[0]}}}const i1={pickedColor:null,pickedObjectIndex:-1};function o1({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:s,deviceRect:i}){const{x:o,y:a,width:c,height:l}=i;let u=s*s,h=-1,f=0;for(let d=0;d<l;d++){const p=d+a-r,m=p*p;if(m>u)f+=4*c;else for(let g=0;g<c;g++){if(n[f+3]-1>=0){const S=g+o-t,v=S*S+m;v<=u&&(u=v,h=f)}f+=4}}if(h>=0){const d=n.slice(h,h+4),p=e(d);if(p){const m=Math.floor(h/4/c),g=h/4-m*c;return{...p,pickedColor:d,pickedX:o+g,pickedY:a+m}}fe.error("Picked non-existent layer. Is picking buffer corrupt?")()}return i1}function a1({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let r=0;r<n.length;r+=4)if(n[r+3]-1>=0){const i=n.slice(r,r+4),o=i.join(",");if(!t.has(o)){const a=e(i);a?t.set(o,{...a,color:i}):fe.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function ng({pickInfo:n,viewports:e,pixelRatio:t,x:r,y:s,z:i}){let o=e[0];e.length>1&&(o=l1((n==null?void 0:n.pickedViewports)||e,{x:r,y:s}));let a;if(o){const c=[r-o.x,s-o.y];i!==void 0&&(c[2]=i),a=o.unproject(c)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:s,pixel:[r,s],coordinate:a,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function c1(n){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:s}=n,{pickedColor:i,pickedLayer:o,pickedObjectIndex:a}=e,c=o?[o]:[];if(r==="hover"){const h=t.index,f=t.layerId,d=o?o.props.id:null;if(d!==f||a!==h){if(d!==f){const p=s.find(m=>m.props.id===f);p&&c.unshift(p)}t.layerId=d,t.index=a,t.info=null}}const l=ng(n),u=new Map;return u.set(null,l),c.forEach(h=>{let f={...l};h===o&&(f.color=i,f.index=a,f.picked=!0),f=rg({layer:h,info:f,mode:r});const d=f.layer;h===o&&r==="hover"&&(t.info=f),u.set(d.id,f),r==="hover"&&d.updateAutoHighlight(f)}),u}function rg({layer:n,info:e,mode:t}){for(;n&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:r}),n=n.parent}return e}function l1(n,e){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r.containsPixel(e))return r}return n[0]}class u1{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Qp(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:s},i=this.lastPickedInfo.info){const o=i&&i.layer&&i.layer.id,a=i&&i.viewport&&i.viewport.id,c=o?r.find(f=>f.id===o):null,l=a&&s.find(f=>f.id===a)||s[0],u=l&&l.unproject([e-l.x,t-l.y]);return{...i,...{x:e,y:t,viewport:l,coordinate:u,layer:c}}}_resizeBuffer(){var t,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:s,y:i,radius:o=0,depth:a=1,mode:c="query",unproject3D:l,onViewportActive:u,effects:h}){const f=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||r.length===0)return{result:[],emptyInfo:ng({viewports:r,x:s,y:i,pixelRatio:f})};this._resizeBuffer();const p=this.device.canvasContext.cssToDevicePixels([s,i],!0),m=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],g=Math.round(o*f),{width:y,height:S}=this.pickingFBO,v=this._getPickingRect({deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceWidth:y,deviceHeight:S}),x={x:s-o,y:i-o,width:o*2+1,height:o*2+1};let T;const I=[],M=new Set;for(let N=0;N<a;N++){let L;if(v){const $=this._drawAndSample({layers:d,views:t,viewports:r,onViewportActive:u,deviceRect:v,cullRect:x,effects:h,pass:`picking:${c}`});L=o1({...$,deviceX:m[0],deviceY:m[1],deviceRadius:g,deviceRect:v})}else L={pickedColor:null,pickedObjectIndex:-1};let j;if(L.pickedLayer&&l&&this.depthFBO){const{pickedColors:$}=this._drawAndSample({layers:[L.pickedLayer],views:t,viewports:r,onViewportActive:u,deviceRect:{x:L.pickedX,y:L.pickedY,width:1,height:1},cullRect:x,effects:h,pass:`picking:${c}:z`},!0);$[3]&&(j=$[0])}L.pickedLayer&&N+1<a&&(M.add(L.pickedLayer),L.pickedLayer.disablePickingIndex(L.pickedObjectIndex)),T=c1({pickInfo:L,lastPickedInfo:this.lastPickedInfo,mode:c,layers:d,viewports:r,x:s,y:i,z:j,pixelRatio:f});for(const $ of T.values())$.layer&&I.push($);if(!L.pickedColor)break}for(const N of M)N.restorePickingColors();return{result:I,emptyInfo:T.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:s,y:i,width:o=1,height:a=1,mode:c="query",maxObjects:l=null,onViewportActive:u,effects:h}){const f=this._getPickable(e);if(!f||r.length===0)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([s,i],!0),m=p.x,g=p.y+p.height,y=this.device.canvasContext.cssToDevicePixels([s+o,i+a],!0),S=y.x+y.width,v=y.y,x={x:m,y:v,width:S-m,height:g-v},T=this._drawAndSample({layers:f,views:t,viewports:r,onViewportActive:u,deviceRect:x,cullRect:{x:s,y:i,width:o,height:a},effects:h,pass:`picking:${c}`}),I=a1(T),M=new Map,N=[],L=Number.isFinite(l);for(let j=0;j<I.length&&!(L&&N.length>=l);j++){const $=I[j];let K={color:$.pickedColor,layer:null,index:$.pickedObjectIndex,picked:!0,x:s,y:i,pixelRatio:d};K=rg({layer:$.pickedLayer,info:K,mode:c});const se=K.layer.id;M.has(se)||M.set(se,new Set);const Z=M.get(se),ie=K.object??K.index;Z.has(ie)||(Z.add(ie),N.push(K))}return N}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:s,deviceRect:i,cullRect:o,effects:a,pass:c},l=!1){const u=l?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:s,pickingFBO:u,deviceRect:i,cullRect:o,effects:a,pass:c,pickZ:l,preRenderStats:{},isPicking:!0};for(const S of a)S.useInPicking&&(h.preRenderStats[S.id]=S.preRender(h));const{decodePickingColor:f}=this.pickLayersPass.render(h),{x:d,y:p,width:m,height:g}=i,y=new(l?Float32Array:Uint8Array)(m*g*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:p,sourceWidth:m,sourceHeight:g,target:y}),{pickedColors:y,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:s,deviceHeight:i}){const o=Math.max(0,e-r),a=Math.max(0,t-r),c=Math.min(s,e+r+1)-o,l=Math.min(i,t+r+1)-a;return c<=0||l<=0?null:{x:o,y:a,width:c,height:l}}}const h1={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},f1="top-left",Gu="__root";class d1{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Ye(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const r of this.resolvedWidgets)t[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)t[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const s=t[r.id];s?s.viewId!==r.viewId||s.placement!==r.placement?(this._remove(s),this._add(r)):r!==s&&(s.setProps(r.props),r=s):this._add(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(const r in t){const s=t[r];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:t=null,placement:r=f1}=e,s=e.onAdd({deck:this.deck,viewId:t});s&&this._getContainer(t,r).append(s),e._element=s}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var o;const r=e||Gu;let s=this.containers[r];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(o=this.parentElement)==null||o.append(s),this.containers[r]=s);let i=s.querySelector(`.${t}`);return i||(i=document.createElement("div"),i.className=t,i.style.position="absolute",i.style.zIndex="2",Object.assign(i.style,h1[t]),s.append(i)),i}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const r in this.containers){const s=this.lastViewports[r]||null,i=r===Gu||s,o=this.containers[r];i?(o.style.display="block",o.style.left=`${s?s.x:0}px`,o.style.top=`${s?s.y:0}px`,o.style.width=`${s?s.width:e}px`,o.style.height=`${s?s.height:t}px`):o.style.display="none"}}onRedraw({viewports:e,layers:t}){var s,i;const r=e.reduce((o,a)=>(o[a.id]=a,o),{});for(const o of this.getWidgets()){const{viewId:a}=o;if(a){const c=r[a];c&&(o.onViewportChange&&o.onViewportChange(c),(s=o.onRedraw)==null||s.call(o,{viewports:[c],layers:t}))}else{if(o.onViewportChange)for(const c of e)o.onViewportChange(c);(i=o.onRedraw)==null||i.call(o,{viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){var r,s;for(const i of this.getWidgets()){const{viewId:o}=i;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((s=i.onHover)==null||s.call(i,e,t))}}onEvent(e,t){var s,i;const r=Ua[t.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((s=e.viewport)==null?void 0:s.id))&&((i=o[r])==null||i.call(o,e,t))}}}const p1={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class g1{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,p1),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;const s=r(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,r){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var zn;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(zn||(zn={}));const jc={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ae=(n,e,t)=>e?n.enable(t):n.disable(t),eh=(n,e,t)=>n.hint(t,e),Ze=(n,e,t)=>n.pixelStorei(t,e),th=(n,e,t)=>{const r=t===36006?36009:36008;return n.bindFramebuffer(r,e)},Tr=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function jo(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const m1={3042:Ae,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:Ae,2885:(n,e)=>n.cullFace(e),2929:Ae,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:Ae,35723:eh,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>{var t;return(t=n.bindTransformFeedback)==null?void 0:t.call(n,36386,e)},34229:(n,e)=>n.bindVertexArray(e),36006:th,36010:th,34964:Tr,36662:Tr,36663:Tr,35053:Tr,35055:Tr,2886:(n,e)=>n.frontFace(e),33170:eh,2849:(n,e)=>n.lineWidth(e),32823:Ae,32824:"polygonOffset",10752:"polygonOffset",35977:Ae,32926:Ae,32928:Ae,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ae,3088:(n,e)=>n.scissor(...e),2960:Ae,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:Ae,10754:Ae,12288:Ae,12289:Ae,12290:Ae,12291:Ae,12292:Ae,12293:Ae,12294:Ae,12295:Ae,3333:Ze,3317:Ze,37440:Ze,37441:Ze,37443:Ze,3330:Ze,3332:Ze,3331:Ze,3314:Ze,32878:Ze,3316:Ze,3315:Ze,32877:Ze,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=jo(e)?e:[e,e];const[t,r]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,r)},stencilFunc:(n,e)=>{e=jo(e)&&e.length===3?[...e,...e]:e;const[t,r,s,i,o,a]=e;n.stencilFuncSeparate(1028,t,r,s),n.stencilFuncSeparate(1029,i,o,a)},stencilOp:(n,e)=>{e=jo(e)&&e.length===3?[...e,...e]:e;const[t,r,s,i,o,a]=e;n.stencilOpSeparate(1028,t,r,s),n.stencilOpSeparate(1029,i,o,a)},viewport:(n,e)=>n.viewport(...e)};function ve(n,e,t){return e[n]!==void 0?e[n]:t[n]}const _1={blendEquation:(n,e,t)=>n.blendEquationSeparate(ve(32777,e,t),ve(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(ve(32969,e,t),ve(32968,e,t),ve(32971,e,t),ve(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(ve(32824,e,t),ve(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(ve(32938,e,t),ve(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,ve(2962,e,t),ve(2967,e,t),ve(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,ve(34816,e,t),ve(36003,e,t),ve(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,ve(2964,e,t),ve(2965,e,t),ve(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,ve(34817,e,t),ve(34818,e,t),ve(34819,e,t))},nh={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?n({[r]:t}):{valueChanged:!0}},blendColor:(n,e,t,r,s)=>n({32773:new Float32Array([e,t,r,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,r,s)=>n({32969:e,32968:t,32971:r,32970:s}),clearColor:(n,e,t,r,s)=>n({3106:new Float32Array([e,t,r,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,r,s)=>n({3107:[e,t,r,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,r,s)=>n({3088:new Int32Array([e,t,r,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,r)=>n({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(n,e,t,r,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,r)=>n({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(n,e,t,r,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:s}),viewport:(n,e,t,r,s)=>n({2978:[e,t,r,s]})},gt=(n,e)=>n.isEnabled(e),rh={3042:gt,2884:gt,2929:gt,3024:gt,32823:gt,32926:gt,32928:gt,3089:gt,2960:gt,35977:gt},b1=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function gr(n,e){if(v1(e))return;const t={};for(const s in e){const i=Number(s),o=m1[s];o&&(typeof o=="string"?t[o]=!0:o(n,e[s],i))}const r=n.state&&n.state.cache;if(r)for(const s in t){const i=_1[s];i(n,e,r)}}function sg(n,e=jc){if(typeof e=="number"){const s=e,i=rh[s];return i?i(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const s of t){const i=rh[s];r[s]=i?i(n,Number(s)):n.getParameter(Number(s))}return r}function y1(n){gr(n,jc)}function v1(n){for(const e in n)return!1;return!0}function w1(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&n.length===e.length){for(let s=0;s<n.length;++s)if(n[s]!==e[s])return!1;return!0}return!1}class dn{constructor(e,t){_(this,"gl");_(this,"program",null);_(this,"stateStack",[]);_(this,"enable",!0);_(this,"cache",null);_(this,"log");_(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];gr(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?sg(e):Object.assign({},jc),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,x1(e);for(const r in nh){const s=nh[r];T1(e,r,s)}sh(e,"getParameter"),sh(e,"isEnabled")}_updateCache(e){let t=!1,r;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const i in e){const o=e[i],a=this.cache[i];w1(o,a)||(t=!0,r=a,s&&!(i in s)&&(s[i]=a),this.cache[i]=o)}return{valueChanged:t,oldValue:r}}}function sh(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||b1.has(s))return t(s);const i=dn.get(n);return s in i.cache||(i.cache[s]=t(s)),i.enable?i.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function T1(n,e,t){if(!n[e])return;const r=n[e].bind(n);n[e]=function(...i){const o=dn.get(n),{valueChanged:a,oldValue:c}=t(o._updateCache,...i);return a&&r(...i),c},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function x1(n){const e=n.useProgram.bind(n);n.useProgram=function(r){const s=dn.get(n);s.program!==r&&(e(r),s.program=r)}}function S1(n,e,t){let r="";const s={preserveDrawingBuffer:!0,...t};let i=null;if(i||(i=n.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!i&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,i=n.getContext("webgl2",s),i.luma||(i.luma={}),i.luma.softwareRenderer=!0),i||(i=n.getContext("webgl",{}),i&&(i=null,r||(r="Your browser only supports WebGL1"))),!i)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:a}=e;return n.addEventListener("webglcontextlost",c=>o(c),!1),n.addEventListener("webglcontextrestored",c=>a(c),!1),i.luma||(i.luma={}),i}function ur(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function A1(n,e){const t=n.getParameter(7936),r=n.getParameter(7937);ur(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,i=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),o=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),a=i||t,c=o||r,l=n.getParameter(7938),u=ig(a,c),h=E1(a,c),f=R1(a,c);return{type:"webgl",gpu:u,gpuType:f,gpuBackend:h,vendor:a,renderer:c,version:l,shadingLanguage:"glsl",shadingLanguageVersion:300}}function ig(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function E1(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function R1(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(ig(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function og(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Or="WEBGL_compressed_texture_s3tc",kr="WEBGL_compressed_texture_s3tc_srgb",Xn="EXT_texture_compression_rgtc",qn="EXT_texture_compression_bptc",C1="WEBGL_compressed_texture_etc",I1="WEBGL_compressed_texture_astc",P1="WEBGL_compressed_texture_etc1",O1="WEBGL_compressed_texture_pvrtc",k1="WEBGL_compressed_texture_atc",ih="EXT_texture_norm16",oh="EXT_render_snorm",M1="EXT_color_buffer_float",Wc={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[oh],"norm16-renderable-webgl":[ih],"snorm16-renderable-webgl":[ih,oh],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Or,kr,Xn,qn],"texture-compression-bc5-webgl":[Xn],"texture-compression-bc7-webgl":[qn],"texture-compression-etc2":[C1],"texture-compression-astc":[I1],"texture-compression-etc1-webgl":[P1],"texture-compression-pvrtc-webgl":[O1],"texture-compression-atc-webgl":[k1]};function N1(n){return n in Wc}function D1(n,e,t){return(Wc[e]||[]).every(s=>ur(n,s,t))}const Hc={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:M1,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Or},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:kr},"bc1-rgba-unorm":{gl:33777,x:Or},"bc1-rgba-unorm-srgb":{gl:35916,x:kr},"bc2-rgba-unorm":{gl:33778,x:Or},"bc2-rgba-unorm-srgb":{gl:35918,x:kr},"bc3-rgba-unorm":{gl:33779,x:Or},"bc3-rgba-unorm-srgb":{gl:35919,x:kr},"bc4-r-unorm":{gl:36283,x:Xn},"bc4-r-snorm":{gl:36284,x:Xn},"bc5-rg-unorm":{gl:36285,x:Xn},"bc5-rg-snorm":{gl:36286,x:Xn},"bc6h-rgb-ufloat":{gl:36495,x:qn},"bc6h-rgb-float":{gl:36494,x:qn},"bc7-rgba-unorm":{gl:36492,x:qn},"bc7-rgba-unorm-srgb":{gl:36493,x:qn},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function F1(n,e,t){let r=e.create;const s=Hc[e.format];return(s==null?void 0:s.gl)===void 0&&(r=!1),s!=null&&s.x&&(r=r&&!!ur(n,s.x,t)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function ag(n){var s;const e=Hc[n],t=L1(n),r=Ec(n);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||B1(r.channels,r.integer,r.normalized,t),type:r.dataType?og(r.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:r.compressed||!1}}function U1(n){switch(Ec(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function B1(n,e,t,r){if(r===6408||r===6407)return r;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function L1(n){const e=Hc[n],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const ah={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class V1 extends vv{constructor(t,r,s){super([],s);_(this,"gl");_(this,"extensions");_(this,"testedFeatures",new Set);this.gl=t,this.extensions=r,ur(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const t=this.getFeatures();for(const r of t)this.has(r)&&(yield r);return[]}has(t){var r;return(r=this.disabledFeatures)!=null&&r[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),N1(t)&&D1(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of t)this.has(r)}getFeatures(){return[...Object.keys(ah),...Object.keys(Wc)]}getWebGLFeature(t){const r=ah[t];return typeof r=="string"?!!ur(this.gl,r,this.extensions):!!r}}class $1 extends yv{constructor(t){super();_(this,"gl");_(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class Vr extends ei{constructor(t,r){super(t,r);_(this,"device");_(this,"gl");_(this,"handle");_(this,"colorAttachments",[]);_(this,"depthStencilAttachment",null);const s=r.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const s=this.colorAttachments[r];if(s){const i=36064+r;this._attachTextureView(i,s)}}if(this.depthStencilAttachment){const r=U1(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${W1(r)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,r){const{gl:s}=this.device,{texture:i}=r,o=r.props.baseMipLevel,a=r.props.baseArrayLayer;switch(s.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,t,i.handle,o,a);break;case 34067:const c=j1(a);s.framebufferTexture2D(36160,t,c,i.handle,o);break;case 3553:s.framebufferTexture2D(36160,t,3553,i.handle,o);break;default:throw new Error("Illegal texture type")}s.bindTexture(i.glTarget,null)}}function j1(n){return n<34069?n+34069:n}function W1(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class H1 extends Ta{constructor(t,r){super(r);_(this,"device");_(this,"format","rgba8unorm");_(this,"depthStencilFormat","depth24plus");_(this,"presentationSize");_(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Vr(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}}async function cg(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",n),new Promise((s,i)=>{r.onload=s,r.onerror=o=>i(new Error(`Unable to load script '${n}': ${o}`)),t.appendChild(r)})}const z1=1;let me=null,ch=!1;const zc={debugSpectorJS:F.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function X1(n){if(!globalThis.SPECTOR)try{await cg(n.debugSpectorJSUrl||zc.debugSpectorJSUrl)}catch(e){F.warn(String(e))}}function q1(n){var e;if(n={...zc,...n},!n.debugSpectorJS)return null;if(!me&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){F.probe(z1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;me=new t,globalThis.luma&&(globalThis.luma.spector=me)}if(!me)return null;if(ch||(ch=!0,me.spyCanvases(),me==null||me.onCaptureStarted.add(t=>F.info("Spector capture started:",t)()),me==null||me.onCapture.add(t=>{F.info("Spector capture complete:",t)(),me==null||me.getResultUI(),me==null||me.resultView.display(),me==null||me.resultView.addCapture(t)})),n.gl){const t=n.gl,r=t.device;me==null||me.startCapture(n.gl,500),t.device=r,new Promise(s=>setTimeout(s,2e3)).then(s=>{F.info("Spector capture stopped after 2 seconds")(),me==null||me.stopCapture()})}return me}const Y1="https://unpkg.com/webgl-debug@2.0.1/index.js";function lg(n){return n.luma=n.luma||{},n.luma}async function K1(){vn()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await cg(Y1))}function Z1(n,e={}){return e.debugWebGL||e.traceWebGL?Q1(n,e):J1(n)}function J1(n){const e=lg(n);return e.realContext?e.realContext:n}function Q1(n,e){if(!globalThis.WebGLDebugUtils)return F.warn("webgl-debug not loaded")(),n;const t=lg(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...zn,...n});const r=globalThis.WebGLDebugUtils.makeDebugContext(n,G1.bind(null,e),eA.bind(null,e));for(const o in zn)!(o in r)&&typeof zn[o]=="number"&&(r[o]=zn[o]);class s{}Object.setPrototypeOf(r,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,r);const i=Object.create(s);return t.realContext=n,t.debugContext=i,i.debug=!0,i}function lh(n,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function G1(n,e,t,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const s=globalThis.WebGLDebugUtils.glEnumToString(e),i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,r),o=`${s} in gl.${t}(${i})`;F.error(o)();debugger}function eA(n,e,t){let r="";F.level>=1&&(r=lh(e,t),n.traceWebGL&&F.log(1,r)());for(const s of t)if(s===void 0){r=r||lh(e,t);debugger}}const Wo={};function tA(n="id"){Wo[n]=Wo[n]||1;const e=Wo[n]++;return`${n}-${e}`}class $r extends xe{constructor(t,r={}){super(t,r);_(this,"device");_(this,"gl");_(this,"handle");_(this,"glTarget");_(this,"glUsage");_(this,"glIndexType",5123);_(this,"byteLength");_(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const s=typeof r=="object"?r.handle:void 0;this.handle=s||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=nA(this.props.usage),this.glUsage=rA(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,s=t.byteLength+r){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,s,this.glUsage),this.gl.bufferSubData(i,r,t),this.gl.bindBuffer(i,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(t,r,s),this.trackAllocatedMemory(s)}_initWithByteLength(t){let r=t;t===0&&(r=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;const s=new Uint8Array(r),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,s,i,r),this.gl.bindBuffer(36662,null),this._setDebugData(s,t,r),s}}function nA(n){return n&xe.INDEX?34963:n&xe.VERTEX?34962:n&xe.UNIFORM?35345:34962}function rA(n){return n&xe.INDEX||n&xe.VERTEX?35044:n&xe.UNIFORM?35048:35044}function sA(n){const e=n.split(/\r?\n/),t=[];for(const r of e){if(r.length<=1)continue;const s=r.split(":");if(s.length===2){const[h,f]=s;t.push({message:f.trim(),type:uh(h),lineNum:0,linePos:0});continue}const[i,o,a,...c]=s;let l=parseInt(a,10);isNaN(l)&&(l=0);let u=parseInt(o,10);isNaN(u)&&(u=0),t.push({message:c.join(":").trim(),type:uh(i),lineNum:l,linePos:u})}return t}function uh(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class iA extends Qs{constructor(t,r){super(t,r);_(this,"device");_(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?sA(t):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,t),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}F.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),F.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function oA(n,e,t,r){if(uA(e))return r(n);const s=n;s.pushState();try{return aA(n,e),gr(s.gl,t),r(n)}finally{s.popState()}}function aA(n,e){const t=n,{gl:r}=t;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(pn("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const i=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=pn("provokingVertex",e.provokingVertex,{first:36429,last:36430});i==null||i.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const i=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=pn("polygonMode",e.polygonMode,{fill:6914,line:6913});i==null||i.polygonModeWEBGL(1028,o),i==null||i.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(lA("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Xa("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;r.stencilMaskSeparate(1028,s),r.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&F.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,i=Xa("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,i,0,s),r.stencilFuncSeparate(1029,i,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=Ho("stencilPassOperation",e.stencilPassOperation),i=Ho("stencilFailOperation",e.stencilFailOperation),o=Ho("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,i,o,s),r.stencilOpSeparate(1029,i,o,s)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=hh("blendColorOperation",e.blendColorOperation||"add"),i=hh("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(s,i);const o=vs("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=vs("blendColorDstFactor",e.blendColorDstFactor||"zero"),c=vs("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),l=vs("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,c,l)}}function Xa(n,e){return pn(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Ho(n,e){return pn(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function hh(n,e){return pn(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function vs(n,e){return pn(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function cA(n,e){return`Illegal parameter ${e} for ${n}`}function pn(n,e,t){if(!(e in t))throw new Error(cA(n,e));return t[e]}function lA(n,e){return e}function uA(n){let e=!0;for(const t in n){e=!1;break}return e}function ug(n){const e={};return n.addressModeU&&(e[10242]=zo(n.addressModeU)),n.addressModeV&&(e[10243]=zo(n.addressModeV)),n.addressModeW&&(e[32882]=zo(n.addressModeW)),n.magFilter&&(e[10240]=qa(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=hA(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=Xa("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function zo(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function qa(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function hA(n,e="none"){if(!e)return qa(n);switch(e){case"none":return qa(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class Ya extends Gs{constructor(t,r){super(t,r);_(this,"device");_(this,"handle");_(this,"parameters");this.device=t,this.parameters=ug(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[r,s]of Object.entries(t)){const i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,s);break;default:this.device.gl.samplerParameteri(this.handle,i,s);break}}}}class Yn extends Js{constructor(t,r){super(t,{...we.defaultProps,...r});_(this,"device");_(this,"gl");_(this,"handle");_(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const fA="Failed to deduce GL constant from typed array";function dA(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(fA)}}function pA(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function hg(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function gA(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function gi(n,e,t){if(mA(e))return t(n);const{nocatch:r=!0}=e,s=dn.get(n);s.push(),gr(n,e);let i;if(r)i=t(n),s.pop();else try{i=t(n)}finally{s.pop()}return i}function mA(n){for(const e in n)return!1;return!0}function _A(n,e,t){const{dimension:r,width:s,height:i,depth:o=0}=t,{glInternalFormat:a}=t,c=t.glTarget;switch(r){case"2d-array":case"3d":n.texStorage3D(c,e,a,s,i,o);break;default:n.texStorage2D(c,e,a,s,i)}}function fh(n,e,t,r){const{width:s,height:i}=r,{dimension:o,depth:a=0,mipLevel:c=0}=r,{x:l=0,y:u=0,z:h=0}=r,{glFormat:f,glType:d}=r,p=fg(r.glTarget,o,a),m=r.flipY?{37440:!0}:{};gi(n,m,()=>{switch(o){case"2d-array":case"3d":n.bindTexture(p,e),n.texSubImage3D(p,c,l,u,h,s,i,a,f,d,t),n.bindTexture(p,null);break;case"2d":case"cube":n.bindTexture(p,e),n.texSubImage2D(p,c,l,u,s,i,f,d,t),n.bindTexture(p,null);break;default:throw new Error(o)}})}function dh(n,e,t){const{dimension:r,width:s,height:i,depth:o=0,mipLevel:a=0,byteOffset:c=0}=t,{x:l=0,y:u=0,z:h=0}=t,{glFormat:f,glType:d,compressed:p}=t,m=fg(t.glTarget,r,o);switch(r){case"2d-array":case"3d":p?n.compressedTexSubImage3D(m,a,l,u,h,s,i,o,f,e,c):n.texSubImage3D(m,a,l,u,h,s,i,o,f,d,e,c);break;case"2d":case"cube":p?n.compressedTexSubImage2D(m,a,l,u,s,i,f,e,c):n.texSubImage2D(m,a,l,u,s,i,f,d,e,c);break;default:throw new Error(r)}}function bA(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function fg(n,e,t){return e==="cube"?34069+t:n}function yA(n,e){var y;const{sourceX:t=0,sourceY:r=0,sourceAttachment:s=0}=e||{};let{target:i=null,sourceWidth:o,sourceHeight:a,sourceDepth:c,sourceFormat:l,sourceType:u}=e||{};const{framebuffer:h,deleteFramebuffer:f}=dg(n),{gl:d,handle:p}=h;o||(o=h.width),a||(a=h.height);const m=(y=h.colorAttachments[s])==null?void 0:y.texture;if(!m)throw new Error(`Invalid framebuffer attachment ${s}`);c=(m==null?void 0:m.depth)||1,l||(l=(m==null?void 0:m.glFormat)||6408),u||(u=(m==null?void 0:m.glType)||5121),i=TA(i,u,l,o,a),u=u||dA(i);const g=d.bindFramebuffer(36160,p);return d.readBuffer(36064+s),d.readPixels(t,r,o,a,l,u,i),d.readBuffer(36064),d.bindFramebuffer(36160,g||null),f&&h.destroy(),i}function vA(n,e){const{target:t,sourceX:r=0,sourceY:s=0,sourceFormat:i=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:c,sourceType:l}=e||{};const{framebuffer:u,deleteFramebuffer:h}=dg(n);a=a||u.width,c=c||u.height;const f=u;l=l||5121;let d=t;if(!d){const m=hg(i),g=gA(l),y=o+a*c*m*g;d=f.device.createBuffer({byteLength:y})}const p=n.device.createCommandEncoder();return p.copyTextureToBuffer({sourceTexture:n,width:a,height:c,origin:[r,s],destinationBuffer:d,byteOffset:o}),p.destroy(),h&&u.destroy(),d}function dg(n){return n instanceof ei?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:wA(n),deleteFramebuffer:!0}}function wA(n,e){const{device:t,width:r,height:s,id:i}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${i}`,width:r,height:s,colorAttachments:[n]})}function TA(n,e,t,r,s,i){if(n)return n;e||(e=5121);const o=pA(e,{clamped:!1}),a=hg(t);return new o(r*s*a)}class jr extends we{constructor(t,r){super(t,r);_(this,"device");_(this,"gl");_(this,"handle");_(this,"sampler");_(this,"view");_(this,"mipmaps");_(this,"compressed");_(this,"glTarget");_(this,"glFormat");_(this,"glType");_(this,"glInternalFormat");_(this,"textureUnit",0);const s={...this.props};s.data=r.data,this.device=t,this.gl=this.device.gl,this.glTarget=bA(this.props.dimension);const i=ag(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(s),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:r,height:s}=t;if(!r||!s){const i=we.getTextureDataSize(t.data);r=(i==null?void 0:i.width)||1,s=(i==null?void 0:i.height)||1}if(this.width=r,this.height=s,this.depth=t.depth,this.setSampler(t.sampler),this.view=new Yn(this.device,{...this.props,texture:this}),this.bind(),_A(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Yn(this.device,{...t,texture:this})}setSampler(t={}){let r;t instanceof Ya?(this.sampler=t,r=t.props):(this.sampler=new Ya(this.device,t),r=t);const s=ug(r);this._setSamplerParameters(s)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(F.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){F.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const r=we.getExternalImageSize(t.image),s={...we.defaultCopyExternalImageOptions,...r,...t},{image:i,depth:o,mipLevel:a,x:c,y:l,z:u,flipY:h}=s;let{width:f,height:d}=s;const{dimension:p,glTarget:m,glFormat:g,glInternalFormat:y,glType:S}=this;if(f=Math.min(f,this.width-c),d=Math.min(d,this.height-l),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return fh(this.device.gl,this.handle,i,{dimension:p,mipLevel:a,x:c,y:l,z:u,width:f,height:d,depth:o,glFormat:g,glType:S,glTarget:m,flipY:h}),{width:s.width,height:s.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,r=0){this.bind();const s=we.normalizeTextureData(t,this);s.length>1&&this.props.mipmaps!==!1&&F.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<s.length;i++){const o=s[i];this._setMipLevel(r,i,o)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),dh(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const s of we.CubeFaces)this.setTextureCubeFaceData(t[s],s)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,r,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&F.warn(`${this.id} has mipmap and multiple LODs.`)();const i=we.CubeFaces.indexOf(r);this.setTexture2DData(t,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:r,width:s,height:i,pixels:o,data:a,format:c=6408,type:l=5121}=t,{gl:u}=this,h=o||a;this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},t,{face:r,data:f,pixels:f}))):this.width||this.height?u.texImage2D(r,0,c,s,i,0,c,l,h):u.texImage2D(r,0,c,c,l,h)}_getImageDataMap(t){for(let r=0;r<we.CubeFaces.length;++r){const s=we.CubeFaces[r];t[s]&&(t[34069+r]=t[s],delete t[s])}return t}_setSamplerParameters(t){F.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,s]of Object.entries(t)){const i=Number(r),o=s;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,o);break;case 10241:this.gl.texParameteri(this.glTarget,i,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,i,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,o);break;default:this.gl.texParameteri(this.glTarget,i,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,r,s,i=this.glTarget){if(we.isExternalImage(s)){fh(this.device.gl,this.handle,s,{...this,depth:t,mipLevel:r,glTarget:i,flipY:this.props.flipY});return}if(we.isTextureLevelData(s)){dh(this.device.gl,s.data,{...this,depth:t,mipLevel:r,glTarget:i});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,null),t}}const xA=[1,2,4,8];class SA extends xa{constructor(t,r){var o;super(t,r);_(this,"device");_(this,"glParameters");this.device=t;let s;if(!((o=r==null?void 0:r.parameters)!=null&&o.viewport))if(r!=null&&r.framebuffer){const{width:a,height:c}=r.framebuffer;s=[0,0,a,c]}else{const[a,c]=t.getCanvasContext().getDrawingBufferSize();s=[0,0,a,c]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const i=this.props.framebuffer;if(i!=null&&i.handle)if(this.props.framebuffer){const a=this.props.framebuffer.colorAttachments.map((c,l)=>36064+l);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=xA.map(s=>!!(s&t.colorMask))),this.glParameters=r,gr(this.device.gl,r)}beginOcclusionQuery(t){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((s,i)=>{s&&this.clearColorBuffer(i,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,t.clearStencil=this.props.clearStencil),r!==0&&gi(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){gi(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function AA(n){return EA.includes(n)}const EA=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],pg={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function gg(n){const e=pg[n];if(!e)throw new Error("uniform");const[t,r,,s]=e;return{format:s,components:r,glType:t}}function RA(n){const e=pg[n];if(!e)throw new Error("attribute");const[,t,,r,s]=e;return{attributeType:r,vertexFormat:s,components:t}}function CA(n,e){const t={attributes:[],bindings:[]};t.attributes=IA(n,e);const r=kA(n,e);for(const a of r){const c=a.uniforms.map(l=>({name:l.name,format:l.format,byteOffset:l.byteOffset,byteStride:l.byteStride,arrayLength:l.arrayLength}));t.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:c})}const s=OA(n,e);let i=0;for(const a of s)if(AA(a.type)){const{viewDimension:c,sampleType:l}=NA(a.type);t.bindings.push({type:"texture",name:a.name,group:0,location:i,viewDimension:c,sampleType:l}),a.textureUnit=i,i+=1}s.length&&(t.uniforms=s);const o=PA(n,e);return o!=null&&o.length&&(t.varyings=o),t}function IA(n,e){const t=[],r=n.getProgramParameter(e,35721);for(let s=0;s<r;s++){const i=n.getActiveAttrib(e,s);if(!i)throw new Error("activeInfo");const{name:o,type:a}=i,c=n.getAttribLocation(e,o);if(c>=0){const{attributeType:l}=RA(a),u=/instance/i.test(o)?"instance":"vertex";t.push({name:o,location:c,stepMode:u,type:l})}}return t.sort((s,i)=>s.location-i.location),t}function PA(n,e){const t=[],r=n.getProgramParameter(e,35971);for(let s=0;s<r;s++){const i=n.getTransformFeedbackVarying(e,s);if(!i)throw new Error("activeInfo");const{name:o,type:a,size:c}=i,{glType:l,components:u}=gg(a),h={location:s,name:o,type:l,size:c*u};t.push(h)}return t.sort((s,i)=>s.location-i.location),t}function OA(n,e){const t=[],r=n.getProgramParameter(e,35718);for(let s=0;s<r;s++){const i=n.getActiveUniform(e,s);if(!i)throw new Error("activeInfo");const{name:o,size:a,type:c}=i,{name:l,isArray:u}=DA(o);let h=n.getUniformLocation(e,l);const f={location:h,name:l,size:a,type:c,isArray:u};if(t.push(f),f.size>1)for(let d=0;d<f.size;d++){const p=`${l}[${d}]`;h=n.getUniformLocation(e,p);const m={...f,name:p,location:h};t.push(m)}}return t}function kA(n,e){const t=(i,o)=>n.getActiveUniformBlockParameter(e,i,o),r=[],s=n.getProgramParameter(e,35382);for(let i=0;i<s;i++){const o={name:n.getActiveUniformBlockName(e,i)||"",location:t(i,35391),byteLength:t(i,35392),vertex:t(i,35396),fragment:t(i,35398),uniformCount:t(i,35394),uniforms:[]},a=t(i,35395)||[],c=n.getActiveUniforms(e,a,35383),l=n.getActiveUniforms(e,a,35384),u=n.getActiveUniforms(e,a,35387),h=n.getActiveUniforms(e,a,35388);for(let f=0;f<o.uniformCount;++f){const d=n.getActiveUniform(e,a[f]);if(!d)throw new Error("activeInfo");o.uniforms.push({name:d.name,format:gg(c[f]).format,type:c[f],arrayLength:l[f],byteOffset:u[f],byteStride:h[f]})}r.push(o)}return r.sort((i,o)=>i.location-o.location),r}const MA={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function NA(n){const e=MA[n];if(!e)throw new Error("sampler");const[t,r]=e;return{viewDimension:t,sampleType:r}}function DA(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function FA(n,e,t,r){const s=n;let i=r;i===!0&&(i=1),i===!1&&(i=0);const o=typeof i=="number"?[i]:i;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,r);case 5126:return n.uniform1fv(e,o);case 35664:return n.uniform2fv(e,o);case 35665:return n.uniform3fv(e,o);case 35666:return n.uniform4fv(e,o);case 5124:return n.uniform1iv(e,o);case 35667:return n.uniform2iv(e,o);case 35668:return n.uniform3iv(e,o);case 35669:return n.uniform4iv(e,o);case 35670:return n.uniform1iv(e,o);case 35671:return n.uniform2iv(e,o);case 35672:return n.uniform3iv(e,o);case 35673:return n.uniform4iv(e,o);case 5125:return s.uniform1uiv(e,o,1);case 36294:return s.uniform2uiv(e,o,2);case 36295:return s.uniform3uiv(e,o,3);case 36296:return s.uniform4uiv(e,o,4);case 35674:return n.uniformMatrix2fv(e,!1,o);case 35675:return n.uniformMatrix3fv(e,!1,o);case 35676:return n.uniformMatrix4fv(e,!1,o);case 35685:return s.uniformMatrix2x3fv(e,!1,o);case 35686:return s.uniformMatrix2x4fv(e,!1,o);case 35687:return s.uniformMatrix3x2fv(e,!1,o);case 35688:return s.uniformMatrix3x4fv(e,!1,o);case 35689:return s.uniformMatrix4x2fv(e,!1,o);case 35690:return s.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function UA(n){return Kp(n)!==null||typeof n=="number"||typeof n=="boolean"}function BA(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];UA(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}function LA(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function VA(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const ph=4;class $A extends er{constructor(t,r){super(t,r);_(this,"device");_(this,"handle");_(this,"vs");_(this,"fs");_(this,"introspectedLayout");_(this,"uniforms",{});_(this,"bindings",{});_(this,"varyings",null);_(this,"_uniformCount",0);_(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:s,bufferMode:i=35981}=r;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,i)),this._linkShaders(),F.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=CA(this.device.gl,this.handle),F.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=jA(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(const[s,i]of Object.entries(t)){const o=this.shaderLayout.bindings.find(a=>a.name===s)||this.shaderLayout.bindings.find(a=>a.name===`${s}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");r!=null&&r.disableWarnings||F.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${a}`,i)();continue}switch(i||F.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(i instanceof $r)&&!(i.buffer instanceof $r))throw new Error("buffer value");break;case"texture":if(!(i instanceof Yn||i instanceof jr||i instanceof Vr))throw new Error("texture value");break;case"sampler":F.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(o.type)}this.bindings[s]=i}}draw(t){var g;const{renderPass:r,parameters:s=this.props.parameters,topology:i=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:c,isInstanced:l=!1,firstVertex:u=0,transformFeedback:h}=t,f=LA(i),d=!!o.indexBuffer,p=(g=o.indexBuffer)==null?void 0:g.glIndexType;if(this.linkStatus!=="success")return F.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return F.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),h&&h.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const m=r;return oA(this.device,s,m.glParameters,()=>{d&&l?this.device.gl.drawElementsInstanced(f,a||0,p,u,c||0):d?this.device.gl.drawElements(f,a||0,p,u):l?this.device.gl.drawArraysInstanced(f,u,a||0,c||0):this.device.gl.drawArrays(f,u,a||0),h&&h.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(t){const{bindings:r}=BA(t);Object.keys(r).forEach(s=>{F.warn(`Unsupported value "${JSON.stringify(r[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),F.time(ph,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),F.timeEnd(ph,`linkProgram for ${this.id}`)(),F.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}F.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),F.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(t){var r;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const s=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${s}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(F.warn(`Binding ${r.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let r=0,s=0;for(const i of this.shaderLayout.bindings){const o=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:a}=i,c=t.getUniformBlockIndex(this.handle,a);if(c===4294967295)throw new Error(`Invalid uniform block name ${a}`);t.uniformBlockBinding(this.handle,s,c),o instanceof $r?t.bindBufferBase(35345,s,o.handle):t.bindBufferRange(35345,s,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),s+=1;break;case"texture":if(!(o instanceof Yn||o instanceof jr||o instanceof Vr))throw new Error("texture");let l;if(o instanceof Yn)l=o.texture;else if(o instanceof jr)l=o;else if(o instanceof Vr&&o.colorAttachments[0]instanceof Yn)F.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),l=o.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(l.glTarget,l.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:r,location:s,type:i,textureUnit:o}=t,a=this.uniforms[r]??o;a!==void 0&&FA(this.device.gl,s,i,a)}}}function jA(n,e){const t={...n,attributes:n.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const s=t.attributes.find(i=>i.name===r.name);s?(s.type=r.type||s.type,s.stepMode=r.stepMode||s.stepMode):F.warn(`shader layout attribute ${r.name} not present in shader`)}return t}class WA extends Aa{constructor(t){super(t,{});_(this,"device");_(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const r of t)switch(r.name){case"copy-buffer-to-buffer":HA(this.device,r.options);break;case"copy-buffer-to-texture":zA(this.device,r.options);break;case"copy-texture-to-buffer":XA(this.device,r.options);break;case"copy-texture-to-texture":qA(this.device,r.options);break;default:throw new Error(r.name)}}}function HA(n,e){const t=e.sourceBuffer,r=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,r.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function zA(n,e){throw new Error("Not implemented")}function XA(n,e){const{sourceTexture:t,mipLevel:r=0,aspect:s="all",width:i=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:c=[0,0],destinationBuffer:l,byteOffset:u=0,bytesPerRow:h,rowsPerImage:f}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||a!==0||h||f)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:p}=mg(t);let m;try{const g=l,y=i||d.width,S=o||d.height,v=ag(d.colorAttachments[0].texture.props.format),x=v.format,T=v.type;n.gl.bindBuffer(35051,g.handle),m=n.gl.bindFramebuffer(36160,d.handle),n.gl.readPixels(c[0],c[1],y,S,x,T,u)}finally{n.gl.bindBuffer(35051,null),m!==void 0&&n.gl.bindFramebuffer(36160,m),p&&d.destroy()}}function qA(n,e){const{sourceTexture:t,destinationMipLevel:r=0,origin:s=[0,0],destinationOrigin:i=[0,0],destinationTexture:o}=e;let{width:a=e.destinationTexture.width,height:c=e.destinationTexture.height}=e;const{framebuffer:l,destroyFramebuffer:u}=mg(t),[h,f]=s,[d,p,m]=i,g=n.gl.bindFramebuffer(36160,l.handle);let y=null,S;if(o instanceof jr)y=o,a=Number.isFinite(a)?a:y.width,c=Number.isFinite(c)?c:y.height,y.bind(0),S=y.glTarget;else throw new Error("invalid destination");switch(S){case 3553:case 34067:n.gl.copyTexSubImage2D(S,r,d,p,h,f,a,c);break;case 35866:case 32879:n.gl.copyTexSubImage3D(S,r,d,p,m,h,f,a,c);break}y&&y.unbind(),n.gl.bindFramebuffer(36160,g),u&&l.destroy()}function mg(n){if(n instanceof we){const{width:e,height:t,id:r}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class YA extends Sa{constructor(t,r){super(t,r);_(this,"device");_(this,"commandBuffer");this.device=t,this.commandBuffer=new WA(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,s){}}function KA(n){const{target:e,source:t,start:r=0,count:s=1}=n,i=t.length,o=s*i;let a=0;for(let c=r;a<i;a++)e[c++]=t[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return n.target}class Xc extends Ea{constructor(t,r){super(t,r);_(this,"device");_(this,"handle");_(this,"buffer",null);_(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return u_()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){const s=r;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:o,stride:a,offset:c,normalized:l,integer:u,divisor:h}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),u?this.device.gl.vertexAttribIPointer(t,i,o,a,c):this.device.gl.vertexAttribPointer(t,i,o,l,a,c),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,h||0),this.attributes[t]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){const r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);const s=og(r.bufferDataType);return{size:r.bufferComponents,type:s,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){const i=Xc.isConstantAttributeZeroSupported(this.device)||t!==0;(r||i)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){const s=ZA(r),i=s.byteLength*t,o=s.length*t;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),a=a||!JA(s,this.bufferValue),a){const c=Kv(r.constructor,o);KA({target:c,source:s,start:0,count:o}),this.buffer.write(c),this.bufferValue=r}return this.buffer}}function ZA(n){return Array.isArray(n)?new Float32Array(n):n}function JA(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class QA extends Ra{constructor(t,r){super(t,r);_(this,"device");_(this,"gl");_(this,"handle");_(this,"layout");_(this,"buffers",{});_(this,"unusedBuffers",{});_(this,"bindOnUse",!0);_(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(VA(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){const s=this._getVaryingIndex(t),{buffer:i,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(s<0){this.unusedBuffers[t]=i,F.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[s]={buffer:i,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(s,i,a,o)}getBuffer(t){if(gh(t))return this.buffers[t]||null;const r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof $r)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:r,byteOffset:s=0,byteLength:i=t.buffer.byteLength}=t;return{buffer:r,byteOffset:s,byteLength:i}}_getVaryingIndex(t){if(gh(t))return Number(t);for(const r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:r,byteLength:s,byteOffset:i}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,i,s)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,s=0,i){const o=r&&r.handle;!o||i===void 0?this.gl.bindBufferBase(35982,t,o):this.gl.bindBufferRange(35982,t,o,s,i)}}function gh(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class GA extends Ca{constructor(t,r){super(t,r);_(this,"device");_(this,"handle");_(this,"target",null);_(this,"_queryPending",!1);_(this,"_pollingPromise",null);if(this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((s,i)=>{const o=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):r++>t?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class Kn extends Jt{constructor(t){var h,f;super({...t,id:t.id||tA("webgl-device")});_(this,"type","webgl");_(this,"handle");_(this,"features");_(this,"limits");_(this,"info");_(this,"canvasContext");_(this,"lost");_(this,"_resolveContextLost");_(this,"gl");_(this,"debug",!1);_(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});_(this,"_extensions",{});_(this,"_polyfilled",!1);_(this,"spectorJS");_(this,"renderPass",null);_(this,"_constants");const r=Jt._getCanvasContextProps(t);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=(f=(h=r.canvas)==null?void 0:h.gl)==null?void 0:f.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new H1(this,r),this.lost=new Promise(d=>{this._resolveContextLost=d});const i={...t.webgl};r.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),t.powerPreference!==void 0&&(i.powerPreference=t.powerPreference);const a=this.props._handle||S1(this.canvasContext.canvas,{onContextLost:d=>{var p;return(p=this._resolveContextLost)==null?void 0:p.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:d=>console.log("WebGL context restored")},i);if(!a)throw new Error("WebGL context creation failed");if(s=a.device,s){if(t._reuseDevices)return F.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=a,this.gl=a,this.spectorJS=q1({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=A1(this.gl,this._extensions),this.limits=new $1(this.gl),this.features=new V1(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new dn(this.gl,{log:(...d)=>F.log(1,...d)()}).trackState(this.gl,{copyState:!1});const l=t.debugWebGL||t.debug,u=t.debugWebGL;l&&(this.gl=Z1(this.gl,{debugWebGL:l,traceWebGL:u}),F.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(F.level=Math.max(F.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const r=this._normalizeBufferProps(t);return new $r(this,r)}createTexture(t){return new jr(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Ya(this,t)}createShader(t){return new iA(this,t)}createFramebuffer(t){return new Vr(this,t)}createVertexArray(t){return new Xc(this,t)}createTransformFeedback(t){return new QA(this,t)}createQuerySet(t){return new GA(this,t)}createRenderPipeline(t){return new $A(this,t)}beginRenderPass(t){return new SA(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new YA(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return yA(t,r)}readPixelsToBufferWebGL(t,r){return vA(t,r)}setParametersWebGL(t){gr(this.gl,t)}getParametersWebGL(t){return sg(this.gl,t)}withParametersWebGL(t,r){return gi(this.gl,t,r)}resetWebGL(){F.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),y1(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return F1(this.gl,t,this._extensions)}loseDevice(){var i;let t=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(t=!0,s.loseContext()),(i=this._resolveContextLost)==null||i.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){dn.get(this.gl).push()}popState(){dn.get(this.gl).pop()}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){const s=Number(t);for(const i in this.gl)if(this.gl[i]===s)return`GL.${i}`;return r!=null&&r.emptyIfUnknown?"":String(t)}getGLKeys(t){const r={emptyIfUnknown:!0};return Object.entries(t).reduce((s,[i,o])=>(s[`${i}:${this.getGLKey(i,r)}`]=`${o}:${this.getGLKey(o,r)}`,s),{})}setConstantAttributeWebGL(t,r){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const i=this._constants[t];switch(i&&r3(i,r)&&F.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:e3(this,t,r);break;case Int32Array:t3(this,t,r);break;case Uint32Array:n3(this,t,r);break;default:throw new Error("constant")}}getExtension(t){return ur(this.gl,t,this._extensions),this._extensions}}function e3(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function t3(n,e,t){n.gl.vertexAttribI4iv(e,t)}function n3(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function r3(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const s3={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},i3=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),o3=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),a3=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function c3(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,r){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",r);return s instanceof HTMLElement&&l3(s),s}return this.originalGetContext(t,r)}}function l3(n){n.getExtension("EXT_color_buffer_float");const e={...s3,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:i3(n),OES_vertex_array_object:o3(n),ANGLE_instanced_arrays:a3(n)},t=n.getExtension;n.getExtension=function(s){const i=t.call(n,s);return i||(s in e?e[s]:null)};const r=n.getSupportedExtensions;n.getSupportedExtensions=function(){const s=r.apply(n)||[];return s==null?void 0:s.concat(Object.keys(e))}}const ws=1;class u3 extends Av{constructor(){super();_(this,"type","webgl");Jt.defaultProps={...Jt.defaultProps,...zc},Kn.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){c3(t)}async attach(t){if(t instanceof Kn)return t;if((t==null?void 0:t.device)instanceof Jt)return t.device;if(!h3(t))throw new Error("Invalid WebGL2RenderingContext");return new Kn({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){F.groupCollapsed(ws,"WebGLDevice created")();const r=[];(t.debugWebGL||t.debug)&&r.push(K1()),t.debugSpectorJS&&r.push(X1(t));const s=await Promise.allSettled(r);for(const a of s)a.status==="rejected"&&F.error(`Failed to initialize debug libraries ${a.reason}`)();const i=new Kn(t),o=`${i._reused?"Reusing":"Created"} device with WebGL2 ${i.debug?"debug ":""}context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return F.probe(ws,o)(),F.table(ws,i.info)(),F.groupEnd(ws)(),i}}function h3(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const mh=new u3;function Vt(){}const f3=({isDragging:n})=>n?"grabbing":"grab",_g={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Vt,onWebGLInitialized:Vt,onResize:Vt,onViewStateChange:Vt,onInteractionStateChange:Vt,onBeforeRender:Vt,onAfterRender:Vt,onLoad:Vt,onError:n=>fe.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:f3,getTooltip:null,debug:!1,drawPickingColors:!1};class qc{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Hi({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:s}=this;if(r.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(r.leftButton||r.rightButton)return;{const i=r.offsetCenter;if(!i)return;s.x=i.x,s.y=i.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=r},this._onEvent=r=>{const s=Ua[r.type],i=r.offsetCenter;if(!s||!i||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:o,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:c}=a,l=c&&(c[s]||c.props[s]),u=this.props[s];let h=!1;l&&(h=l.call(c,a,r)),h||(u==null||u(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{var o;if(((o=this.device)==null?void 0:o.type)==="webgpu")return;const s=r.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={..._g,...e},e=this.props,e.viewState&&e.initialViewState&&fe.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&fe.error("WebGL1 context not supported.")(),t=mh.attach(e.gl)),t||(t=wa.createDevice({type:"best-available",_reuseDevices:!0,adapters:[mh],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Jr.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,s,i,o,a,c,l,u;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(i=this.effectManager)==null||i.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(c=this.eventManager)==null||c.destroy(),this.eventManager=null,(l=this.widgetManager)==null||l.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&fe.removed("onLayerHover","onHover")(),"onLayerClick"in e&&fe.removed("onLayerClick","onClick")(),e.initialViewState&&!Ye(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),i=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||r||s||i||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return He(this.viewManager),this.viewManager.views}getViewports(e){return He(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,r){He(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const i=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return s.get(t).timeEnd(),i}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),He(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const i=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=i}if(r||r===0){const i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){var s,i;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,(s=this.viewManager)==null||s.setProps({width:t,height:r}),(i=this.layerManager)==null||i.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){const{gl:r,onError:s,useDevicePixels:i}=t;return new dS({device:e,useDevicePixels:i,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new tg({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,r,s,i;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:a}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let c=a,l=!1;for(const u of o)c=u,l=((r=u.layer)==null?void 0:r.onHover(u,e.event))||l;l||((i=(s=this.props).onHover)==null||i.call(s,c,e.event),this.widgetManager.onHover(c,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,i;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new Yp;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new BT(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Du).map(o=>{var d;const[a,c,l,u]=Du[o],h=(d=this.props.eventRecognizerOptions)==null?void 0:d[o],f={...c,...h,event:o};return{recognizer:new a(f),recognizeWith:l,requestFailure:u}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Ua)this.eventManager.on(o,this._onEvent);this.viewManager=new LS({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new BS(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new t1({deck:this,device:this.device}),this.deckRenderer=new s1(this.device),this.deckPicker=new u1(this.device),this.widgetManager=new d1({deck:this,parentElement:(i=this.canvas)==null?void 0:i.parentElement}),this.widgetManager.addDefault(new g1),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var o;const{device:r,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:s});const i={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(o=this.deckRenderer)==null||o.renderLayers(i),i.pass==="screen"&&this.widgetManager.onRedraw({viewports:i.viewports,layers:i.layers}),this.props.onAfterRender({device:r,gl:s})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),fe.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=wa.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}qc.defaultProps=_g;qc.VERSION=Oy;function d3(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return qd(n)}}const p3=Xd;function Ts(n,e,t){const r=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function un(n){return n.stride||n.size*n.bytesPerElement}function g3(n,e){return n.type===e.type&&n.size===e.size&&un(n)===un(e)&&(n.offset||0)===(e.offset||0)}function Ka(n,e){e.offset&&fe.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=un(n),r=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,i=r*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:i,stride:t}}function m3(n,e){const t=Ka(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class _3{constructor(e,t,r){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,i=s==="float64";let{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;i?a="float32":!s&&t.isIndexed?a="uint32":a=s||"float32";let c=d3(s||a);this.doublePrecision=i,i&&t.fp64===!1&&(c=Float32Array),this.value=null,this.settings={...t,defaultType:c,defaultValue:o,logicalType:s,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:c.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*un(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Jr.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const r={};if(this.state.constant){const s=this.value;if(t){const i=Ka(this.getAccessor(),t),o=i.offset/s.BYTES_PER_ELEMENT,a=i.size||this.size;r[e]=s.subarray(o,o+a)}else r[e]=s}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){const r=this.getAccessor(),s=[],i={name:this.id,byteStride:un(r),attributes:s};if(this.doublePrecision){const o=m3(r,t||{});s.push(Ts(e,{...r,...o.high},this.device.type),Ts(`${e}64Low`,{...r,...o.low},this.device.type))}else if(t){const o=Ka(r,t);s.push(Ts(e,{...r,...o},this.device.type))}else s.push(Ts(e,r,this.device.type));return i}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:s}=this,i=r*s;if(t&&i&&t.length>=i){const o=new Array(s).fill(1/0),a=new Array(s).fill(-1/0);for(let c=0;c<i;)for(let l=0;l<s;l++){const u=t[c++];u<o[l]&&(o[l]=u),u>a[l]&&(a[l]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof xe?r={buffer:e}:r=e;const s={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)s.type="float32";else{const o=p3(r.value);s.type=s.normalized?o.replace("int","norm"):o}s.bytesPerElement=r.value.BYTES_PER_ELEMENT,s.stride=un(s)}if(t.bounds=null,r.constant){let i=r.value;if(i=this._normalizeValue(i,[],0),this.settings.normalized&&(i=this.normalizeConstant(i)),!(!t.constant||!this._areValuesEqual(i,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(i)?i:new Float32Array(i)}else if(r.buffer){const i=r.buffer;t.externalBuffer=i,t.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let i=r.value;t.externalBuffer=null,t.constant=!1,this.value=i;let{buffer:o}=this;const a=un(s),c=(s.vertexOffset||0)*a;if(this.doublePrecision&&i instanceof Float64Array&&(i=Uo(i,s)),this.settings.isIndexed){const u=this.settings.defaultType;i.constructor!==u&&(i=new u(i))}const l=i.byteLength+c+a*2;(!o||o.byteLength<l)&&(o=this._createBuffer(l)),o.write(i,c)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Uo(t,{size:this.size,startIndex:r,endIndex:s}):t.subarray(r,s),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:r}=this,s=r.allocatedValue,i=Jr.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=i;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<i.byteLength+o)&&(a=this._createBuffer(i.byteLength+o),t&&s&&a.write(s instanceof Float64Array?Uo(s,this):s,o)),r.allocatedValue=i,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&fe.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:s,size:i}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let o=i;for(;--o>=0;)t[r+o]=s[o];return t}switch(i){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let o=i;for(;--o>=0;)t[r+o]=Number.isFinite(e[o])?e[o]:s[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let s=0;s<r;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:(t?xe.INDEX:xe.VERTEX)|xe.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}const _h=[],bh=[];function bg(n,e=0,t=1/0){let r=_h;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?r=n:n.length>0&&(bh.length=n.length,r=bh):r=_h,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),s.index=e-1),{iterable:r,objectInfo:s}}function yg(n){return n&&n[Symbol.asyncIterator]}function b3(n,e){const{size:t,stride:r,offset:s,startIndices:i,nested:o}=e,a=n.BYTES_PER_ELEMENT,c=r?r/a:t,l=s?s/a:0,u=Math.floor((n.length-l)/c);return(h,{index:f,target:d})=>{if(!i){const y=f*c+l;for(let S=0;S<t;S++)d[S]=n[y+S];return d}const p=i[f],m=i[f+1]||u;let g;if(o){g=new Array(m-p);for(let y=p;y<m;y++){const S=y*c+l;d=new Array(t);for(let v=0;v<t;v++)d[v]=n[S+v];g[y-p]=d}}else if(c===t)g=n.subarray(p*t+l,m*t+l);else{g=new n.constructor((m-p)*t);let y=0;for(let S=p;S<m;S++){const v=S*c+l;for(let x=0;x<t;x++)g[y++]=n[v+x]}}return g}}const y3=[],Bs=[[0,1/0]];function v3(n,e){if(n===Bs||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],r=n.length;let s=0;for(let i=0;i<r;i++){const o=n[i];o[1]<e[0]?(t.push(o),s=i+1):o[0]>e[1]?t.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return t.splice(s,0,e),t}const w3={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function vg(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...w3[t],...e,...n,type:t}}class wg extends _3{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Bs}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!g3(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,s=Array.isArray(t)?e[t.find(i=>e[i])]:e[t];return vg(s,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:s=1/0}=t;this.state.updateRanges=v3(this.state.updateRanges,[r,s])}else this.state.updateRanges=Bs}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=y3}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==Bs),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:i},settings:{update:o,noAlloc:a}}=this;let c=!0;if(o){for(const[l,u]of i)o.call(s,this,{data:t,startRow:l,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[l,u]of i){const h=Number.isFinite(l)?this.getVertexOffset(l):0,f=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:f})}this._checkAttributeArray()}else c=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),c}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:s}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;He(ArrayBuffer.isView(o.value),`invalid ${s.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=b3(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=s??"vertex",!t)return r;for(const i in t){const o=super._getBufferLayout(i,t[i]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:s,props:i,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:c,value:l,size:u,startIndices:h}=e,{accessor:f,transform:d}=a;let p=c.binaryAccessor||(typeof f=="function"?f:i[f]);typeof p!="function"&&(p=()=>p),He(typeof p=="function",`accessor "${f}" is not a function`);let m=e.getVertexOffset(r);const{iterable:g,objectInfo:y}=bg(t,r,s);for(const S of g){y.index++;let v=p(S,y);if(d&&(v=d.call(this,v)),h){const x=(y.index<h.length-1?h[y.index+1]:o)-h[y.index];if(v&&Array.isArray(v[0])){let T=m;for(const I of v)e._normalizeValue(I,l,T),T+=u}else v&&v.length>u?l.set(v,m):(e._normalizeValue(v,y.target,0),MS({target:l,source:y.target,start:m,count:x}));m+=x*u}else e._normalizeValue(v,l,m),m+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Xo(n){const{source:e,target:t,start:r=0,size:s,getData:i}=n,o=n.end||t.length,a=e.length,c=o-r;if(a>c){t.set(e.subarray(0,c),r);return}if(t.set(e,r),!i)return;let l=a;for(;l<c;){const u=i(l,e);for(let h=0;h<s;h++)t[r+l]=u[h]||0,l++}}function T3({source:n,target:e,size:t,getData:r,sourceStartIndices:s,targetStartIndices:i}){if(!s||!i)return Xo({source:n,target:e,size:t,getData:r}),e;let o=0,a=0;const c=r&&((u,h)=>r(u+a,h)),l=Math.min(s.length,i.length);for(let u=1;u<l;u++){const h=s[u]*t,f=i[u]*t;Xo({source:n.subarray(o,h),target:e,start:a,end:f,size:t,getData:c}),o=h,a=f}return a<e.length&&Xo({source:[],target:e,start:a,size:t,getData:c}),e}function x3(n){const{device:e,settings:t,value:r}=n,s=new wg(e,t);return s.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function Tg(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function xg(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Sg(n){n.push(n.shift())}function S3(n,e){const{doublePrecision:t,settings:r,value:s,size:i}=n,o=t&&s instanceof Float64Array?2:1;let a=0;const{shaderAttributes:c}=n.settings;if(c)for(const l of Object.values(c))a=Math.max(a,l.vertexOffset??0);return(r.noAlloc?s.length:(e+a)*i)*o}function Ag({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function Eg({device:n,buffer:e,attribute:t,fromLength:r,toLength:s,fromStartIndices:i,getData:o=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,c=t.size*a,l=t.byteOffset,u=t.settings.bytesPerElement<4?l/t.settings.bytesPerElement*4:l,h=t.startIndices,f=i&&h,d=t.isConstant;if(!f&&e&&r>=s)return e;const p=t.value instanceof Float64Array?Float32Array:t.value.constructor,m=d?t.value:new p(t.getBuffer().readSyncWebGL(l,s*p.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!d){const v=o;o=(x,T)=>t.normalizeConstant(v(x,T))}const g=d?(v,x)=>o(m,x):(v,x)=>o(m.subarray(v+l,v+l+c),x),y=e?new Float32Array(e.readSyncWebGL(u,r*4).buffer):new Float32Array(0),S=new Float32Array(s);return T3({source:y,target:S,sourceStartIndices:i,targetStartIndices:h,size:c,getData:g}),(!e||e.byteLength<S.byteLength+u)&&(e==null||e.destroy(),e=n.createBuffer({byteLength:S.byteLength+u,usage:35050})),e.write(S,u),e}class Rg{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Zi(r),this.attribute=t,this.attributeInTransition=x3(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=S3(this.attribute,t),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class A3 extends Rg{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=I3(e,t)}start(e,t){const r=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:i,attribute:o}=this;Sg(i),i[0]=Eg({device:this.device,buffer:i[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),i[1]=Ag({device:this.device,source:i[0],target:i[1]}),this.setBuffer(i[1]);const{transform:a}=this,c=a.model;let l=Math.floor(this.currentLength/o.size);Cg(o)&&(l/=2),c.setVertexCount(l),o.isConstant?(c.setAttributes({aFrom:i[0]}),c.setConstantAttributes({aTo:o.value})):c.setAttributes({aFrom:i[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:i[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:r}=this.transition;let s=r/e;t&&(s=t(s));const{model:i}=this.transform,o={time:s};i.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const E3=`uniform interpolationUniforms {
  float time;
} interpolation;
`,yh={name:"interpolation",vs:E3,uniformTypes:{time:"f32"}},R3=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,C3=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Cg(n){return n.doublePrecision&&n.value instanceof Float64Array}function I3(n,e){const t=e.size,r=Tg(t),s=xg(t),i=e.getBufferLayout();return Cg(e)?new cr(n,{vs:C3,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[Pw,yh],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new cr(n,{vs:R3,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:i.attributes[0].format}],modules:[yh],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class P3 extends Rg{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=F3(e),this.framebuffer=U3(e,this.texture),this.transform=D3(e,t)}start(e,t){const r=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:i,attribute:o}=this;for(let c=0;c<2;c++)i[c]=Eg({device:this.device,buffer:i[c],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});i[2]=Ag({device:this.device,source:i[0],target:i[2]}),this.setBuffer(i[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:r,transition:s}=this,i=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:i.stiffness,damping:i.damping};t.model.shaderInputs.setProps({spring:o}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Sg(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const O3=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,k3={name:"spring",vs:O3,uniformTypes:{damping:"f32",stiffness:"f32"}},M3=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,N3=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function D3(n,e){const t=Tg(e.size),r=xg(e.size);return new cr(n,{vs:M3,fs:N3,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[k3],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function F3(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function U3(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const B3={interpolation:A3,spring:P3};class L3{constructor(e,{id:t,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const s in e){const i=e[s],o=i.getTransitionSetting(t);o&&this._updateAttribute(s,i,o)}for(const s in this.transitions){const i=e[s];(!i||!i.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){const s=this.transitions[e];let i=!s||s.type!==r.type;if(i){s&&this._removeTransition(e);const o=B3[r.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(fe.error(`unsupported transition type '${r.type}'`)(),i=!1)}(i||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const vh="attributeManager.invalidate",V3="attributeManager.updateStart",$3="attributeManager.updateEnd",j3="attribute.updateStart",W3="attribute.allocate",H3="attribute.updateEnd";class Ji{constructor(e,{id:t="attribute-manager",stats:r,timeline:s}={}){this.mergeBoundsMemoized=os(Kx),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new L3(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);We(vh,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);We(vh,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:s,props:i={},buffers:o={},context:a={}}){let c=!1;We(V3,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const l in this.attributes){const u=this.attributes[l],h=u.settings.accessor;u.startIndices=r,u.numInstances=t,i[l]&&fe.removed(`props.${l}`,`data.attributes.${l}`)(),u.setExternalBuffer(o[l])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,e.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(i[h])||u.needsUpdate()&&(c=!0,this._updateAttribute({attribute:u,numInstances:t,data:e,props:i,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}c&&We($3,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(r=>{var s;return(s=this.attributes[r])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,s={...r.getAttributes()};for(const i in t){const o=t[i];o.needsRedraw(e)&&!r.hasAttribute(i)&&(s[i]=o)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const r in e){const s=e[r],i={...s,id:r,size:s.isIndexed&&1||s.size||1,...t};this.attributes[r]=new wg(this.device,i)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:s}=this,i=s[e];return i&&i.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,t)}),i}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(We(j3,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&We(W3,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,We(H3,t,r))}}class z3 extends Zi{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:s,easing:i}}=this,o=i(e/s);this._value=ci(t,r,o)}}const wh=1e-5;function Th(n,e,t,r,s){const i=e-n,a=(t-e)*s,c=-i*r;return a+c+i+e}function X3(n,e,t,r,s){if(Array.isArray(t)){const i=[];for(let o=0;o<t.length;o++)i[o]=Th(n[o],e[o],t[o],r,s);return i}return Th(n,e,t,r,s)}function xh(n,e){if(Array.isArray(n)){let t=0;for(let r=0;r<n.length;r++){const s=n[r]-e[r];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class q3 extends Zi{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:s}=this.settings,{_prevValue:i=e,_currValue:o=e}=this;let a=X3(i,o,t,r,s);const c=xh(a,t),l=xh(a,o);c<wh&&l<wh&&(a=t,this.end()),this._prevValue=o,this._currValue=a}}const Y3={interpolation:z3,spring:q3};class K3{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,s){const{transitions:i}=this;if(i.has(e)){const c=i.get(e),{value:l=c.settings.fromValue}=c;t=l,this.remove(e)}if(s=vg(s),!s)return;const o=Y3[s.type];if(!o){fe.error(`unsupported transition type '${s.type}'`)();return}const a=new o(this.timeline);a.start({...s,fromValue:t,toValue:r}),i.set(e,a)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Z3(n){const e=n[Gt];for(const t in e){const r=e[t],{validate:s}=r;if(s&&!s(n[t],r))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function J3(n,e){const t=Yc({newProps:n,oldProps:e,propTypes:n[Gt],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=G3(n,e);let s=!1;return r||(s=e2(n,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:s,extensionsChanged:t2(n,e),transitionsChanged:Q3(n,e)}}function Q3(n,e){if(!n.transitions)return!1;const t={},r=n[Gt];let s=!1;for(const i in n.transitions){const o=r[i],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Za(n[i],e[i],o)&&(t[i]=!0,s=!0)}return s?t:!1}function Yc({newProps:n,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const i of Object.keys(n))if(!(i in t)){if(!(i in e))return`${s}.${i} added`;const o=Za(n[i],e[i],r[i]);if(o)return`${s}.${i} ${o}`}for(const i of Object.keys(e))if(!(i in t)){if(!(i in n))return`${s}.${i} dropped`;if(!Object.hasOwnProperty.call(n,i)){const o=Za(n[i],e[i],r[i]);if(o)return`${s}.${i} ${o}`}}return!1}function Za(n,e,t){let r=t&&t.equal;return r&&!r(n,e,t)||!r&&(r=n&&e&&n.equals,r&&!r.call(n,e))?"changed deeply":!r&&e!==n?"changed shallowly":null}function G3(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:s}=n;return r?r(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function e2(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&Sh(n,e,"all"))return{all:!0};const t={};let r=!1;for(const s in n.updateTriggers)s!=="all"&&Sh(n,e,s)&&(t[s]=!0,r=!0);return r?t:!1}function t2(n,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=n;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let s=0;s<r.length;s++)if(!r[s].equals(t[s]))return!0;return!1}function Sh(n,e,t){let r=n.updateTriggers[t];r=r??{};let s=e.updateTriggers[t];return s=s??{},Yc({oldProps:s,newProps:r,triggerName:t})}const n2="count(): argument not an object",r2="count(): argument not a container";function s2(n){if(!o2(n))throw new Error(n2);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(i2(n))return Object.keys(n).length;throw new Error(r2)}function i2(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function o2(n){return n!==null&&typeof n=="object"}function Ah(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(s=>s.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const r={...n.inject};for(const s in e.inject)r[s]=(r[s]||"")+e.inject[s];t.inject=r}return t}const a2={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ja={};function c2(n,e,t,r){if(t instanceof we)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const i=e.createTexture({...t,sampler:{...a2,...s,...r},mipmaps:!0});return Ja[i.id]=n,i}function l2(n,e){!e||!(e instanceof we)||Ja[e.id]===n&&(e.delete(),delete Ja[e.id])}const u2={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Qa(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Ye(n,e,1)}},accessor:{validate(n,e){const t=mi(n);return t==="function"||t===mi(e.value)},equal(n,e,t){return typeof e=="function"?!0:Ye(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Qa(n)},equal(n,e,t){const{compare:r}=t,s=Number.isInteger(r)?r:r?1:0;return r?Ye(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:r}=t,s=Number.isInteger(r)?r:r?1:0;return r?Ye(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:r}=t.props;return r?r(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const r=t.context;return!r||!r.device?null:c2(t.id,r.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{l2(t.id,n)}}};function h2(n){const e={},t={},r={};for(const[s,i]of Object.entries(n)){const o=i==null?void 0:i.deprecatedFor;if(o)r[s]=Array.isArray(o)?o:[o];else{const a=f2(s,i);e[s]=a,t[s]=a.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function f2(n,e){switch(mi(e)){case"object":return xr(n,e);case"array":return xr(n,{type:"array",value:e,compare:!1});case"boolean":return xr(n,{type:"boolean",value:e});case"number":return xr(n,{type:"number",value:e});case"function":return xr(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function xr(n,e){return"type"in e?{name:n,...u2[e.type],...e}:"value"in e?{name:n,type:mi(e.value),...e}:{name:n,type:"object",value:e}}function Qa(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function mi(n){return Qa(n)?"array":n===null?"null":typeof n}function d2(n,e){let t;for(let i=e.length-1;i>=0;i--){const o=e[i];"extensions"in o&&(t=o.extensions)}const r=Ga(n.constructor,t),s=Object.create(r);s[pi]=n,s[_n]={},s[Zt]={};for(let i=0;i<e.length;++i){const o=e[i];for(const a in o)s[a]=o[a]}return Object.freeze(s),s}const p2="_mergedDefaultProps";function Ga(n,e){if(!(n instanceof Qi.constructor))return{};let t=p2;if(e)for(const s of e){const i=s.constructor;i&&(t+=`:${i.extensionName||i.name}`)}const r=Ig(n,t);return r||(n[t]=g2(n,e||[]))}function g2(n,e){if(!n.prototype)return null;const r=Object.getPrototypeOf(n),s=Ga(r),i=Ig(n,"defaultProps")||{},o=h2(i),a=Object.assign(Object.create(null),s,o.defaultProps),c=Object.assign(Object.create(null),s==null?void 0:s[Gt],o.propTypes),l=Object.assign(Object.create(null),s==null?void 0:s[$o],o.deprecatedProps);for(const u of e){const h=Ga(u.constructor);h&&(Object.assign(a,h),Object.assign(c,h[Gt]),Object.assign(l,h[$o]))}return m2(a,n),b2(a,c),_2(a,l),a[Gt]=c,a[$o]=l,e.length===0&&!Kc(n,"_propTypes")&&(n._propTypes=c),a}function m2(n,e){const t=v2(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function _2(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(r){const s=`${this.id}: ${t}`;for(const i of e[t])Kc(this,i)||(this[i]=r);fe.deprecated(s,e[t].join("/"))()}})}function b2(n,e){const t={},r={};for(const s in e){const i=e[s],{name:o,value:a}=i;i.async&&(t[o]=a,r[o]=y2(o))}n[Jn]=t,n[_n]={},Object.defineProperties(n,r)}function y2(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||yg(e)?this[_n][n]=e:this[Zt][n]=e},get(){if(this[Zt]){if(n in this[Zt])return this[Zt][n]||this[Jn][n];if(n in this[_n]){const e=this[pi]&&this[pi].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[Jn][n]}}return this[Jn][n]}}}function Kc(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ig(n,e){return Kc(n,e)&&n[e]}function v2(n){const e=n.componentName;return e||fe.warn(`${n.name}.componentName not specified`)(),e||n.name}let w2=0;class Qi{constructor(...e){this.props=d2(this,e),this.id=this.props.id,this.count=w2++}clone(e){const{props:t}=this,r={};for(const s in t[Jn])s in t[Zt]?r[s]=t[Zt][s]:s in t[_n]&&(r[s]=t[_n][s]);return new this.constructor({...t,...r,...e})}}Qi.componentName="Component";Qi.defaultProps={};const T2=Object.freeze({});class x2{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||T2}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[pi]||this.component;const t=e[Zt]||{},r=e[_n]||e,s=e[Jn]||{};for(const i in t){const o=t[i];this._createAsyncPropData(i,s[i]),this._updateAsyncProp(i,o),t[i]=this.getAsyncProp(i)}for(const i in r){const o=r[i];this._createAsyncPropData(i,s[i]),this._updateAsyncProp(i,o)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(yg(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const s=this.asyncProps[e];s&&r>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const s=r.pendingLoadCount;t.then(i=>{this.component&&(i=this._postProcessValue(r,i),this._setAsyncPropValue(e,i,s),this._onResolve(e,i))}).catch(i=>{this._onError(e,i)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const s=r.pendingLoadCount;let i=[],o=0;for await(const a of t){if(!this.component)return;const{dataTransform:c}=this.component.props;c?i=c(a,i):i=i.concat(a),Object.defineProperty(i,"__diff",{enumerable:!1,value:[{startRow:o,endRow:i.length}]}),o=i.length,this._setAsyncPropValue(e,i,s)}this._onResolve(e,i)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[Gt];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class S2 extends x2{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,s=r==null?void 0:r.props.fetch;return s?s(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const s=r.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}const A2="layer.changeFlag",E2="layer.initialize",R2="layer.update",C2="layer.finalize",I2="layer.matched",Eh=2**24-1,P2=Object.freeze([]),O2=os(({oldViewport:n,viewport:e})=>n.equals(e));let ct=new Uint8ClampedArray(0);const k2={data:{type:"data",value:P2,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:r,loadOptions:s,signal:i})=>{const{resourceManager:o}=t.context;s=s||t.getLoadOptions(),r=r||t.props.loaders,i&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:i}});let a=o.contains(n);return!a&&!s&&(o.add({resourceId:n,data:pa(n,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:n,onChange:c=>{var l;return(l=t.internalState)==null?void 0:l.reloadAsyncProp(e,c)},consumerId:t.id,requestId:e}):pa(n,r,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ne.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class mr extends Qi{constructor(){super(...arguments),this.internalState=null,this.lifecycle=jn.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){He(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=zp(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,i,o]=$p(r,t.pixelProjectionMatrix);return e.length===2?[s,i]:[s,i,o]}unproject(e){return He(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){He(this.internalState);const r=this.internalState.viewport||this.context.viewport;return Xp(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ne.DEFAULT||e===ne.LNGLAT||e===ne.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){He(e instanceof Uint8Array);const[t,r,s]=e;return t+r*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:s2(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Ah(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=Ah(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const s of r)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,i=this.internalState.hasPickingBuffer,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(i!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:c}=t.attributes,l=a||c;l&&(o&&l.constant&&(l.constant=!1,t.invalidate(l.id)),!l.value&&!o&&(l.constant=!0,l.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){var r,s,i,o;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(s=(r=this.props).onError)!=null&&s.call(r,e)||(o=(i=this.context)==null?void 0:i.onError)==null||o.call(i,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!O2({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const r in e)e[r].layoutChanged()&&(t=!0);for(const r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const i=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const s in t)Object.defineProperty(r,s,{value:t[s]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(ct.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>Eh&&fe.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ct=Jr.allocate(ct,t,{size:4,copy:!0,maxCount:Math.max(t,Eh)});const s=Math.floor(ct.length/4),i=[0,0,0];for(let o=r;o<s;o++)this.encodePickingColor(o,i),ct[o*4+0]=i[0],ct[o*4+1]=i[1],ct[o*4+2]=i[2],ct[o*4+3]=0}e.value=ct.subarray(0,t*4)}_setModelAttributes(e,t,r=!1){var a;if(!Object.keys(t).length)return;if(r){const c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts(e)),t=c.getAttributes()}const s=((a=e.userData)==null?void 0:a.excludeAttributes)||{},i={},o={};for(const c in t){if(s[c])continue;const l=t[c].getValue();for(const u in l){const h=l[u];h instanceof xe?t[c].settings.isIndexed?e.setIndexBuffer(h):i[u]=h:h&&(o[u]=h)}}e.setAttributes(i),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:s}=this.getAttributeManager().attributes,i=r||s,o=i&&t.attributes&&t.attributes[i.id];if(o&&o.value){const a=o.value,c=this.encodePickingColor(e);for(let l=0;l<t.length;l++){const u=i.getVertexOffset(l);a[u]===c[0]&&a[u+1]===c[1]&&a[u+2]===c[2]&&this._disablePickingIndex(l)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,s=t||r;if(!s)return;const i=s.getVertexOffset(e),o=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(o-i),i)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==ct.buffer&&(r.value=ct.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){He(!this.internalState),He(Number.isFinite(this.props.coordinateSystem)),We(E2,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new S2({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(fe.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new K3(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){We(I2,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(We(R2,this,e),!e)return;const t=this.props,r=this.context,s=this.internalState,i=r.viewport,o=this._updateUniformTransition();s.propsInTransition=o,r.viewport=s.viewport||i,this.props=o;try{const a=this._getUpdateParams(),c=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);this.setNeedsRedraw(),this._updateAttributes();const l=this.getModels()[0]!==c[0];this._postUpdate(a,l)}finally{r.viewport=i,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){We(C2,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:s={}}){this._updateAttributeTransition();const i=this.props,o=this.context;this.props=this.internalState.propsInTransition||i;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:a}=this.props,c=a&&a(r)||[0,0];o.device instanceof Kn&&o.device.setParametersWebGL({polygonOffset:c});for(const l of this.getModels())l.device.type==="webgpu"?l.setParameters({...l.parameters,...s}):l.setParameters(s);if(o.device instanceof Kn)o.device.withParametersWebGL(s,()=>{const l={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:s,context:o};for(const u of this.props.extensions)u.draw.call(this,l,u);this.draw(l)});else{const l={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:s,context:o};for(const u of this.props.extensions)u.draw.call(this,l,u);this.draw(l)}}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let i=!1;switch(s){case"dataChanged":const o=e[s],a=t[s];o&&Array.isArray(a)&&(t.dataChanged=Array.isArray(o)?a.concat(o):o,i=!0);default:t[s]||(t[s]=e[s],i=!0)}i&&We(A2,this,s,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var s;const r=J3(e,t);if(r.updateTriggersChanged)for(const i in r.updateTriggersChanged)r.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(r.transitionsChanged)for(const i in r.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],(s=e.transitions)==null?void 0:s[i]);return this.setChangeFlags(r)}validateProps(){Z3(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Ji(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:s}=e,i=this.state.model;i!=null&&i.isInstanced&&i.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:c}=r;if(t||s.autoHighlight!==o||s.highlightedObjectIndex!==a||s.highlightColor!==c){const l={};Array.isArray(c)&&(l.highlightColor=c),(t||s.autoHighlight!==o||a!==s.highlightedObjectIndex)&&(l.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:l})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),s=r?r.getNeedsRedraw(e):!1;if(t=t||s,t)for(const i of this.props.extensions)i.onNeedsRedraw.call(this,i);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}mr.defaultProps=k2;mr.layerName="Layer";const M2="compositeLayer.renderLayers";class Zc extends mr{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,s)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,s)}return e}getSubLayerProps(e={}){var M;const{opacity:t,pickable:r,visible:s,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:p,extensions:m,fetch:g,operation:y,_subLayerProps:S}=this.props,v={id:"",updateTriggers:{},opacity:t,pickable:r,visible:s,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:p,extensions:m,fetch:g,operation:y},x=S&&e.id&&S[e.id],T=x&&x.updateTriggers,I=e.id||"sublayer";if(x){const N=this.props[Gt],L=e.type?e.type._propTypes:{};for(const j in x){const $=L[j]||N[j];$&&$.type==="accessor"&&(x[j]=this.getSubLayerAccessor(x[j]))}}Object.assign(v,e,x),v.id=`${this.props.id}-${I}`,v.updateTriggers={all:(M=this.props.updateTriggers)==null?void 0:M.all,...e.updateTriggers,...T};for(const N of m){const L=N.getSubLayerProps.call(this,N);L&&Object.assign(v,L,{updateTriggers:Object.assign(v.updateTriggers,L.updateTriggers)})}return v}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const s=!r||this.needsUpdate();if(s){const i=this.renderLayers();r=$c(i,Boolean),this.internalState.subLayers=r}We(M2,this,s,r);for(const i of r)i.parent=this}}Zc.layerName="CompositeLayer";const N2=typeof window<"u"?C.useLayoutEffect:C.useEffect;function _i(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const D2={position:"absolute",zIndex:-1};function Pg(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>Pg(t,e));if(Gi(n)){if(F2(n))return e.style=D2,C.cloneElement(n,e);if(U2(n))return C.cloneElement(n,e)}return n}function Gi(n){return n&&typeof n=="object"&&"type"in n||!1}function F2(n){var e;return(e=n.props)==null?void 0:e.mapStyle}function U2(n){const e=n.type;return e&&e.deckGLViewProps}function ec(n){if(typeof n=="function")return C.createElement(lr,{},n);if(Array.isArray(n))return n.map(ec);if(Gi(n)){if(n.type===C.Fragment)return ec(n.props.children);if(_i(n.type,lr))return n}return n}function B2({children:n,layers:e=[],views:t=null}){const r=[],s=[],i={};return C.Children.forEach(ec(n),o=>{if(Gi(o)){const a=o.type;if(_i(a,mr)){const c=L2(a,o.props);s.push(c)}else r.push(o);if(_i(a,lr)&&a!==lr&&o.props.id){const c=new a(o.props);i[c.id]=c}}else o&&r.push(o)}),Object.keys(i).length>0&&(Array.isArray(t)?t.forEach(o=>{i[o.id]=o}):t&&(i[t.id]=t),t=Object.values(i)),e=s.length>0?[...s,...e]:e,{layers:e,children:r,views:t}}function L2(n,e){const t={},r=n.defaultProps||{};for(const s in e)r[s]!==e[s]&&(t[s]=e[s]);return new n(t)}const V2=C.createContext();function $2({children:n,deck:e,ContextProvider:t=V2.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const s={},i=r.views[0].id;for(const o of n){let a=i,c=o;Gi(o)&&_i(o.type,lr)&&(a=o.props.id||i,c=o.props.children);const l=r.getViewport(a),u=r.getViewState(a);if(l){u.padding=l.padding;const{x:h,y:f,width:d,height:p}=l;c=Pg(c,{x:h,y:f,width:d,height:p,viewport:l,viewState:u}),s[a]||(s[a]={viewport:l,children:[]}),s[a].children.push(c)}}return Object.keys(s).map(o=>{const{viewport:a,children:c}=s[o],{x:l,y:u,width:h,height:f}=a,d={position:"absolute",left:l,top:u,width:h,height:f},p=`view-${o}`,m=C.createElement("div",{key:p,id:p,style:d},...c),g={deck:e,viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:S=>{S.viewId=o,e._onViewStateChange(S)},widgets:[]},y=`view-${o}-context`;return C.createElement(t,{key:y,value:g},m)})}const j2={mixBlendMode:null};function W2({width:n,height:e,style:t}){const r={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const i in t)i in j2?s[i]=t[i]:r[i]=t[i];return{containerStyle:r,canvasStyle:s}}function H2(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function Og(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function z2(n,e,t){var s,i,o;const r=new e({...t,_customRender:((o=(i=(s=t.deviceProps)==null?void 0:s.adapters)==null?void 0:i[0])==null?void 0:o.type)==="webgpu"?void 0:a=>{n.redrawReason=a;const c=r.getViewports();n.lastRenderedViewports!==c?n.forceUpdate():Og(n)}});return r}function X2(n,e){const[t,r]=C.useState(0),i=C.useRef({control:null,version:t,forceUpdate:()=>r(T=>T+1)}).current,o=C.useRef(null),a=C.useRef(null),c=C.useMemo(()=>B2(n),[n.layers,n.views,n.children]);let l=!0;const u=T=>{var I;return l&&n.viewState?(i.viewStateUpdateRequested=T,null):(i.viewStateUpdateRequested=null,(I=n.onViewStateChange)==null?void 0:I.call(n,T))},h=T=>{var I;l?i.interactionStateUpdateRequested=T:(i.interactionStateUpdateRequested=null,(I=n.onInteractionStateChange)==null||I.call(n,T))},f=C.useMemo(()=>{const T={widgets:[],...n,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:c.layers,views:c.views,onViewStateChange:u,onInteractionStateChange:h};return delete T._customRender,i.deck&&i.deck.setProps(T),T},[n]);C.useEffect(()=>{const T=n.Deck||qc;return i.deck=z2(i,T,{...f,parent:o.current,canvas:a.current}),()=>{var I;return(I=i.deck)==null?void 0:I.finalize()}},[]),N2(()=>{Og(i);const{viewStateUpdateRequested:T,interactionStateUpdateRequested:I}=i;T&&u(T),I&&h(I)}),C.useImperativeHandle(e,()=>H2(i),[]);const d=i.deck&&i.deck.isInitialized?i.deck.getViewports():void 0,{ContextProvider:p,width:m="100%",height:g="100%",id:y,style:S}=n,{containerStyle:v,canvasStyle:x}=C.useMemo(()=>W2({width:m,height:g,style:S}),[m,g,S]);if(!i.viewStateUpdateRequested&&i.lastRenderedViewports===d||i.version!==t){i.lastRenderedViewports=d,i.version=t;const T=$2({children:c.children,deck:i.deck,ContextProvider:p}),I=C.createElement("canvas",{key:"canvas",id:y||"deckgl-overlay",ref:a,style:x});i.control=C.createElement("div",{id:`${y||"deckgl"}-wrapper`,ref:o,style:v},[I,T])}return l=!1,i.control}const q2=C.forwardRef(X2),Y2="modulepreload",K2=function(n){return"/accidents/"+n},Rh={},bn=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(c=>{if(c=K2(c),c in Rh)return;Rh[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":Y2,l||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),l)return new Promise((f,d)=>{h.addEventListener("load",f),h.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},Z2=C.createContext(null);function J2(n,e){const t=Array.isArray(n)?n[0]:n?n.x:0,r=Array.isArray(n)?n[1]:n?n.y:0,s=Array.isArray(e)?e[0]:e?e.x:0,i=Array.isArray(e)?e[1]:e?e.y:0;return t===s&&r===i}function bt(n,e){if(n===e)return!0;if(!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!bt(n[t],e[t]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(const s of t)if(!e.hasOwnProperty(s)||!bt(n[s],e[s]))return!1;return!0}return!1}function Ch(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function Ih(n,e){const t=e.viewState||e,r={};if("longitude"in t&&"latitude"in t&&(t.longitude!==n.center.lng||t.latitude!==n.center.lat)){const s=n.center.constructor;r.center=new s(t.longitude,t.latitude)}return"zoom"in t&&t.zoom!==n.zoom&&(r.zoom=t.zoom),"bearing"in t&&t.bearing!==n.bearing&&(r.bearing=t.bearing),"pitch"in t&&t.pitch!==n.pitch&&(r.pitch=t.pitch),t.padding&&n.padding&&!bt(t.padding,n.padding)&&(r.padding=t.padding),r}const Q2=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ph(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const e={};for(const r of n.layers)e[r.id]=r;const t=n.layers.map(r=>{let s=null;"interactive"in r&&(s=Object.assign({},r),delete s.interactive);const i=e[r.ref];if(i){s=s||Object.assign({},r),delete s.ref;for(const o of Q2)o in i&&(s[o]=i[o])}return s||r});return{...n,layers:t}}const Oh={version:8,sources:{},layers:[]},kh={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Mh={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Nh={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},G2=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],eE=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class hr{constructor(e,t,r){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=s=>{const i=this.props[Nh[s.type]];i?i(s):s.type==="error"&&console.error(s.error)},this._onCameraEvent=s=>{if(this._internalUpdate)return;s.viewState=this._propsedCameraUpdate||Ch(this._map.transform);const i=this.props[Mh[s.type]];i&&i(s)},this._onCameraUpdate=s=>this._internalUpdate?s:(this._propsedCameraUpdate=Ch(s),Ih(s,this.props)),this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const i=this.props[kh[s.type]];i&&(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"&&(s.features=this._hoveredFeatures||this._queryRenderedFeatures(s.point)),i(s),delete s.features)},this._MapClass=e,this.props=t,this._initialize(r)}get map(){return this._map}setProps(e){const t=this.props;this.props=e;const r=this._updateSettings(e,t),s=this._updateSize(e),i=this._updateViewState(e);this._updateStyle(e,t),this._updateStyleComponents(e),this._updateHandlers(e,t),(r||s||i&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const r=hr.savedMaps.pop();if(!r)return null;const s=r.map,i=s.getContainer();for(t.className=i.className;i.childNodes.length>0;)t.appendChild(i.childNodes[0]);s._container=t;const o=s._resizeObserver;o&&(o.disconnect(),o.observe(t)),r.setProps({...e,styleDiffing:!1}),s.resize();const{initialViewState:a}=e;return a&&(a.bounds?s.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a)),s.isStyleLoaded()?s.fire("load"):s.once("style.load",()=>s.fire("load")),s._update(),r}_initialize(e){const{props:t}=this,{mapStyle:r=Oh}=t,s={...t,...t.initialViewState,container:e,style:Ph(r)},i=s.initialViewState||s.viewState||s;if(Object.assign(s,{center:[i.longitude||0,i.latitude||0],zoom:i.zoom||0,pitch:i.pitch||0,bearing:i.bearing||0}),t.gl){const a=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=a,t.gl)}const o=new this._MapClass(s);i.padding&&o.setPadding(i.padding),t.cursor&&(o.getCanvas().style.cursor=t.cursor),o.transformCameraUpdate=this._onCameraUpdate,o.on("style.load",()=>{var a;this._styleComponents={light:o.getLight(),sky:o.getSky(),projection:(a=o.getProjection)==null?void 0:a.call(o),terrain:o.getTerrain()},this._updateStyleComponents(this.props)}),o.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const a in kh)o.on(a,this._onPointerEvent);for(const a in Mh)o.on(a,this._onCameraEvent);for(const a in Nh)o.on(a,this._onEvent);this._map=o}recycle(){const t=this.map.getContainer().querySelector("[mapboxgl-children]");t==null||t.remove(),hr.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:t}=e;if(t){const r=this._map;if(t.width!==r.transform.width||t.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e){const t=this._map,r=t.transform;if(!t.isMoving()){const i=Ih(r,e);if(Object.keys(i).length>0)return this._internalUpdate=!0,t.jumpTo(i),this._internalUpdate=!1,!0}return!1}_updateSettings(e,t){const r=this._map;let s=!1;for(const i of G2)if(i in e&&!bt(e[i],t[i])){s=!0;const o=r[`set${i[0].toUpperCase()}${i.slice(1)}`];o==null||o.call(r,e[i])}return s}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:r=Oh,styleDiffing:s=!0}=e,i={diff:s};"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Ph(r),i)}}_updateStyleComponents({light:e,projection:t,sky:r,terrain:s}){var a,c;const i=this._map,o=this._styleComponents;i.style._loaded&&(e&&!bt(e,o.light)&&(o.light=e,i.setLight(e)),t&&!bt(t,o.projection)&&t!==((a=o.projection)==null?void 0:a.type)&&(o.projection=typeof t=="string"?{type:t}:t,(c=i.setProjection)==null||c.call(i,o.projection)),r&&!bt(r,o.sky)&&(o.sky=r,i.setSky(r)),s!==void 0&&!bt(s,o.terrain)&&(!s||i.getSource(s.source))&&(o.terrain=s,i.setTerrain(s)))}_updateHandlers(e,t){const r=this._map;for(const s of eE){const i=e[s]??!0,o=t[s]??!0;bt(i,o)||(i?r[s].enable(i):r[s].disable())}}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:r=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:r.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){var s;const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const i=e.type,o=((s=this._hoveredFeatures)==null?void 0:s.length)>0,a=this._queryRenderedFeatures(e.point),c=a.length>0;!c&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,c&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=i}else this._hoveredFeatures=null}}hr.savedMaps=[];const tE=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function nE(n){if(!n)return null;const e=n.map,t={getMap:()=>e};for(const r of rE(e))!(r in t)&&!tE.includes(r)&&(t[r]=e[r].bind(e));return t}function rE(n){const e=new Set;let t=n;for(;t;){for(const r of Object.getOwnPropertyNames(t))r[0]!=="_"&&typeof n[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);t=Object.getPrototypeOf(t)}return Array.from(e)}const sE=typeof document<"u"?C.useLayoutEffect:C.useEffect;function iE(n,e){const{RTLTextPlugin:t,maxParallelImageRequests:r,workerCount:s,workerUrl:i}=e;if(t&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:o,lazy:a=!0}=typeof t=="string"?{pluginUrl:t}:t;n.setRTLTextPlugin(o,c=>{c&&console.error(c)},a)}r!==void 0&&n.setMaxParallelImageRequests(r),s!==void 0&&n.setWorkerCount(s),i!==void 0&&n.setWorkerUrl(i)}const eo=C.createContext(null);function oE(n,e){const t=C.useContext(Z2),[r,s]=C.useState(null),i=C.useRef(),{current:o}=C.useRef({mapLib:null,map:null});C.useEffect(()=>{const l=n.mapLib;let u=!0,h;return Promise.resolve(l||bn(()=>import("./maplibre-gl-CcwOsANJ.js").then(f=>f.m),[])).then(f=>{if(!u)return;if(!f)throw new Error("Invalid mapLib");const d="Map"in f?f:f.default;if(!d.Map)throw new Error("Invalid mapLib");if(iE(d,n),!d.supported||d.supported(n))n.reuseMaps&&(h=hr.reuse(n,i.current)),h||(h=new hr(d.Map,n,i.current)),o.map=nE(h),o.mapLib=d,s(h),t==null||t.onMapMount(o.map,n.id);else throw new Error("Map is not supported by this browser")}).catch(f=>{const{onError:d}=n;d?d({type:"error",target:null,originalEvent:null,error:f}):console.error(f)}),()=>{u=!1,h&&(t==null||t.onMapUnmount(n.id),n.reuseMaps?h.recycle():h.destroy())}},[]),sE(()=>{r&&r.setProps(n)}),C.useImperativeHandle(e,()=>o.map,[r]);const a=C.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]),c={height:"100%"};return C.createElement("div",{id:n.id,ref:i,style:a},r&&C.createElement(eo.Provider,{value:o},C.createElement("div",{"mapboxgl-children":"",style:c},n.children)))}const aE=C.forwardRef(oE);var Jc=c_();const cE=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Dt(n,e){if(!n||!e)return;const t=n.style;for(const r in e){const s=e[r];Number.isFinite(s)&&!cE.test(r)?t[r]=`${s}px`:t[r]=s}}C.memo(C.forwardRef((n,e)=>{const{map:t,mapLib:r}=C.useContext(eo),s=C.useRef({props:n});s.current.props=n;const i=C.useMemo(()=>{let m=!1;C.Children.forEach(n.children,S=>{S&&(m=!0)});const g={...n,element:m?document.createElement("div"):null},y=new r.Marker(g);return y.setLngLat([n.longitude,n.latitude]),y.getElement().addEventListener("click",S=>{var v,x;(x=(v=s.current.props).onClick)==null||x.call(v,{type:"click",target:y,originalEvent:S})}),y.on("dragstart",S=>{var x,T;const v=S;v.lngLat=i.getLngLat(),(T=(x=s.current.props).onDragStart)==null||T.call(x,v)}),y.on("drag",S=>{var x,T;const v=S;v.lngLat=i.getLngLat(),(T=(x=s.current.props).onDrag)==null||T.call(x,v)}),y.on("dragend",S=>{var x,T;const v=S;v.lngLat=i.getLngLat(),(T=(x=s.current.props).onDragEnd)==null||T.call(x,v)}),y},[]);C.useEffect(()=>(i.addTo(t.getMap()),()=>{i.remove()}),[]);const{longitude:o,latitude:a,offset:c,style:l,draggable:u=!1,popup:h=null,rotation:f=0,rotationAlignment:d="auto",pitchAlignment:p="auto"}=n;return C.useEffect(()=>{Dt(i.getElement(),l)},[l]),C.useImperativeHandle(e,()=>i,[]),(i.getLngLat().lng!==o||i.getLngLat().lat!==a)&&i.setLngLat([o,a]),c&&!J2(i.getOffset(),c)&&i.setOffset(c),i.isDraggable()!==u&&i.setDraggable(u),i.getRotation()!==f&&i.setRotation(f),i.getRotationAlignment()!==d&&i.setRotationAlignment(d),i.getPitchAlignment()!==p&&i.setPitchAlignment(p),i.getPopup()!==h&&i.setPopup(h),Jc.createPortal(n.children,i.getElement())}));function Dh(n){return new Set(n?n.trim().split(/\s+/):[])}C.memo(C.forwardRef((n,e)=>{const{map:t,mapLib:r}=C.useContext(eo),s=C.useMemo(()=>document.createElement("div"),[]),i=C.useRef({props:n});i.current.props=n;const o=C.useMemo(()=>{const a={...n},c=new r.Popup(a);return c.setLngLat([n.longitude,n.latitude]),c.once("open",l=>{var u,h;(h=(u=i.current.props).onOpen)==null||h.call(u,l)}),c},[]);if(C.useEffect(()=>{const a=c=>{var l,u;(u=(l=i.current.props).onClose)==null||u.call(l,c)};return o.on("close",a),o.setDOMContent(s).addTo(t.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),C.useEffect(()=>{Dt(o.getElement(),n.style)},[n.style]),C.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==n.longitude||o.getLngLat().lat!==n.latitude)&&o.setLngLat([n.longitude,n.latitude]),n.offset&&!bt(o.options.offset,n.offset)&&o.setOffset(n.offset),(o.options.anchor!==n.anchor||o.options.maxWidth!==n.maxWidth)&&(o.options.anchor=n.anchor,o.setMaxWidth(n.maxWidth)),o.options.className!==n.className)){const a=Dh(o.options.className),c=Dh(n.className);for(const l of a)c.has(l)||o.removeClassName(l);for(const l of c)a.has(l)||o.addClassName(l);o.options.className=n.className}return Jc.createPortal(n.children,s)}));function xn(n,e,t,r){const s=C.useContext(eo),i=C.useMemo(()=>n(s),[]);return C.useEffect(()=>{const o=e,a=null,c=typeof e=="function"?e:null,{map:l}=s;return l.hasControl(i)||(l.addControl(i,o==null?void 0:o.position),a&&a(s)),()=>{c&&c(s),l.hasControl(i)&&l.removeControl(i)}},[]),i}function lE(n){const e=xn(({mapLib:t})=>new t.AttributionControl(n),{position:n.position});return C.useEffect(()=>{Dt(e._container,n.style)},[n.style]),null}C.memo(lE);function uE(n){const e=xn(({mapLib:t})=>new t.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return C.useEffect(()=>{Dt(e._controlContainer,n.style)},[n.style]),null}C.memo(uE);function hE(n,e){const t=C.useRef({props:n}),r=xn(({mapLib:s})=>{const i=new s.GeolocateControl(n),o=i._setupUI;return i._setupUI=()=>{i._container.hasChildNodes()||o()},i.on("geolocate",a=>{var c,l;(l=(c=t.current.props).onGeolocate)==null||l.call(c,a)}),i.on("error",a=>{var c,l;(l=(c=t.current.props).onError)==null||l.call(c,a)}),i.on("outofmaxbounds",a=>{var c,l;(l=(c=t.current.props).onOutOfMaxBounds)==null||l.call(c,a)}),i.on("trackuserlocationstart",a=>{var c,l;(l=(c=t.current.props).onTrackUserLocationStart)==null||l.call(c,a)}),i.on("trackuserlocationend",a=>{var c,l;(l=(c=t.current.props).onTrackUserLocationEnd)==null||l.call(c,a)}),i},{position:n.position});return t.current.props=n,C.useImperativeHandle(e,()=>r,[]),C.useEffect(()=>{Dt(r._container,n.style)},[n.style]),null}C.memo(C.forwardRef(hE));function fE(n){const e=xn(({mapLib:t})=>new t.NavigationControl(n),{position:n.position});return C.useEffect(()=>{Dt(e._container,n.style)},[n.style]),null}C.memo(fE);function dE(n){const e=xn(({mapLib:i})=>new i.ScaleControl(n),{position:n.position}),t=C.useRef(n),r=t.current;t.current=n;const{style:s}=n;return n.maxWidth!==void 0&&n.maxWidth!==r.maxWidth&&(e.options.maxWidth=n.maxWidth),n.unit!==void 0&&n.unit!==r.unit&&e.setUnit(n.unit),C.useEffect(()=>{Dt(e._container,s)},[s]),null}C.memo(dE);function pE(n){const e=xn(({mapLib:t})=>new t.TerrainControl(n),{position:n.position});return C.useEffect(()=>{Dt(e._container,n.style)},[n.style]),null}C.memo(pE);function gE(n){const e=xn(({mapLib:t})=>new t.LogoControl(n),{position:n.position});return C.useEffect(()=>{Dt(e._container,n.style)},[n.style]),null}C.memo(gE);function mE({pointCount:n,getBinId:e}){const t=new Map;for(let r=0;r<n;r++){const s=e(r);if(s===null)continue;let i=t.get(String(s));i?i.points.push(r):(i={id:s,index:t.size,points:[r]},t.set(String(s),i))}return Array.from(t.values())}function _E({bins:n,dimensions:e,target:t}){const r=n.length*e;(!t||t.length<r)&&(t=new Float32Array(r));for(let s=0;s<n.length;s++){const{id:i}=n[s];Array.isArray(i)?t.set(i,s*e):t[s]=i}return t}const bE=n=>n.length,kg=(n,e)=>{let t=0;for(const r of n)t+=e(r);return t},yE=(n,e)=>n.length===0?NaN:kg(n,e)/n.length,vE=(n,e)=>{let t=1/0;for(const r of n){const s=e(r);s<t&&(t=s)}return t},wE=(n,e)=>{let t=-1/0;for(const r of n){const s=e(r);s>t&&(t=s)}return t},TE={COUNT:bE,SUM:kg,MEAN:yE,MIN:vE,MAX:wE};function xE({bins:n,getValue:e,operation:t,target:r}){(!r||r.length<n.length)&&(r=new Float32Array(n.length));let s=1/0,i=-1/0;for(let o=0;o<n.length;o++){const{points:a}=n[o];r[o]=t(a,e),r[o]<s&&(s=r[o]),r[o]>i&&(i=r[o])}return{value:r,domain:[s,i]}}function Fh(n,e,t){const r={};for(const i of n.sources||[]){const o=e[i];if(o)r[i]=SE(o);else throw new Error(`Cannot find attribute ${i}`)}const s={};return i=>{for(const o in r)s[o]=r[o](i);return n.getValue(s,i,t)}}function SE(n){const e=n.value,{offset:t=0,stride:r,size:s}=n.getAccessor(),i=e.BYTES_PER_ELEMENT,o=t/i,a=r?r/i:s;if(s===1)return n.isConstant?()=>e[0]:l=>{const u=o+a*l;return e[u]};let c;return n.isConstant?(c=Array.from(e),()=>c):(c=new Array(s),l=>{const u=o+a*l;for(let h=0;h<s;h++)c[h]=e[u+h];return c})}class AE{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){const t=this.props;if(e.binOptions&&(Ye(e.binOptions,t.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let r=0;r<this.channelCount;r++)e.operations[r]!==t.operations[r]&&this.setNeedsUpdate(r);if(e.customOperations)for(let r=0;r<this.channelCount;r++)!!e.customOperations[r]!=!!t.customOperations[r]&&this.setNeedsUpdate(r);e.pointCount!==void 0&&e.pointCount!==t.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...t.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){var e,t,r,s;if(this.needsUpdate===!0){this.bins=mE({pointCount:this.props.pointCount,getBinId:Fh(this.props.getBin,this.props.attributes,this.props.binOptions)});const i=_E({bins:this.bins,dimensions:this.dimensions,target:(e=this.binIds)==null?void 0:e.value});this.binIds={value:i,type:"float32",size:this.dimensions}}for(let i=0;i<this.channelCount;i++)if(this.needsUpdate===!0||this.needsUpdate[i]){const o=this.props.customOperations[i]||TE[this.props.operations[i]],{value:a,domain:c}=xE({bins:this.bins,getValue:Fh(this.props.getValue[i],this.props.attributes,void 0),operation:o,target:(t=this.results[i])==null?void 0:t.value});this.results[i]={value:a,domain:c,type:"float32",size:1},(s=(r=this.props).onUpdate)==null||s.call(r,{channel:i})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){var t;return((t=this.results[e])==null?void 0:t.domain)??[1/0,-1/0]}getBin(e){const t=this.bins[e];if(!t)return null;const r=new Array(this.channelCount);for(let s=0;s<r.length;s++){const i=this.results[s];r[s]=i==null?void 0:i.value[e]}return{id:t.id,value:r,count:t.points.length,pointIndices:t.points}}}function Mg(n,e,t){return n.createFramebuffer({width:e,height:t,colorAttachments:[n.createTexture({width:e,height:t,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const EE=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,RE={name:"binSorter",vs:EE,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},Ng=[1,2,4,8],CE=3e38,IE={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},Ls=1024;class PE{constructor(e,t){this.binsFBO=null,this.device=e,this.model=kE(e,t)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){var e,t;this.model.destroy(),(e=this.binsFBO)==null||e.colorAttachments[0].texture.destroy(),(t=this.binsFBO)==null||t.destroy()}getBinValues(e){if(!this.binsFBO)return null;const t=e%Ls,r=Math.floor(e/Ls),s=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:t,sourceY:r,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(s)}setDimensions(e,t){var o,a;const r=Ls,s=Math.ceil(e/r);this.binsFBO?this.binsFBO.height<s&&this.binsFBO.resize({width:r,height:s}):this.binsFBO=Mg(this.device,r,s);const i={binIdRange:[t[0][0],t[0][1],((o=t[1])==null?void 0:o[0])||0,((a=t[1])==null?void 0:a[1])||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:i})}setModelProps(e){const t=this.model;e.attributes&&t.setAttributes(e.attributes),e.constantAttributes&&t.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&t.setVertexCount(e.vertexCount),e.shaderModuleProps&&t.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;const t=OE(e);this._updateBins("SUM",t.SUM+t.MEAN),this._updateBins("MIN",t.MIN),this._updateBins("MAX",t.MAX)}_updateBins(e,t){if(t===0)return;t|=Ng[3];const r=this.model,s=this.binsFBO,i=e==="MAX"?-3e38:e==="MIN"?CE:0,o=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:s,parameters:{viewport:[0,0,s.width,s.height],colorMask:t},clearColor:[i,i,i,0],clearDepth:!1,clearStencil:!1});r.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),r.draw(o),o.end()}}function OE(n){const e={...IE};for(let t=0;t<n.length;t++){const r=n[t];r&&(e[r]+=Ng[t])}return e}function kE(n,e){let t=e.vs;e.dimensions===2&&(t+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const r=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${t}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,s=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Mt(n,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],RE],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:r,fs:s,topology:"point-list",disableWarnings:!0})}const ME=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,NE={name:"aggregatorTransform",vs:ME,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class DE{constructor(e,t){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=t.channelCount,this.transform=FE(e,t),this.domainFBO=Mg(e,2,1)}destroy(){var e,t;this.transform.destroy(),(e=this.binBuffer)==null||e.destroy(),(t=this.valueBuffer)==null||t.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,t=new Float32Array(e);this._domains=[[-t[4],t[0]],[-t[5],t[1]],[-t[6],t[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,t){var c,l,u,h;const{model:r,transformFeedback:s}=this.transform;r.setVertexCount(e);const i={binIdRange:[t[0][0],t[0][1],((c=t[1])==null?void 0:c[0])||0,((l=t[1])==null?void 0:l[1])||0]};r.shaderInputs.setProps({aggregatorTransform:i});const o=e*t.length*4;(!this.binBuffer||this.binBuffer.byteLength<o)&&((u=this.binBuffer)==null||u.destroy(),this.binBuffer=this.device.createBuffer({byteLength:o}),s.setBuffer("binIds",this.binBuffer));const a=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<a)&&((h=this.valueBuffer)==null||h.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:a}),s.setBuffer("values",this.valueBuffer))}update(e,t){if(!e)return;const r=this.transform,s=this.domainFBO,i=[0,1,2].map(c=>t[c]==="COUNT"?1:0),o=[0,1,2].map(c=>t[c]==="MEAN"?1:0),a={isCount:i,isMean:o,bins:e};r.model.shaderInputs.setProps({aggregatorTransform:a}),r.run({id:"gpu-aggregation-domain",framebuffer:s,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function FE(n,e){const t=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,r=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new cr(n,{vs:t,fs:r,topology:"point-list",modules:[NE],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:Ls},varyings:["binIds","values"],disableWarnings:!0})}class Uh{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,t){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=t.dimensions,this.channelCount=t.channelCount,this.props={...t,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new PE(e,t),this.aggregationTransform=new DE(e,t),this.setProps(t)}getBins(){var t;const e=this.aggregationTransform.binBuffer;return e?(((t=this.binIds)==null?void 0:t.buffer)!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){var r;const t=this.aggregationTransform.valueBuffer;return!t||e>=this.channelCount?null:(((r=this.results[e])==null?void 0:r.buffer)!==t&&(this.results[e]={buffer:t,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;const{binIdRange:t}=this.props;let r;if(this.dimensions===1)r=[e+t[0][0]];else{const[[a,c],[l]]=t,u=c-a;r=[e%u+a,Math.floor(e/u)+l]}const s=this.binSorter.getBinValues(e);if(!s)return null;const i=s[3],o=[];for(let a=0;a<this.channelCount;a++){const c=this.props.operations[a];c==="COUNT"?o[a]=i:i===0?o[a]=NaN:o[a]=c==="MEAN"?s[a]/i:s[a]}return{id:r,value:o,count:i}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){const t=this.props;if("binIdRange"in e&&!Ye(e.binIdRange,t.binIdRange,2)){const r=e.binIdRange;if(fe.assert(r.length===this.dimensions),this.dimensions===1){const[[s,i]]=r;this.binCount=i-s}else{const[[s,i],[o,a]]=r;this.binCount=(i-s)*(a-o)}this.binSorter.setDimensions(this.binCount,r),this.aggregationTransform.setDimensions(this.binCount,r),this.setNeedsUpdate()}if(e.operations)for(let r=0;r<this.channelCount;r++)e.operations[r]!==t.operations[r]&&this.setNeedsUpdate(r);if(e.pointCount!==void 0&&e.pointCount!==t.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(Ye(e.binOptions,t.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){const r={},s={};for(const i of Object.values(e.attributes))for(const[o,a]of Object.entries(i.getValue()))ArrayBuffer.isView(a)?s[o]=a:a&&(r[o]=a);this.binSorter.setModelProps({attributes:r,constantAttributes:s})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){var r,s;if(!this.needsUpdate.some(Boolean))return;const{operations:e}=this.props,t=this.needsUpdate.map((i,o)=>i?e[o]:null);this.binSorter.update(t),this.aggregationTransform.update(this.binSorter.texture,e);for(let i=0;i<this.channelCount;i++)this.needsUpdate[i]&&(this.needsUpdate[i]=!1,(s=(r=this.props).onUpdate)==null||s.call(r,{channel:i}))}}let Dg=class extends Zc{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){var r,s;super.updateState(e);const t=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==t){(r=this.state.aggregator)==null||r.destroy();const i=this.createAggregator(t);return i.setProps({attributes:(s=this.getAttributeManager())==null?void 0:s.attributes}),this.setState({aggregator:i,aggregatorType:t}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){const{aggregator:t}=this.state;t.setProps({attributes:e});for(const r in e)this.onAttributeChange(r);t.update()}draw({shaderModuleProps:e}){const{aggregator:t}=this.state;t.setProps({shaderModuleProps:e}),t.preDraw()}_getAttributeManager(){return new Ji(this.context.device,{id:this.props.id,stats:this.context.stats})}};Dg.layerName="AggregationLayer";const Fg=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function Ug(n,e=!1,t=Float32Array){let r;if(Number.isFinite(n[0]))r=new t(n);else{r=new t(n.length*4);let s=0;for(let i=0;i<n.length;i++){const o=n[i];r[s++]=o[0],r[s++]=o[1],r[s++]=o[2],r[s++]=Number.isFinite(o[3])?o[3]:255}}if(e)for(let s=0;s<r.length;s++)r[s]/=255;return r}const bi={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function UE(n,e){n.setSampler({minFilter:bi[e],magFilter:bi[e]})}function BE(n,e,t="linear"){const r=Ug(e,!1,Uint8Array);return n.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:bi[t],magFilter:bi[t],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:r,width:r.length/4,height:1})}class Bh{constructor(e,t){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=t,this.attribute=e}getScalePercentile(){if(!this._percentile){const e=Lh(this.input,this.inputLength);this._percentile=VE(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const e=Lh(this.input,this.inputLength);this._ordinal=LE(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:t,upperPercentile:r}){if(e==="quantile")return[t,r-1];if(t>0||r<100){const{domain:s}=this.getScalePercentile();let i=s[Math.floor(t)-1]??-1/0,o=s[Math.floor(r)-1]??1/0;if(e==="ordinal"){const{domain:a}=this.getScaleOrdinal();i=a.findIndex(c=>c>=i),o=a.findIndex(c=>c>o)-1,o===-2&&(o=a.length-1)}return[i,o]}return null}update(e){const t=this.props;if(e.scaleType!==t.scaleType)switch(e.scaleType){case"quantile":{const{attribute:r}=this.getScalePercentile();this.attribute=r,this.domain=[0,99];break}case"ordinal":{const{attribute:r,domain:s}=this.getScaleOrdinal();this.attribute=r,this.domain=[0,s.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==t.scaleType||e.lowerPercentile!==t.lowerPercentile||e.upperPercentile!==t.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}}function LE(n){const e=new Set;for(const s of n)Number.isFinite(s)&&e.add(s);const t=Array.from(e).sort(),r=new Map;for(let s=0;s<t.length;s++)r.set(t[s],s);return{attribute:{value:n.map(s=>Number.isFinite(s)?r.get(s):NaN),type:"float32",size:1},domain:t}}function VE(n,e=100){const t=Array.from(n).filter(Number.isFinite).sort($E);let r=0;const s=Math.max(1,e),i=new Array(s-1);for(;++r<s;)i[r-1]=jE(t,r/s);return{attribute:{value:n.map(o=>Number.isFinite(o)?WE(i,o):NaN),type:"float32",size:1},domain:i}}function Lh(n,e){var o;const t=(n.stride??4)/4,r=(n.offset??0)/4;let s=n.value;if(!s){const a=(o=n.buffer)==null?void 0:o.readSyncWebGL(0,t*4*e);a&&(s=new Float32Array(a.buffer),n.value=s)}if(t===1)return s.subarray(0,e);const i=new Float32Array(e);for(let a=0;a<e;a++)i[a]=s[a*t+r];return i}function $E(n,e){return n-e}function jE(n,e){const t=n.length;if(e<=0||t<2)return n[0];if(e>=1)return n[t-1];const r=(t-1)*e,s=Math.floor(r),i=n[s],o=n[s+1];return i+(o-i)*(r-s)}function WE(n,e){let t=0,r=n.length;for(;t<r;){const s=t+r>>>1;n[s]>e?r=s:t=s+1}return t}function HE({dataBounds:n,getBinId:e,padding:t=0}){const r=[n[0],n[1],[n[0][0],n[1][1]],[n[1][0],n[0][1]]].map(c=>e(c)),s=Math.min(...r.map(c=>c[0]))-t,i=Math.min(...r.map(c=>c[1]))-t,o=Math.max(...r.map(c=>c[0]))+t+1,a=Math.max(...r.map(c=>c[1]))+t+1;return[[s,o],[i,a]]}const zE={COUNTER_CLOCKWISE:-1};function XE(n,e,t={}){return qE(n,t)!==e?(KE(n,t),!0):!1}function qE(n,e={}){return Math.sign(YE(n,e))}const Vh={x:0,y:1,z:2};function YE(n,e={}){const{start:t=0,end:r=n.length,plane:s="xy"}=e,i=e.size||2;let o=0;const a=Vh[s[0]],c=Vh[s[1]];for(let l=t,u=r-i;l<r;l+=i)o+=(n[l+a]-n[u+a])*(n[l+c]+n[u+c]),u=l;return o/2}function KE(n,e){const{start:t=0,end:r=n.length,size:s=2}=e,i=(r-t)/s,o=Math.floor(i/2);for(let a=0;a<o;++a){const c=t+a*s,l=t+(i-1-a)*s;for(let u=0;u<s;++u){const h=n[c+u];n[c+u]=n[l+u],n[l+u]=h}}}class ZE extends IS{constructor(e){const{indices:t,attributes:r}=JE(e);super({...e,indices:t,attributes:r})}}function JE(n){const{radius:e,height:t=1,nradial:r=10}=n;let{vertices:s}=n;s&&(fe.assert(s.length>=r),s=s.flatMap(d=>[d[0],d[1]]),XE(s,zE.COUNTER_CLOCKWISE));const i=t>0,o=r+1,a=i?o*3+1:r,c=Math.PI*2/r,l=new Uint16Array(i?r*3*2:0),u=new Float32Array(a*3),h=new Float32Array(a*3);let f=0;if(i){for(let d=0;d<o;d++){const p=d*c,m=d%r,g=Math.sin(p),y=Math.cos(p);for(let S=0;S<2;S++)u[f+0]=s?s[m*2]:y*e,u[f+1]=s?s[m*2+1]:g*e,u[f+2]=(1/2-S)*t,h[f+0]=s?s[m*2]:y,h[f+1]=s?s[m*2+1]:g,f+=3}u[f+0]=u[f-3],u[f+1]=u[f-2],u[f+2]=u[f-1],f+=3}for(let d=i?0:1;d<o;d++){const p=Math.floor(d/2)*Math.sign(.5-d%2),m=p*c,g=(p+r)%r,y=Math.sin(m),S=Math.cos(m);u[f+0]=s?s[g*2]:S*e,u[f+1]=s?s[g*2+1]:y*e,u[f+2]=t/2,h[f+2]=1,f+=3}if(i){let d=0;for(let p=0;p<r;p++)l[d++]=p*2+0,l[d++]=p*2+2,l[d++]=p*2+0,l[d++]=p*2+1,l[d++]=p*2+1,l[d++]=p*2+3}return{indices:l,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:h}}}}const $h=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,QE={name:"column",vs:$h,fs:$h,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},GE=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,eR=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,yi=[0,0,0,255],tR={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:n=>n.position},getFillColor:{type:"accessor",value:yi},getLineColor:{type:"accessor",value:yi},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Qc extends mr{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:GE,fs:eR,defines:e,modules:[Yi,t?Ep:Ap,Cx,QE]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:yi},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:yi},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var a;super.updateState(e);const{props:t,oldProps:r,changeFlags:s}=e,i=s.extensionsChanged||t.flatShading!==r.flatShading;i&&((a=this.state.models)==null||a.forEach(c=>c.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const o=this.getNumInstances();this.state.fillModel.setInstanceCount(o),this.state.wireframeModel.setInstanceCount(o),(i||t.diskResolution!==r.diskResolution||t.vertices!==r.vertices||(t.extruded||t.stroked)!==(r.extruded||r.stroked))&&this._updateGeometry(t)}getGeometry(e,t,r){const s=new ZE({radius:1,height:r?2:0,vertices:t,nradial:e});let i=0;if(t)for(let o=0;o<e;o++){const a=t[o],c=Math.sqrt(a[0]*a[0]+a[1]*a[1]);i+=c/e}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*i}),s}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),r=new Mt(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),s=new Mt(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:r,wireframeModel:s,models:[s,r]}}_updateGeometry({diskResolution:e,vertices:t,extruded:r,stroked:s}){const i=this.getGeometry(e,t,r||s);this.setState({fillVertexCount:i.attributes.POSITION.value.length/3});const o=this.state.fillModel,a=this.state.wireframeModel;o.setGeometry(i),o.setTopology("triangle-strip"),o.setIndexBuffer(null),a.setGeometry(i),a.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:t,lineWidthScale:r,lineWidthMinPixels:s,lineWidthMaxPixels:i,radiusUnits:o,elevationScale:a,extruded:c,filled:l,stroked:u,wireframe:h,offset:f,coverage:d,radius:p,angle:m}=this.props,g=this.state.fillModel,y=this.state.wireframeModel,{fillVertexCount:S,edgeDistance:v}=this.state,x={radius:p,angle:m/180*Math.PI,offset:f,extruded:c,stroked:u,coverage:d,elevationScale:a,edgeDistance:v,radiusUnits:sr[o],widthUnits:sr[t],widthScale:r,widthMinPixels:s,widthMaxPixels:i};c&&h&&(y.shaderInputs.setProps({column:{...x,isStroke:!0}}),y.draw(this.context.renderPass)),l&&(g.setVertexCount(S),g.shaderInputs.setProps({column:{...x,isStroke:!1}}),g.draw(this.context.renderPass)),!c&&u&&(g.setVertexCount(S*2/3),g.shaderInputs.setProps({column:{...x,isStroke:!0}}),g.draw(this.context.renderPass))}}Qc.layerName="ColumnLayer";Qc.defaultProps=tR;const Bg=Math.PI/3,to=2*Math.sin(Bg),no=1.5,nR=Array.from({length:6},(n,e)=>{const t=e*Bg;return[Math.sin(t),-Math.cos(t)]});function qo([n,e],t){let r=Math.round(e=e/t/no),s=Math.round(n=n/t/to-(r&1)/2);const i=e-r;if(Math.abs(i)*3>1){const o=n-s,a=s+(n<s?-1:1)/2,c=r+(e<r?-1:1),l=n-a,u=e-c;o*o+i*i>l*l+u*u&&(s=a+(r&1?1:-1)/2,r=c)}return[s,r]}const rR=`
const vec2 DIST = vec2(${to}, ${no});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function jh([n,e],t){return[(n+(e&1)/2)*t*to,e*t*no]}const sR=`
const vec2 DIST = vec2(${to}, ${no});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,iR=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${sR}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,oR=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,aR={name:"hexagon",vs:oR,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class Lg extends Qc{getShaders(){const e=super.getShaders();return e.modules.push(aR),{...e,vs:iR}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){var i;super.updateState(e);const{props:t,oldProps:r}=e,s=this.state.fillModel;if(r.colorRange!==t.colorRange){(i=this.state.colorTexture)==null||i.destroy(),this.state.colorTexture=BE(this.context.device,t.colorRange,t.colorScaleType);const o={colorRange:this.state.colorTexture};s.shaderInputs.setProps({hexagon:o})}else r.colorScaleType!==t.colorScaleType&&UE(this.state.colorTexture,t.colorScaleType)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}draw({uniforms:e}){const{radius:t,hexOriginCommon:r,elevationRange:s,elevationScale:i,extruded:o,coverage:a,colorDomain:c,elevationDomain:l}=this.props,u=this.props.colorCutoff||[-1/0,1/0],h=this.props.elevationCutoff||[-1/0,1/0],f=this.state.fillModel;f.vertexArray.indexBuffer&&f.setIndexBuffer(null),f.setVertexCount(this.state.fillVertexCount);const d={colorDomain:[Math.max(c[0],u[0]),Math.min(c[1],u[1]),Math.max(c[0]-1,u[0]),Math.min(c[1]+1,u[1])],elevationDomain:[Math.max(l[0],h[0]),Math.min(l[1],h[1]),Math.max(l[0]-1,h[0]),Math.min(l[1]+1,h[1])],elevationRange:[s[0]*i,s[1]*i],originCommon:r};f.shaderInputs.setProps({column:{extruded:o,coverage:a,radius:t},hexagon:d}),f.draw(this.context.renderPass)}}Lg.layerName="HexagonCellLayer";const cR=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,lR={name:"binOptions",vs:cR,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function Wh(){}const uR={gpuAggregation:!0,colorDomain:null,colorRange:Fg,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:Wh,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:Wh,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:n=>n.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class Gc extends Dg{getAggregatorType(){const{gpuAggregation:e,hexagonAggregator:t,getColorValue:r,getElevationValue:s}=this.props;return e&&(t||r||s)?(fe.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Uh.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{hexagonAggregator:t,radius:r}=this.props;return new AE({dimensions:2,getBin:{sources:["positions"],getValue:({positions:s},i,o)=>{if(t)return t(s,r);const c=this.state.aggregatorViewport.projectPosition(s),{radiusCommon:l,hexOriginCommon:u}=o;return qo([c[0]-u[0],c[1]-u[1]],l)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:s})=>s},{sources:["elevationWeights"],getValue:({elevationWeights:s})=>s}]})}return new Uh(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Yi,lR],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${rR}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const t=super.updateState(e),{props:r,oldProps:s,changeFlags:i}=e,{aggregator:o}=this.state;if((i.dataChanged||!this.state.dataAsArray)&&(r.getColorValue||r.getElevationValue)&&(this.state.dataAsArray=Array.from(bg(r.data).iterable)),t||i.dataChanged||r.radius!==s.radius||r.getColorValue!==s.getColorValue||r.getElevationValue!==s.getElevationValue||r.colorAggregation!==s.colorAggregation||r.elevationAggregation!==s.elevationAggregation){this._updateBinOptions();const{radiusCommon:a,hexOriginCommon:c,binIdRange:l,dataAsArray:u}=this.state;if(o.setProps({binIdRange:l,pointCount:this.getNumInstances(),operations:[r.colorAggregation,r.elevationAggregation],binOptions:{radiusCommon:a,hexOriginCommon:c},onUpdate:this._onAggregationUpdate.bind(this)}),u){const{getColorValue:h,getElevationValue:f}=this.props;o.setProps({customOperations:[h&&(d=>h(d.map(p=>u[p]),{indices:d,data:r.data})),f&&(d=>f(d.map(p=>u[p]),{indices:d,data:r.data}))]})}}return i.updateTriggersChanged&&i.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),i.updateTriggersChanged&&i.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),t}_updateBinOptions(){const e=this.getBounds();let t=1,r=[0,0],s=[[0,1],[0,1]],i=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let o=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{radius:a}=this.props,{unitsPerMeter:c}=i.getDistanceScales(o);t=c[0]*a;const l=qo(i.projectFlat(o),t);o=i.unprojectFlat(jh(l,t));const u=i.constructor;i=i.isGeospatial?new u({longitude:o[0],latitude:o[1],zoom:12}):new pr({position:[o[0],o[1],0],zoom:12}),r=[Math.fround(i.center[0]),Math.fround(i.center[1])],s=HE({dataBounds:e,getBinId:h=>{const f=i.projectFlat(h);return f[0]-=r[0],f[1]-=r[1],qo(f,t)},padding:1})}this.setState({radiusCommon:t,hexOriginCommon:r,binIdRange:s,aggregatorViewport:i})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const t=this.getCurrentLayer().props,{aggregator:r}=this.state;if(e===0){const s=r.getResult(0);this.setState({colors:new Bh(s,r.binCount)}),t.onSetColorDomain(r.getResultDomain(0))}else if(e===1){const s=r.getResult(1);this.setState({elevations:new Bh(s,r.binCount)}),t.onSetElevationDomain(r.getResultDomain(1))}}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:r,hexOriginCommon:s,binIdRange:i}=this.state;t.setProps({binIdRange:i,binOptions:{radiusCommon:r,hexOriginCommon:s}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1);break}}renderLayers(){var M,N;const{aggregator:e,radiusCommon:t,hexOriginCommon:r}=this.state,{elevationScale:s,colorRange:i,elevationRange:o,extruded:a,coverage:c,material:l,transitions:u,colorScaleType:h,lowerPercentile:f,upperPercentile:d,colorDomain:p,elevationScaleType:m,elevationLowerPercentile:g,elevationUpperPercentile:y,elevationDomain:S}=this.props,v=this.getSubLayerClass("cells",Lg),x=e.getBins(),T=(M=this.state.colors)==null?void 0:M.update({scaleType:h,lowerPercentile:f,upperPercentile:d}),I=(N=this.state.elevations)==null?void 0:N.update({scaleType:m,lowerPercentile:g,upperPercentile:y});return!T||!I?null:new v(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:x,getColorValue:T.attribute,getElevationValue:I.attribute}},dataComparator:(L,j)=>L.length===j.length,updateTriggers:{getBin:[x],getColorValue:[T.attribute],getElevationValue:[I.attribute]},diskResolution:6,vertices:nR,radius:t,hexOriginCommon:r,elevationScale:s,colorRange:i,colorScaleType:h,elevationRange:o,extruded:a,coverage:c,material:l,colorDomain:T.domain||p||e.getResultDomain(0),elevationDomain:I.domain||S||e.getResultDomain(1),colorCutoff:T.cutoff,elevationCutoff:I.cutoff,transitions:u&&{getFillColor:u.getColorValue||u.getColorWeight,getElevation:u.getElevationValue||u.getElevationWeight},extensions:[]})}getPickingInfo(e){const t=e.info,{index:r}=t;if(r>=0){const s=this.state.aggregator.getBin(r);let i;if(s){const o=jh(s.id,this.state.radiusCommon),a=this.context.viewport.unprojectFlat(o);i={col:s.id[0],row:s.id[1],position:a,colorValue:s.value[0],elevationValue:s.value[1],count:s.count},s.pointIndices&&(i.pointIndices=s.pointIndices,i.points=Array.isArray(this.props.data)?s.pointIndices.map(c=>this.props.data[c]):[])}t.object=i}return t}}Gc.layerName="HexagonLayer";Gc.defaultProps=uR;function hR(n){const e=n.map(a=>a[0]),t=n.map(a=>a[1]),r=Math.min.apply(null,e),s=Math.max.apply(null,e),i=Math.min.apply(null,t),o=Math.max.apply(null,t);return[r,i,s,o]}function fR(n,e){return e[0]>=n[0]&&e[2]<=n[2]&&e[1]>=n[1]&&e[3]<=n[3]}const Hh=new Float32Array(12);function zh(n,e=2){let t=0;for(const r of n)for(let s=0;s<e;s++)Hh[t++]=r[s]||0;return Hh}function dR(n,e,t){const[r,s,i,o]=n,a=i-r,c=o-s;let l=a,u=c;a/c<e/t?l=e/t*c:u=t/e*a,l<e&&(l=e,u=t);const h=(i+r)/2,f=(o+s)/2;return[h-l/2,f-u/2,h+l/2,f+u/2]}function pR(n,e){const[t,r,s,i]=e;return[(n[0]-t)/(s-t),(n[1]-r)/(i-r)]}const gR=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,mR=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,Xh=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,_R={name:"triangle",vs:Xh,fs:Xh,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class Vg extends mr{getShaders(){return super.getShaders({vs:gR,fs:mR,modules:[Yi,_R]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:r}=this.props;return new Mt(e,{...this.getShaders(),id:this.props.id,attributes:r.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:r,intensity:s,threshold:i,colorTexture:o,maxTexture:a,weightsTexture:c}=this.props,l={aggregationMode:t,colorDomain:r,intensity:s,threshold:i,colorTexture:o,maxTexture:a,weightsTexture:c};e.shaderInputs.setProps({triangle:l}),e.draw(this.context.renderPass)}}Vg.layerName="TriangleLayer";function bR(n,e){const t={};for(const r in n)e.includes(r)||(t[r]=n[r]);return t}class $g extends Zc{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:bR(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const r=this.getShaders({});r&&r.defines&&(r.defines.NON_INSTANCED_MODEL=1),this.updateShaders(r)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:r}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:r.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:r,oldProps:s,changeFlags:i}=e,{compareAll:o=!1,dimension:a}=t,{ignoreProps:c}=this.state,{props:l,accessors:u=[]}=a,{updateTriggersChanged:h}=i;if(i.dataChanged)return!0;if(h){if(h.all)return!0;for(const f of u)if(h[f])return!0}if(o)return i.extensionsChanged?!0:Yc({oldProps:s,newProps:r,ignoreProps:c,propTypes:this.constructor._propTypes});for(const f of l)if(r[f]!==s[f])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!yR(t)}_getAttributeManager(){return new Ji(this.context.device,{id:this.props.id,stats:this.context.stats})}}$g.layerName="AggregationLayer";function yR(n){let e=!0;for(const t in n){e=!1;break}return e}const qh=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,Yh=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,vR=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,wR=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,TR=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,xR={name:"weight",vs:TR,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},SR={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},AR=2,Yo={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},Kh=[0,0],ER={SUM:0,MEAN:1},RR={getPosition:{type:"accessor",value:n=>n.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Fg,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},CR=["float32-renderable-webgl","texture-blend-float-webgl"],IR={data:{props:["radiusPixels"]}};class el extends $g{getShaders(e){let t=[Yi];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(IR),this.setState({colorDomain:Kh}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:r}=e,s=this._getChangeFlags(e);(s.dataChanged||s.viewportChanged)&&(s.boundsChanged=this._updateBounds(s.dataChanged),this._updateTextureRenderingBounds()),s.dataChanged||s.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):s.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==r.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:r,maxWeightsTexture:s,colorTexture:i,colorDomain:o}=this.state,{updateTriggers:a,intensity:c,threshold:l,aggregation:u}=this.props,h=this.getSubLayerClass("triangle",Vg);return new h(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:ne.DEFAULT,data:{attributes:{positions:t,texCoords:r}},vertexCount:4,maxTexture:s,colorTexture:i,aggregationMode:ER[u]||0,weightsTexture:e,intensity:c,threshold:l,colorDomain:o})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:r,maxWeightTransform:s,maxWeightsTexture:i,triPositionBuffer:o,triTexCoordBuffer:a,colorTexture:c,updateTimer:l}=this.state;t==null||t.destroy(),r==null||r.destroy(),s==null||s.destroy(),i==null||i.destroy(),o==null||o.destroy(),a==null||a.destroy(),c==null||c.destroy(),l&&clearTimeout(l)}_getAttributeManager(){return new Ji(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:r}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:r.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:s}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==s)&&(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...Yo,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...Yo,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,r=Math.min(t,e.limits.maxTextureDimension2D),s=CR.every(a=>e.features.has(a)),i=s?"rgba32float":"rgba8unorm",o=s?1:1/255;this.setState({textureSize:r,format:i,weightsScale:o}),s||fe.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:r}=this.state,s=this.getAttributeManager();t==null||t.destroy(),t=new Zu(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:s.getBufferLayouts(),vertexCount:1,targetTexture:r,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,xR]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:r,maxWeightsTexture:s}=this.state,i=this.getShaders({vs:qh,fs:Yh});this._createWeightsTransform(i);const o=this.getShaders({vs:vR,fs:wR,modules:[SR]}),a=new Zu(e,{id:`${this.id}-max-weights-transform`,targetTexture:s,...o,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),c={inTexture:r,textureSize:t};a.model.shaderInputs.setProps({maxWeight:c}),this.setState({weightsTexture:r,maxWeightsTexture:s,maxWeightTransform:a,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:qh,fs:Yh,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,r=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(a=>a.map(Math.fround)),s=hR(r),i={visibleWorldBounds:s,viewportCorners:r};let o=!1;if(e||!this.state.worldBounds||!fR(this.state.worldBounds,s)){const a=this._worldToCommonBounds(s),c=this._commonToWorldBounds(a);this.props.coordinateSystem===ne.LNGLAT&&(c[1]=Math.max(c[1],-85.051129),c[3]=Math.min(c[3],85.051129),c[0]=Math.max(c[0],-360),c[2]=Math.min(c[2],360));const l=this._worldToCommonBounds(c);i.worldBounds=c,i.normalizedCommonBounds=l,o=!0}return this.setState(i),o}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:r,viewportCorners:s}=this.state,{viewport:i}=this.context;e.write(zh(s,3));const o=s.map(a=>pR(i.projectPosition(a),r));t.write(zh(o,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:r}=this.state;const s=Ug(t,!1,Uint8Array);r&&(r==null?void 0:r.width)===t.length?r.setTexture2DData({data:s}):(r==null||r.destroy(),r=this.context.device.createTexture({...Yo,data:s,width:t.length,height:1})),this.setState({colorTexture:r})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:r}=this.props,{worldBounds:s,textureSize:i,weightsScale:o,weightsTexture:a}=this.state,c=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const l=this._worldToCommonBounds(s,{useLayerCoordinateSystem:!0});if(t&&r==="SUM"){const{viewport:v}=this.context,x=v.distanceScales.metersPerUnit[2]*(l[2]-l[0])/i;this.state.colorDomain=t.map(T=>T*x*o)}else this.state.colorDomain=t||Kh;const h=this.getAttributeManager().getAttributes(),f=this.getModuleSettings();this._setModelAttributes(c.model,h),c.model.setVertexCount(this.getNumInstances());const d={radiusPixels:e,commonBounds:l,textureWidth:i,weightsScale:o,weightsTexture:a},{viewport:p,devicePixelRatio:m,coordinateSystem:g,coordinateOrigin:y}=f,{modelMatrix:S}=this.props;c.model.shaderInputs.setProps({project:{viewport:p,devicePixelRatio:m,modelMatrix:S,coordinateSystem:g,coordinateOrigin:y},weight:d}),c.run({parameters:{viewport:[0,0,i,i]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:r}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),r)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:r=!1}=t,[s,i,o,a]=e,{viewport:c}=this.context,{textureSize:l}=this.state,{coordinateSystem:u}=this.props,h=r&&(u===ne.LNGLAT_OFFSETS||u===ne.METER_OFFSETS),f=h?c.projectPosition(this.props.coordinateOrigin):[0,0],d=l*AR/c.scale;let p,m;return r&&!h?(p=this.projectPosition([s,i,0]),m=this.projectPosition([o,a,0])):(p=c.projectPosition([s,i,0]),m=c.projectPosition([o,a,0])),dR([p[0]-f[0],p[1]-f[1],m[0]-f[0],m[1]-f[1]],d,d)}_commonToWorldBounds(e){const[t,r,s,i]=e,{viewport:o}=this.context,a=o.unprojectPosition([t,r]),c=o.unprojectPosition([s,i]);return a.slice(0,2).concat(c.slice(0,2))}}el.layerName="HeatmapLayer";el.defaultProps=RR;const PR=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>bn(async()=>{const{default:r}=await Promise.resolve().then(()=>_r);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class tl extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class OR extends tl{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class kR extends tl{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class MR extends tl{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var tc;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(tc||(tc={}));var NR=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})};class DR{constructor(e,{headers:t={},customFetch:r,region:s=tc.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=PR(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return NR(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(a["x-region"]=c);let l;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=o):typeof o=="string"?(a["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(a["Content-Type"]="application/json",l=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:l}).catch(p=>{throw new OR(p)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new kR(u);if(!u.ok)throw new MR(u);let f=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),d;return f==="application/json"?d=yield u.json():f==="application/octet-stream"?d=yield u.blob():f==="text/event-stream"?d=u:f==="multipart/form-data"?d=yield u.formData():d=yield u.text(),{data:d,error:null}}catch(s){return{data:null,error:s}}})}}var Me={},Mn={},Nn={},Dn={},Fn={},Un={},FR=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},fr=FR();const UR=fr.fetch,jg=fr.fetch.bind(fr),Wg=fr.Headers,BR=fr.Request,LR=fr.Response,_r=Object.freeze(Object.defineProperty({__proto__:null,Headers:Wg,Request:BR,Response:LR,default:jg,fetch:UR},Symbol.toStringTag,{value:"Module"})),VR=n_(_r);var xs={},Zh;function Hg(){if(Zh)return xs;Zh=1,Object.defineProperty(xs,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return xs.default=n,xs}var Jh;function zg(){if(Jh)return Un;Jh=1;var n=Un&&Un.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Un,"__esModule",{value:!0});const e=n(VR),t=n(Hg());class r{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let c=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var u,h,f;let d=null,p=null,m=null,g=l.status,y=l.statusText;if(l.ok){if(this.method!=="HEAD"){const T=await l.text();T===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?p=T:p=JSON.parse(T))}const v=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),x=(h=l.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");v&&x&&x.length>1&&(m=parseInt(x[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(p)&&(p.length>1?(d={code:"PGRST116",details:`Results contain ${p.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},p=null,m=null,g=406,y="Not Acceptable"):p.length===1?p=p[0]:p=null)}else{const v=await l.text();try{d=JSON.parse(v),Array.isArray(d)&&l.status===404&&(p=[],d=null,g=200,y="OK")}catch{l.status===404&&v===""?(g=204,y="No Content"):d={message:v}}if(d&&this.isMaybeSingle&&(!((f=d==null?void 0:d.details)===null||f===void 0)&&f.includes("0 rows"))&&(d=null,g=200,y="OK"),d&&this.shouldThrowOnError)throw new t.default(d)}return{error:d,data:p,count:m,status:g,statusText:y}});return this.shouldThrowOnError||(c=c.catch(l=>{var u,h,f;return{error:{message:`${(u=l==null?void 0:l.name)!==null&&u!==void 0?u:"FetchError"}: ${l==null?void 0:l.message}`,details:`${(h=l==null?void 0:l.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(f=l==null?void 0:l.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,o)}returns(){return this}overrideTypes(){return this}}return Un.default=r,Un}var Qh;function Xg(){if(Qh)return Fn;Qh=1;var n=Fn&&Fn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Fn,"__esModule",{value:!0});const e=n(zg());class t extends e.default{select(s){let i=!1;const o=(s??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(s,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:c=a}={}){const l=c?`${c}.order`:"order",u=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${u?`${u},`:""}${s}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,i,{foreignTable:o,referencedTable:a=o}={}){const c=typeof a>"u"?"offset":`${a}.offset`,l=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(c,`${s}`),this.url.searchParams.set(l,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:s=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:c=!1,format:l="text"}={}){var u;const h=[s?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,c?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${l}; for="${f}"; options=${h};`,l==="json"?this:this}rollback(){var s;return((s=this.headers.Prefer)!==null&&s!==void 0?s:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Fn.default=t,Fn}var Gh;function nl(){if(Gh)return Dn;Gh=1;var n=Dn&&Dn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Dn,"__esModule",{value:!0});const e=n(Xg());class t extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`in.(${o})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:o,type:a}={}){let c="";a==="plain"?c="pl":a==="phrase"?c="ph":a==="websearch"&&(c="w");const l=o===void 0?"":`(${o})`;return this.url.searchParams.append(s,`${c}fts${l}.${i}`),this}match(s){return Object.entries(s).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(s,i,o){return this.url.searchParams.append(s,`not.${i}.${o}`),this}or(s,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${s})`),this}filter(s,i,o){return this.url.searchParams.append(s,`${i}.${o}`),this}}return Dn.default=t,Dn}var ef;function qg(){if(ef)return Nn;ef=1;var n=Nn&&Nn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Nn,"__esModule",{value:!0});const e=n(nl());class t{constructor(s,{headers:i={},schema:o,fetch:a}){this.url=s,this.headers=i,this.schema=o,this.fetch=a}select(s,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let c=!1;const l=(s??"*").split("").map(u=>/\s/.test(u)&&!c?"":(u==='"'&&(c=!c),u)).join("");return this.url.searchParams.set("select",l),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(s,{count:i,defaultToNull:o=!0}={}){const a="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),o||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(s)){const l=s.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(l.length>0){const u=[...new Set(l)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(s,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:c=!0}={}){const l="POST",u=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),c||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(s)){const h=s.reduce((f,d)=>f.concat(Object.keys(d)),[]);if(h.length>0){const f=[...new Set(h)].map(d=>`"${d}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}update(s,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:s}={}){const i="DELETE",o=[];return s&&o.push(`count=${s}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Nn.default=t,Nn}var Sr={},Ar={},tf;function $R(){return tf||(tf=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.version=void 0,Ar.version="0.0.0-automated"),Ar}var nf;function jR(){if(nf)return Sr;nf=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.DEFAULT_HEADERS=void 0;const n=$R();return Sr.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${n.version}`},Sr}var rf;function WR(){if(rf)return Mn;rf=1;var n=Mn&&Mn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Mn,"__esModule",{value:!0});const e=n(qg()),t=n(nl()),r=jR();class s{constructor(o,{headers:a={},schema:c,fetch:l}={}){this.url=o,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),a),this.schemaName=c,this.fetch=l}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new s(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:c=!1,get:l=!1,count:u}={}){let h;const f=new URL(`${this.url}/rpc/${o}`);let d;c||l?(h=c?"HEAD":"GET",Object.entries(a).filter(([m,g])=>g!==void 0).map(([m,g])=>[m,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([m,g])=>{f.searchParams.append(m,g)})):(h="POST",d=a);const p=Object.assign({},this.headers);return u&&(p.Prefer=`count=${u}`),new t.default({method:h,url:f,headers:p,schema:this.schemaName,body:d,fetch:this.fetch,allowEmpty:!1})}}return Mn.default=s,Mn}var sf;function HR(){if(sf)return Me;sf=1;var n=Me&&Me.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Me,"__esModule",{value:!0}),Me.PostgrestError=Me.PostgrestBuilder=Me.PostgrestTransformBuilder=Me.PostgrestFilterBuilder=Me.PostgrestQueryBuilder=Me.PostgrestClient=void 0;const e=n(WR());Me.PostgrestClient=e.default;const t=n(qg());Me.PostgrestQueryBuilder=t.default;const r=n(nl());Me.PostgrestFilterBuilder=r.default;const s=n(Xg());Me.PostgrestTransformBuilder=s.default;const i=n(zg());Me.PostgrestBuilder=i.default;const o=n(Hg());return Me.PostgrestError=o.default,Me.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:o.default},Me}var zR=HR();const XR=rd(zR),{PostgrestClient:qR,PostgrestQueryBuilder:zM,PostgrestFilterBuilder:XM,PostgrestTransformBuilder:qM,PostgrestBuilder:YM,PostgrestError:KM}=XR,YR="2.11.2",KR={"X-Client-Info":`realtime-js/${YR}`},ZR="1.0.0",Yg=1e4,JR=1e3;var Qn;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Qn||(Qn={}));var Je;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Je||(Je={}));var ht;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(ht||(ht={}));var nc;(function(n){n.websocket="websocket"})(nc||(nc={}));var cn;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(cn||(cn={}));class QR{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const c=r.decode(e.slice(o,o+i));o=o+i;const l=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:l}}}class Kg{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var _e;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(_e||(_e={}));const of=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=GR(o,n,e,s),i),{})},GR=(n,e,t,r)=>{const s=e.find(a=>a.name===n),i=s==null?void 0:s.type,o=t[n];return i&&!r.includes(i)?Zg(i,o):rc(o)},Zg=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return rC(e,t)}switch(n){case _e.bool:return eC(e);case _e.float4:case _e.float8:case _e.int2:case _e.int4:case _e.int8:case _e.numeric:case _e.oid:return tC(e);case _e.json:case _e.jsonb:return nC(e);case _e.timestamp:return sC(e);case _e.abstime:case _e.date:case _e.daterange:case _e.int4range:case _e.int8range:case _e.money:case _e.reltime:case _e.text:case _e.time:case _e.timestamptz:case _e.timetz:case _e.tsrange:case _e.tstzrange:return rc(e);default:return rc(e)}},rc=n=>n,eC=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},tC=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},nC=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},rC=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Zg(e,a))}return n},sC=n=>typeof n=="string"?n.replace(" ","T"):n,Jg=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ko{constructor(e,t,r={},s=Yg){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var af;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(af||(af={}));class Wr{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Wr.syncState(this.state,s,i,o),this.pendingDiffs.forEach(c=>{this.state=Wr.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Wr.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(l,u)=>{o[l]||(c[l]=u)}),this.map(o,(l,u)=>{const h=i[l];if(h){const f=u.map(g=>g.presence_ref),d=h.map(g=>g.presence_ref),p=u.filter(g=>d.indexOf(g.presence_ref)<0),m=h.filter(g=>f.indexOf(g.presence_ref)<0);p.length>0&&(a[l]=p),m.length>0&&(c[l]=m)}else a[l]=u}),this.syncDiff(i,{joins:a,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,c)=>{var l;const u=(l=e[a])!==null&&l!==void 0?l:[];if(e[a]=this.cloneDeep(c),u.length>0){const h=e[a].map(d=>d.presence_ref),f=u.filter(d=>h.indexOf(d.presence_ref)<0);e[a].unshift(...f)}r(a,u,c)}),this.map(o,(a,c)=>{let l=e[a];if(!l)return;const u=c.map(h=>h.presence_ref);l=l.filter(h=>u.indexOf(h.presence_ref)<0),e[a]=l,s(a,l,c),l.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var cf;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(cf||(cf={}));var lf;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(lf||(lf={}));var Rt;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Rt||(Rt={}));class rl{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Je.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ko(this,ht.join,this.params,this.timeout),this.rejoinTimer=new Kg(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Je.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Je.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Je.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Je.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ht.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Wr(this),this.broadcastEndpointURL=Jg(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(u=>e==null?void 0:e(Rt.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(Rt.CLOSED));const c={},l={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(Rt.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,d=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,p=[];for(let m=0;m<d;m++){const g=f[m],{filter:{event:y,schema:S,table:v,filter:x}}=g,T=u&&u[m];if(T&&T.event===y&&T.schema===S&&T.table===v&&T.filter===x)p.push(Object.assign(Object.assign({},g),{id:T.id}));else{this.unsubscribe(),e==null||e(Rt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(Rt.SUBSCRIBED);return}}).receive("error",u=>{e==null||e(Rt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Rt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=l.body)===null||s===void 0?void 0:s.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Je.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ht.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new Ko(this,ht.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ko(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:l,join:u}=ht;if(r&&[a,c,l,u].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(d=>{var p,m,g;return((p=d.filter)===null||p===void 0?void 0:p.event)==="*"||((g=(m=d.filter)===null||m===void 0?void 0:m.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===o}).map(d=>d.callback(f,r)):(i=this.bindings[o])===null||i===void 0||i.filter(d=>{var p,m,g,y,S,v;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in d){const x=d.id,T=(p=d.filter)===null||p===void 0?void 0:p.event;return x&&((m=t.ids)===null||m===void 0?void 0:m.includes(x))&&(T==="*"||(T==null?void 0:T.toLocaleLowerCase())===((g=t.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const x=(S=(y=d==null?void 0:d.filter)===null||y===void 0?void 0:y.event)===null||S===void 0?void 0:S.toLocaleLowerCase();return x==="*"||x===((v=t==null?void 0:t.event)===null||v===void 0?void 0:v.toLocaleLowerCase())}else return d.type.toLocaleLowerCase()===o}).map(d=>{if(typeof f=="object"&&"ids"in f){const p=f.data,{schema:m,table:g,commit_timestamp:y,type:S,errors:v}=p;f=Object.assign(Object.assign({},{schema:m,table:g,commit_timestamp:y,eventType:S,new:{},old:{},errors:v}),this._getPayloadRecords(p))}d.callback(f,r)})}_isClosed(){return this.state===Je.closed}_isJoined(){return this.state===Je.joined}_isJoining(){return this.state===Je.joining}_isLeaving(){return this.state===Je.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&rl.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ht.close,{},e)}_onError(e){this._on(ht.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Je.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=of(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=of(e.columns,e.old_record)),t}}const iC=()=>{},oC=typeof WebSocket<"u",aC=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class cC{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=KR,this.params={},this.timeout=Yg,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=iC,this.conn=null,this.sendBuffer=[],this.serializer=new QR,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>bn(async()=>{const{default:c}=await Promise.resolve().then(()=>_r);return{default:c}},void 0).then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${nc.websocket}`,this.httpEndpoint=Jg(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Kg(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(oC){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new lC(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),bn(async()=>{const{default:e}=await import("./browser-C_byq99u.js").then(t=>t.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ZR}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Qn.connecting:return cn.Connecting;case Qn.open:return cn.Open;case Qn.closing:return cn.Closing;default:return cn.Closed}}isConnected(){return this.connectionState()===cn.Open}channel(e,t={config:{}}){const r=new rl(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let r=null;try{r=JSON.parse(atob(t.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=t,this.channels.forEach(s=>{t&&s.updateJoinPayload({access_token:t}),s.joinedOnce&&s._isJoined()&&s._push(ht.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(JR,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ht.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([aC],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class lC{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Qn.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class sl extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ne(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class uC extends sl{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class sc extends sl{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var hC=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})};const Qg=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>bn(async()=>{const{default:r}=await Promise.resolve().then(()=>_r);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},fC=()=>hC(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield bn(()=>Promise.resolve().then(()=>_r),void 0)).Response:Response}),ic=n=>{if(Array.isArray(n))return n.map(t=>ic(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=ic(r)}),e};var Sn=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})};const Zo=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),dC=(n,e,t)=>Sn(void 0,void 0,void 0,function*(){const r=yield fC();n instanceof r&&!(t!=null&&t.noResolveJson)?n.json().then(s=>{e(new uC(Zo(s),n.status||500))}).catch(s=>{e(new sc(Zo(s),s))}):e(new sc(Zo(n),n))}),pC=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),t))};function as(n,e,t,r,s,i){return Sn(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,pC(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>dC(c,a,r))})})}function vi(n,e,t,r){return Sn(this,void 0,void 0,function*(){return as(n,"GET",e,t,r)})}function Ht(n,e,t,r,s){return Sn(this,void 0,void 0,function*(){return as(n,"POST",e,r,s,t)})}function gC(n,e,t,r,s){return Sn(this,void 0,void 0,function*(){return as(n,"PUT",e,r,s,t)})}function mC(n,e,t,r){return Sn(this,void 0,void 0,function*(){return as(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Gg(n,e,t,r,s){return Sn(this,void 0,void 0,function*(){return as(n,"DELETE",e,r,s,t)})}var qe=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})};const _C={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},uf={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class bC{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Qg(s)}uploadOrUpdate(e,t,r,s){return qe(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},uf),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s!=null&&s.headers&&(a=Object.assign(Object.assign({},a),s.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),f=yield h.json();return h.ok?{data:{path:l,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(Ne(i))return{data:null,error:i};throw i}})}upload(e,t,r){return qe(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return qe(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:uf.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",l.cacheControl)):(c=r,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:u}),f=yield h.json();return h.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(Ne(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return qe(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const i=yield Ht(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new sl("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(Ne(r))return{data:null,error:r};throw r}})}update(e,t,r){return qe(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return qe(this,void 0,void 0,function*(){try{return{data:yield Ht(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Ne(s))return{data:null,error:s};throw s}})}copy(e,t,r){return qe(this,void 0,void 0,function*(){try{return{data:{path:(yield Ht(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Ne(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return qe(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Ht(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(Ne(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return qe(this,void 0,void 0,function*(){try{const s=yield Ht(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(Ne(s))return{data:null,error:s};throw s}})}download(e,t){return qe(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield vi(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Ne(a))return{data:null,error:a};throw a}})}info(e){return qe(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield vi(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ic(r),error:null}}catch(r){if(Ne(r))return{data:null,error:r};throw r}})}exists(e){return qe(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield mC(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Ne(r)&&r instanceof sc){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&s.push(c);let l=s.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${l}`)}}}remove(e){return qe(this,void 0,void 0,function*(){try{return{data:yield Gg(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Ne(t))return{data:null,error:t};throw t}})}list(e,t,r){return qe(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},_C),t),{prefix:e||""});return{data:yield Ht(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(Ne(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const yC="2.7.1",vC={"X-Client-Info":`storage-js/${yC}`};var Bn=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})};class wC{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},vC),t),this.fetch=Qg(r)}listBuckets(){return Bn(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Ne(e))return{data:null,error:e};throw e}})}getBucket(e){return Bn(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Ne(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Bn(this,void 0,void 0,function*(){try{return{data:yield Ht(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Ne(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Bn(this,void 0,void 0,function*(){try{return{data:yield gC(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Ne(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Bn(this,void 0,void 0,function*(){try{return{data:yield Ht(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Ne(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Bn(this,void 0,void 0,function*(){try{return{data:yield Gg(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Ne(t))return{data:null,error:t};throw t}})}}class TC extends wC{constructor(e,t={},r){super(e,t,r)}from(e){return new bC(this.url,this.headers,e,this.fetch)}}const xC="2.49.3";let Mr="";typeof Deno<"u"?Mr="deno":typeof document<"u"?Mr="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Mr="react-native":Mr="node";const SC={"X-Client-Info":`supabase-js-${Mr}/${xC}`},AC={headers:SC},EC={schema:"public"},RC={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},CC={};var IC=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})};const PC=n=>{let e;return n?e=n:typeof fetch>"u"?e=jg:e=fetch,(...t)=>e(...t)},OC=()=>typeof Headers>"u"?Wg:Headers,kC=(n,e,t)=>{const r=PC(t),s=OC();return(i,o)=>IC(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:n;let l=new s(o==null?void 0:o.headers);return l.has("apikey")||l.set("apikey",n),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:l}))})};var MC=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})};function NC(n){return n.replace(/\/$/,"")}function DC(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:o,auth:a,realtime:c,global:l}=e,u={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},l),i),accessToken:()=>MC(this,void 0,void 0,function*(){return""})};return n.accessToken?u.accessToken=n.accessToken:delete u.accessToken,u}const em="2.69.1",Wn=30*1e3,oc=3,Jo=oc*Wn,FC="http://localhost:9999",UC="supabase.auth.token",BC={"X-Client-Info":`gotrue-js/${em}`},ac="X-Supabase-Api-Version",tm={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},LC=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,VC=6e5;class il extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function te(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class $C extends il{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function jC(n){return te(n)&&n.name==="AuthApiError"}class nm extends il{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class tn extends il{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class $t extends tn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function WC(n){return te(n)&&n.name==="AuthSessionMissingError"}class Qo extends tn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ss extends tn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class As extends tn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function HC(n){return te(n)&&n.name==="AuthImplicitGrantRedirectError"}class hf extends tn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class cc extends tn{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Go(n){return te(n)&&n.name==="AuthRetryableFetchError"}class ff extends tn{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Hr extends tn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const df="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),pf=` 	
\r=`.split(""),zC=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<pf.length;e+=1)n[pf[e].charCodeAt(0)]=-2;for(let e=0;e<df.length;e+=1)n[df[e].charCodeAt(0)]=e;return n})();function rm(n,e,t){const r=zC[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function gf(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{YC(o,r,t)};for(let o=0;o<n.length;o+=1)rm(n.charCodeAt(o),s,i);return e.join("")}function XC(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function qC(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}XC(r,e)}}function YC(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function KC(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)rm(n.charCodeAt(s),t,r);return new Uint8Array(e)}function ZC(n){const e=[];return qC(n,t=>e.push(t)),new Uint8Array(e)}function JC(n){return Math.round(Date.now()/1e3)+n}function QC(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const mt=()=>typeof window<"u"&&typeof document<"u",on={tested:!1,writable:!1},zr=()=>{if(!mt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(on.tested)return on.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),on.tested=!0,on.writable=!0}catch{on.tested=!0,on.writable=!1}return on.writable};function GC(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const sm=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>bn(async()=>{const{default:r}=await Promise.resolve().then(()=>_r);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},eI=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",im=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Es=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Rs=async(n,e)=>{await n.removeItem(e)};class ro{constructor(){this.promise=new ro.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ro.promiseConstructor=Promise;function ea(n){const e=n.split(".");if(e.length!==3)throw new Hr("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!LC.test(e[r]))throw new Hr("JWT not in base64url format");return{header:JSON.parse(gf(e[0])),payload:JSON.parse(gf(e[1])),signature:KC(e[2]),raw:{header:e[0],payload:e[1]}}}async function tI(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function nI(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function rI(n){return("0"+n.toString(16)).substr(-2)}function sI(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,rI).join("")}async function iI(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function oI(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await iI(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ln(n,e,t=!1){const r=sI();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await im(n,`${e}-code-verifier`,s);const i=await oI(r);return[i,r===i?"plain":"s256"]}const aI=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function cI(n){const e=n.headers.get(ac);if(!e||!e.match(aI))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function lI(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function uI(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var hI=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const an=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),fI=[502,503,504];async function mf(n){var e;if(!eI(n))throw new cc(an(n),0);if(fI.includes(n.status))throw new cc(an(n),n.status);let t;try{t=await n.json()}catch(i){throw new nm(an(i),i)}let r;const s=cI(n);if(s&&s.getTime()>=tm["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new ff(an(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new $t}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new ff(an(t),n.status,t.weak_password.reasons);throw new $C(an(t),n.status||500,r)}const dI=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function re(n,e,t,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[ac]||(i[ac]=tm["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await pI(n,e,t+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function pI(n,e,t,r,s,i){const o=dI(e,r,s,i);let a;try{a=await n(t,Object.assign({},o))}catch(c){throw console.error(c),new cc(an(c),0)}if(a.ok||await mf(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(c){await mf(c)}}function jt(n){var e;let t=null;bI(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=JC(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function _f(n){const e=jt(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function qt(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function gI(n){return{data:n,error:null}}function mI(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=hI(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function _I(n){return n}function bI(n){return n.access_token&&n.refresh_token&&n.expires_in}var yI=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class vI{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=sm(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await re(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(te(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await re(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:qt})}catch(r){if(te(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=yI(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await re(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:mI,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(te(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await re(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:qt})}catch(t){if(te(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,o,a,c;try{const l={nextPage:null,lastPage:0,total:0},u=await re(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:_I});if(u.error)throw u.error;const h=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,d=(c=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return d.length>0&&(d.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(p.split(";")[1].split("=")[1]);l[`${g}Page`]=m}),l.total=parseInt(f)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(te(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await re(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:qt})}catch(t){if(te(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await re(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:qt})}catch(r){if(te(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await re(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:qt})}catch(r){if(te(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await re(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(te(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await re(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}}}const wI={getItem:n=>zr()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{zr()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{zr()&&globalThis.localStorage.removeItem(n)}};function bf(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function TI(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Vn={debug:!!(globalThis&&zr()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class om extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class xI extends om{}async function SI(n,e,t){Vn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Vn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){Vn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{Vn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw Vn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new xI(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Vn.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}TI();const AI={url:FC,storageKey:UC,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:BC,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function yf(n,e,t){return await t()}class Qr{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Qr.nextInstanceID,Qr.nextInstanceID+=1,this.instanceID>0&&mt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},AI),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new vI({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=sm(s.fetch),this.lock=s.lock||yf,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:mt()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=SI:this.lock=yf,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:zr()?this.storage=wI:(this.memoryStorage={},this.storage=bf(this.memoryStorage)):(this.memoryStorage={},this.storage=bf(this.memoryStorage)),mt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${em}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=GC(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),mt()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),HC(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return te(t)?{error:t}:{error:new nm("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const i=await re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:jt}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(te(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,s;try{let i;if("email"in e){const{email:u,password:h,options:f}=e;let d=null,p=null;this.flowType==="pkce"&&([d,p]=await Ln(this.storage,this.storageKey)),i=await re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:d,code_challenge_method:p},xform:jt})}else if("phone"in e){const{phone:u,password:h,options:f}=e;i=await re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:jt})}else throw new Ss("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(te(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await re(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:_f})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await re(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:_f})}else throw new Ss("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Qo}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(te(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Es(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:i,error:o}=await re(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:jt});if(await Rs(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Qo}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(te(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,a=await re(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:jt}),{data:c,error:l}=a;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Qo}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(te(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,o;try{if("email"in e){const{email:a,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await Ln(this.storage,this.storageKey));const{error:h}=await re(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:c}=e,{data:l,error:u}=await re(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new Ss("You must provide either an email or phone number.")}catch(a){if(te(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await re(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:jt});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,l=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(s){if(te(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await Ln(this.storage,this.storageKey)),await re(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:gI})}catch(i){if(te(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new $t;const{error:s}=await re(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(te(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await re(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=await re(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Ss("You must provide either an email or phone number and a type")}catch(t){if(te(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Es(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Jo:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,u)=>(!o&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,u))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await re(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:qt}):await this._useSession(async t=>{var r,s,i;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new $t}:await re(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:qt})})}catch(t){if(te(t))return WC(t)&&(await this._removeSession(),await Rs(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new $t;const o=s.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await Ln(this.storage,this.storageKey));const{data:l,error:u}=await re(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:qt});if(u)throw u;return o.user=l.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(te(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new $t;const t=Date.now()/1e3;let r=t,s=!0,i=null;const{payload:o}=ea(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(te(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new $t;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(te(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!mt())throw new As("No browser detected.");if(e.error||e.error_description||e.error_code)throw new As(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new hf("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new As("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new hf("No code detected.");const{data:S,error:v}=await this._exchangeCodeForSession(e.code);if(v)throw v;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:S.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:c,token_type:l}=e;if(!i||!a||!o||!l)throw new As("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(a);let f=u+h;c&&(f=parseInt(c));const d=f-u;d*1e3<=Wn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);const p=f-h;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,f,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,f,u);const{data:m,error:g}=await this._getUser(i);if(g)throw g;const y={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:f,refresh_token:o,token_type:l,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(r){if(te(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Es(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(jC(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Rs(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=QC(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await Ln(this.storage,this.storageKey,!0));try{return await re(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(te(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(te(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var o,a,c,l,u;const{data:h,error:f}=i;if(f)throw f;const d=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await re(this.fetch,"GET",d,{headers:this.headers,jwt:(u=(l=h.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return mt()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(te(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)throw o;return await re(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(te(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await nI(async s=>(s>0&&await tI(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await re(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:jt})),(s,i)=>{const o=200*Math.pow(2,s);return i&&Go(i)&&Date.now()+o-r<Wn})}catch(r){if(this._debug(t,"error",r),te(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),mt()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Es(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Jo;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${Jo}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),Go(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new $t;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new ro;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new $t;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),te(i)){const o={session:null,error:i};return Go(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await im(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Rs(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&mt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Wn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Wn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Wn}ms, refresh threshold is ${oc} ticks`),s<=oc&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof om)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!mt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await Ln(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await re(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(te(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:l}=await re(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((s=c==null?void 0:c.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(te(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await re(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(te(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await re(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(te(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=ea(s.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r||(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+VC>Date.now()))return r;const{data:s,error:i}=await re(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!s.keys||s.keys.length===0)throw new Hr("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(o=>o.kid===e),!r)throw new Hr("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:d,error:p}=await this.getSession();if(p||!d.session)return{data:null,error:p};r=d.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:c}}=ea(r);if(lI(i.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:d}=await this.getUser(r);if(d)throw d;return{data:{claims:i,header:s,signature:o},error:null}}const l=uI(s.alg),u=await this.fetchJwk(s.kid,t),h=await crypto.subtle.importKey("jwk",u,l,!0,["verify"]);if(!await crypto.subtle.verify(l,h,o,ZC(`${a}.${c}`)))throw new Hr("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(te(r))return{data:null,error:r};throw r}}}Qr.nextInstanceID=0;const EI=Qr;class RI extends EI{constructor(e){super(e)}}var CI=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})};class II{constructor(e,t,r){var s,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=NC(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:EC,realtime:CC,auth:Object.assign(Object.assign({},RC),{storageKey:c}),global:AC},u=DC(r??{},l);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=kC(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new qR(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new DR(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new TC(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return CI(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o,lock:a,debug:c},l,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new RI({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,lock:a,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new cC(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const PI=(n,e,t)=>new II(n,e,t),OI="https://dmlbahrzzlumkdeomfkr.supabase.co",kI="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRtbGJhaHJ6emx1bWtkZW9tZmtyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI3NDEzMjcsImV4cCI6MjA1ODMxNzMyN30.CiHvVZOUDrNkMUV_hfgTNheRNJ8RhgC9hvhXXJS5rt0",am=PI(OI,kI);async function MI(n,e=2e4){let t=0;const r=[];for(;;){const{data:s,error:i}=await am.from(n).select("oid, xgcswgs84, ygcswgs84").range(t,t+e-1);if(i)throw i;if(!s.length)break;const o=s.map(a=>({type:"Feature",properties:{oid:a.oid},geometry:{coordinates:[a.xgcswgs84,a.ygcswgs84],type:"Point"},latitude:parseFloat(a.ygcswgs84),longitude:parseFloat(a.xgcswgs84)}));r.push(...o),t+=e}return r}async function NI(n,e=2e4){let t=0;const r=[];for(;;){const{data:s,error:i}=await am.from(n).select("oid, uland, uwochentag, ukategorie, ist_rad, ist_pkw, ist_fuss").range(t,t+e-1);if(i)throw console.error("Ошибка при загрузке атрибутов (по диапазону):",i),i;if(!s.length)break;r.push(...s),t+=e}return r}function DI(){const[n,e]=C.useState({loading:!1,loadingAttributes:!1,errors:{},initialFeatures:[],fullFeatures:[],initialLoadTime:null,fullLoadTime:null}),t=C.useRef(null),r=C.useRef(null),s=C.useRef(null),i=C.useCallback(async o=>{e(l=>({...l,loading:!0,loadingAttributes:!1,errors:{}})),t.current=performance.now();let a=[],c=[];try{const l=o.map(async g=>await MI(g));a=(await Promise.all(l)).flat(),r.current=performance.now(),e(g=>({...g,loading:!1,initialFeatures:a,initialLoadTime:(r.current-t.current)/1e3})),e(g=>({...g,loadingAttributes:!0})),s.current=performance.now();const h=o.map(async g=>await NI(g)),d=(await Promise.all(h)).flat(),p=new Map(d.map(g=>[g.oid,g]));c=a.map(g=>{const y=p.get(g.properties.oid);return{...g,properties:{...g.properties,...y||{}}}});const m=performance.now();e(g=>({...g,loadingAttributes:!1,fullFeatures:c,fullLoadTime:(m-s.current)/1e3}))}catch(l){e(u=>({...u,loading:!1,loadingAttributes:!1,errors:{global:l}}))}},[]);return{state:n,loadPartitions:i}}const FI=new Wp({color:[255,255,255],intensity:1}),UI=new qp({color:[255,255,255],intensity:.8,position:[-.144528,49.739968,8e4]}),BI=new qp({color:[255,255,255],intensity:.8,position:[-3.807751,54.104682,8e3]}),LI=new Vc({ambientLight:FI,pointLight1:UI,pointLight2:BI}),VI=[[1,152,189],[73,227,206],[216,254,181],[254,237,177],[254,173,84],[209,55,78]];function yn(n){"@babel/helpers - typeof";return yn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yn(n)}function $I(n,e){if(yn(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(yn(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function cm(n){var e=$I(n,"string");return yn(e)=="symbol"?e:e+""}function Nr(n,e,t){return(e=cm(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function vf(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function X(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vf(Object(t),!0).forEach(function(r){Nr(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):vf(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function jI(n){if(Array.isArray(n))return n}function WI(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],c=!0,l=!1;try{if(i=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,s=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw s}}return a}}function lc(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function lm(n,e){if(n){if(typeof n=="string")return lc(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?lc(n,e):void 0}}function HI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ot(n,e){return jI(n)||WI(n,e)||lm(n,e)||HI()}function zI(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}function Ft(n,e){if(n==null)return{};var t,r,s=zI(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)t=i[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(s[t]=n[t])}return s}var XI=["defaultInputValue","defaultMenuIsOpen","defaultValue","inputValue","menuIsOpen","onChange","onInputChange","onMenuClose","onMenuOpen","value"];function qI(n){var e=n.defaultInputValue,t=e===void 0?"":e,r=n.defaultMenuIsOpen,s=r===void 0?!1:r,i=n.defaultValue,o=i===void 0?null:i,a=n.inputValue,c=n.menuIsOpen,l=n.onChange,u=n.onInputChange,h=n.onMenuClose,f=n.onMenuOpen,d=n.value,p=Ft(n,XI),m=C.useState(a!==void 0?a:t),g=Ot(m,2),y=g[0],S=g[1],v=C.useState(c!==void 0?c:s),x=Ot(v,2),T=x[0],I=x[1],M=C.useState(d!==void 0?d:o),N=Ot(M,2),L=N[0],j=N[1],$=C.useCallback(function(ze,dt){typeof l=="function"&&l(ze,dt),j(ze)},[l]),K=C.useCallback(function(ze,dt){var P;typeof u=="function"&&(P=u(ze,dt)),S(P!==void 0?P:ze)},[u]),se=C.useCallback(function(){typeof f=="function"&&f(),I(!0)},[f]),Z=C.useCallback(function(){typeof h=="function"&&h(),I(!1)},[h]),ie=a!==void 0?a:y,be=c!==void 0?c:T,tt=d!==void 0?d:L;return X(X({},p),{},{inputValue:ie,menuIsOpen:be,onChange:$,onInputChange:K,onMenuClose:Z,onMenuOpen:se,value:tt})}function Y(){return Y=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Y.apply(null,arguments)}function YI(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function wf(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,cm(r.key),r)}}function KI(n,e,t){return e&&wf(n.prototype,e),t&&wf(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function uc(n,e){return uc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},uc(n,e)}function ZI(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&uc(n,e)}function wi(n){return wi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},wi(n)}function um(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(um=function(){return!!n})()}function JI(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function QI(n,e){if(e&&(yn(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return JI(n)}function GI(n){var e=um();return function(){var t,r=wi(n);if(e){var s=wi(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return QI(this,t)}}function eP(n){if(Array.isArray(n))return lc(n)}function tP(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function nP(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ol(n){return eP(n)||tP(n)||lm(n)||nP()}function rP(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function sP(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var iP=function(){function n(t){var r=this;this._insertTag=function(s){var i;r.tags.length===0?r.insertionPoint?i=r.insertionPoint.nextSibling:r.prepend?i=r.container.firstChild:i=r.before:i=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(s,i),r.tags.push(s)},this.isSpeedy=t.speedy===void 0?!0:t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(r){r.forEach(this._insertTag)},e.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(sP(this));var s=this.tags[this.tags.length-1];if(this.isSpeedy){var i=rP(s);try{i.insertRule(r,i.cssRules.length)}catch{}}else s.appendChild(document.createTextNode(r));this.ctr++},e.flush=function(){this.tags.forEach(function(r){var s;return(s=r.parentNode)==null?void 0:s.removeChild(r)}),this.tags=[],this.ctr=0},n}(),$e="-ms-",Ti="-moz-",ae="-webkit-",hm="comm",al="rule",cl="decl",oP="@import",fm="@keyframes",aP="@layer",cP=Math.abs,so=String.fromCharCode,lP=Object.assign;function uP(n,e){return Ue(n,0)^45?(((e<<2^Ue(n,0))<<2^Ue(n,1))<<2^Ue(n,2))<<2^Ue(n,3):0}function dm(n){return n.trim()}function hP(n,e){return(n=e.exec(n))?n[0]:n}function ce(n,e,t){return n.replace(e,t)}function hc(n,e){return n.indexOf(e)}function Ue(n,e){return n.charCodeAt(e)|0}function Gr(n,e,t){return n.slice(e,t)}function yt(n){return n.length}function ll(n){return n.length}function Cs(n,e){return e.push(n),n}function fP(n,e){return n.map(e).join("")}var io=1,dr=1,pm=0,Ke=0,Ce=0,br="";function oo(n,e,t,r,s,i,o){return{value:n,root:e,parent:t,type:r,props:s,children:i,line:io,column:dr,length:o,return:""}}function Er(n,e){return lP(oo("",null,null,"",null,null,0),n,{length:-n.length},e)}function dP(){return Ce}function pP(){return Ce=Ke>0?Ue(br,--Ke):0,dr--,Ce===10&&(dr=1,io--),Ce}function et(){return Ce=Ke<pm?Ue(br,Ke++):0,dr++,Ce===10&&(dr=1,io++),Ce}function xt(){return Ue(br,Ke)}function Vs(){return Ke}function cs(n,e){return Gr(br,n,e)}function es(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function gm(n){return io=dr=1,pm=yt(br=n),Ke=0,[]}function mm(n){return br="",n}function $s(n){return dm(cs(Ke-1,fc(n===91?n+2:n===40?n+1:n)))}function gP(n){for(;(Ce=xt())&&Ce<33;)et();return es(n)>2||es(Ce)>3?"":" "}function mP(n,e){for(;--e&&et()&&!(Ce<48||Ce>102||Ce>57&&Ce<65||Ce>70&&Ce<97););return cs(n,Vs()+(e<6&&xt()==32&&et()==32))}function fc(n){for(;et();)switch(Ce){case n:return Ke;case 34:case 39:n!==34&&n!==39&&fc(Ce);break;case 40:n===41&&fc(n);break;case 92:et();break}return Ke}function _P(n,e){for(;et()&&n+Ce!==57;)if(n+Ce===84&&xt()===47)break;return"/*"+cs(e,Ke-1)+"*"+so(n===47?n:et())}function bP(n){for(;!es(xt());)et();return cs(n,Ke)}function yP(n){return mm(js("",null,null,null,[""],n=gm(n),0,[0],n))}function js(n,e,t,r,s,i,o,a,c){for(var l=0,u=0,h=o,f=0,d=0,p=0,m=1,g=1,y=1,S=0,v="",x=s,T=i,I=r,M=v;g;)switch(p=S,S=et()){case 40:if(p!=108&&Ue(M,h-1)==58){hc(M+=ce($s(S),"&","&\f"),"&\f")!=-1&&(y=-1);break}case 34:case 39:case 91:M+=$s(S);break;case 9:case 10:case 13:case 32:M+=gP(p);break;case 92:M+=mP(Vs()-1,7);continue;case 47:switch(xt()){case 42:case 47:Cs(vP(_P(et(),Vs()),e,t),c);break;default:M+="/"}break;case 123*m:a[l++]=yt(M)*y;case 125*m:case 59:case 0:switch(S){case 0:case 125:g=0;case 59+u:y==-1&&(M=ce(M,/\f/g,"")),d>0&&yt(M)-h&&Cs(d>32?xf(M+";",r,t,h-1):xf(ce(M," ","")+";",r,t,h-2),c);break;case 59:M+=";";default:if(Cs(I=Tf(M,e,t,l,u,s,a,v,x=[],T=[],h),i),S===123)if(u===0)js(M,e,I,I,x,i,h,a,T);else switch(f===99&&Ue(M,3)===110?100:f){case 100:case 108:case 109:case 115:js(n,I,I,r&&Cs(Tf(n,I,I,0,0,s,a,v,s,x=[],h),T),s,T,h,a,r?x:T);break;default:js(M,I,I,I,[""],T,0,a,T)}}l=u=d=0,m=y=1,v=M="",h=o;break;case 58:h=1+yt(M),d=p;default:if(m<1){if(S==123)--m;else if(S==125&&m++==0&&pP()==125)continue}switch(M+=so(S),S*m){case 38:y=u>0?1:(M+="\f",-1);break;case 44:a[l++]=(yt(M)-1)*y,y=1;break;case 64:xt()===45&&(M+=$s(et())),f=xt(),u=h=yt(v=M+=bP(Vs())),S++;break;case 45:p===45&&yt(M)==2&&(m=0)}}return i}function Tf(n,e,t,r,s,i,o,a,c,l,u){for(var h=s-1,f=s===0?i:[""],d=ll(f),p=0,m=0,g=0;p<r;++p)for(var y=0,S=Gr(n,h+1,h=cP(m=o[p])),v=n;y<d;++y)(v=dm(m>0?f[y]+" "+S:ce(S,/&\f/g,f[y])))&&(c[g++]=v);return oo(n,e,t,s===0?al:a,c,l,u)}function vP(n,e,t){return oo(n,e,t,hm,so(dP()),Gr(n,2,-2),0)}function xf(n,e,t,r){return oo(n,e,t,cl,Gr(n,0,r),Gr(n,r+1,-1),r)}function Gn(n,e){for(var t="",r=ll(n),s=0;s<r;s++)t+=e(n[s],s,n,e)||"";return t}function wP(n,e,t,r){switch(n.type){case aP:if(n.children.length)break;case oP:case cl:return n.return=n.return||n.value;case hm:return"";case fm:return n.return=n.value+"{"+Gn(n.children,r)+"}";case al:n.value=n.props.join(",")}return yt(t=Gn(n.children,r))?n.return=n.value+"{"+t+"}":""}function TP(n){var e=ll(n);return function(t,r,s,i){for(var o="",a=0;a<e;a++)o+=n[a](t,r,s,i)||"";return o}}function xP(n){return function(e){e.root||(e=e.return)&&n(e)}}function SP(n){var e=Object.create(null);return function(t){return e[t]===void 0&&(e[t]=n(t)),e[t]}}var AP=function(e,t,r){for(var s=0,i=0;s=i,i=xt(),s===38&&i===12&&(t[r]=1),!es(i);)et();return cs(e,Ke)},EP=function(e,t){var r=-1,s=44;do switch(es(s)){case 0:s===38&&xt()===12&&(t[r]=1),e[r]+=AP(Ke-1,t,r);break;case 2:e[r]+=$s(s);break;case 4:if(s===44){e[++r]=xt()===58?"&\f":"",t[r]=e[r].length;break}default:e[r]+=so(s)}while(s=et());return e},RP=function(e,t){return mm(EP(gm(e),t))},Sf=new WeakMap,CP=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var t=e.value,r=e.parent,s=e.column===r.column&&e.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(e.props.length===1&&t.charCodeAt(0)!==58&&!Sf.get(r))&&!s){Sf.set(e,!0);for(var i=[],o=RP(t,i),a=r.props,c=0,l=0;c<o.length;c++)for(var u=0;u<a.length;u++,l++)e.props[l]=i[c]?o[c].replace(/&\f/g,a[u]):a[u]+" "+o[c]}}},IP=function(e){if(e.type==="decl"){var t=e.value;t.charCodeAt(0)===108&&t.charCodeAt(2)===98&&(e.return="",e.value="")}};function _m(n,e){switch(uP(n,e)){case 5103:return ae+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ae+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return ae+n+Ti+n+$e+n+n;case 6828:case 4268:return ae+n+$e+n+n;case 6165:return ae+n+$e+"flex-"+n+n;case 5187:return ae+n+ce(n,/(\w+).+(:[^]+)/,ae+"box-$1$2"+$e+"flex-$1$2")+n;case 5443:return ae+n+$e+"flex-item-"+ce(n,/flex-|-self/,"")+n;case 4675:return ae+n+$e+"flex-line-pack"+ce(n,/align-content|flex-|-self/,"")+n;case 5548:return ae+n+$e+ce(n,"shrink","negative")+n;case 5292:return ae+n+$e+ce(n,"basis","preferred-size")+n;case 6060:return ae+"box-"+ce(n,"-grow","")+ae+n+$e+ce(n,"grow","positive")+n;case 4554:return ae+ce(n,/([^-])(transform)/g,"$1"+ae+"$2")+n;case 6187:return ce(ce(ce(n,/(zoom-|grab)/,ae+"$1"),/(image-set)/,ae+"$1"),n,"")+n;case 5495:case 3959:return ce(n,/(image-set\([^]*)/,ae+"$1$`$1");case 4968:return ce(ce(n,/(.+:)(flex-)?(.*)/,ae+"box-pack:$3"+$e+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ae+n+n;case 4095:case 3583:case 4068:case 2532:return ce(n,/(.+)-inline(.+)/,ae+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(yt(n)-1-e>6)switch(Ue(n,e+1)){case 109:if(Ue(n,e+4)!==45)break;case 102:return ce(n,/(.+:)(.+)-([^]+)/,"$1"+ae+"$2-$3$1"+Ti+(Ue(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~hc(n,"stretch")?_m(ce(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(Ue(n,e+1)!==115)break;case 6444:switch(Ue(n,yt(n)-3-(~hc(n,"!important")&&10))){case 107:return ce(n,":",":"+ae)+n;case 101:return ce(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ae+(Ue(n,14)===45?"inline-":"")+"box$3$1"+ae+"$2$3$1"+$e+"$2box$3")+n}break;case 5936:switch(Ue(n,e+11)){case 114:return ae+n+$e+ce(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return ae+n+$e+ce(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return ae+n+$e+ce(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return ae+n+$e+n+n}return n}var PP=function(e,t,r,s){if(e.length>-1&&!e.return)switch(e.type){case cl:e.return=_m(e.value,e.length);break;case fm:return Gn([Er(e,{value:ce(e.value,"@","@"+ae)})],s);case al:if(e.length)return fP(e.props,function(i){switch(hP(i,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Gn([Er(e,{props:[ce(i,/:(read-\w+)/,":"+Ti+"$1")]})],s);case"::placeholder":return Gn([Er(e,{props:[ce(i,/:(plac\w+)/,":"+ae+"input-$1")]}),Er(e,{props:[ce(i,/:(plac\w+)/,":"+Ti+"$1")]}),Er(e,{props:[ce(i,/:(plac\w+)/,$e+"input-$1")]})],s)}return""})}},OP=[PP],kP=function(e){var t=e.key;if(t==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(m){var g=m.getAttribute("data-emotion");g.indexOf(" ")!==-1&&(document.head.appendChild(m),m.setAttribute("data-s",""))})}var s=e.stylisPlugins||OP,i={},o,a=[];o=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(m){for(var g=m.getAttribute("data-emotion").split(" "),y=1;y<g.length;y++)i[g[y]]=!0;a.push(m)});var c,l=[CP,IP];{var u,h=[wP,xP(function(m){u.insert(m)})],f=TP(l.concat(s,h)),d=function(g){return Gn(yP(g),f)};c=function(g,y,S,v){u=S,d(g?g+"{"+y.styles+"}":y.styles),v&&(p.inserted[y.name]=!0)}}var p={key:t,sheet:new iP({key:t,container:o,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:i,registered:{},insert:c};return p.sheet.hydrate(a),p},ta={exports:{}},he={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Af;function MP(){if(Af)return he;Af=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,t=n?Symbol.for("react.portal"):60106,r=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,i=n?Symbol.for("react.profiler"):60114,o=n?Symbol.for("react.provider"):60109,a=n?Symbol.for("react.context"):60110,c=n?Symbol.for("react.async_mode"):60111,l=n?Symbol.for("react.concurrent_mode"):60111,u=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,d=n?Symbol.for("react.memo"):60115,p=n?Symbol.for("react.lazy"):60116,m=n?Symbol.for("react.block"):60121,g=n?Symbol.for("react.fundamental"):60117,y=n?Symbol.for("react.responder"):60118,S=n?Symbol.for("react.scope"):60119;function v(T){if(typeof T=="object"&&T!==null){var I=T.$$typeof;switch(I){case e:switch(T=T.type,T){case c:case l:case r:case i:case s:case h:return T;default:switch(T=T&&T.$$typeof,T){case a:case u:case p:case d:case o:return T;default:return I}}case t:return I}}}function x(T){return v(T)===l}return he.AsyncMode=c,he.ConcurrentMode=l,he.ContextConsumer=a,he.ContextProvider=o,he.Element=e,he.ForwardRef=u,he.Fragment=r,he.Lazy=p,he.Memo=d,he.Portal=t,he.Profiler=i,he.StrictMode=s,he.Suspense=h,he.isAsyncMode=function(T){return x(T)||v(T)===c},he.isConcurrentMode=x,he.isContextConsumer=function(T){return v(T)===a},he.isContextProvider=function(T){return v(T)===o},he.isElement=function(T){return typeof T=="object"&&T!==null&&T.$$typeof===e},he.isForwardRef=function(T){return v(T)===u},he.isFragment=function(T){return v(T)===r},he.isLazy=function(T){return v(T)===p},he.isMemo=function(T){return v(T)===d},he.isPortal=function(T){return v(T)===t},he.isProfiler=function(T){return v(T)===i},he.isStrictMode=function(T){return v(T)===s},he.isSuspense=function(T){return v(T)===h},he.isValidElementType=function(T){return typeof T=="string"||typeof T=="function"||T===r||T===l||T===i||T===s||T===h||T===f||typeof T=="object"&&T!==null&&(T.$$typeof===p||T.$$typeof===d||T.$$typeof===o||T.$$typeof===a||T.$$typeof===u||T.$$typeof===g||T.$$typeof===y||T.$$typeof===S||T.$$typeof===m)},he.typeOf=v,he}var Ef;function NP(){return Ef||(Ef=1,ta.exports=MP()),ta.exports}var na,Rf;function DP(){if(Rf)return na;Rf=1;var n=NP(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},t={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},i={};i[n.ForwardRef]=r,i[n.Memo]=s;function o(p){return n.isMemo(p)?s:i[p.$$typeof]||e}var a=Object.defineProperty,c=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,u=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,f=Object.prototype;function d(p,m,g){if(typeof m!="string"){if(f){var y=h(m);y&&y!==f&&d(p,y,g)}var S=c(m);l&&(S=S.concat(l(m)));for(var v=o(p),x=o(m),T=0;T<S.length;++T){var I=S[T];if(!t[I]&&!(g&&g[I])&&!(x&&x[I])&&!(v&&v[I])){var M=u(m,I);try{a(p,I,M)}catch{}}}}return p}return na=d,na}DP();var FP=!0;function UP(n,e,t){var r="";return t.split(" ").forEach(function(s){n[s]!==void 0?e.push(n[s]+";"):s&&(r+=s+" ")}),r}var bm=function(e,t,r){var s=e.key+"-"+t.name;(r===!1||FP===!1)&&e.registered[s]===void 0&&(e.registered[s]=t.styles)},BP=function(e,t,r){bm(e,t,r);var s=e.key+"-"+t.name;if(e.inserted[t.name]===void 0){var i=t;do e.insert(t===i?"."+s:"",i,e.sheet,!0),i=i.next;while(i!==void 0)}};function LP(n){for(var e=0,t,r=0,s=n.length;s>=4;++r,s-=4)t=n.charCodeAt(r)&255|(n.charCodeAt(++r)&255)<<8|(n.charCodeAt(++r)&255)<<16|(n.charCodeAt(++r)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,e=(t&65535)*1540483477+((t>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(s){case 3:e^=(n.charCodeAt(r+2)&255)<<16;case 2:e^=(n.charCodeAt(r+1)&255)<<8;case 1:e^=n.charCodeAt(r)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var VP={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},$P=/[A-Z]|^ms/g,jP=/_EMO_([^_]+?)_([^]*?)_EMO_/g,ym=function(e){return e.charCodeAt(1)===45},Cf=function(e){return e!=null&&typeof e!="boolean"},ra=SP(function(n){return ym(n)?n:n.replace($P,"-$&").toLowerCase()}),If=function(e,t){switch(e){case"animation":case"animationName":if(typeof t=="string")return t.replace(jP,function(r,s,i){return vt={name:s,styles:i,next:vt},s})}return VP[e]!==1&&!ym(e)&&typeof t=="number"&&t!==0?t+"px":t};function ts(n,e,t){if(t==null)return"";var r=t;if(r.__emotion_styles!==void 0)return r;switch(typeof t){case"boolean":return"";case"object":{var s=t;if(s.anim===1)return vt={name:s.name,styles:s.styles,next:vt},s.name;var i=t;if(i.styles!==void 0){var o=i.next;if(o!==void 0)for(;o!==void 0;)vt={name:o.name,styles:o.styles,next:vt},o=o.next;var a=i.styles+";";return a}return WP(n,e,t)}case"function":{if(n!==void 0){var c=vt,l=t(n);return vt=c,ts(n,e,l)}break}}var u=t;return u}function WP(n,e,t){var r="";if(Array.isArray(t))for(var s=0;s<t.length;s++)r+=ts(n,e,t[s])+";";else for(var i in t){var o=t[i];if(typeof o!="object"){var a=o;Cf(a)&&(r+=ra(i)+":"+If(i,a)+";")}else if(Array.isArray(o)&&typeof o[0]=="string"&&e==null)for(var c=0;c<o.length;c++)Cf(o[c])&&(r+=ra(i)+":"+If(i,o[c])+";");else{var l=ts(n,e,o);switch(i){case"animation":case"animationName":{r+=ra(i)+":"+l+";";break}default:r+=i+"{"+l+"}"}}}return r}var Pf=/label:\s*([^\s;{]+)\s*(;|$)/g,vt;function vm(n,e,t){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var r=!0,s="";vt=void 0;var i=n[0];if(i==null||i.raw===void 0)r=!1,s+=ts(t,e,i);else{var o=i;s+=o[0]}for(var a=1;a<n.length;a++)if(s+=ts(t,e,n[a]),r){var c=i;s+=c[a]}Pf.lastIndex=0;for(var l="",u;(u=Pf.exec(s))!==null;)l+="-"+u[1];var h=LP(s)+l;return{name:h,styles:s,next:vt}}var HP=function(e){return e()},zP=Sl.useInsertionEffect?Sl.useInsertionEffect:!1,XP=zP||HP,wm=C.createContext(typeof HTMLElement<"u"?kP({key:"css"}):null);wm.Provider;var qP=function(e){return C.forwardRef(function(t,r){var s=C.useContext(wm);return e(t,s,r)})},YP=C.createContext({}),ul={}.hasOwnProperty,dc="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",KP=function(e,t){var r={};for(var s in t)ul.call(t,s)&&(r[s]=t[s]);return r[dc]=e,r},ZP=function(e){var t=e.cache,r=e.serialized,s=e.isStringTag;return bm(t,r,s),XP(function(){return BP(t,r,s)}),null},JP=qP(function(n,e,t){var r=n.css;typeof r=="string"&&e.registered[r]!==void 0&&(r=e.registered[r]);var s=n[dc],i=[r],o="";typeof n.className=="string"?o=UP(e.registered,i,n.className):n.className!=null&&(o=n.className+" ");var a=vm(i,void 0,C.useContext(YP));o+=e.key+"-"+a.name;var c={};for(var l in n)ul.call(n,l)&&l!=="css"&&l!==dc&&(c[l]=n[l]);return c.className=o,t&&(c.ref=t),C.createElement(C.Fragment,null,C.createElement(ZP,{cache:e,serialized:a,isStringTag:typeof s=="string"}),C.createElement(s,c))}),QP=JP,z=function(e,t){var r=arguments;if(t==null||!ul.call(t,"css"))return C.createElement.apply(void 0,r);var s=r.length,i=new Array(s);i[0]=QP,i[1]=KP(e,t);for(var o=2;o<s;o++)i[o]=r[o];return C.createElement.apply(null,i)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(z||(z={}));function hl(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return vm(e)}function GP(){var n=hl.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}function eO(n,e){return e||(e=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(e)}}))}const tO=Math.min,nO=Math.max,xi=Math.round,Is=Math.floor,Si=n=>({x:n,y:n});function rO(n){const{x:e,y:t,width:r,height:s}=n;return{width:r,height:s,top:t,left:e,right:e+r,bottom:t+s,x:e,y:t}}function ao(){return typeof window<"u"}function Tm(n){return Sm(n)?(n.nodeName||"").toLowerCase():"#document"}function Nt(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function xm(n){var e;return(e=(Sm(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function Sm(n){return ao()?n instanceof Node||n instanceof Nt(n).Node:!1}function sO(n){return ao()?n instanceof Element||n instanceof Nt(n).Element:!1}function fl(n){return ao()?n instanceof HTMLElement||n instanceof Nt(n).HTMLElement:!1}function Of(n){return!ao()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Nt(n).ShadowRoot}function Am(n){const{overflow:e,overflowX:t,overflowY:r,display:s}=dl(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(s)}function iO(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function oO(n){return["html","body","#document"].includes(Tm(n))}function dl(n){return Nt(n).getComputedStyle(n)}function aO(n){if(Tm(n)==="html")return n;const e=n.assignedSlot||n.parentNode||Of(n)&&n.host||xm(n);return Of(e)?e.host:e}function Em(n){const e=aO(n);return oO(e)?n.ownerDocument?n.ownerDocument.body:n.body:fl(e)&&Am(e)?e:Em(e)}function Ai(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=Em(n),i=s===((r=n.ownerDocument)==null?void 0:r.body),o=Nt(s);if(i){const a=pc(o);return e.concat(o,o.visualViewport||[],Am(s)?s:[],a&&t?Ai(a):[])}return e.concat(s,Ai(s,[],t))}function pc(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function cO(n){const e=dl(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const s=fl(n),i=s?n.offsetWidth:t,o=s?n.offsetHeight:r,a=xi(t)!==i||xi(r)!==o;return a&&(t=i,r=o),{width:t,height:r,$:a}}function pl(n){return sO(n)?n:n.contextElement}function kf(n){const e=pl(n);if(!fl(e))return Si(1);const t=e.getBoundingClientRect(),{width:r,height:s,$:i}=cO(e);let o=(i?xi(t.width):t.width)/r,a=(i?xi(t.height):t.height)/s;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const lO=Si(0);function uO(n){const e=Nt(n);return!iO()||!e.visualViewport?lO:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function hO(n,e,t){return!1}function Mf(n,e,t,r){e===void 0&&(e=!1);const s=n.getBoundingClientRect(),i=pl(n);let o=Si(1);e&&(o=kf(n));const a=hO()?uO(i):Si(0);let c=(s.left+a.x)/o.x,l=(s.top+a.y)/o.y,u=s.width/o.x,h=s.height/o.y;if(i){const f=Nt(i),d=r;let p=f,m=pc(p);for(;m&&r&&d!==p;){const g=kf(m),y=m.getBoundingClientRect(),S=dl(m),v=y.left+(m.clientLeft+parseFloat(S.paddingLeft))*g.x,x=y.top+(m.clientTop+parseFloat(S.paddingTop))*g.y;c*=g.x,l*=g.y,u*=g.x,h*=g.y,c+=v,l+=x,p=Nt(m),m=pc(p)}}return rO({width:u,height:h,x:c,y:l})}function Rm(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function fO(n,e){let t=null,r;const s=xm(n);function i(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),i();const l=n.getBoundingClientRect(),{left:u,top:h,width:f,height:d}=l;if(a||e(),!f||!d)return;const p=Is(h),m=Is(s.clientWidth-(u+f)),g=Is(s.clientHeight-(h+d)),y=Is(u),v={rootMargin:-p+"px "+-m+"px "+-g+"px "+-y+"px",threshold:nO(0,tO(1,c))||1};let x=!0;function T(I){const M=I[0].intersectionRatio;if(M!==c){if(!x)return o();M?o(!1,M):r=setTimeout(()=>{o(!1,1e-7)},1e3)}M===1&&!Rm(l,n.getBoundingClientRect())&&o(),x=!1}try{t=new IntersectionObserver(T,{...v,root:s.ownerDocument})}catch{t=new IntersectionObserver(T,v)}t.observe(n)}return o(!0),i}function dO(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:s=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,l=pl(n),u=s||i?[...l?Ai(l):[],...Ai(e)]:[];u.forEach(y=>{s&&y.addEventListener("scroll",t,{passive:!0}),i&&y.addEventListener("resize",t)});const h=l&&a?fO(l,t):null;let f=-1,d=null;o&&(d=new ResizeObserver(y=>{let[S]=y;S&&S.target===l&&d&&(d.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var v;(v=d)==null||v.observe(e)})),t()}),l&&!c&&d.observe(l),d.observe(e));let p,m=c?Mf(n):null;c&&g();function g(){const y=Mf(n);m&&!Rm(m,y)&&t(),m=y,p=requestAnimationFrame(g)}return t(),()=>{var y;u.forEach(S=>{s&&S.removeEventListener("scroll",t),i&&S.removeEventListener("resize",t)}),h==null||h(),(y=d)==null||y.disconnect(),d=null,c&&cancelAnimationFrame(p)}}var gc=C.useLayoutEffect,pO=["className","clearValue","cx","getStyles","getClassNames","getValue","hasValue","isMulti","isRtl","options","selectOption","selectProps","setValue","theme"],Ei=function(){};function gO(n,e){return e?e[0]==="-"?n+e:n+"__"+e:n}function mO(n,e){for(var t=arguments.length,r=new Array(t>2?t-2:0),s=2;s<t;s++)r[s-2]=arguments[s];var i=[].concat(r);if(e&&n)for(var o in e)e.hasOwnProperty(o)&&e[o]&&i.push("".concat(gO(n,o)));return i.filter(function(a){return a}).map(function(a){return String(a).trim()}).join(" ")}var Nf=function(e){return AO(e)?e.filter(Boolean):yn(e)==="object"&&e!==null?[e]:[]},Cm=function(e){e.className,e.clearValue,e.cx,e.getStyles,e.getClassNames,e.getValue,e.hasValue,e.isMulti,e.isRtl,e.options,e.selectOption,e.selectProps,e.setValue,e.theme;var t=Ft(e,pO);return X({},t)},Se=function(e,t,r){var s=e.cx,i=e.getStyles,o=e.getClassNames,a=e.className;return{css:i(t,e),className:s(r??{},o(t,e),a)}};function co(n){return[document.documentElement,document.body,window].indexOf(n)>-1}function _O(n){return co(n)?window.innerHeight:n.clientHeight}function Im(n){return co(n)?window.pageYOffset:n.scrollTop}function Ri(n,e){if(co(n)){window.scrollTo(0,e);return}n.scrollTop=e}function bO(n){var e=getComputedStyle(n),t=e.position==="absolute",r=/(auto|scroll)/;if(e.position==="fixed")return document.documentElement;for(var s=n;s=s.parentElement;)if(e=getComputedStyle(s),!(t&&e.position==="static")&&r.test(e.overflow+e.overflowY+e.overflowX))return s;return document.documentElement}function yO(n,e,t,r){return t*((n=n/r-1)*n*n+1)+e}function Ps(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Ei,s=Im(n),i=e-s,o=10,a=0;function c(){a+=o;var l=yO(a,s,i,t);Ri(n,l),a<t?window.requestAnimationFrame(c):r(n)}c()}function Df(n,e){var t=n.getBoundingClientRect(),r=e.getBoundingClientRect(),s=e.offsetHeight/3;r.bottom+s>t.bottom?Ri(n,Math.min(e.offsetTop+e.clientHeight-n.offsetHeight+s,n.scrollHeight)):r.top-s<t.top&&Ri(n,Math.max(e.offsetTop-s,0))}function vO(n){var e=n.getBoundingClientRect();return{bottom:e.bottom,height:e.height,left:e.left,right:e.right,top:e.top,width:e.width}}function Ff(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}function wO(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch{return!1}}var Pm=!1,TO={get passive(){return Pm=!0}},Os=typeof window<"u"?window:{};Os.addEventListener&&Os.removeEventListener&&(Os.addEventListener("p",Ei,TO),Os.removeEventListener("p",Ei,!1));var xO=Pm;function SO(n){return n!=null}function AO(n){return Array.isArray(n)}function ks(n,e,t){return n?e:t}var EO=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];var i=Object.entries(e).filter(function(o){var a=Ot(o,1),c=a[0];return!r.includes(c)});return i.reduce(function(o,a){var c=Ot(a,2),l=c[0],u=c[1];return o[l]=u,o},{})},RO=["children","innerProps"],CO=["children","innerProps"];function IO(n){var e=n.maxHeight,t=n.menuEl,r=n.minHeight,s=n.placement,i=n.shouldScroll,o=n.isFixedPosition,a=n.controlHeight,c=bO(t),l={placement:"bottom",maxHeight:e};if(!t||!t.offsetParent)return l;var u=c.getBoundingClientRect(),h=u.height,f=t.getBoundingClientRect(),d=f.bottom,p=f.height,m=f.top,g=t.offsetParent.getBoundingClientRect(),y=g.top,S=o?window.innerHeight:_O(c),v=Im(c),x=parseInt(getComputedStyle(t).marginBottom,10),T=parseInt(getComputedStyle(t).marginTop,10),I=y-T,M=S-m,N=I+v,L=h-v-m,j=d-S+v+x,$=v+m-T,K=160;switch(s){case"auto":case"bottom":if(M>=p)return{placement:"bottom",maxHeight:e};if(L>=p&&!o)return i&&Ps(c,j,K),{placement:"bottom",maxHeight:e};if(!o&&L>=r||o&&M>=r){i&&Ps(c,j,K);var se=o?M-x:L-x;return{placement:"bottom",maxHeight:se}}if(s==="auto"||o){var Z=e,ie=o?I:N;return ie>=r&&(Z=Math.min(ie-x-a,e)),{placement:"top",maxHeight:Z}}if(s==="bottom")return i&&Ri(c,j),{placement:"bottom",maxHeight:e};break;case"top":if(I>=p)return{placement:"top",maxHeight:e};if(N>=p&&!o)return i&&Ps(c,$,K),{placement:"top",maxHeight:e};if(!o&&N>=r||o&&I>=r){var be=e;return(!o&&N>=r||o&&I>=r)&&(be=o?I-T:N-T),i&&Ps(c,$,K),{placement:"top",maxHeight:be}}return{placement:"bottom",maxHeight:e};default:throw new Error('Invalid placement provided "'.concat(s,'".'))}return l}function PO(n){var e={bottom:"top",top:"bottom"};return n?e[n]:"bottom"}var Om=function(e){return e==="auto"?"bottom":e},OO=function(e,t){var r,s=e.placement,i=e.theme,o=i.borderRadius,a=i.spacing,c=i.colors;return X((r={label:"menu"},Nr(r,PO(s),"100%"),Nr(r,"position","absolute"),Nr(r,"width","100%"),Nr(r,"zIndex",1),r),t?{}:{backgroundColor:c.neutral0,borderRadius:o,boxShadow:"0 0 0 1px hsla(0, 0%, 0%, 0.1), 0 4px 11px hsla(0, 0%, 0%, 0.1)",marginBottom:a.menuGutter,marginTop:a.menuGutter})},km=C.createContext(null),kO=function(e){var t=e.children,r=e.minMenuHeight,s=e.maxMenuHeight,i=e.menuPlacement,o=e.menuPosition,a=e.menuShouldScrollIntoView,c=e.theme,l=C.useContext(km)||{},u=l.setPortalPlacement,h=C.useRef(null),f=C.useState(s),d=Ot(f,2),p=d[0],m=d[1],g=C.useState(null),y=Ot(g,2),S=y[0],v=y[1],x=c.spacing.controlHeight;return gc(function(){var T=h.current;if(T){var I=o==="fixed",M=a&&!I,N=IO({maxHeight:s,menuEl:T,minHeight:r,placement:i,shouldScroll:M,isFixedPosition:I,controlHeight:x});m(N.maxHeight),v(N.placement),u==null||u(N.placement)}},[s,i,o,a,r,u,x]),t({ref:h,placerProps:X(X({},e),{},{placement:S||Om(i),maxHeight:p})})},MO=function(e){var t=e.children,r=e.innerRef,s=e.innerProps;return z("div",Y({},Se(e,"menu",{menu:!0}),{ref:r},s),t)},NO=MO,DO=function(e,t){var r=e.maxHeight,s=e.theme.spacing.baseUnit;return X({maxHeight:r,overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},t?{}:{paddingBottom:s,paddingTop:s})},FO=function(e){var t=e.children,r=e.innerProps,s=e.innerRef,i=e.isMulti;return z("div",Y({},Se(e,"menuList",{"menu-list":!0,"menu-list--is-multi":i}),{ref:s},r),t)},Mm=function(e,t){var r=e.theme,s=r.spacing.baseUnit,i=r.colors;return X({textAlign:"center"},t?{}:{color:i.neutral40,padding:"".concat(s*2,"px ").concat(s*3,"px")})},UO=Mm,BO=Mm,LO=function(e){var t=e.children,r=t===void 0?"No options":t,s=e.innerProps,i=Ft(e,RO);return z("div",Y({},Se(X(X({},i),{},{children:r,innerProps:s}),"noOptionsMessage",{"menu-notice":!0,"menu-notice--no-options":!0}),s),r)},VO=function(e){var t=e.children,r=t===void 0?"Loading...":t,s=e.innerProps,i=Ft(e,CO);return z("div",Y({},Se(X(X({},i),{},{children:r,innerProps:s}),"loadingMessage",{"menu-notice":!0,"menu-notice--loading":!0}),s),r)},$O=function(e){var t=e.rect,r=e.offset,s=e.position;return{left:t.left,position:s,top:r,width:t.width,zIndex:1}},jO=function(e){var t=e.appendTo,r=e.children,s=e.controlElement,i=e.innerProps,o=e.menuPlacement,a=e.menuPosition,c=C.useRef(null),l=C.useRef(null),u=C.useState(Om(o)),h=Ot(u,2),f=h[0],d=h[1],p=C.useMemo(function(){return{setPortalPlacement:d}},[]),m=C.useState(null),g=Ot(m,2),y=g[0],S=g[1],v=C.useCallback(function(){if(s){var M=vO(s),N=a==="fixed"?0:window.pageYOffset,L=M[f]+N;(L!==(y==null?void 0:y.offset)||M.left!==(y==null?void 0:y.rect.left)||M.width!==(y==null?void 0:y.rect.width))&&S({offset:L,rect:M})}},[s,a,f,y==null?void 0:y.offset,y==null?void 0:y.rect.left,y==null?void 0:y.rect.width]);gc(function(){v()},[v]);var x=C.useCallback(function(){typeof l.current=="function"&&(l.current(),l.current=null),s&&c.current&&(l.current=dO(s,c.current,v,{elementResize:"ResizeObserver"in window}))},[s,v]);gc(function(){x()},[x]);var T=C.useCallback(function(M){c.current=M,x()},[x]);if(!t&&a!=="fixed"||!y)return null;var I=z("div",Y({ref:T},Se(X(X({},e),{},{offset:y.offset,position:a,rect:y.rect}),"menuPortal",{"menu-portal":!0}),i),r);return z(km.Provider,{value:p},t?Jc.createPortal(I,t):I)},WO=function(e){var t=e.isDisabled,r=e.isRtl;return{label:"container",direction:r?"rtl":void 0,pointerEvents:t?"none":void 0,position:"relative"}},HO=function(e){var t=e.children,r=e.innerProps,s=e.isDisabled,i=e.isRtl;return z("div",Y({},Se(e,"container",{"--is-disabled":s,"--is-rtl":i}),r),t)},zO=function(e,t){var r=e.theme.spacing,s=e.isMulti,i=e.hasValue,o=e.selectProps.controlShouldRenderValue;return X({alignItems:"center",display:s&&i&&o?"flex":"grid",flex:1,flexWrap:"wrap",WebkitOverflowScrolling:"touch",position:"relative",overflow:"hidden"},t?{}:{padding:"".concat(r.baseUnit/2,"px ").concat(r.baseUnit*2,"px")})},XO=function(e){var t=e.children,r=e.innerProps,s=e.isMulti,i=e.hasValue;return z("div",Y({},Se(e,"valueContainer",{"value-container":!0,"value-container--is-multi":s,"value-container--has-value":i}),r),t)},qO=function(){return{alignItems:"center",alignSelf:"stretch",display:"flex",flexShrink:0}},YO=function(e){var t=e.children,r=e.innerProps;return z("div",Y({},Se(e,"indicatorsContainer",{indicators:!0}),r),t)},Uf,KO=["size"],ZO=["innerProps","isRtl","size"],JO={name:"8mmkcg",styles:"display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0"},Nm=function(e){var t=e.size,r=Ft(e,KO);return z("svg",Y({height:t,width:t,viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",css:JO},r))},gl=function(e){return z(Nm,Y({size:20},e),z("path",{d:"M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"}))},Dm=function(e){return z(Nm,Y({size:20},e),z("path",{d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"}))},Fm=function(e,t){var r=e.isFocused,s=e.theme,i=s.spacing.baseUnit,o=s.colors;return X({label:"indicatorContainer",display:"flex",transition:"color 150ms"},t?{}:{color:r?o.neutral60:o.neutral20,padding:i*2,":hover":{color:r?o.neutral80:o.neutral40}})},QO=Fm,GO=function(e){var t=e.children,r=e.innerProps;return z("div",Y({},Se(e,"dropdownIndicator",{indicator:!0,"dropdown-indicator":!0}),r),t||z(Dm,null))},ek=Fm,tk=function(e){var t=e.children,r=e.innerProps;return z("div",Y({},Se(e,"clearIndicator",{indicator:!0,"clear-indicator":!0}),r),t||z(gl,null))},nk=function(e,t){var r=e.isDisabled,s=e.theme,i=s.spacing.baseUnit,o=s.colors;return X({label:"indicatorSeparator",alignSelf:"stretch",width:1},t?{}:{backgroundColor:r?o.neutral10:o.neutral20,marginBottom:i*2,marginTop:i*2})},rk=function(e){var t=e.innerProps;return z("span",Y({},t,Se(e,"indicatorSeparator",{"indicator-separator":!0})))},sk=GP(Uf||(Uf=eO([`
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
`]))),ik=function(e,t){var r=e.isFocused,s=e.size,i=e.theme,o=i.colors,a=i.spacing.baseUnit;return X({label:"loadingIndicator",display:"flex",transition:"color 150ms",alignSelf:"center",fontSize:s,lineHeight:1,marginRight:s,textAlign:"center",verticalAlign:"middle"},t?{}:{color:r?o.neutral60:o.neutral20,padding:a*2})},sa=function(e){var t=e.delay,r=e.offset;return z("span",{css:hl({animation:"".concat(sk," 1s ease-in-out ").concat(t,"ms infinite;"),backgroundColor:"currentColor",borderRadius:"1em",display:"inline-block",marginLeft:r?"1em":void 0,height:"1em",verticalAlign:"top",width:"1em"},"","")})},ok=function(e){var t=e.innerProps,r=e.isRtl,s=e.size,i=s===void 0?4:s,o=Ft(e,ZO);return z("div",Y({},Se(X(X({},o),{},{innerProps:t,isRtl:r,size:i}),"loadingIndicator",{indicator:!0,"loading-indicator":!0}),t),z(sa,{delay:0,offset:r}),z(sa,{delay:160,offset:!0}),z(sa,{delay:320,offset:!r}))},ak=function(e,t){var r=e.isDisabled,s=e.isFocused,i=e.theme,o=i.colors,a=i.borderRadius,c=i.spacing;return X({label:"control",alignItems:"center",cursor:"default",display:"flex",flexWrap:"wrap",justifyContent:"space-between",minHeight:c.controlHeight,outline:"0 !important",position:"relative",transition:"all 100ms"},t?{}:{backgroundColor:r?o.neutral5:o.neutral0,borderColor:r?o.neutral10:s?o.primary:o.neutral20,borderRadius:a,borderStyle:"solid",borderWidth:1,boxShadow:s?"0 0 0 1px ".concat(o.primary):void 0,"&:hover":{borderColor:s?o.primary:o.neutral30}})},ck=function(e){var t=e.children,r=e.isDisabled,s=e.isFocused,i=e.innerRef,o=e.innerProps,a=e.menuIsOpen;return z("div",Y({ref:i},Se(e,"control",{control:!0,"control--is-disabled":r,"control--is-focused":s,"control--menu-is-open":a}),o,{"aria-disabled":r||void 0}),t)},lk=ck,uk=["data"],hk=function(e,t){var r=e.theme.spacing;return t?{}:{paddingBottom:r.baseUnit*2,paddingTop:r.baseUnit*2}},fk=function(e){var t=e.children,r=e.cx,s=e.getStyles,i=e.getClassNames,o=e.Heading,a=e.headingProps,c=e.innerProps,l=e.label,u=e.theme,h=e.selectProps;return z("div",Y({},Se(e,"group",{group:!0}),c),z(o,Y({},a,{selectProps:h,theme:u,getStyles:s,getClassNames:i,cx:r}),l),z("div",null,t))},dk=function(e,t){var r=e.theme,s=r.colors,i=r.spacing;return X({label:"group",cursor:"default",display:"block"},t?{}:{color:s.neutral40,fontSize:"75%",fontWeight:500,marginBottom:"0.25em",paddingLeft:i.baseUnit*3,paddingRight:i.baseUnit*3,textTransform:"uppercase"})},pk=function(e){var t=Cm(e);t.data;var r=Ft(t,uk);return z("div",Y({},Se(e,"groupHeading",{"group-heading":!0}),r))},gk=fk,mk=["innerRef","isDisabled","isHidden","inputClassName"],_k=function(e,t){var r=e.isDisabled,s=e.value,i=e.theme,o=i.spacing,a=i.colors;return X(X({visibility:r?"hidden":"visible",transform:s?"translateZ(0)":""},bk),t?{}:{margin:o.baseUnit/2,paddingBottom:o.baseUnit/2,paddingTop:o.baseUnit/2,color:a.neutral80})},Um={gridArea:"1 / 2",font:"inherit",minWidth:"2px",border:0,margin:0,outline:0,padding:0},bk={flex:"1 1 auto",display:"inline-grid",gridArea:"1 / 1 / 2 / 3",gridTemplateColumns:"0 min-content","&:after":X({content:'attr(data-value) " "',visibility:"hidden",whiteSpace:"pre"},Um)},yk=function(e){return X({label:"input",color:"inherit",background:0,opacity:e?0:1,width:"100%"},Um)},vk=function(e){var t=e.cx,r=e.value,s=Cm(e),i=s.innerRef,o=s.isDisabled,a=s.isHidden,c=s.inputClassName,l=Ft(s,mk);return z("div",Y({},Se(e,"input",{"input-container":!0}),{"data-value":r||""}),z("input",Y({className:t({input:!0},c),ref:i,style:yk(a),disabled:o},l)))},wk=vk,Tk=function(e,t){var r=e.theme,s=r.spacing,i=r.borderRadius,o=r.colors;return X({label:"multiValue",display:"flex",minWidth:0},t?{}:{backgroundColor:o.neutral10,borderRadius:i/2,margin:s.baseUnit/2})},xk=function(e,t){var r=e.theme,s=r.borderRadius,i=r.colors,o=e.cropWithEllipsis;return X({overflow:"hidden",textOverflow:o||o===void 0?"ellipsis":void 0,whiteSpace:"nowrap"},t?{}:{borderRadius:s/2,color:i.neutral80,fontSize:"85%",padding:3,paddingLeft:6})},Sk=function(e,t){var r=e.theme,s=r.spacing,i=r.borderRadius,o=r.colors,a=e.isFocused;return X({alignItems:"center",display:"flex"},t?{}:{borderRadius:i/2,backgroundColor:a?o.dangerLight:void 0,paddingLeft:s.baseUnit,paddingRight:s.baseUnit,":hover":{backgroundColor:o.dangerLight,color:o.danger}})},Bm=function(e){var t=e.children,r=e.innerProps;return z("div",r,t)},Ak=Bm,Ek=Bm;function Rk(n){var e=n.children,t=n.innerProps;return z("div",Y({role:"button"},t),e||z(gl,{size:14}))}var Ck=function(e){var t=e.children,r=e.components,s=e.data,i=e.innerProps,o=e.isDisabled,a=e.removeProps,c=e.selectProps,l=r.Container,u=r.Label,h=r.Remove;return z(l,{data:s,innerProps:X(X({},Se(e,"multiValue",{"multi-value":!0,"multi-value--is-disabled":o})),i),selectProps:c},z(u,{data:s,innerProps:X({},Se(e,"multiValueLabel",{"multi-value__label":!0})),selectProps:c},t),z(h,{data:s,innerProps:X(X({},Se(e,"multiValueRemove",{"multi-value__remove":!0})),{},{"aria-label":"Remove ".concat(t||"option")},a),selectProps:c}))},Ik=Ck,Pk=function(e,t){var r=e.isDisabled,s=e.isFocused,i=e.isSelected,o=e.theme,a=o.spacing,c=o.colors;return X({label:"option",cursor:"default",display:"block",fontSize:"inherit",width:"100%",userSelect:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)"},t?{}:{backgroundColor:i?c.primary:s?c.primary25:"transparent",color:r?c.neutral20:i?c.neutral0:"inherit",padding:"".concat(a.baseUnit*2,"px ").concat(a.baseUnit*3,"px"),":active":{backgroundColor:r?void 0:i?c.primary:c.primary50}})},Ok=function(e){var t=e.children,r=e.isDisabled,s=e.isFocused,i=e.isSelected,o=e.innerRef,a=e.innerProps;return z("div",Y({},Se(e,"option",{option:!0,"option--is-disabled":r,"option--is-focused":s,"option--is-selected":i}),{ref:o,"aria-disabled":r},a),t)},kk=Ok,Mk=function(e,t){var r=e.theme,s=r.spacing,i=r.colors;return X({label:"placeholder",gridArea:"1 / 1 / 2 / 3"},t?{}:{color:i.neutral50,marginLeft:s.baseUnit/2,marginRight:s.baseUnit/2})},Nk=function(e){var t=e.children,r=e.innerProps;return z("div",Y({},Se(e,"placeholder",{placeholder:!0}),r),t)},Dk=Nk,Fk=function(e,t){var r=e.isDisabled,s=e.theme,i=s.spacing,o=s.colors;return X({label:"singleValue",gridArea:"1 / 1 / 2 / 3",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},t?{}:{color:r?o.neutral40:o.neutral80,marginLeft:i.baseUnit/2,marginRight:i.baseUnit/2})},Uk=function(e){var t=e.children,r=e.isDisabled,s=e.innerProps;return z("div",Y({},Se(e,"singleValue",{"single-value":!0,"single-value--is-disabled":r}),s),t)},Bk=Uk,Lk={ClearIndicator:tk,Control:lk,DropdownIndicator:GO,DownChevron:Dm,CrossIcon:gl,Group:gk,GroupHeading:pk,IndicatorsContainer:YO,IndicatorSeparator:rk,Input:wk,LoadingIndicator:ok,Menu:NO,MenuList:FO,MenuPortal:jO,LoadingMessage:VO,NoOptionsMessage:LO,MultiValue:Ik,MultiValueContainer:Ak,MultiValueLabel:Ek,MultiValueRemove:Rk,Option:kk,Placeholder:Dk,SelectContainer:HO,SingleValue:Bk,ValueContainer:XO},Vk=function(e){return X(X({},Lk),e.components)},Bf=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function $k(n,e){return!!(n===e||Bf(n)&&Bf(e))}function jk(n,e){if(n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(!$k(n[t],e[t]))return!1;return!0}function Wk(n,e){e===void 0&&(e=jk);var t=null;function r(){for(var s=[],i=0;i<arguments.length;i++)s[i]=arguments[i];if(t&&t.lastThis===this&&e(s,t.lastArgs))return t.lastResult;var o=n.apply(this,s);return t={lastResult:o,lastArgs:s,lastThis:this},o}return r.clear=function(){t=null},r}var Hk={name:"7pg0cj-a11yText",styles:"label:a11yText;z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap"},zk=function(e){return z("span",Y({css:Hk},e))},Lf=zk,Xk={guidance:function(e){var t=e.isSearchable,r=e.isMulti,s=e.tabSelectsValue,i=e.context,o=e.isInitialFocus;switch(i){case"menu":return"Use Up and Down to choose options, press Enter to select the currently focused option, press Escape to exit the menu".concat(s?", press Tab to select the option and exit the menu":"",".");case"input":return o?"".concat(e["aria-label"]||"Select"," is focused ").concat(t?",type to refine list":"",", press Down to open the menu, ").concat(r?" press left to focus selected values":""):"";case"value":return"Use left and right to toggle between focused values, press Backspace to remove the currently focused value";default:return""}},onChange:function(e){var t=e.action,r=e.label,s=r===void 0?"":r,i=e.labels,o=e.isDisabled;switch(t){case"deselect-option":case"pop-value":case"remove-value":return"option ".concat(s,", deselected.");case"clear":return"All selected options have been cleared.";case"initial-input-focus":return"option".concat(i.length>1?"s":""," ").concat(i.join(","),", selected.");case"select-option":return o?"option ".concat(s," is disabled. Select another option."):"option ".concat(s,", selected.");default:return""}},onFocus:function(e){var t=e.context,r=e.focused,s=e.options,i=e.label,o=i===void 0?"":i,a=e.selectValue,c=e.isDisabled,l=e.isSelected,u=e.isAppleDevice,h=function(m,g){return m&&m.length?"".concat(m.indexOf(g)+1," of ").concat(m.length):""};if(t==="value"&&a)return"value ".concat(o," focused, ").concat(h(a,r),".");if(t==="menu"&&u){var f=c?" disabled":"",d="".concat(l?" selected":"").concat(f);return"".concat(o).concat(d,", ").concat(h(s,r),".")}return""},onFilter:function(e){var t=e.inputValue,r=e.resultsMessage;return"".concat(r).concat(t?" for search term "+t:"",".")}},qk=function(e){var t=e.ariaSelection,r=e.focusedOption,s=e.focusedValue,i=e.focusableOptions,o=e.isFocused,a=e.selectValue,c=e.selectProps,l=e.id,u=e.isAppleDevice,h=c.ariaLiveMessages,f=c.getOptionLabel,d=c.inputValue,p=c.isMulti,m=c.isOptionDisabled,g=c.isSearchable,y=c.menuIsOpen,S=c.options,v=c.screenReaderStatus,x=c.tabSelectsValue,T=c.isLoading,I=c["aria-label"],M=c["aria-live"],N=C.useMemo(function(){return X(X({},Xk),h||{})},[h]),L=C.useMemo(function(){var ie="";if(t&&N.onChange){var be=t.option,tt=t.options,ze=t.removedValue,dt=t.removedValues,P=t.value,U=function(de){return Array.isArray(de)?null:de},W=ze||be||U(P),H=W?f(W):"",G=tt||dt||void 0,le=G?G.map(f):[],J=X({isDisabled:W&&m(W,a),label:H,labels:le},t);ie=N.onChange(J)}return ie},[t,N,m,a,f]),j=C.useMemo(function(){var ie="",be=r||s,tt=!!(r&&a&&a.includes(r));if(be&&N.onFocus){var ze={focused:be,label:f(be),isDisabled:m(be,a),isSelected:tt,options:i,context:be===r?"menu":"value",selectValue:a,isAppleDevice:u};ie=N.onFocus(ze)}return ie},[r,s,f,m,N,i,a,u]),$=C.useMemo(function(){var ie="";if(y&&S.length&&!T&&N.onFilter){var be=v({count:i.length});ie=N.onFilter({inputValue:d,resultsMessage:be})}return ie},[i,d,y,N,S,v,T]),K=(t==null?void 0:t.action)==="initial-input-focus",se=C.useMemo(function(){var ie="";if(N.guidance){var be=s?"value":y?"menu":"input";ie=N.guidance({"aria-label":I,context:be,isDisabled:r&&m(r,a),isMulti:p,isSearchable:g,tabSelectsValue:x,isInitialFocus:K})}return ie},[I,r,s,p,m,g,y,N,a,x,K]),Z=z(C.Fragment,null,z("span",{id:"aria-selection"},L),z("span",{id:"aria-focused"},j),z("span",{id:"aria-results"},$),z("span",{id:"aria-guidance"},se));return z(C.Fragment,null,z(Lf,{id:l},K&&Z),z(Lf,{"aria-live":M,"aria-atomic":"false","aria-relevant":"additions text",role:"log"},o&&!K&&Z))},Yk=qk,mc=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],Kk=new RegExp("["+mc.map(function(n){return n.letters}).join("")+"]","g"),Lm={};for(var ia=0;ia<mc.length;ia++)for(var oa=mc[ia],aa=0;aa<oa.letters.length;aa++)Lm[oa.letters[aa]]=oa.base;var Vm=function(e){return e.replace(Kk,function(t){return Lm[t]})},Zk=Wk(Vm),Vf=function(e){return e.replace(/^\s+|\s+$/g,"")},Jk=function(e){return"".concat(e.label," ").concat(e.value)},Qk=function(e){return function(t,r){if(t.data.__isNew__)return!0;var s=X({ignoreCase:!0,ignoreAccents:!0,stringify:Jk,trim:!0,matchFrom:"any"},e),i=s.ignoreCase,o=s.ignoreAccents,a=s.stringify,c=s.trim,l=s.matchFrom,u=c?Vf(r):r,h=c?Vf(a(t)):a(t);return i&&(u=u.toLowerCase(),h=h.toLowerCase()),o&&(u=Zk(u),h=Vm(h)),l==="start"?h.substr(0,u.length)===u:h.indexOf(u)>-1}},Gk=["innerRef"];function eM(n){var e=n.innerRef,t=Ft(n,Gk),r=EO(t,"onExited","in","enter","exit","appear");return z("input",Y({ref:e},r,{css:hl({label:"dummyInput",background:0,border:0,caretColor:"transparent",fontSize:"inherit",gridArea:"1 / 1 / 2 / 3",outline:0,padding:0,width:1,color:"transparent",left:-100,opacity:0,position:"relative",transform:"scale(.01)"},"","")}))}var tM=function(e){e.cancelable&&e.preventDefault(),e.stopPropagation()};function nM(n){var e=n.isEnabled,t=n.onBottomArrive,r=n.onBottomLeave,s=n.onTopArrive,i=n.onTopLeave,o=C.useRef(!1),a=C.useRef(!1),c=C.useRef(0),l=C.useRef(null),u=C.useCallback(function(g,y){if(l.current!==null){var S=l.current,v=S.scrollTop,x=S.scrollHeight,T=S.clientHeight,I=l.current,M=y>0,N=x-T-v,L=!1;N>y&&o.current&&(r&&r(g),o.current=!1),M&&a.current&&(i&&i(g),a.current=!1),M&&y>N?(t&&!o.current&&t(g),I.scrollTop=x,L=!0,o.current=!0):!M&&-y>v&&(s&&!a.current&&s(g),I.scrollTop=0,L=!0,a.current=!0),L&&tM(g)}},[t,r,s,i]),h=C.useCallback(function(g){u(g,g.deltaY)},[u]),f=C.useCallback(function(g){c.current=g.changedTouches[0].clientY},[]),d=C.useCallback(function(g){var y=c.current-g.changedTouches[0].clientY;u(g,y)},[u]),p=C.useCallback(function(g){if(g){var y=xO?{passive:!1}:!1;g.addEventListener("wheel",h,y),g.addEventListener("touchstart",f,y),g.addEventListener("touchmove",d,y)}},[d,f,h]),m=C.useCallback(function(g){g&&(g.removeEventListener("wheel",h,!1),g.removeEventListener("touchstart",f,!1),g.removeEventListener("touchmove",d,!1))},[d,f,h]);return C.useEffect(function(){if(e){var g=l.current;return p(g),function(){m(g)}}},[e,p,m]),function(g){l.current=g}}var $f=["boxSizing","height","overflow","paddingRight","position"],jf={boxSizing:"border-box",overflow:"hidden",position:"relative",height:"100%"};function Wf(n){n.cancelable&&n.preventDefault()}function Hf(n){n.stopPropagation()}function zf(){var n=this.scrollTop,e=this.scrollHeight,t=n+this.offsetHeight;n===0?this.scrollTop=1:t===e&&(this.scrollTop=n-1)}function Xf(){return"ontouchstart"in window||navigator.maxTouchPoints}var qf=!!(typeof window<"u"&&window.document&&window.document.createElement),Rr=0,$n={capture:!1,passive:!1};function rM(n){var e=n.isEnabled,t=n.accountForScrollbars,r=t===void 0?!0:t,s=C.useRef({}),i=C.useRef(null),o=C.useCallback(function(c){if(qf){var l=document.body,u=l&&l.style;if(r&&$f.forEach(function(p){var m=u&&u[p];s.current[p]=m}),r&&Rr<1){var h=parseInt(s.current.paddingRight,10)||0,f=document.body?document.body.clientWidth:0,d=window.innerWidth-f+h||0;Object.keys(jf).forEach(function(p){var m=jf[p];u&&(u[p]=m)}),u&&(u.paddingRight="".concat(d,"px"))}l&&Xf()&&(l.addEventListener("touchmove",Wf,$n),c&&(c.addEventListener("touchstart",zf,$n),c.addEventListener("touchmove",Hf,$n))),Rr+=1}},[r]),a=C.useCallback(function(c){if(qf){var l=document.body,u=l&&l.style;Rr=Math.max(Rr-1,0),r&&Rr<1&&$f.forEach(function(h){var f=s.current[h];u&&(u[h]=f)}),l&&Xf()&&(l.removeEventListener("touchmove",Wf,$n),c&&(c.removeEventListener("touchstart",zf,$n),c.removeEventListener("touchmove",Hf,$n)))}},[r]);return C.useEffect(function(){if(e){var c=i.current;return o(c),function(){a(c)}}},[e,o,a]),function(c){i.current=c}}var sM=function(e){var t=e.target;return t.ownerDocument.activeElement&&t.ownerDocument.activeElement.blur()},iM={name:"1kfdb0e",styles:"position:fixed;left:0;bottom:0;right:0;top:0"};function oM(n){var e=n.children,t=n.lockEnabled,r=n.captureEnabled,s=r===void 0?!0:r,i=n.onBottomArrive,o=n.onBottomLeave,a=n.onTopArrive,c=n.onTopLeave,l=nM({isEnabled:s,onBottomArrive:i,onBottomLeave:o,onTopArrive:a,onTopLeave:c}),u=rM({isEnabled:t}),h=function(d){l(d),u(d)};return z(C.Fragment,null,t&&z("div",{onClick:sM,css:iM}),e(h))}var aM={name:"1a0ro4n-requiredInput",styles:"label:requiredInput;opacity:0;pointer-events:none;position:absolute;bottom:0;left:0;right:0;width:100%"},cM=function(e){var t=e.name,r=e.onFocus;return z("input",{required:!0,name:t,tabIndex:-1,"aria-hidden":"true",onFocus:r,css:aM,value:"",onChange:function(){}})},lM=cM;function ml(n){var e;return typeof window<"u"&&window.navigator!=null?n.test(((e=window.navigator.userAgentData)===null||e===void 0?void 0:e.platform)||window.navigator.platform):!1}function uM(){return ml(/^iPhone/i)}function $m(){return ml(/^Mac/i)}function hM(){return ml(/^iPad/i)||$m()&&navigator.maxTouchPoints>1}function fM(){return uM()||hM()}function dM(){return $m()||fM()}var pM=function(e){return e.label},gM=function(e){return e.label},mM=function(e){return e.value},_M=function(e){return!!e.isDisabled},bM={clearIndicator:ek,container:WO,control:ak,dropdownIndicator:QO,group:hk,groupHeading:dk,indicatorsContainer:qO,indicatorSeparator:nk,input:_k,loadingIndicator:ik,loadingMessage:BO,menu:OO,menuList:DO,menuPortal:$O,multiValue:Tk,multiValueLabel:xk,multiValueRemove:Sk,noOptionsMessage:UO,option:Pk,placeholder:Mk,singleValue:Fk,valueContainer:zO},yM={primary:"#2684FF",primary75:"#4C9AFF",primary50:"#B2D4FF",primary25:"#DEEBFF",danger:"#DE350B",dangerLight:"#FFBDAD",neutral0:"hsl(0, 0%, 100%)",neutral5:"hsl(0, 0%, 95%)",neutral10:"hsl(0, 0%, 90%)",neutral20:"hsl(0, 0%, 80%)",neutral30:"hsl(0, 0%, 70%)",neutral40:"hsl(0, 0%, 60%)",neutral50:"hsl(0, 0%, 50%)",neutral60:"hsl(0, 0%, 40%)",neutral70:"hsl(0, 0%, 30%)",neutral80:"hsl(0, 0%, 20%)",neutral90:"hsl(0, 0%, 10%)"},vM=4,jm=4,wM=38,TM=jm*2,xM={baseUnit:jm,controlHeight:wM,menuGutter:TM},ca={borderRadius:vM,colors:yM,spacing:xM},SM={"aria-live":"polite",backspaceRemovesValue:!0,blurInputOnSelect:Ff(),captureMenuScroll:!Ff(),classNames:{},closeMenuOnSelect:!0,closeMenuOnScroll:!1,components:{},controlShouldRenderValue:!0,escapeClearsValue:!1,filterOption:Qk(),formatGroupLabel:pM,getOptionLabel:gM,getOptionValue:mM,isDisabled:!1,isLoading:!1,isMulti:!1,isRtl:!1,isSearchable:!0,isOptionDisabled:_M,loadingMessage:function(){return"Loading..."},maxMenuHeight:300,minMenuHeight:140,menuIsOpen:!1,menuPlacement:"bottom",menuPosition:"absolute",menuShouldBlockScroll:!1,menuShouldScrollIntoView:!wO(),noOptionsMessage:function(){return"No options"},openMenuOnFocus:!1,openMenuOnClick:!0,options:[],pageSize:5,placeholder:"Select...",screenReaderStatus:function(e){var t=e.count;return"".concat(t," result").concat(t!==1?"s":""," available")},styles:{},tabIndex:0,tabSelectsValue:!0,unstyled:!1};function Yf(n,e,t,r){var s=zm(n,e,t),i=Xm(n,e,t),o=Hm(n,e),a=Ci(n,e);return{type:"option",data:e,isDisabled:s,isSelected:i,label:o,value:a,index:r}}function Ws(n,e){return n.options.map(function(t,r){if("options"in t){var s=t.options.map(function(o,a){return Yf(n,o,e,a)}).filter(function(o){return Zf(n,o)});return s.length>0?{type:"group",data:t,options:s,index:r}:void 0}var i=Yf(n,t,e,r);return Zf(n,i)?i:void 0}).filter(SO)}function Wm(n){return n.reduce(function(e,t){return t.type==="group"?e.push.apply(e,ol(t.options.map(function(r){return r.data}))):e.push(t.data),e},[])}function Kf(n,e){return n.reduce(function(t,r){return r.type==="group"?t.push.apply(t,ol(r.options.map(function(s){return{data:s.data,id:"".concat(e,"-").concat(r.index,"-").concat(s.index)}}))):t.push({data:r.data,id:"".concat(e,"-").concat(r.index)}),t},[])}function AM(n,e){return Wm(Ws(n,e))}function Zf(n,e){var t=n.inputValue,r=t===void 0?"":t,s=e.data,i=e.isSelected,o=e.label,a=e.value;return(!Ym(n)||!i)&&qm(n,{label:o,value:a,data:s},r)}function EM(n,e){var t=n.focusedValue,r=n.selectValue,s=r.indexOf(t);if(s>-1){var i=e.indexOf(t);if(i>-1)return t;if(s<e.length)return e[s]}return null}function RM(n,e){var t=n.focusedOption;return t&&e.indexOf(t)>-1?t:e[0]}var la=function(e,t){var r,s=(r=e.find(function(i){return i.data===t}))===null||r===void 0?void 0:r.id;return s||null},Hm=function(e,t){return e.getOptionLabel(t)},Ci=function(e,t){return e.getOptionValue(t)};function zm(n,e,t){return typeof n.isOptionDisabled=="function"?n.isOptionDisabled(e,t):!1}function Xm(n,e,t){if(t.indexOf(e)>-1)return!0;if(typeof n.isOptionSelected=="function")return n.isOptionSelected(e,t);var r=Ci(n,e);return t.some(function(s){return Ci(n,s)===r})}function qm(n,e,t){return n.filterOption?n.filterOption(e,t):!0}var Ym=function(e){var t=e.hideSelectedOptions,r=e.isMulti;return t===void 0?r:t},CM=1,Km=function(n){ZI(t,n);var e=GI(t);function t(r){var s;if(YI(this,t),s=e.call(this,r),s.state={ariaSelection:null,focusedOption:null,focusedOptionId:null,focusableOptionsWithIds:[],focusedValue:null,inputIsHidden:!1,isFocused:!1,selectValue:[],clearFocusValueOnUpdate:!1,prevWasFocused:!1,inputIsHiddenAfterUpdate:void 0,prevProps:void 0,instancePrefix:""},s.blockOptionHover=!1,s.isComposing=!1,s.commonProps=void 0,s.initialTouchX=0,s.initialTouchY=0,s.openAfterFocus=!1,s.scrollToFocusedOptionOnUpdate=!1,s.userIsDragging=void 0,s.isAppleDevice=dM(),s.controlRef=null,s.getControlRef=function(c){s.controlRef=c},s.focusedOptionRef=null,s.getFocusedOptionRef=function(c){s.focusedOptionRef=c},s.menuListRef=null,s.getMenuListRef=function(c){s.menuListRef=c},s.inputRef=null,s.getInputRef=function(c){s.inputRef=c},s.focus=s.focusInput,s.blur=s.blurInput,s.onChange=function(c,l){var u=s.props,h=u.onChange,f=u.name;l.name=f,s.ariaOnChange(c,l),h(c,l)},s.setValue=function(c,l,u){var h=s.props,f=h.closeMenuOnSelect,d=h.isMulti,p=h.inputValue;s.onInputChange("",{action:"set-value",prevInputValue:p}),f&&(s.setState({inputIsHiddenAfterUpdate:!d}),s.onMenuClose()),s.setState({clearFocusValueOnUpdate:!0}),s.onChange(c,{action:l,option:u})},s.selectOption=function(c){var l=s.props,u=l.blurInputOnSelect,h=l.isMulti,f=l.name,d=s.state.selectValue,p=h&&s.isOptionSelected(c,d),m=s.isOptionDisabled(c,d);if(p){var g=s.getOptionValue(c);s.setValue(d.filter(function(y){return s.getOptionValue(y)!==g}),"deselect-option",c)}else if(!m)h?s.setValue([].concat(ol(d),[c]),"select-option",c):s.setValue(c,"select-option");else{s.ariaOnChange(c,{action:"select-option",option:c,name:f});return}u&&s.blurInput()},s.removeValue=function(c){var l=s.props.isMulti,u=s.state.selectValue,h=s.getOptionValue(c),f=u.filter(function(p){return s.getOptionValue(p)!==h}),d=ks(l,f,f[0]||null);s.onChange(d,{action:"remove-value",removedValue:c}),s.focusInput()},s.clearValue=function(){var c=s.state.selectValue;s.onChange(ks(s.props.isMulti,[],null),{action:"clear",removedValues:c})},s.popValue=function(){var c=s.props.isMulti,l=s.state.selectValue,u=l[l.length-1],h=l.slice(0,l.length-1),f=ks(c,h,h[0]||null);u&&s.onChange(f,{action:"pop-value",removedValue:u})},s.getFocusedOptionId=function(c){return la(s.state.focusableOptionsWithIds,c)},s.getFocusableOptionsWithIds=function(){return Kf(Ws(s.props,s.state.selectValue),s.getElementId("option"))},s.getValue=function(){return s.state.selectValue},s.cx=function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return mO.apply(void 0,[s.props.classNamePrefix].concat(l))},s.getOptionLabel=function(c){return Hm(s.props,c)},s.getOptionValue=function(c){return Ci(s.props,c)},s.getStyles=function(c,l){var u=s.props.unstyled,h=bM[c](l,u);h.boxSizing="border-box";var f=s.props.styles[c];return f?f(h,l):h},s.getClassNames=function(c,l){var u,h;return(u=(h=s.props.classNames)[c])===null||u===void 0?void 0:u.call(h,l)},s.getElementId=function(c){return"".concat(s.state.instancePrefix,"-").concat(c)},s.getComponents=function(){return Vk(s.props)},s.buildCategorizedOptions=function(){return Ws(s.props,s.state.selectValue)},s.getCategorizedOptions=function(){return s.props.menuIsOpen?s.buildCategorizedOptions():[]},s.buildFocusableOptions=function(){return Wm(s.buildCategorizedOptions())},s.getFocusableOptions=function(){return s.props.menuIsOpen?s.buildFocusableOptions():[]},s.ariaOnChange=function(c,l){s.setState({ariaSelection:X({value:c},l)})},s.onMenuMouseDown=function(c){c.button===0&&(c.stopPropagation(),c.preventDefault(),s.focusInput())},s.onMenuMouseMove=function(c){s.blockOptionHover=!1},s.onControlMouseDown=function(c){if(!c.defaultPrevented){var l=s.props.openMenuOnClick;s.state.isFocused?s.props.menuIsOpen?c.target.tagName!=="INPUT"&&c.target.tagName!=="TEXTAREA"&&s.onMenuClose():l&&s.openMenu("first"):(l&&(s.openAfterFocus=!0),s.focusInput()),c.target.tagName!=="INPUT"&&c.target.tagName!=="TEXTAREA"&&c.preventDefault()}},s.onDropdownIndicatorMouseDown=function(c){if(!(c&&c.type==="mousedown"&&c.button!==0)&&!s.props.isDisabled){var l=s.props,u=l.isMulti,h=l.menuIsOpen;s.focusInput(),h?(s.setState({inputIsHiddenAfterUpdate:!u}),s.onMenuClose()):s.openMenu("first"),c.preventDefault()}},s.onClearIndicatorMouseDown=function(c){c&&c.type==="mousedown"&&c.button!==0||(s.clearValue(),c.preventDefault(),s.openAfterFocus=!1,c.type==="touchend"?s.focusInput():setTimeout(function(){return s.focusInput()}))},s.onScroll=function(c){typeof s.props.closeMenuOnScroll=="boolean"?c.target instanceof HTMLElement&&co(c.target)&&s.props.onMenuClose():typeof s.props.closeMenuOnScroll=="function"&&s.props.closeMenuOnScroll(c)&&s.props.onMenuClose()},s.onCompositionStart=function(){s.isComposing=!0},s.onCompositionEnd=function(){s.isComposing=!1},s.onTouchStart=function(c){var l=c.touches,u=l&&l.item(0);u&&(s.initialTouchX=u.clientX,s.initialTouchY=u.clientY,s.userIsDragging=!1)},s.onTouchMove=function(c){var l=c.touches,u=l&&l.item(0);if(u){var h=Math.abs(u.clientX-s.initialTouchX),f=Math.abs(u.clientY-s.initialTouchY),d=5;s.userIsDragging=h>d||f>d}},s.onTouchEnd=function(c){s.userIsDragging||(s.controlRef&&!s.controlRef.contains(c.target)&&s.menuListRef&&!s.menuListRef.contains(c.target)&&s.blurInput(),s.initialTouchX=0,s.initialTouchY=0)},s.onControlTouchEnd=function(c){s.userIsDragging||s.onControlMouseDown(c)},s.onClearIndicatorTouchEnd=function(c){s.userIsDragging||s.onClearIndicatorMouseDown(c)},s.onDropdownIndicatorTouchEnd=function(c){s.userIsDragging||s.onDropdownIndicatorMouseDown(c)},s.handleInputChange=function(c){var l=s.props.inputValue,u=c.currentTarget.value;s.setState({inputIsHiddenAfterUpdate:!1}),s.onInputChange(u,{action:"input-change",prevInputValue:l}),s.props.menuIsOpen||s.onMenuOpen()},s.onInputFocus=function(c){s.props.onFocus&&s.props.onFocus(c),s.setState({inputIsHiddenAfterUpdate:!1,isFocused:!0}),(s.openAfterFocus||s.props.openMenuOnFocus)&&s.openMenu("first"),s.openAfterFocus=!1},s.onInputBlur=function(c){var l=s.props.inputValue;if(s.menuListRef&&s.menuListRef.contains(document.activeElement)){s.inputRef.focus();return}s.props.onBlur&&s.props.onBlur(c),s.onInputChange("",{action:"input-blur",prevInputValue:l}),s.onMenuClose(),s.setState({focusedValue:null,isFocused:!1})},s.onOptionHover=function(c){if(!(s.blockOptionHover||s.state.focusedOption===c)){var l=s.getFocusableOptions(),u=l.indexOf(c);s.setState({focusedOption:c,focusedOptionId:u>-1?s.getFocusedOptionId(c):null})}},s.shouldHideSelectedOptions=function(){return Ym(s.props)},s.onValueInputFocus=function(c){c.preventDefault(),c.stopPropagation(),s.focus()},s.onKeyDown=function(c){var l=s.props,u=l.isMulti,h=l.backspaceRemovesValue,f=l.escapeClearsValue,d=l.inputValue,p=l.isClearable,m=l.isDisabled,g=l.menuIsOpen,y=l.onKeyDown,S=l.tabSelectsValue,v=l.openMenuOnFocus,x=s.state,T=x.focusedOption,I=x.focusedValue,M=x.selectValue;if(!m&&!(typeof y=="function"&&(y(c),c.defaultPrevented))){switch(s.blockOptionHover=!0,c.key){case"ArrowLeft":if(!u||d)return;s.focusValue("previous");break;case"ArrowRight":if(!u||d)return;s.focusValue("next");break;case"Delete":case"Backspace":if(d)return;if(I)s.removeValue(I);else{if(!h)return;u?s.popValue():p&&s.clearValue()}break;case"Tab":if(s.isComposing||c.shiftKey||!g||!S||!T||v&&s.isOptionSelected(T,M))return;s.selectOption(T);break;case"Enter":if(c.keyCode===229)break;if(g){if(!T||s.isComposing)return;s.selectOption(T);break}return;case"Escape":g?(s.setState({inputIsHiddenAfterUpdate:!1}),s.onInputChange("",{action:"menu-close",prevInputValue:d}),s.onMenuClose()):p&&f&&s.clearValue();break;case" ":if(d)return;if(!g){s.openMenu("first");break}if(!T)return;s.selectOption(T);break;case"ArrowUp":g?s.focusOption("up"):s.openMenu("last");break;case"ArrowDown":g?s.focusOption("down"):s.openMenu("first");break;case"PageUp":if(!g)return;s.focusOption("pageup");break;case"PageDown":if(!g)return;s.focusOption("pagedown");break;case"Home":if(!g)return;s.focusOption("first");break;case"End":if(!g)return;s.focusOption("last");break;default:return}c.preventDefault()}},s.state.instancePrefix="react-select-"+(s.props.instanceId||++CM),s.state.selectValue=Nf(r.value),r.menuIsOpen&&s.state.selectValue.length){var i=s.getFocusableOptionsWithIds(),o=s.buildFocusableOptions(),a=o.indexOf(s.state.selectValue[0]);s.state.focusableOptionsWithIds=i,s.state.focusedOption=o[a],s.state.focusedOptionId=la(i,o[a])}return s}return KI(t,[{key:"componentDidMount",value:function(){this.startListeningComposition(),this.startListeningToTouch(),this.props.closeMenuOnScroll&&document&&document.addEventListener&&document.addEventListener("scroll",this.onScroll,!0),this.props.autoFocus&&this.focusInput(),this.props.menuIsOpen&&this.state.focusedOption&&this.menuListRef&&this.focusedOptionRef&&Df(this.menuListRef,this.focusedOptionRef)}},{key:"componentDidUpdate",value:function(s){var i=this.props,o=i.isDisabled,a=i.menuIsOpen,c=this.state.isFocused;(c&&!o&&s.isDisabled||c&&a&&!s.menuIsOpen)&&this.focusInput(),c&&o&&!s.isDisabled?this.setState({isFocused:!1},this.onMenuClose):!c&&!o&&s.isDisabled&&this.inputRef===document.activeElement&&this.setState({isFocused:!0}),this.menuListRef&&this.focusedOptionRef&&this.scrollToFocusedOptionOnUpdate&&(Df(this.menuListRef,this.focusedOptionRef),this.scrollToFocusedOptionOnUpdate=!1)}},{key:"componentWillUnmount",value:function(){this.stopListeningComposition(),this.stopListeningToTouch(),document.removeEventListener("scroll",this.onScroll,!0)}},{key:"onMenuOpen",value:function(){this.props.onMenuOpen()}},{key:"onMenuClose",value:function(){this.onInputChange("",{action:"menu-close",prevInputValue:this.props.inputValue}),this.props.onMenuClose()}},{key:"onInputChange",value:function(s,i){this.props.onInputChange(s,i)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"blurInput",value:function(){this.inputRef&&this.inputRef.blur()}},{key:"openMenu",value:function(s){var i=this,o=this.state,a=o.selectValue,c=o.isFocused,l=this.buildFocusableOptions(),u=s==="first"?0:l.length-1;if(!this.props.isMulti){var h=l.indexOf(a[0]);h>-1&&(u=h)}this.scrollToFocusedOptionOnUpdate=!(c&&this.menuListRef),this.setState({inputIsHiddenAfterUpdate:!1,focusedValue:null,focusedOption:l[u],focusedOptionId:this.getFocusedOptionId(l[u])},function(){return i.onMenuOpen()})}},{key:"focusValue",value:function(s){var i=this.state,o=i.selectValue,a=i.focusedValue;if(this.props.isMulti){this.setState({focusedOption:null});var c=o.indexOf(a);a||(c=-1);var l=o.length-1,u=-1;if(o.length){switch(s){case"previous":c===0?u=0:c===-1?u=l:u=c-1;break;case"next":c>-1&&c<l&&(u=c+1);break}this.setState({inputIsHidden:u!==-1,focusedValue:o[u]})}}}},{key:"focusOption",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"first",i=this.props.pageSize,o=this.state.focusedOption,a=this.getFocusableOptions();if(a.length){var c=0,l=a.indexOf(o);o||(l=-1),s==="up"?c=l>0?l-1:a.length-1:s==="down"?c=(l+1)%a.length:s==="pageup"?(c=l-i,c<0&&(c=0)):s==="pagedown"?(c=l+i,c>a.length-1&&(c=a.length-1)):s==="last"&&(c=a.length-1),this.scrollToFocusedOptionOnUpdate=!0,this.setState({focusedOption:a[c],focusedValue:null,focusedOptionId:this.getFocusedOptionId(a[c])})}}},{key:"getTheme",value:function(){return this.props.theme?typeof this.props.theme=="function"?this.props.theme(ca):X(X({},ca),this.props.theme):ca}},{key:"getCommonProps",value:function(){var s=this.clearValue,i=this.cx,o=this.getStyles,a=this.getClassNames,c=this.getValue,l=this.selectOption,u=this.setValue,h=this.props,f=h.isMulti,d=h.isRtl,p=h.options,m=this.hasValue();return{clearValue:s,cx:i,getStyles:o,getClassNames:a,getValue:c,hasValue:m,isMulti:f,isRtl:d,options:p,selectOption:l,selectProps:h,setValue:u,theme:this.getTheme()}}},{key:"hasValue",value:function(){var s=this.state.selectValue;return s.length>0}},{key:"hasOptions",value:function(){return!!this.getFocusableOptions().length}},{key:"isClearable",value:function(){var s=this.props,i=s.isClearable,o=s.isMulti;return i===void 0?o:i}},{key:"isOptionDisabled",value:function(s,i){return zm(this.props,s,i)}},{key:"isOptionSelected",value:function(s,i){return Xm(this.props,s,i)}},{key:"filterOption",value:function(s,i){return qm(this.props,s,i)}},{key:"formatOptionLabel",value:function(s,i){if(typeof this.props.formatOptionLabel=="function"){var o=this.props.inputValue,a=this.state.selectValue;return this.props.formatOptionLabel(s,{context:i,inputValue:o,selectValue:a})}else return this.getOptionLabel(s)}},{key:"formatGroupLabel",value:function(s){return this.props.formatGroupLabel(s)}},{key:"startListeningComposition",value:function(){document&&document.addEventListener&&(document.addEventListener("compositionstart",this.onCompositionStart,!1),document.addEventListener("compositionend",this.onCompositionEnd,!1))}},{key:"stopListeningComposition",value:function(){document&&document.removeEventListener&&(document.removeEventListener("compositionstart",this.onCompositionStart),document.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"startListeningToTouch",value:function(){document&&document.addEventListener&&(document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("touchend",this.onTouchEnd,!1))}},{key:"stopListeningToTouch",value:function(){document&&document.removeEventListener&&(document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"renderInput",value:function(){var s=this.props,i=s.isDisabled,o=s.isSearchable,a=s.inputId,c=s.inputValue,l=s.tabIndex,u=s.form,h=s.menuIsOpen,f=s.required,d=this.getComponents(),p=d.Input,m=this.state,g=m.inputIsHidden,y=m.ariaSelection,S=this.commonProps,v=a||this.getElementId("input"),x=X(X(X({"aria-autocomplete":"list","aria-expanded":h,"aria-haspopup":!0,"aria-errormessage":this.props["aria-errormessage"],"aria-invalid":this.props["aria-invalid"],"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-required":f,role:"combobox","aria-activedescendant":this.isAppleDevice?void 0:this.state.focusedOptionId||""},h&&{"aria-controls":this.getElementId("listbox")}),!o&&{"aria-readonly":!0}),this.hasValue()?(y==null?void 0:y.action)==="initial-input-focus"&&{"aria-describedby":this.getElementId("live-region")}:{"aria-describedby":this.getElementId("placeholder")});return o?C.createElement(p,Y({},S,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",id:v,innerRef:this.getInputRef,isDisabled:i,isHidden:g,onBlur:this.onInputBlur,onChange:this.handleInputChange,onFocus:this.onInputFocus,spellCheck:"false",tabIndex:l,form:u,type:"text",value:c},x)):C.createElement(eM,Y({id:v,innerRef:this.getInputRef,onBlur:this.onInputBlur,onChange:Ei,onFocus:this.onInputFocus,disabled:i,tabIndex:l,inputMode:"none",form:u,value:""},x))}},{key:"renderPlaceholderOrValue",value:function(){var s=this,i=this.getComponents(),o=i.MultiValue,a=i.MultiValueContainer,c=i.MultiValueLabel,l=i.MultiValueRemove,u=i.SingleValue,h=i.Placeholder,f=this.commonProps,d=this.props,p=d.controlShouldRenderValue,m=d.isDisabled,g=d.isMulti,y=d.inputValue,S=d.placeholder,v=this.state,x=v.selectValue,T=v.focusedValue,I=v.isFocused;if(!this.hasValue()||!p)return y?null:C.createElement(h,Y({},f,{key:"placeholder",isDisabled:m,isFocused:I,innerProps:{id:this.getElementId("placeholder")}}),S);if(g)return x.map(function(N,L){var j=N===T,$="".concat(s.getOptionLabel(N),"-").concat(s.getOptionValue(N));return C.createElement(o,Y({},f,{components:{Container:a,Label:c,Remove:l},isFocused:j,isDisabled:m,key:$,index:L,removeProps:{onClick:function(){return s.removeValue(N)},onTouchEnd:function(){return s.removeValue(N)},onMouseDown:function(se){se.preventDefault()}},data:N}),s.formatOptionLabel(N,"value"))});if(y)return null;var M=x[0];return C.createElement(u,Y({},f,{data:M,isDisabled:m}),this.formatOptionLabel(M,"value"))}},{key:"renderClearIndicator",value:function(){var s=this.getComponents(),i=s.ClearIndicator,o=this.commonProps,a=this.props,c=a.isDisabled,l=a.isLoading,u=this.state.isFocused;if(!this.isClearable()||!i||c||!this.hasValue()||l)return null;var h={onMouseDown:this.onClearIndicatorMouseDown,onTouchEnd:this.onClearIndicatorTouchEnd,"aria-hidden":"true"};return C.createElement(i,Y({},o,{innerProps:h,isFocused:u}))}},{key:"renderLoadingIndicator",value:function(){var s=this.getComponents(),i=s.LoadingIndicator,o=this.commonProps,a=this.props,c=a.isDisabled,l=a.isLoading,u=this.state.isFocused;if(!i||!l)return null;var h={"aria-hidden":"true"};return C.createElement(i,Y({},o,{innerProps:h,isDisabled:c,isFocused:u}))}},{key:"renderIndicatorSeparator",value:function(){var s=this.getComponents(),i=s.DropdownIndicator,o=s.IndicatorSeparator;if(!i||!o)return null;var a=this.commonProps,c=this.props.isDisabled,l=this.state.isFocused;return C.createElement(o,Y({},a,{isDisabled:c,isFocused:l}))}},{key:"renderDropdownIndicator",value:function(){var s=this.getComponents(),i=s.DropdownIndicator;if(!i)return null;var o=this.commonProps,a=this.props.isDisabled,c=this.state.isFocused,l={onMouseDown:this.onDropdownIndicatorMouseDown,onTouchEnd:this.onDropdownIndicatorTouchEnd,"aria-hidden":"true"};return C.createElement(i,Y({},o,{innerProps:l,isDisabled:a,isFocused:c}))}},{key:"renderMenu",value:function(){var s=this,i=this.getComponents(),o=i.Group,a=i.GroupHeading,c=i.Menu,l=i.MenuList,u=i.MenuPortal,h=i.LoadingMessage,f=i.NoOptionsMessage,d=i.Option,p=this.commonProps,m=this.state.focusedOption,g=this.props,y=g.captureMenuScroll,S=g.inputValue,v=g.isLoading,x=g.loadingMessage,T=g.minMenuHeight,I=g.maxMenuHeight,M=g.menuIsOpen,N=g.menuPlacement,L=g.menuPosition,j=g.menuPortalTarget,$=g.menuShouldBlockScroll,K=g.menuShouldScrollIntoView,se=g.noOptionsMessage,Z=g.onMenuScrollToTop,ie=g.onMenuScrollToBottom;if(!M)return null;var be=function(H,G){var le=H.type,J=H.data,De=H.isDisabled,de=H.isSelected,An=H.label,Zm=H.value,_l=m===J,bl=De?void 0:function(){return s.onOptionHover(J)},Jm=De?void 0:function(){return s.selectOption(J)},yl="".concat(s.getElementId("option"),"-").concat(G),Qm={id:yl,onClick:Jm,onMouseMove:bl,onMouseOver:bl,tabIndex:-1,role:"option","aria-selected":s.isAppleDevice?void 0:de};return C.createElement(d,Y({},p,{innerProps:Qm,data:J,isDisabled:De,isSelected:de,key:yl,label:An,type:le,value:Zm,isFocused:_l,innerRef:_l?s.getFocusedOptionRef:void 0}),s.formatOptionLabel(H.data,"menu"))},tt;if(this.hasOptions())tt=this.getCategorizedOptions().map(function(W){if(W.type==="group"){var H=W.data,G=W.options,le=W.index,J="".concat(s.getElementId("group"),"-").concat(le),De="".concat(J,"-heading");return C.createElement(o,Y({},p,{key:J,data:H,options:G,Heading:a,headingProps:{id:De,data:W.data},label:s.formatGroupLabel(W.data)}),W.options.map(function(de){return be(de,"".concat(le,"-").concat(de.index))}))}else if(W.type==="option")return be(W,"".concat(W.index))});else if(v){var ze=x({inputValue:S});if(ze===null)return null;tt=C.createElement(h,p,ze)}else{var dt=se({inputValue:S});if(dt===null)return null;tt=C.createElement(f,p,dt)}var P={minMenuHeight:T,maxMenuHeight:I,menuPlacement:N,menuPosition:L,menuShouldScrollIntoView:K},U=C.createElement(kO,Y({},p,P),function(W){var H=W.ref,G=W.placerProps,le=G.placement,J=G.maxHeight;return C.createElement(c,Y({},p,P,{innerRef:H,innerProps:{onMouseDown:s.onMenuMouseDown,onMouseMove:s.onMenuMouseMove},isLoading:v,placement:le}),C.createElement(oM,{captureEnabled:y,onTopArrive:Z,onBottomArrive:ie,lockEnabled:$},function(De){return C.createElement(l,Y({},p,{innerRef:function(An){s.getMenuListRef(An),De(An)},innerProps:{role:"listbox","aria-multiselectable":p.isMulti,id:s.getElementId("listbox")},isLoading:v,maxHeight:J,focusedOption:m}),tt)}))});return j||L==="fixed"?C.createElement(u,Y({},p,{appendTo:j,controlElement:this.controlRef,menuPlacement:N,menuPosition:L}),U):U}},{key:"renderFormField",value:function(){var s=this,i=this.props,o=i.delimiter,a=i.isDisabled,c=i.isMulti,l=i.name,u=i.required,h=this.state.selectValue;if(u&&!this.hasValue()&&!a)return C.createElement(lM,{name:l,onFocus:this.onValueInputFocus});if(!(!l||a))if(c)if(o){var f=h.map(function(m){return s.getOptionValue(m)}).join(o);return C.createElement("input",{name:l,type:"hidden",value:f})}else{var d=h.length>0?h.map(function(m,g){return C.createElement("input",{key:"i-".concat(g),name:l,type:"hidden",value:s.getOptionValue(m)})}):C.createElement("input",{name:l,type:"hidden",value:""});return C.createElement("div",null,d)}else{var p=h[0]?this.getOptionValue(h[0]):"";return C.createElement("input",{name:l,type:"hidden",value:p})}}},{key:"renderLiveRegion",value:function(){var s=this.commonProps,i=this.state,o=i.ariaSelection,a=i.focusedOption,c=i.focusedValue,l=i.isFocused,u=i.selectValue,h=this.getFocusableOptions();return C.createElement(Yk,Y({},s,{id:this.getElementId("live-region"),ariaSelection:o,focusedOption:a,focusedValue:c,isFocused:l,selectValue:u,focusableOptions:h,isAppleDevice:this.isAppleDevice}))}},{key:"render",value:function(){var s=this.getComponents(),i=s.Control,o=s.IndicatorsContainer,a=s.SelectContainer,c=s.ValueContainer,l=this.props,u=l.className,h=l.id,f=l.isDisabled,d=l.menuIsOpen,p=this.state.isFocused,m=this.commonProps=this.getCommonProps();return C.createElement(a,Y({},m,{className:u,innerProps:{id:h,onKeyDown:this.onKeyDown},isDisabled:f,isFocused:p}),this.renderLiveRegion(),C.createElement(i,Y({},m,{innerRef:this.getControlRef,innerProps:{onMouseDown:this.onControlMouseDown,onTouchEnd:this.onControlTouchEnd},isDisabled:f,isFocused:p,menuIsOpen:d}),C.createElement(c,Y({},m,{isDisabled:f}),this.renderPlaceholderOrValue(),this.renderInput()),C.createElement(o,Y({},m,{isDisabled:f}),this.renderClearIndicator(),this.renderLoadingIndicator(),this.renderIndicatorSeparator(),this.renderDropdownIndicator())),this.renderMenu(),this.renderFormField())}}],[{key:"getDerivedStateFromProps",value:function(s,i){var o=i.prevProps,a=i.clearFocusValueOnUpdate,c=i.inputIsHiddenAfterUpdate,l=i.ariaSelection,u=i.isFocused,h=i.prevWasFocused,f=i.instancePrefix,d=s.options,p=s.value,m=s.menuIsOpen,g=s.inputValue,y=s.isMulti,S=Nf(p),v={};if(o&&(p!==o.value||d!==o.options||m!==o.menuIsOpen||g!==o.inputValue)){var x=m?AM(s,S):[],T=m?Kf(Ws(s,S),"".concat(f,"-option")):[],I=a?EM(i,S):null,M=RM(i,x),N=la(T,M);v={selectValue:S,focusedOption:M,focusedOptionId:N,focusableOptionsWithIds:T,focusedValue:I,clearFocusValueOnUpdate:!1}}var L=c!=null&&s!==o?{inputIsHidden:c,inputIsHiddenAfterUpdate:void 0}:{},j=l,$=u&&h;return u&&!$&&(j={value:ks(y,S,S[0]||null),options:S,action:"initial-input-focus"},$=!h),(l==null?void 0:l.action)==="initial-input-focus"&&(j=null),X(X(X({},v),L),{},{prevProps:s,ariaSelection:j,prevWasFocused:$})}}]),t}(C.Component);Km.defaultProps=SM;var IM=C.forwardRef(function(n,e){var t=qI(n);return C.createElement(Km,Y({ref:e},t))}),PM=IM;const ua=({options:n,value:e,onChange:t,placeholder:r})=>{const s={control:i=>({...i,backgroundColor:"#2a2d2e",border:"1px solid #3a3d3e",borderRadius:"0px",minHeight:"22px",boxShadow:"none","&:hover":{borderColor:"#4a4d4e"}}),menu:i=>({...i,backgroundColor:"#2a2d2e",position:"absolute",width:"100%",maxHeight:"none !important",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e3,border:"1px solid #3a3d3e",borderRadius:"0px",marginTop:"2px"}),option:(i,o)=>({...i,backgroundColor:o.isFocused?"#353839":"#2a2d2e",color:"#d9d7d4",fontSize:"11px",cursor:"pointer",padding:"4px 16px","&:active":{backgroundColor:"#404344"}}),singleValue:i=>({...i,color:"#d9d7d4",fontSize:"11px"}),placeholder:i=>({...i,color:"#7a7a7a",fontSize:"11px"}),dropdownIndicator:i=>({...i,padding:"1px",color:"#7a7a7a","&:hover":{color:"#d9d7d4"}}),indicatorSeparator:()=>({display:"none"}),input:i=>({...i,color:"#d9d7d4",fontSize:"11px"}),menuList:i=>({...i,maxHeight:"none !important",overflow:"visible !important",padding:0,"::-webkit-scrollbar":{width:"8px"},"::-webkit-scrollbar-track":{background:"#2a2d2e"},"::-webkit-scrollbar-thumb":{background:"#3a3d3e",borderRadius:"4px"}})};return B.jsx(PM,{styles:s,options:n,value:e,onChange:t,placeholder:r,isSearchable:!1,components:{IndicatorSeparator:null}})},OM=[{label:"Alle Wochentage",value:0},{label:"Sonntag",value:1},{label:"Montag",value:2},{label:"Dienstag",value:3},{label:"Mittwoch",value:4},{label:"Donnerstag",value:5},{label:"Freitag",value:6},{label:"Samstag",value:7}],kM=[{label:"Alle Länder",value:0},{label:"Schleswig-Holstein",value:1},{label:"Hamburg",value:2},{label:"Niedersachsen",value:3},{label:"Bremen",value:4},{label:"Nordrhein-Westfalen",value:5},{label:"Hessen",value:6},{label:"Rheinland-Pfalz",value:7},{label:"Baden-Württemberg",value:8},{label:"Bayern",value:9},{label:"Saarland",value:10},{label:"Berlin",value:11},{label:"Brandenburg",value:12},{label:"Mecklenburg-Vorpommern",value:13},{label:"Sachsen",value:14},{label:"Sachsen-Anhalt",value:15},{label:"Thüringen",value:16}],MM=[{label:"Alle Unfallkategorien",value:0},{label:"mit Getöteten",value:1},{label:"mit Schwerverletzten",value:2},{label:"mit Leichtverletzten",value:3}],Jf=kM.map(n=>({value:n.value,label:n.label})),Qf=OM.map(n=>({value:n.value,label:n.label})),Gf=MM.map(n=>({value:n.value,label:n.label})),ed=()=>B.jsxs(B.Fragment,{children:[B.jsx("div",{className:"legend-gradient",children:["#0198bd","#49e3ce","#d8feb5","#feedb1","#fead54","#d1374e"].map(n=>B.jsx("div",{className:"legend-step",style:{backgroundColor:n,width:"16.666%"}},n))}),B.jsxs("p",{className:"legend-labels",children:[B.jsx("span",{className:"label-left",children:"Weniger Unfälle"}),B.jsx("span",{className:"label-right",children:"Mehr Unfälle"})]})]}),td={hexagon:{title:"Hexagon Layer",small_desc:"Die Ebene zeigt die Unfalldichte innerhalb jeder hexagon",methodology:["Hexagon radius: 1km","Color scale: Quantile (6 classes)","Upper percentile: 100","Elevation range: 1-3000","Elevation scale: dynamic","Coverage: 0.7"]},heatmap:{title:"Heatmap Layer",small_desc:"Die Ebene visualisiert die Unfallintensität als Farbverläufe",methodology:["Aggregation: SUM","Color scale: Quantile (6 classes)","Intensity: 1.3","Radius: 35px","Threshold: 0.15"]}},NM=({showHex:n,setShowHex:e,filters:t,setFilters:r,dataStats:s})=>{const[i,o]=C.useState(!0),[a,c]=C.useState(!1),[l,u]=C.useState(!1),[h,f]=C.useState(!1),d=C.useRef(null),p=C.useRef(null),m=n?td.hexagon:td.heatmap,g=()=>B.jsx("button",{className:"legend-button",onClick:()=>e(!n),children:n?"Switch to Heatmap":"Switch to Hexagon"}),y=()=>{o(!i),i||(c(!1),u(!1))},S=()=>{c(!a),a||(o(!1),u(!1))},v=()=>{u(!l),l||(o(!1),c(!1))},x=I=>I?I>=1e3?`${(I/1e3).toFixed(1)}K`:I.toString():"0",T=()=>{if(!d.current||!p.current)return;const I=d.current.offsetWidth,M=p.current.offsetWidth,N=I-M-8;d.current.style.setProperty("--travel-distance",`${N}px`),f(!0),r({uland:null,uwochentag:null,ukategorie:null,ist_rad:null,ist_pkw:null,ist_fuss:null}),setTimeout(()=>f(!1),1200)};return B.jsxs("div",{className:"panel-container",children:[B.jsxs("div",{className:"panel-block",children:[B.jsxs("div",{className:"panel-header",onClick:y,children:[B.jsx("div",{className:"panel-title",children:"Deutschland Verkehrsunfälle"}),B.jsx("div",{className:"panel-expander",children:i?"×":"i"})]}),i&&B.jsxs("div",{className:"panel-content",children:[B.jsxs("div",{className:"description-block",children:[B.jsx("h2",{className:"dataset-title",children:m.title}),B.jsx("p",{className:"dataset",children:m.small_desc}),B.jsx(ed,{}),B.jsx("h4",{className:"dataset",children:"Methodologie"}),B.jsx("ul",{className:"dataset",children:m.methodology.map((I,M)=>B.jsx("li",{children:I},M))})]}),B.jsx(g,{})]})]}),B.jsxs("div",{className:"panel-block filters-block",children:[B.jsxs("div",{className:"panel-header",onClick:S,children:[B.jsx("div",{className:"panel-title",children:"Filter"}),B.jsx("div",{className:"panel-expander",children:a?"×":"⚙️"})]}),a&&B.jsxs("div",{className:"panel-content",children:[B.jsx(ed,{}),B.jsx("h2",{className:"data-stats-accidents",children:"Unfälle"}),B.jsxs("div",{className:"stats-grid",children:[B.jsxs("div",{className:"stat-item",children:[B.jsx("div",{className:"stat-label",children:"Gesamt "}),B.jsx("div",{className:"stat-value",children:x(s.total)})]}),B.jsxs("div",{className:"stat-item",children:[B.jsx("div",{className:"stat-label",children:"Gefiltert"}),B.jsx("div",{className:"stat-value",children:x(s.filtered)})]})]}),B.jsxs("div",{className:"description-block",children:[B.jsxs("div",{className:"filter-group",children:[B.jsx("label",{children:"Land:"}),B.jsx(ua,{options:Jf,value:t.uland?Jf.find(I=>I.value===t.uland):null,onChange:I=>r(M=>({...M,uland:I?I.value:null})),placeholder:"Alle Länder"})]}),B.jsxs("div",{className:"filter-group",children:[B.jsx("label",{children:"Wochentag:"}),B.jsx(ua,{options:Qf,value:t.uwochentag?Qf.find(I=>I.value===t.uwochentag):null,onChange:I=>r(M=>({...M,uwochentag:I?I.value:null})),placeholder:"Alle Wochentagen"})]}),B.jsxs("div",{className:"filter-group",children:[B.jsx("label",{children:"Unfallkategorien:"}),B.jsx(ua,{options:Gf,value:t.ukategorie?Gf.find(I=>I.value===t.ukategorie):null,onChange:I=>r(M=>({...M,ukategorie:I?I.value:null})),placeholder:"Alle Unfallkategorien"})]}),B.jsxs("div",{className:"filter-group",children:[B.jsx("label",{children:"Unfall mit Rad:"}),B.jsxs("div",{className:`toggle-switch ${t.ist_rad===1?"active":""}`,onClick:()=>r({...t,ist_rad:t.ist_rad===1?0:1}),children:[B.jsx("div",{className:"toggle-knob"}),B.jsx("span",{className:"toggle-label",children:t.ist_rad===1?"mit Fahrradbeteiligung":"ohne Fahrradbeteiligung"})]})]}),B.jsxs("div",{className:"filter-group",children:[B.jsx("label",{children:"Unfall mit Pkw:"}),B.jsxs("div",{className:`toggle-switch ${t.ist_pkw===1?"active":""}`,onClick:()=>r({...t,ist_pkw:t.ist_pkw===1?0:1}),children:[B.jsx("div",{className:"toggle-knob"}),B.jsx("span",{className:"toggle-label",children:t.ist_pkw===1?"mit PKW-Beteiligung":"ohne PKW-Beteiligung"})]})]}),B.jsxs("div",{className:"filter-group",children:[B.jsx("label",{children:"Unfall mit Fußgänger:"}),B.jsxs("div",{className:`toggle-switch ${t.ist_fuss===1?"active":""}`,onClick:()=>r({...t,ist_fuss:t.ist_fuss===1?0:1}),children:[B.jsx("div",{className:"toggle-knob"}),B.jsx("span",{className:"toggle-label",children:t.ist_fuss===1?"mit Fußgängerbeteiligung":"ohne Fußgängerbeteiligung"})]})]}),B.jsx("div",{className:"reset-toggle-container",ref:d,style:{"--travel-distance":"0px"},children:B.jsx("div",{className:`reset-toggle ${h?"animating":""}`,onClick:T,children:B.jsxs("div",{className:"reset-toggle-track",children:[B.jsx("div",{className:"reset-toggle-knob",ref:p}),B.jsx("span",{className:"reset-toggle-label",children:"Filter zurücksetzen"})]})})})]}),B.jsx(g,{})]})]}),B.jsxs("div",{className:"panel-block",children:[B.jsxs("div",{className:"panel-header",onClick:v,children:[B.jsx("div",{className:"panel-title",children:"Infos zum Datensatz"}),B.jsx("div",{className:"panel-expander",children:l?"×":"i"})]}),l&&B.jsx("div",{className:"panel-content",children:B.jsxs("div",{className:"description-block",children:[B.jsx("h4",{children:"Über den Datensatz"}),B.jsxs("p",{className:"dataset",children:["In der Straßenverkehrsunfallstatistik werden alle polizeilich erfassten Unfälle mit Personen- oder Sachschäden auf öffentlichen Straßen und Plätzen erfasst. ",B.jsx("br",{}),B.jsx("br",{}),"Der Datensatz enthält Daten über Unfallopfer nach Alter, Fahrzeugtyp (z. B. Auto-, Motorrad- oder Busunfälle) und Unfallursachen. Fahrerbedingte Gründe wie Alkoholfahrten oder Raserei weisen wir ebenso nach wie Verkehrsunfälle durch Eisglätte, Nebel oder Wildunfälle. ",B.jsx("br",{}),B.jsx("br",{})," Neben den Straßenverkehrsunfällen veröffentlichen wir auch Daten zu Unfällen mit Fußgängern, Radfahrern und neuerdings auch zu Unfällen mit Elektrorollern.",B.jsx("br",{}),B.jsx("br",{}),"Es wurden nicht alle Felder für die Filterung angewandt, es fehlen Vorfälle mit Kraftrad, Güterkraftfahrzeug, Sonstigen sowie gibt es keine Filterung nach den folgenden Werten: Straßenzustand, Lichtverhältnisse, Unfalltyp und Unfallart."]}),B.jsxs("p",{children:["Datenquelle: ",B.jsx("a",{href:"https://www.destatis.de/DE/Home/_inhalt.html",target:"_blank",rel:"noopener noreferrer",children:"Destatis"})]})]})})]})]})},DM="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",FM=`${DM}`,UM={longitude:10.4,latitude:51.1,zoom:5.5,maxZoom:16,minZoom:6,pitch:33,bearing:0},ZM=()=>{const{state:n,loadPartitions:e}=DI(),{loading:t,errors:r,initialFeatures:s,initialLoadTime:i,loadingAttributes:o,fullFeatures:a,fullLoadTime:c}=n,[l,u]=C.useState(null),[h,f]=C.useState(!0),[d,p]=C.useState(0),[m,g]=C.useState({}),[y,S]=C.useState(!1);C.useEffect(()=>{(async()=>{u(performance.now());const L=Array.from({length:16},(j,$)=>`unfallatlas_uland_${String($+1).padStart(2,"0")}`);await e(L)})();const N=setTimeout(()=>p(50),2500);return()=>clearTimeout(N)},[e]),C.useEffect(()=>{a&&a.length>0&&S(!0)},[a]);const v=C.useMemo(()=>y?a:s,[y,a,s]),x=C.useMemo(()=>!m.uland&&!m.uwochentag&&!m.ukategorie&&!m.ist_rad&&!m.ist_pkw&&!m.ist_fuss?v.map(M=>({latitude:M.latitude,longitude:M.longitude})):v.filter(M=>{const N=M.properties,L=!m.uland||Number(N.uland)===Number(m.uland),j=!m.uwochentag||Number(N.uwochentag)===Number(m.uwochentag),$=!m.ukategorie||Number(N.ukategorie)===Number(m.ukategorie),K=!m.ist_rad||Number(N.ist_rad)===Number(m.ist_rad),se=!m.ist_pkw||Number(N.ist_pkw)===Number(m.ist_pkw),Z=!m.ist_fuss||Number(N.ist_fuss)===Number(m.ist_fuss);return L&&j&&$&&K&&se&&Z}).map(M=>({latitude:M.latitude,longitude:M.longitude})),[v,m]),T=C.useMemo(()=>{const M={data:x,getPosition:N=>[N.longitude,N.latitude],colorRange:VI,updateTriggers:{getPosition:[x?x.length:0],elevationScale:[d]}};return h?[new Gc({id:"hexagon-layer",...M,coverage:.8,gpuAggregation:!0,radius:1e3,elevationRange:[1,3e3],elevationScale:d,extruded:!0,pickable:!0,upperPercentile:100,material:{ambient:.64,diffuse:.6,shininess:32,specularColor:[51,51,51]},transitions:{elevationScale:3e3}})]:[new el({id:"heatmap-layer",...M,radiusPixels:35,intensity:1.3,threshold:.15})]},[x,h,d]);function I(M){var K,se,Z;if(!M||typeof M!="object")return null;const N=Array.isArray(M.coordinate)&&M.coordinate.length===2&&!isNaN(M.coordinate[0])&&!isNaN(M.coordinate[1])&&Math.abs(M.coordinate[0])<=180&&Math.abs(M.coordinate[1])<=90,L=Array.isArray(M.pixel)&&M.pixel.length===2&&M.pixel[0]>=0&&M.pixel[1]>=0;if(!N||!L)return null;const j=((se=(K=M.object)==null?void 0:K.points)==null?void 0:se.length)||((Z=M.object)==null?void 0:Z.count)||0;return j<=0?null:{html:`<div className="tooltip-container">${j} ${j===1?"Unfall":"Unfälle"}</div>`}}return B.jsx("div",{style:{display:"flex",height:"70vh"},children:B.jsxs(q2,{initialViewState:UM,controller:!0,layers:T,getTooltip:I,effects:[LI],children:[B.jsx(aE,{reuseMaps:!0,mapStyle:FM}),t&&B.jsx("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",color:"white",padding:"10px",borderRadius:"5px",zIndex:100},children:"Data loading..."}),B.jsx(NM,{showHex:h,setShowHex:f,filters:m,setFilters:g,dataStats:{total:a.length,filtered:x.length}}),B.jsxs("div",{className:"rotate-shift",children:["Hold down shift to rotate ",B.jsx("br",{}),"Zum Drehen Umschalttaste gedrückt halten"]})]})})};export{ZM as S,c_ as a,rd as g,B as j,sd as r};
